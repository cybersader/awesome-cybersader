(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>A});const n=require("obsidian"),i=["note","abstract","info","todo","tip","success","question","warning","failure","danger","bug","example","quote"];const l="callout-manager";async function o(t){var e;if((null!=(e=t.app)?e:globalThis.app).plugins.enabledPlugins.has(l))return function(t){var e,n,i,o,a;return n=this,i=void 0,a=function*(){const n=null!==(e=null==t?void 0:t.app)&&void 0!==e?e:globalThis.app,{plugins:i}=n;if(!i.enabledPlugins.has(l))return;const o=yield new Promise(((t,e)=>{const n=i.plugins[l];if(void 0!==n)return t(n);const o=setInterval((()=>{const e=i.plugins[l];void 0!==e&&(clearInterval(o),t(e))}),10)}));return o.newApiHandle("v1",t,(()=>{o.destroyApiHandle("v1",t)}))},new((o=void 0)||(o=Promise))((function(t,e){function l(t){try{r(a.next(t))}catch(t){e(t)}}function s(t){try{r(a.throw(t))}catch(t){e(t)}}function r(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(l,s)}r((a=a.apply(n,i||[])).next())}))}(t)}function a(t){return`wrap-lines-in-${t}-callout`}function s(t){return t[t.length-1]}function r(t,e){return t.filter((t=>!e.has(t)))}function u(t){throw new Error(`Unexpected value: ${t}`)}function c(t,e){const n=function(t,e){const n=t.exec(e);return n?.[1]}(t,e);return n?.trim()}function d(t){return t.split("\n")}function g(t){return`${t.charAt(0).toUpperCase()}${t.slice(1).toLowerCase()}`}const h=/^> \[!(.+)\]/,f=/^> \[!.+\][+-]? (.+)/,p=/^#+ (.+)/;function m({calloutID:t,maybeExplicitTitle:e,pluginSettingsManager:n}){const i=function(t,e){const n=function(t,e){const n=e.getSetting("calloutIDCapitalization");switch(n){case"lower":return t.toLowerCase();case"upper":return t.toUpperCase();case"sentence":return g(t);case"title":return t.split("-").map((t=>g(t))).join("-");default:u(n)}}(t,e);return`> [!${n}]`}(t,n),l=function(t){const e=t.getSetting("defaultFoldableState");switch(e){case"unfoldable":return"";case"foldable-expanded":return"+";case"foldable-collapsed":return"-";default:u(e)}}(n);return`${i}${l}${null!==e?` ${e}`:""}`}function C(t){return g(t).replace(/-/g," ")}function S({editor:t,selectedLinesDiff:e,originalCursorPositions:n,selectedLinesRange:i}){const l=function({originalCursorPositions:t,selectedLinesDiff:e}){const{from:n,to:i}=t,l=function({oldFrom:t,selectedLinesDiff:e}){const{oldLines:n,newLines:i}=e;if(n.length!==i.length)return{line:t.line,ch:0};const l={oldLine:n[0],newLine:i[0]},o=b({oldCh:t.ch,lineDiff:l});return{line:t.line,ch:o}}({oldFrom:n,selectedLinesDiff:e}),o=function({oldTo:t,selectedLinesDiff:e}){const{oldLines:n,newLines:i}=e,l=i.length-n.length,o=t.line+l,a={oldLine:s(n),newLine:s(i)};return{line:o,ch:b({oldCh:t.ch,lineDiff:a})}}({oldTo:i,selectedLinesDiff:e});return{from:l,to:o}}({originalCursorPositions:n,selectedLinesDiff:e}),o=e.newLines.join("\n");t.replaceRange(o,i.from,i.to),function(t,e,n){const{newAnchor:i,newHead:l}=function(t,e){const{from:n,to:i}=e;return function({anchor:t,head:e}){return e.line<t.line||e.line===t.line&&e.ch<t.ch}(t)?{newAnchor:i,newHead:n}:{newAnchor:n,newHead:i}}(e,n);t.setSelection(i,l)}(t,n,l)}function b({oldCh:t,lineDiff:e}){const{oldLine:n,newLine:i}=e,l=n.length-i.length;return Math.clamp(t-l,0,i.length)}function y(t){const{from:e,to:n}=function(t){const{from:e,to:n}=w(t);return{from:{line:e.line,ch:0},to:{line:n.line,ch:t.getLine(n.line).length}}}(t);return{selectedLinesRange:{from:e,to:n},selectedLinesText:t.getRange(e,n)}}function L(t){const{anchor:e,head:n}=function(t){return{anchor:t.getCursor("anchor"),head:t.getCursor("head")}}(t),{from:i,to:l}=w(t);return{anchor:e,head:n,from:i,to:l}}function w(t){return{from:t.getCursor("from"),to:t.getCursor("to")}}const D={id:"remove-callout-from-selected-lines",name:"Remove callout from selected lines",editorCheckCallback:(I=function(t){const e=L(t),{selectedLinesRange:n,selectedLinesText:i}=y(t),l=d(i),{calloutID:o,maybeExplicitTitle:a}=function(t){const e=function(t){const e=function(t){return c(h,t)}(t);if(void 0===e)throw new Error("Callout ID not found in callout text.");return e}(t),n=function(t){return c(f,t)}(t);return{calloutID:e,maybeExplicitTitle:n}}(i),s=function({calloutID:t,maybeExplicitTitle:e,selectedLines:n}){return void 0!==e&&function({calloutID:t,title:e}){return""!==e&&e!==C(t)}({calloutID:t,title:e})?function(t,e){return[`###### ${t}`,...e.slice(1).map((t=>t.replace(/^> /,"")))]}(e,n):function(t){const e=t.slice(1).map((t=>t.replace(/^> /,"")));return e.length>0?e:[""]}(n)}({calloutID:o,maybeExplicitTitle:a,selectedLines:l});S({editor:t,selectedLinesDiff:{oldLines:l,newLines:s},originalCursorPositions:e,selectedLinesRange:n})},(t,e,n)=>!!e.somethingSelected()&&!!function(t){const{selectedLinesText:e}=y(t);return h.test(e)}(e)&&function(t,e,n){return n||t(e),!0}(I,e,t))};var I;function v(t,e,n){const i=L(t),{selectedLinesRange:l,selectedLinesText:o}=y(t),a=d(o),{maybeExplicitTitle:s,rawBodyLines:r}=function(t,e,n){const[i,...l]=e,o=function({firstSelectedLine:t}){const e=function(t){return c(p,t)}(t);if(""!==e&&void 0!==e)return e}({firstSelectedLine:i});if(void 0===o){const i=function(t,e){return e.getSetting("shouldUseExplicitTitle")?C(t):null}(t,n);return{maybeExplicitTitle:i,rawBodyLines:e}}return{maybeExplicitTitle:o,rawBodyLines:l}}(e,a,n),u=function({calloutID:t,maybeExplicitTitle:e,rawBodyLines:n,pluginSettingsManager:i}){return[m({calloutID:t,maybeExplicitTitle:e,pluginSettingsManager:i}),...n.map((t=>`> ${t}`))]}({calloutID:e,maybeExplicitTitle:s,rawBodyLines:r,pluginSettingsManager:n});S({editor:t,selectedLinesDiff:{oldLines:a,newLines:u},originalCursorPositions:i,selectedLinesRange:l})}function T(t,e){return{id:a(t),name:`Wrap lines in ${t} callout`,editorCallback:n=>function(t,e,n){t.somethingSelected()?v(t,e,n):function({editor:t,calloutID:e,pluginSettingsManager:n}){const i=t.getCursor(),{line:l}=i,o=t.getLine(l),a=function(t,e,n){const i=function(t,e){return m({calloutID:t,maybeExplicitTitle:e.getSetting("shouldUseExplicitTitle")?C(t):null,pluginSettingsManager:e})}(t,n);return`${i}\n> ${e}`}(e,o,n);t.replaceRange(a,{line:l,ch:0},{line:l,ch:o.length}),function({editor:t,oldCursor:e,lineText:n,pluginSettingsManager:i}){i.getSetting("shouldSetSelectionAfterCurrentLineWrap")?function({editor:t,oldCursor:{line:e,ch:n},lineText:i}){const l={line:e,ch:0},o=i.length+2,a={line:e+1,ch:Math.min(n+3,o)};t.setSelection(l,a)}({editor:t,oldCursor:e,lineText:n}):function(t,e){const{line:n,ch:i}=e;t.setCursor({line:n+1,ch:i+2})}(t,e)}({editor:t,oldCursor:i,lineText:o,pluginSettingsManager:n})}({editor:t,calloutID:e,pluginSettingsManager:n})}(n,t,e)}}class x{constructor(t,e){this.plugin=t,this.pluginSettingsManager=e,this.addedCommandCalloutIDsSet=new Set,this.onCalloutManagerChange=this.resyncCalloutCommands.bind(this)}onPluginUnload(){void 0!==this.calloutManager&&this.calloutManager.off("change",this.onCalloutManagerChange)}async setupCommands(){await this.setupCalloutManagerIfInstalled(),this.addAllCommands()}async setupCalloutManagerIfInstalled(){const t=await o(this.plugin);void 0!==t&&(this.calloutManager=t,this.calloutManager.on("change",this.onCalloutManagerChange))}resyncCalloutCommands(){const t=this.getAllCalloutIDs();this.removeOutdatedCalloutCommands(t),this.addMissingCalloutCommands(t)}getAllCalloutIDs(){return void 0===this.calloutManager?i:this.calloutManager.getCallouts().map((t=>t.id))}removeOutdatedCalloutCommands(t){r(Array.from(this.addedCommandCalloutIDsSet),new Set(t)).forEach((t=>this.removeWrapLinesInCalloutCommand(t)))}removeWrapLinesInCalloutCommand(t){const e=function({pluginID:t,calloutID:e}){return function(t,e){return`${t}:${e}`}(t,a(e))}({pluginID:this.plugin.manifest.id,calloutID:t});this.removeCommand({fullCommandID:e}),this.addedCommandCalloutIDsSet.delete(t)}addMissingCalloutCommands(t){r(t,this.addedCommandCalloutIDsSet).forEach((t=>this.addWrapLinesInCalloutCommand(t)))}addAllCommands(){this.addAllWrapLinesInCalloutCommands(),this.addCommand(D)}addAllWrapLinesInCalloutCommands(){this.getAllCalloutIDs().forEach((t=>this.addWrapLinesInCalloutCommand(t)))}addWrapLinesInCalloutCommand(t){const e=T(t,this.pluginSettingsManager);this.addCommand(e),this.addedCommandCalloutIDsSet.add(t)}addCommand(t){this.plugin.addCommand(t)}removeCommand({fullCommandID:t}){this.plugin.app.commands.removeCommand(t)}}const E={shouldUseExplicitTitle:!0,calloutIDCapitalization:"lower",defaultFoldableState:"unfoldable",shouldSetSelectionAfterCurrentLineWrap:!1};class M extends n.PluginSettingTab{constructor(t){super(t.app,t),this.plugin=t,this.settings=Object.assign({},E)}async setupSettingsTab(){this.settings=await this.loadSettings(),this.addSettingTab()}async loadSettings(){const t=await this.plugin.loadData();return Object.assign({},E,t)}addSettingTab(){this.plugin.addSettingTab(this)}getSetting(t){return this.settings[t]}async setSetting(t,e){this.settings[t]=e,await this.saveSettings()}display(){const{containerEl:t}=this;t.empty(),this.displayExplicitCalloutTitlesSetting(),this.displayCalloutIDCapitalizationSetting(),this.displayDefaultFoldableStateSetting(),this.displaySelectTextAfterInsertingCalloutSetting()}displayExplicitCalloutTitlesSetting(){new n.Setting(this.containerEl).setName("Explicit callout titles").setDesc("Whether inserted callouts should have an explicit or implicit title by default. E.g. `> [!quote] Quote` vs `> [!quote]`.").addToggle((t=>t.setValue(this.settings.shouldUseExplicitTitle).onChange((t=>this.setSetting("shouldUseExplicitTitle",t)))))}displayCalloutIDCapitalizationSetting(){new n.Setting(this.containerEl).setName("Callout ID capitalization").setDesc("The default capitalization for inserted callout IDs. E.g. `> [!quote]` vs `> [!QUOTE]`.").addDropdown((t=>t.addOption("lower","lower-case").addOption("upper","UPPER-CASE").addOption("sentence","Sentence-case").addOption("title","Title-Case").setValue(this.settings.calloutIDCapitalization).onChange((t=>this.setSetting("calloutIDCapitalization",t)))))}displayDefaultFoldableStateSetting(){new n.Setting(this.containerEl).setName("Foldable callouts").setDesc("The default folded state for inserted callouts: unfoldable, expanded, or collapsed. E.g. `> [!quote]` vs `> [!quote]+` vs `> [!quote]-`.").addDropdown((t=>t.addOption("unfoldable","Unfoldable").addOption("foldable-expanded","Foldable, expanded").addOption("foldable-collapsed","Foldable, collapsed").setValue(this.settings.defaultFoldableState).onChange((t=>this.setSetting("defaultFoldableState",t)))))}displaySelectTextAfterInsertingCalloutSetting(){new n.Setting(this.containerEl).setName("Select text after inserting callout").setDesc("Whether to auto-select text, after inserting a callout with no text selected. Leave disabled if you'd prefer to be able to keep typing content after inserting/wrapping.").addToggle(this.setupSetSelectionToggle.bind(this))}setupSetSelectionToggle(t){return(t=t.setValue(this.settings.shouldSetSelectionAfterCurrentLineWrap)).onChange(this.setSetting.bind(this,"shouldSetSelectionAfterCurrentLineWrap"))}async saveSettings(){await this.plugin.saveData(this.settings)}}class A extends n.Plugin{constructor(){super(...arguments),this.pluginSettingsManager=new M(this),this.pluginCommandManager=new x(this,this.pluginSettingsManager)}logInfo(t){console.log(`${this.manifest.name}: ${t}`)}async onload(){await this.pluginSettingsManager.setupSettingsTab(),this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this))}async onLayoutReady(){await this.pluginCommandManager.setupCommands()}onunload(){this.pluginCommandManager.onPluginUnload()}}var P=exports;for(var O in e)P[O]=e[O];e.__esModule&&Object.defineProperty(P,"__esModule",{value:!0})})();
/* nosourcemap */
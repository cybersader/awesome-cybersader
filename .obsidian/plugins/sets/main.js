/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var gs=Object.create;var Jt=Object.defineProperty,hs=Object.defineProperties,ys=Object.getOwnPropertyDescriptor,bs=Object.getOwnPropertyDescriptors,vs=Object.getOwnPropertyNames,kn=Object.getOwnPropertySymbols,ws=Object.getPrototypeOf,Cr=Object.prototype.hasOwnProperty,ti=Object.prototype.propertyIsEnumerable;var Sr=(e,t,n)=>t in e?Jt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,F=(e,t)=>{for(var n in t||(t={}))Cr.call(t,n)&&Sr(e,n,t[n]);if(kn)for(var n of kn(t))ti.call(t,n)&&Sr(e,n,t[n]);return e},M=(e,t)=>hs(e,bs(t));var ni=(e,t)=>{var n={};for(var r in e)Cr.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&kn)for(var r of kn(e))t.indexOf(r)<0&&ti.call(e,r)&&(n[r]=e[r]);return n};var xs=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),$s=(e,t)=>{for(var n in t)Jt(e,n,{get:t[n],enumerable:!0})},ri=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of vs(t))!Cr.call(e,i)&&i!==n&&Jt(e,i,{get:()=>t[i],enumerable:!(r=ys(t,i))||r.enumerable});return e};var _s=(e,t,n)=>(n=e!=null?gs(ws(e)):{},ri(t||!e||!e.__esModule?Jt(n,"default",{value:e,enumerable:!0}):n,e)),Ss=e=>ri(Jt({},"__esModule",{value:!0}),e);var Oe=(e,t,n)=>(Sr(e,typeof t!="symbol"?t+"":t,n),n);var Y=(e,t,n)=>new Promise((r,i)=>{var o=l=>{try{a(n.next(l))}catch(u){i(u)}},s=l=>{try{a(n.throw(l))}catch(u){i(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(o,s);a((n=n.apply(e,t)).next())});var io=xs((zn,ro)=>{(function(e,t){typeof zn=="object"&&typeof ro!="undefined"?t(zn):typeof define=="function"&&define.amd?define(["exports"],t):t((e=typeof globalThis!="undefined"?globalThis:e||self).Sqrl={})})(zn,function(e){"use strict";function t(p){var g,x,y=new Error(p);return g=y,x=t.prototype,Object.setPrototypeOf?Object.setPrototypeOf(g,x):g.__proto__=x,y}function n(p,g,x){var y=g.slice(0,x).split(/\n/),$=y.length,L=y[$-1].length+1;throw t(p+=" at line "+$+" col "+L+`:

  `+g.split(/\n/)[$-1]+`
  `+Array(L).join(" ")+"^")}t.prototype=Object.create(Error.prototype,{name:{value:"Squirrelly Error",enumerable:!1}});var r=new Function("return this")().Promise,i=!1;try{i=new Function("return (async function(){}).constructor")()}catch(p){if(!(p instanceof SyntaxError))throw p}function o(p,g){return Object.prototype.hasOwnProperty.call(p,g)}function s(p,g,x){for(var y in g)o(g,y)&&(g[y]==null||typeof g[y]!="object"||y!=="storage"&&y!=="prefixes"||x?p[y]=g[y]:p[y]=s({},g[y]));return p}var a=/^async +/,l=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,u=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,c=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g,f=/[.*+\-?^${}()|[\]\\]/g;function d(p){return f.test(p)?p.replace(f,"\\$&"):p}function h(p,g){g.rmWhitespace&&(p=p.replace(/[\r\n]+/g,`
`).replace(/^\s+|\s+$/gm,"")),l.lastIndex=0,u.lastIndex=0,c.lastIndex=0;var x=g.prefixes,y=[x.h,x.b,x.i,x.r,x.c,x.e].reduce(function(ke,J){return ke&&J?ke+"|"+d(J):J?d(J):ke},""),$=new RegExp("([|()]|=>)|('|\"|`|\\/\\*)|\\s*((\\/)?(-|_)?"+d(g.tags[1])+")","g"),L=new RegExp("([^]*?)"+d(g.tags[0])+"(-|_)?\\s*("+y+")?\\s*","g"),K=0,ie=!1;function fe(ke,J){var ge,me={f:[]},Pe=0,de="c";function et(Gt){var Xt=p.slice(K,Gt),Ne=Xt.trim();if(de==="f")Ne==="safe"?me.raw=!0:g.async&&a.test(Ne)?(Ne=Ne.replace(a,""),me.f.push([Ne,"",!0])):me.f.push([Ne,""]);else if(de==="fp")me.f[me.f.length-1][1]+=Ne;else if(de==="err"){if(Ne){var ut=Xt.search(/\S/);n("invalid syntax",p,K+ut)}}else me[de]=Ne;K=Gt+1}for(J==="h"||J==="b"||J==="c"?de="n":J==="r"&&(me.raw=!0,J="i"),$.lastIndex=K;(ge=$.exec(p))!==null;){var tt=ge[1],vt=ge[2],xr=ge[3],Sn=ge[4],Cn=ge[5],ce=ge.index;if(tt)tt==="("?(Pe===0&&(de==="n"?(et(ce),de="p"):de==="f"&&(et(ce),de="fp")),Pe++):tt===")"?--Pe===0&&de!=="c"&&(et(ce),de="err"):Pe===0&&tt==="|"?(et(ce),de="f"):tt==="=>"&&(et(ce),K+=1,de="res");else if(vt)if(vt==="/*"){var wt=p.indexOf("*/",$.lastIndex);wt===-1&&n("unclosed comment",p,ge.index),$.lastIndex=wt+2}else vt==="'"?(u.lastIndex=ge.index,u.exec(p)?$.lastIndex=u.lastIndex:n("unclosed string",p,ge.index)):vt==='"'?(c.lastIndex=ge.index,c.exec(p)?$.lastIndex=c.lastIndex:n("unclosed string",p,ge.index)):vt==="`"&&(l.lastIndex=ge.index,l.exec(p)?$.lastIndex=l.lastIndex:n("unclosed string",p,ge.index));else if(xr)return et(ce),K=ce+ge[0].length,L.lastIndex=K,ie=Cn,Sn&&J==="h"&&(J="s"),me.t=J,me}return n("unclosed tag",p,ke),me}var pe=function ke(J,ge){J.b=[],J.d=[];var me,Pe=!1,de=[];function et(ut,ps){ut&&(ut=function(Le,Qt,$r,_r){var ft,dt;return typeof Qt.autoTrim=="string"?ft=dt=Qt.autoTrim:Array.isArray(Qt.autoTrim)&&(ft=Qt.autoTrim[1],dt=Qt.autoTrim[0]),($r||$r===!1)&&(ft=$r),(_r||_r===!1)&&(dt=_r),ft==="slurp"&&dt==="slurp"?Le.trim():(ft==="_"||ft==="slurp"?Le=String.prototype.trimLeft?Le.trimLeft():Le.replace(/^[\s\uFEFF\xA0]+/,""):ft!=="-"&&ft!=="nl"||(Le=Le.replace(/^(?:\n|\r|\r\n)/,"")),dt==="_"||dt==="slurp"?Le=String.prototype.trimRight?Le.trimRight():Le.replace(/[\s\uFEFF\xA0]+$/,""):dt!=="-"&&dt!=="nl"||(Le=Le.replace(/(?:\n|\r|\r\n)$/,"")),Le)}(ut,g,ie,ps))&&(ut=ut.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),de.push(ut))}for(;(me=L.exec(p))!==null;){var tt,vt=me[1],xr=me[2],Sn=me[3]||"";for(var Cn in x)if(x[Cn]===Sn){tt=Cn;break}et(vt,xr),K=me.index+me[0].length,tt||n("unrecognized tag type: "+Sn,p,K);var ce=fe(me.index,tt),wt=ce.t;if(wt==="h"){var Gt=ce.n||"";g.async&&a.test(Gt)&&(ce.a=!0,ce.n=Gt.replace(a,"")),ce=ke(ce),de.push(ce)}else if(wt==="c"){if(J.n===ce.n)return Pe?(Pe.d=de,J.b.push(Pe)):J.d=de,J;n("Helper start and end don't match",p,me.index+me[0].length)}else if(wt==="b"){Pe?(Pe.d=de,J.b.push(Pe)):J.d=de;var Xt=ce.n||"";g.async&&a.test(Xt)&&(ce.a=!0,ce.n=Xt.replace(a,"")),Pe=ce,de=[]}else if(wt==="s"){var Ne=ce.n||"";g.async&&a.test(Ne)&&(ce.a=!0,ce.n=Ne.replace(a,"")),de.push(ce)}else de.push(ce)}if(!ge)throw t('unclosed helper "'+J.n+'"');return et(p.slice(K,p.length),!1),J.d=de,J}({f:[]},!0);if(g.plugins)for(var $e=0;$e<g.plugins.length;$e++){var je=g.plugins[$e];je.processAST&&(pe.d=je.processAST(pe.d,g))}return pe.d}function C(p,g){var x=h(p,g),y="var tR='';"+(g.useWith?"with("+g.varName+"||{}){":"")+b(x,g)+"if(cb){cb(null,tR)} return tR"+(g.useWith?"}":"");if(g.plugins)for(var $=0;$<g.plugins.length;$++){var L=g.plugins[$];L.processFnString&&(y=L.processFnString(y,g))}return y}function D(p,g){for(var x=0;x<g.length;x++){var y=g[x][0],$=g[x][1];p=(g[x][2]?"await ":"")+"c.l('F','"+y+"')("+p,$&&(p+=","+$),p+=")"}return p}function A(p,g,x,y,$,L){var K="{exec:"+($?"async ":"")+k(x,g,p)+",params:["+y+"]";return L&&(K+=",name:'"+L+"'"),$&&(K+=",async:true"),K+="}"}function w(p,g){for(var x="[",y=0;y<p.length;y++){var $=p[y];x+=A(g,$.res||"",$.d,$.p||"",$.a,$.n),y<p.length&&(x+=",")}return x+="]"}function k(p,g,x){return"function("+g+"){var tR='';"+b(p,x)+"return tR}"}function b(p,g){for(var x=0,y=p.length,$="";x<y;x++){var L=p[x];if(typeof L=="string")$+="tR+='"+L+"';";else{var K=L.t,ie=L.c||"",fe=L.f,pe=L.n||"",$e=L.p||"",je=L.res||"",ke=L.b,J=!!L.a;if(K==="i"){g.defaultFilter&&(ie="c.l('F','"+g.defaultFilter+"')("+ie+")");var ge=D(ie,fe);!L.raw&&g.autoEscape&&(ge="c.l('F','e')("+ge+")"),$+="tR+="+ge+";"}else if(K==="h")if(g.storage.nativeHelpers.get(pe))$+=g.storage.nativeHelpers.get(pe)(L,g);else{var me=(J?"await ":"")+"c.l('H','"+pe+"')("+A(g,je,L.d,$e,J);me+=ke?","+w(ke,g):",[]",$+="tR+="+D(me+=",c)",fe)+";"}else K==="s"?$+="tR+="+D((J?"await ":"")+"c.l('H','"+pe+"')({params:["+$e+"]},[],c)",fe)+";":K==="e"&&($+=ie+`
`)}}return $}var E=function(){function p(g){this.cache=g}return p.prototype.define=function(g,x){this.cache[g]=x},p.prototype.get=function(g){return this.cache[g]},p.prototype.remove=function(g){delete this.cache[g]},p.prototype.reset=function(){this.cache={}},p.prototype.load=function(g){s(this.cache,g,!0)},p}();function v(p,g,x,y){if(g&&g.length>0)throw t((y?"Native":"")+"Helper '"+p+"' doesn't accept blocks");if(x&&x.length>0)throw t((y?"Native":"")+"Helper '"+p+"' doesn't accept filters")}var T={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function I(p){return T[p]}var P=new E({}),H=new E({each:function(p,g){var x="",y=p.params[0];if(v("each",g,!1),p.async)return new Promise(function(L){(function K(ie,fe,pe,$e,je){pe(ie[fe],fe).then(function(ke){$e+=ke,fe===ie.length-1?je($e):K(ie,fe+1,pe,$e,je)})})(y,0,p.exec,x,L)});for(var $=0;$<y.length;$++)x+=p.exec(y[$],$);return x},foreach:function(p,g){var x=p.params[0];if(v("foreach",g,!1),p.async)return new Promise(function(L){(function K(ie,fe,pe,$e,je,ke){$e(fe[pe],ie[fe[pe]]).then(function(J){je+=J,pe===fe.length-1?ke(je):K(ie,fe,pe+1,$e,je,ke)})})(x,Object.keys(x),0,p.exec,"",L)});var y="";for(var $ in x)o(x,$)&&(y+=p.exec($,x[$]));return y},include:function(p,g,x){v("include",g,!1);var y=x.storage.templates.get(p.params[0]);if(!y)throw t('Could not fetch template "'+p.params[0]+'"');return y(p.params[1],x)},extends:function(p,g,x){var y=p.params[1]||{};y.content=p.exec();for(var $=0;$<g.length;$++){var L=g[$];y[L.name]=L.exec()}var K=x.storage.templates.get(p.params[0]);if(!K)throw t('Could not fetch template "'+p.params[0]+'"');return K(y,x)},useScope:function(p,g){return v("useScope",g,!1),p.exec(p.params[0])}}),q=new E({if:function(p,g){v("if",!1,p.f,!0);var x="if("+p.p+"){"+b(p.d,g)+"}";if(p.b)for(var y=0;y<p.b.length;y++){var $=p.b[y];$.n==="else"?x+="else{"+b($.d,g)+"}":$.n==="elif"&&(x+="else if("+$.p+"){"+b($.d,g)+"}")}return x},try:function(p,g){if(v("try",!1,p.f,!0),!p.b||p.b.length!==1||p.b[0].n!=="catch")throw t("native helper 'try' only accepts 1 block, 'catch'");var x="try{"+b(p.d,g)+"}",y=p.b[0];return x+="catch"+(y.res?"("+y.res+")":"")+"{"+b(y.d,g)+"}"},block:function(p,g){return v("block",p.b,p.f,!0),"if(!"+g.varName+"["+p.p+"]){tR+=("+k(p.d,"",g)+")()}else{tR+="+g.varName+"["+p.p+"]}"}}),Q=new E({e:function(p){var g=String(p);return/[&<>"']/.test(g)?g.replace(/[&<>"']/g,I):g}}),oe={varName:"it",autoTrim:[!1,"nl"],autoEscape:!0,defaultFilter:!1,tags:["{{","}}"],l:function(p,g){if(p==="H"){var x=this.storage.helpers.get(g);if(x)return x;throw t("Can't find helper '"+g+"'")}if(p==="F"){var y=this.storage.filters.get(g);if(y)return y;throw t("Can't find filter '"+g+"'")}},async:!1,storage:{helpers:H,nativeHelpers:q,filters:Q,templates:P},prefixes:{h:"@",b:"#",i:"",r:"*",c:"/",e:"!"},cache:!1,plugins:[],useWith:!1};function ye(p,g){var x={};return s(x,oe),g&&s(x,g),p&&s(x,p),x.l.bind(x),x}function O(p,g){var x=ye(g||{}),y=Function;if(x.async){if(!i)throw t("This environment doesn't support async/await");y=i}try{return new y(x.varName,"c","cb",C(p,x))}catch($){throw $ instanceof SyntaxError?t(`Bad template syntax

`+$.message+`
`+Array($.message.length+1).join("=")+`
`+C(p,x)):$}}function j(p,g){var x;return g.cache&&g.name&&g.storage.templates.get(g.name)?g.storage.templates.get(g.name):(x=typeof p=="function"?p:O(p,g),g.cache&&g.name&&g.storage.templates.define(g.name,x),x)}oe.l.bind(oe),e.compile=O,e.compileScope=b,e.compileScopeIntoFunction=k,e.compileToString=C,e.defaultConfig=oe,e.filters=Q,e.getConfig=ye,e.helpers=H,e.nativeHelpers=q,e.parse=h,e.render=function(p,g,x,y){var $=ye(x||{});if(!$.async)return j(p,$)(g,$);if(!y){if(typeof r=="function")return new r(function(L,K){try{L(j(p,$)(g,$))}catch(ie){K(ie)}});throw t("Please provide a callback function, this env doesn't support Promises")}try{j(p,$)(g,$,y)}catch(L){return y(L)}},e.templates=P,Object.defineProperty(e,"__esModule",{value:!0})})});var Lc={};$s(Lc,{default:()=>wr,getSetsSettings:()=>xe});module.exports=Ss(Lc);var ii={showAtStartup:!1,setsRoot:"Sets",typeSetSuffix:"Set",typesFolder:"Types",typesSuffix:"Type",typeAttributeKey:"type",collectionsRoot:"Collections",collectionAttributeKey:"collection",collectionType:"collection",inferCollectionFieldsByDefault:!0,inferSetFieldsByDefault:!1,inferQueryFieldsByDefault:!1,createObjectsInSetsFolder:!1,topResults:200,topResultsWidget:10,registerCustomTypes:!0,sidebarState:{typesCollapsed:!1,collectionsCollapsed:!1,widgets:[]}},Dn="set";var Me=require("obsidian");var ue={context:void 0,registry:void 0};function Ar(e){ue.context=e}function Cs(){return M(F({},ue.context),{id:`${ue.context.id}${ue.context.count++}-`,count:0})}var ks=(e,t)=>e===t,Be=Symbol("solid-proxy"),On=Symbol("solid-track"),Ds=Symbol("solid-dev-component"),Tn={equals:ks},oi=null,ui=hi,Re=1,Zt=2,fi={owned:null,cleanups:null,context:null,owner:null};var G=null,N=null,tn=null,kr=null,ne=null,be=null,_e=null,Fn=0,[jc,si]=W(!1);function At(e,t){let n=ne,r=G,i=e.length===0,o=t===void 0?r:t,s=i?fi:{owned:null,cleanups:null,context:o?o.context:null,owner:o},a=i?e:()=>e(()=>re(()=>mt(s)));G=s,ne=null;try{return We(a,!0)}finally{ne=n,G=r}}function W(e,t){t=t?Object.assign({},Tn,t):Tn;let n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=i=>(typeof i=="function"&&(N&&N.running&&N.sources.has(n)?i=i(n.tValue):i=i(n.value)),gi(n,i));return[pi.bind(n),r]}function B(e,t,n){let r=Or(e,t,!1,Re);tn&&N&&N.running?be.push(r):nn(r)}function Z(e,t,n){ui=Os;let r=Or(e,t,!1,Re),i=Tr&&Ue(Tr);i&&(r.suspense=i),(!n||!n.render)&&(r.user=!0),_e?_e.push(r):nn(r)}function se(e,t,n){n=n?Object.assign({},Tn,n):Tn;let r=Or(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,tn&&N&&N.running?(r.tState=Re,be.push(r)):nn(r),pi.bind(r)}function He(e){return We(e,!1)}function re(e){if(ne===null)return e();let t=ne;ne=null;try{return e()}finally{ne=t}}function U(e){Z(()=>re(e))}function ve(e){return G===null||(G.cleanups===null?G.cleanups=[e]:G.cleanups.push(e)),e}function In(){return ne}function Mn(){return G}function di(e,t){let n=G,r=ne;G=e,ne=null;try{return We(t,!0)}catch(i){Pn(i)}finally{G=n,ne=r}}function As(e){if(N&&N.running)return e(),N.done;let t=ne,n=G;return Promise.resolve().then(()=>{ne=t,G=n;let r;return(tn||Tr)&&(r=N||(N={sources:new Set,effects:[],promises:new Set,disposed:new Set,queue:new Set,running:!0}),r.done||(r.done=new Promise(i=>r.resolve=i)),r.running=!0),We(e,!1),ne=G=null,r?r.done:void 0})}function ze(e,t){let n=Symbol("context");return{id:n,Provider:Is(n),defaultValue:e}}function Ue(e){return G&&G.context&&G.context[e.id]!==void 0?G.context[e.id]:e.defaultValue}function mi(e){let t=se(e),n=se(()=>Er(t()));return n.toArray=()=>{let r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}var Tr;function pi(){let e=N&&N.running;if(this.sources&&(e?this.tState:this.state))if((e?this.tState:this.state)===Re)nn(this);else{let t=be;be=null,We(()=>En(this),!1),be=t}if(ne){let t=this.observers?this.observers.length:0;ne.sources?(ne.sources.push(this),ne.sourceSlots.push(t)):(ne.sources=[this],ne.sourceSlots=[t]),this.observers?(this.observers.push(ne),this.observerSlots.push(ne.sources.length-1)):(this.observers=[ne],this.observerSlots=[ne.sources.length-1])}return e&&N.sources.has(this)?this.tValue:this.value}function gi(e,t,n){let r=N&&N.running&&N.sources.has(e)?e.tValue:e.value;if(!e.comparator||!e.comparator(r,t)){if(N){let i=N.running;(i||!n&&N.sources.has(e))&&(N.sources.add(e),e.tValue=t),i||(e.value=t)}else e.value=t;e.observers&&e.observers.length&&We(()=>{for(let i=0;i<e.observers.length;i+=1){let o=e.observers[i],s=N&&N.running;s&&N.disposed.has(o)||((s?!o.tState:!o.state)&&(o.pure?be.push(o):_e.push(o),o.observers&&yi(o)),s?o.tState=Re:o.state=Re)}if(be.length>1e6)throw be=[],new Error},!1)}return t}function nn(e){if(!e.fn)return;mt(e);let t=G,n=ne,r=Fn;ne=G=e,ai(e,N&&N.running&&N.sources.has(e)?e.tValue:e.value,r),N&&!N.running&&N.sources.has(e)&&queueMicrotask(()=>{We(()=>{N&&(N.running=!0),ne=G=e,ai(e,e.tValue,r),ne=G=null},!1)}),ne=n,G=t}function ai(e,t,n){let r;try{r=e.fn(t)}catch(i){return e.pure&&(N&&N.running?(e.tState=Re,e.tOwned&&e.tOwned.forEach(mt),e.tOwned=void 0):(e.state=Re,e.owned&&e.owned.forEach(mt),e.owned=null)),e.updatedAt=n+1,Pn(i)}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?gi(e,r,!0):N&&N.running&&e.pure?(N.sources.add(e),e.tValue=r):e.value=r,e.updatedAt=n)}function Or(e,t,n,r=Re,i){let o={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:G,context:G?G.context:null,pure:n};if(N&&N.running&&(o.state=0,o.tState=r),G===null||G!==fi&&(N&&N.running&&G.pure?G.tOwned?G.tOwned.push(o):G.tOwned=[o]:G.owned?G.owned.push(o):G.owned=[o]),kr){let[s,a]=W(void 0,{equals:!1}),l=kr(o.fn,a);ve(()=>l.dispose());let u=()=>As(a).then(()=>c.dispose()),c=kr(o.fn,u);o.fn=f=>(s(),N&&N.running?c.track(f):l.track(f))}return o}function en(e){let t=N&&N.running;if((t?e.tState:e.state)===0)return;if((t?e.tState:e.state)===Zt)return En(e);if(e.suspense&&re(e.suspense.inFallback))return e.suspense.effects.push(e);let n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Fn);){if(t&&N.disposed.has(e))return;(t?e.tState:e.state)&&n.push(e)}for(let r=n.length-1;r>=0;r--){if(e=n[r],t){let i=e,o=n[r+1];for(;(i=i.owner)&&i!==o;)if(N.disposed.has(i))return}if((t?e.tState:e.state)===Re)nn(e);else if((t?e.tState:e.state)===Zt){let i=be;be=null,We(()=>En(e,n[0]),!1),be=i}}}function We(e,t){if(be)return e();let n=!1;t||(be=[]),_e?n=!0:_e=[],Fn++;try{let r=e();return Ts(n),r}catch(r){n||(_e=null),be=null,Pn(r)}}function Ts(e){if(be&&(tn&&N&&N.running?Es(be):hi(be),be=null),e)return;let t;if(N){if(!N.promises.size&&!N.queue.size){let r=N.sources,i=N.disposed;_e.push.apply(_e,N.effects),t=N.resolve;for(let o of _e)"tState"in o&&(o.state=o.tState),delete o.tState;N=null,We(()=>{for(let o of i)mt(o);for(let o of r){if(o.value=o.tValue,o.owned)for(let s=0,a=o.owned.length;s<a;s++)mt(o.owned[s]);o.tOwned&&(o.owned=o.tOwned),delete o.tValue,delete o.tOwned,o.tState=0}si(!1)},!1)}else if(N.running){N.running=!1,N.effects.push.apply(N.effects,_e),_e=null,si(!0);return}}let n=_e;_e=null,n.length&&We(()=>ui(n),!1),t&&t()}function hi(e){for(let t=0;t<e.length;t++)en(e[t])}function Es(e){for(let t=0;t<e.length;t++){let n=e[t],r=N.queue;r.has(n)||(r.add(n),tn(()=>{r.delete(n),We(()=>{N.running=!0,en(n)},!1),N&&(N.running=!1)}))}}function Os(e){let t,n=0;for(t=0;t<e.length;t++){let r=e[t];r.user?e[n++]=r:en(r)}if(ue.context){if(ue.count){ue.effects||(ue.effects=[]),ue.effects.push(...e.slice(0,n));return}else ue.effects&&(e=[...ue.effects,...e],n+=ue.effects.length,delete ue.effects);Ar()}for(t=0;t<n;t++)en(e[t])}function En(e,t){let n=N&&N.running;n?e.tState=0:e.state=0;for(let r=0;r<e.sources.length;r+=1){let i=e.sources[r];if(i.sources){let o=n?i.tState:i.state;o===Re?i!==t&&(!i.updatedAt||i.updatedAt<Fn)&&en(i):o===Zt&&En(i,t)}}}function yi(e){let t=N&&N.running;for(let n=0;n<e.observers.length;n+=1){let r=e.observers[n];(t?!r.tState:!r.state)&&(t?r.tState=Zt:r.state=Zt,r.pure?be.push(r):_e.push(r),r.observers&&yi(r))}}function mt(e){let t;if(e.sources)for(;e.sources.length;){let n=e.sources.pop(),r=e.sourceSlots.pop(),i=n.observers;if(i&&i.length){let o=i.pop(),s=n.observerSlots.pop();r<i.length&&(o.sourceSlots[s]=r,i[r]=o,n.observerSlots[r]=s)}}if(N&&N.running&&e.pure){if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)mt(e.tOwned[t]);delete e.tOwned}bi(e,!0)}else if(e.owned){for(t=e.owned.length-1;t>=0;t--)mt(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}N&&N.running?e.tState=0:e.state=0}function bi(e,t){if(t||(e.tState=0,N.disposed.add(e)),e.owned)for(let n=0;n<e.owned.length;n++)bi(e.owned[n])}function Fs(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function li(e,t,n){try{for(let r of t)r(e)}catch(r){Pn(r,n&&n.owner||null)}}function Pn(e,t=G){let n=oi&&t&&t.context&&t.context[oi],r=Fs(e);if(!n)throw r;_e?_e.push({fn(){li(r,n,t)},state:Re}):li(r,n,t)}function Er(e){if(typeof e=="function"&&!e.length)return Er(e());if(Array.isArray(e)){let t=[];for(let n=0;n<e.length;n++){let r=Er(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function Is(e,t){return function(r){let i;return B(()=>i=re(()=>(G.context=M(F({},G.context),{[e]:r.value}),mi(()=>r.children))),void 0),i}}var Ms=Symbol("fallback");function ci(e){for(let t=0;t<e.length;t++)e[t]()}function Ps(e,t,n={}){let r=[],i=[],o=[],s=0,a=t.length>1?[]:null;return ve(()=>ci(o)),()=>{let l=e()||[],u,c;return l[On],re(()=>{let d=l.length,h,C,D,A,w,k,b,E,v;if(d===0)s!==0&&(ci(o),o=[],r=[],i=[],s=0,a&&(a=[])),n.fallback&&(r=[Ms],i[0]=At(T=>(o[0]=T,n.fallback())),s=1);else if(s===0){for(i=new Array(d),c=0;c<d;c++)r[c]=l[c],i[c]=At(f);s=d}else{for(D=new Array(d),A=new Array(d),a&&(w=new Array(d)),k=0,b=Math.min(s,d);k<b&&r[k]===l[k];k++);for(b=s-1,E=d-1;b>=k&&E>=k&&r[b]===l[E];b--,E--)D[E]=i[b],A[E]=o[b],a&&(w[E]=a[b]);for(h=new Map,C=new Array(E+1),c=E;c>=k;c--)v=l[c],u=h.get(v),C[c]=u===void 0?-1:u,h.set(v,c);for(u=k;u<=b;u++)v=r[u],c=h.get(v),c!==void 0&&c!==-1?(D[c]=i[u],A[c]=o[u],a&&(w[c]=a[u]),c=C[c],h.set(v,c)):o[u]();for(c=k;c<d;c++)c in D?(i[c]=D[c],o[c]=A[c],a&&(a[c]=w[c],a[c](c))):i[c]=At(f);i=i.slice(0,s=d),r=l.slice(0)}return i});function f(d){if(o[c]=d,a){let[h,C]=W(c);return a[c]=C,t(l[c],h)}return t(l[c])}}}var Ns=!1;function m(e,t){if(Ns&&ue.context){let n=ue.context;Ar(Cs());let r=re(()=>e(t||{}));return Ar(n),r}return re(()=>e(t||{}))}function An(){return!0}var Ls={get(e,t,n){return t===Be?n:e.get(t)},has(e,t){return t===Be?!0:e.has(t)},set:An,deleteProperty:An,getOwnPropertyDescriptor(e,t){return{configurable:!0,enumerable:!0,get(){return e.get(t)},set:An,deleteProperty:An}},ownKeys(e){return e.keys()}};function Dr(e){return(e=typeof e=="function"?e():e)?e:{}}function Rs(){for(let e=0,t=this.length;e<t;++e){let n=this[e]();if(n!==void 0)return n}}function Ke(...e){let t=!1;for(let o=0;o<e.length;o++){let s=e[o];t=t||!!s&&Be in s,e[o]=typeof s=="function"?(t=!0,se(s)):s}if(t)return new Proxy({get(o){for(let s=e.length-1;s>=0;s--){let a=Dr(e[s])[o];if(a!==void 0)return a}},has(o){for(let s=e.length-1;s>=0;s--)if(o in Dr(e[s]))return!0;return!1},keys(){let o=[];for(let s=0;s<e.length;s++)o.push(...Object.keys(Dr(e[s])));return[...new Set(o)]}},Ls);let n={},r={},i=new Set;for(let o=e.length-1;o>=0;o--){let s=e[o];if(!s)continue;let a=Object.getOwnPropertyNames(s);for(let l=0,u=a.length;l<u;l++){let c=a[l];if(c==="__proto__"||c==="constructor")continue;let f=Object.getOwnPropertyDescriptor(s,c);if(!i.has(c))f.get?(i.add(c),Object.defineProperty(n,c,{enumerable:!0,configurable:!0,get:Rs.bind(r[c]=[f.get.bind(s)])})):(f.value!==void 0&&i.add(c),n[c]=f.value);else{let d=r[c];d?f.get?d.push(f.get.bind(s)):f.value!==void 0&&d.push(()=>f.value):n[c]===void 0&&(n[c]=f.value)}}}return n}var vi=e=>`Stale read from <${e}>.`;function ee(e){let t="fallback"in e&&{fallback:()=>e.fallback};return se(Ps(()=>e.each,e.children,t||void 0))}function V(e){let t=e.keyed,n=se(()=>e.when,void 0,{equals:(r,i)=>t?r===i:!r==!i});return se(()=>{let r=n();if(r){let i=e.children;return typeof i=="function"&&i.length>0?re(()=>i(t?r:()=>{if(!re(n))throw vi("Show");return e.when})):i}return e.fallback},void 0,void 0)}function pt(e){let t=!1,n=(o,s)=>o[0]===s[0]&&(t?o[1]===s[1]:!o[1]==!s[1])&&o[2]===s[2],r=mi(()=>e.children),i=se(()=>{let o=r();Array.isArray(o)||(o=[o]);for(let s=0;s<o.length;s++){let a=o[s].when;if(a)return t=!!o[s].keyed,[s,a,o[s]]}return[-1]},void 0,{equals:n});return se(()=>{let[o,s,a]=i();if(o<0)return e.fallback;let l=a.children;return typeof l=="function"&&l.length>0?re(()=>l(t?s:()=>{if(re(i)[0]!==o)throw vi("Match");return a.when})):l},void 0,void 0)}function we(e){return e}var Bc=ze();var Vs=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],Qc=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...Vs]);function js(e,t,n){let r=n.length,i=t.length,o=r,s=0,a=0,l=t[i-1].nextSibling,u=null;for(;s<i||a<o;){if(t[s]===n[a]){s++,a++;continue}for(;t[i-1]===n[o-1];)i--,o--;if(i===s){let c=o<r?a?n[a-1].nextSibling:n[o-a]:l;for(;a<o;)e.insertBefore(n[a++],c)}else if(o===a)for(;s<i;)(!u||!u.has(t[s]))&&t[s].remove(),s++;else if(t[s]===n[o-1]&&n[a]===t[i-1]){let c=t[--i].nextSibling;e.insertBefore(n[a++],t[s++].nextSibling),e.insertBefore(n[--o],c),t[i]=n[o]}else{if(!u){u=new Map;let f=a;for(;f<o;)u.set(n[f],f++)}let c=u.get(t[s]);if(c!=null)if(a<c&&c<o){let f=s,d=1,h;for(;++f<i&&f<o&&!((h=u.get(t[f]))==null||h!==c+d);)d++;if(d>c-a){let C=t[s];for(;a<c;)e.insertBefore(n[a++],C)}else e.replaceChild(n[a++],t[s++])}else s++;else t[s++].remove()}}}var wi="_$DX_DELEGATE";function he(e,t,n,r={}){let i;return At(o=>{i=o,t===document?e():_(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{i(),t.textContent=""}}function S(e,t,n){let r,i=()=>{let s=document.createElement("template");return s.innerHTML=e,n?s.content.firstChild.firstChild:s.content.firstChild},o=t?()=>re(()=>document.importNode(r||(r=i()),!0)):()=>(r||(r=i())).cloneNode(!0);return o.cloneNode=o,o}function z(e,t=window.document){let n=t[wi]||(t[wi]=new Set);for(let r=0,i=e.length;r<i;r++){let o=e[r];n.has(o)||(n.add(o),t.addEventListener(o,Bs))}}function le(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function Ve(e,t,n,r){if(r)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){let i=n[0];e.addEventListener(t,n[0]=o=>i.call(e,n[1],o))}else e.addEventListener(t,n)}function $i(e,t,n){if(!t)return n?le(e,"style"):t;let r=e.style;if(typeof t=="string")return r.cssText=t;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),t||(t={});let i,o;for(o in n)t[o]==null&&r.removeProperty(o),delete n[o];for(o in t)i=t[o],i!==n[o]&&(r.setProperty(o,i),n[o]=i);return n}function R(e,t,n){return re(()=>e(t,n))}function _(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Nn(e,t,r,n);B(i=>Nn(e,t(),i,n),r)}function Bs(e){let t=`$$${e.type}`,n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return n||document}}),ue.registry&&!ue.done&&(ue.done=_$HY.done=!0);n;){let r=n[t];if(r&&!n.disabled){let i=n[`${t}Data`];if(i!==void 0?r.call(n,i,e):r.call(n,e),e.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function Nn(e,t,n,r,i){if(ue.context){!n&&(n=[...e.childNodes]);let a=[];for(let l=0;l<n.length;l++){let u=n[l];u.nodeType===8&&u.data.slice(0,2)==="!$"?u.remove():a.push(u)}n=a}for(;typeof n=="function";)n=n();if(t===n)return n;let o=typeof t,s=r!==void 0;if(e=s&&n[0]&&n[0].parentNode||e,o==="string"||o==="number"){if(ue.context)return n;if(o==="number"&&(t=t.toString()),s){let a=n[0];a&&a.nodeType===3?a.data=t:a=document.createTextNode(t),n=Tt(e,n,r,a)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||o==="boolean"){if(ue.context)return n;n=Tt(e,n,r)}else{if(o==="function")return B(()=>{let a=t();for(;typeof a=="function";)a=a();n=Nn(e,a,n,r)}),()=>n;if(Array.isArray(t)){let a=[],l=n&&Array.isArray(n);if(Fr(a,t,n,i))return B(()=>n=Nn(e,a,n,r,!0)),()=>n;if(ue.context){if(!a.length)return n;for(let u=0;u<a.length;u++)if(a[u].parentNode)return n=a}if(a.length===0){if(n=Tt(e,n,r),s)return n}else l?n.length===0?xi(e,a,r):js(e,n,a):(n&&Tt(e),xi(e,a));n=a}else if(t.nodeType){if(ue.context&&t.parentNode)return n=s?[t]:t;if(Array.isArray(n)){if(s)return n=Tt(e,n,r,t);Tt(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}else console.warn("Unrecognized value. Skipped inserting",t)}return n}function Fr(e,t,n,r){let i=!1;for(let o=0,s=t.length;o<s;o++){let a=t[o],l=n&&n[o],u;if(!(a==null||a===!0||a===!1))if((u=typeof a)=="object"&&a.nodeType)e.push(a);else if(Array.isArray(a))i=Fr(e,a,l)||i;else if(u==="function")if(r){for(;typeof a=="function";)a=a();i=Fr(e,Array.isArray(a)?a:[a],Array.isArray(l)?l:[l])||i}else e.push(a),i=!0;else{let c=String(a);l&&l.nodeType===3&&l.data===c?e.push(l):e.push(document.createTextNode(c))}}return i}function xi(e,t,n=null){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function Tt(e,t,n,r){if(n===void 0)return e.textContent="";let i=r||document.createTextNode("");if(t.length){let o=!1;for(let s=t.length-1;s>=0;s--){let a=t[s];if(i!==a){let l=a.parentNode===e;!o&&!s?l?e.replaceChild(i,a):e.insertBefore(i,n):l&&a.remove()}else o=!0}}else e.insertBefore(i,n);return[i]}var Ws="http://www.w3.org/2000/svg";function Hs(e,t=!1){return t?document.createElementNS(Ws,e):document.createElement(e)}function _i(e){let{useShadow:t}=e,n=document.createTextNode(""),r=()=>e.mount||document.body,i=Mn(),o,s=!!ue.context;return Z(()=>{s&&(Mn().user=s=!1),o||(o=di(i,()=>se(()=>e.children)));let a=r();if(a instanceof HTMLHeadElement){let[l,u]=W(!1),c=()=>u(!0);At(f=>_(a,()=>l()?f():o(),null)),ve(c)}else{let l=Hs(e.isSVG?"g":"div",e.isSVG),u=t&&l.attachShadow?l.attachShadow({mode:"open"}):l;Object.defineProperty(l,"_$host",{get(){return n.parentNode},configurable:!0}),_(u,o),a.appendChild(l),e.ref&&e.ref(l),ve(()=>a.removeChild(l))}},void 0,{render:!s}),n}var gr=require("obsidian");var Si=ze();function Se(e){return m(Si.Provider,{get value(){return e.app},get children(){return e.children}})}function ae(){return Ue(Si)}var ct=require("obsidian");function rn(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function Ce(e){return e.toString().toLowerCase().replace(/-/g," ").replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})}var Ci=require("obsidian");var Ks=S('<div class="sets-collapsible-content">'),qs=S('<div class="sets-collapsible"><div class="sets-collapsible-header"><div class=" collapse-icon "></div><div class="sets-collapsible-title">'),Ys=e=>{let t,[n,r]=W(!!e.isCollapsed);U(()=>{(0,Ci.setIcon)(t,"right-triangle")});let i=()=>{let o=!n();r(o),e.onToggle&&e.onToggle(o)};return(()=>{let o=qs(),s=o.firstChild,a=s.firstChild,l=a.nextSibling;s.$$click=i;let u=t;return typeof u=="function"?R(u,a):t=a,_(l,()=>e.title),_(o,m(V,{get when(){return!n()},get children(){let c=Ks();return _(c,()=>e.children),c}}),null),B(()=>a.classList.toggle("is-collapsed",!!n())),o})()},on=Ys;z(["click"]);var Yt=require("obsidian");var Qi=require("obsidian");var ki=ze();function De(e){let[t,n]=W(e.setDefinition),r={newFile:""},i={definition:t,refresh:e.refresh?e.refresh:()=>{},reorder:(o,s,a)=>{var h;let l=(h=t().fields)==null?void 0:h.slice();if(!l)throw Error("No items to reoreder!");let u=l,c=u==null?void 0:u.indexOf(o),f=u==null?void 0:u.indexOf(s);l&&l.splice(f,0,...l.splice(c,1));let d=M(F({},t()),{fields:l});a?e.updateDefinition(d):n(d)},reorderSort:(o,s)=>{var f;let a=(f=t().sortby)==null?void 0:f.slice();if(!a)throw Error("No items to reoreder!");let l=a.map(d=>d[0]),u=l==null?void 0:l.indexOf(o),c=l==null?void 0:l.indexOf(s);a&&a.splice(c,0,...a.splice(u,1)),n(d=>M(F({},d),{sortby:a}))},addField:o=>{n(s=>{var a;return M(F({},s),{fields:(a=s.fields)!=null&&a.includes(o)?s.fields:[...s.fields||[],o]})})},removeField:o=>{n(s=>{var a;return M(F({},s),{fields:(a=s.fields)==null?void 0:a.filter(l=>l!==o)})})},setSortDirection:(o,s)=>{n(a=>M(F({},a),{sortby:[...(a.sortby||[]).map(l=>l[0]===o?[o,s]:l)]}))},addSort:(o,s)=>{n(a=>M(F({},a),{sortby:[...(a.sortby||[]).filter(([l])=>l!==o),[o,s]]}))},removeSort:o=>{n(s=>M(F({},s),{sortby:[...(s.sortby||[]).filter(([a])=>a!==o)]}))},updateSize:(o,s)=>{n(a=>{var l;return M(F({},a),{grid:M(F({},a.grid),{columnWidths:M(F({},(l=a.grid)==null?void 0:l.columnWidths),{[o]:s})})})})},setDefinition:o=>{n(o)},save:()=>{n(o=>M(F({},o),{timestamp:Date.now()})),e.updateDefinition(t())},setNewFile:o=>{r.newFile=o},getNewFile:()=>r.newFile,addFilter:o=>{n(s=>M(F({},s),{filter:[...s.filter||[],o]}))},updateFilter:(o,s)=>{n(a=>M(F({},a),{filter:[...(a.filter||[]).map((l,u)=>u===o?s:l)]}))},removeFilter:o=>{n(s=>M(F({},s),{filter:[...(s.filter||[]).filter((a,l)=>l!==o)]}))}};return m(ki.Provider,{value:i,get children(){return e.children}})}function te(){return Ue(ki)}var Ge=require("obsidian"),xt="@link-to-this";function $t(e){return e in Ir}function Ln(e,t,n,r){return Ir[e].generate(t,n,r)}function Di(e){return Object.values(Ir).filter(t=>t.type.includes(e))}var Ir={"@link-to-this":{id:"@link-to-this",displayName:()=>"Link to this",generate:(e,t,n)=>{if(n)return t.generateWikiLink(n.file);throw Error("Cannot generate @link-to-this since context is missing.")},type:["multitext","text"]},"@today":{id:"@today",displayName:()=>"Today",generate:(e,t,n)=>(0,Ge.moment)().format("YYYY-MM-DD"),type:["date","datetime"]},"@yesterday":{id:"@yesterday",displayName:()=>"Yesterday",generate:(e,t,n)=>(0,Ge.moment)().subtract(1,"days").format("YYYY-MM-DD"),type:["date","datetime"]},"@tomorrow":{id:"@tomorrow",displayName:()=>"Tomorrow",generate:(e,t,n)=>(0,Ge.moment)().add(1,"days").format("YYYY-MM-DD"),type:["date","datetime"]},"@this-week":{id:"@this-week",displayName:()=>"This week",generate:(e,t,n)=>(0,Ge.moment)().startOf("week").format("YYYY-MM-DD"),type:["date","datetime"]},"@last-week":{id:"@last-week",displayName:()=>"Last week",generate:(e,t,n)=>(0,Ge.moment)().subtract(1,"week").startOf("week").format("YYYY-MM-DD"),type:["date","datetime"]},"@next-week":{id:"@next-week",displayName:()=>"Next week",generate:(e,t,n)=>(0,Ge.moment)().add(1,"week").startOf("week").format("YYYY-MM-DD"),type:["date","datetime"]},"@this-month":{id:"@this-month",displayName:()=>"This month",generate:(e,t,n)=>(0,Ge.moment)().startOf("month").format("YYYY-MM-DD"),type:["date","datetime"]},"@last-month":{id:"@last-month",displayName:()=>"Last month",generate:(e,t,n)=>(0,Ge.moment)().subtract(1,"month").startOf("month").format("YYYY-MM-DD"),type:["date","datetime"]},"@next-month":{id:"@next-month",displayName:()=>"Next month",generate:(e,t,n)=>(0,Ge.moment)().add(1,"month").startOf("month").format("YYYY-MM-DD"),type:["date","datetime"]}};var Gi=require("obsidian");var _t=Math.min,Ae=Math.max,sn=Math.round,an=Math.floor,nt=e=>({x:e,y:e});function Mr(e,t){return typeof e=="function"?e(t):e}function Rn(e){return e.split("-")[0]}function Pr(e){return e.split("-")[1]}function Ai(e){return e==="x"?"y":"x"}function Ti(e){return e==="y"?"height":"width"}function Vn(e){return["top","bottom"].includes(Rn(e))?"y":"x"}function Ei(e){return Ai(Vn(e))}function zs(e){return F({top:0,right:0,bottom:0,left:0},e)}function Oi(e){return typeof e!="number"?zs(e):{top:e,right:e,bottom:e,left:e}}function St(e){return M(F({},e),{top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height})}function Fi(e,t,n){let{reference:r,floating:i}=e,o=Vn(t),s=Ei(t),a=Ti(s),l=Rn(t),u=o==="y",c=r.x+r.width/2-i.width/2,f=r.y+r.height/2-i.height/2,d=r[a]/2-i[a]/2,h;switch(l){case"top":h={x:c,y:r.y-i.height};break;case"bottom":h={x:c,y:r.y+r.height};break;case"right":h={x:r.x+r.width,y:f};break;case"left":h={x:r.x-i.width,y:f};break;default:h={x:r.x,y:r.y}}switch(Pr(t)){case"start":h[s]-=d*(n&&u?-1:1);break;case"end":h[s]+=d*(n&&u?-1:1);break}return h}var Ii=(e,t,n)=>Y(void 0,null,function*(){let{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),l=yield s.isRTL==null?void 0:s.isRTL(t),u=yield s.getElementRects({reference:e,floating:t,strategy:i}),{x:c,y:f}=Fi(u,r,l),d=r,h={},C=0;for(let D=0;D<a.length;D++){let{name:A,fn:w}=a[D],{x:k,y:b,data:E,reset:v}=yield w({x:c,y:f,initialPlacement:r,placement:d,strategy:i,middlewareData:h,rects:u,platform:s,elements:{reference:e,floating:t}});if(c=k!=null?k:c,f=b!=null?b:f,h=M(F({},h),{[A]:F(F({},h[A]),E)}),v&&C<=50){C++,typeof v=="object"&&(v.placement&&(d=v.placement),v.rects&&(u=v.rects===!0?yield s.getElementRects({reference:e,floating:t,strategy:i}):v.rects),{x:c,y:f}=Fi(u,d,l)),D=-1;continue}}return{x:c,y:f,placement:d,strategy:i,middlewareData:h}});function Mi(e,t){return Y(this,null,function*(){var n;t===void 0&&(t={});let{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=e,{boundary:u="clippingAncestors",rootBoundary:c="viewport",elementContext:f="floating",altBoundary:d=!1,padding:h=0}=Mr(t,e),C=Oi(h),A=a[d?f==="floating"?"reference":"floating":f],w=St(yield o.getClippingRect({element:(n=yield o.isElement==null?void 0:o.isElement(A))==null||n?A:A.contextElement||(yield o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:u,rootBoundary:c,strategy:l})),k=f==="floating"?M(F({},s.floating),{x:r,y:i}):s.reference,b=yield o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating),E=(yield o.isElement==null?void 0:o.isElement(b))?(yield o.getScale==null?void 0:o.getScale(b))||{x:1,y:1}:{x:1,y:1},v=St(o.convertOffsetParentRelativeRectToViewportRelativeRect?yield o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:k,offsetParent:b,strategy:l}):k);return{top:(w.top-v.top+C.top)/E.y,bottom:(v.bottom-w.bottom+C.bottom)/E.y,left:(w.left-v.left+C.left)/E.x,right:(v.right-w.right+C.right)/E.x}})}var Nr=function(e){return e===void 0&&(e={}),{name:"size",options:e,fn(n){return Y(this,null,function*(){let{placement:r,rects:i,platform:o,elements:s}=n,I=Mr(e,n),{apply:a=()=>{}}=I,l=ni(I,["apply"]),u=yield Mi(n,l),c=Rn(r),f=Pr(r),d=Vn(r)==="y",{width:h,height:C}=i.floating,D,A;c==="top"||c==="bottom"?(D=c,A=f===((yield o.isRTL==null?void 0:o.isRTL(s.floating))?"start":"end")?"left":"right"):(A=c,D=f==="end"?"top":"bottom");let w=C-u[D],k=h-u[A],b=!n.middlewareData.shift,E=w,v=k;if(d){let P=h-u.left-u.right;v=f||b?_t(k,P):P}else{let P=C-u.top-u.bottom;E=f||b?_t(w,P):P}if(b&&!f){let P=Ae(u.left,0),H=Ae(u.right,0),q=Ae(u.top,0),Q=Ae(u.bottom,0);d?v=h-2*(P!==0||H!==0?P+H:Ae(u.left,u.right)):E=C-2*(q!==0||Q!==0?q+Q:Ae(u.top,u.bottom))}yield a(M(F({},n),{availableWidth:v,availableHeight:E}));let T=yield o.getDimensions(s.floating);return h!==T.width||C!==T.height?{reset:{rects:!0}}:{}})}}};function rt(e){return Ni(e)?(e.nodeName||"").toLowerCase():"#document"}function Te(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Xe(e){var t;return(t=(Ni(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function Ni(e){return e instanceof Node||e instanceof Te(e).Node}function Qe(e){return e instanceof Element||e instanceof Te(e).Element}function qe(e){return e instanceof HTMLElement||e instanceof Te(e).HTMLElement}function Pi(e){return typeof ShadowRoot=="undefined"?!1:e instanceof ShadowRoot||e instanceof Te(e).ShadowRoot}function Et(e){let{overflow:t,overflowX:n,overflowY:r,display:i}=Fe(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(i)}function Li(e){return["table","td","th"].includes(rt(e))}function jn(e){let t=Bn(),n=Fe(e);return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function Ri(e){let t=Ct(e);for(;qe(t)&&!ln(t);){if(jn(t))return t;t=Ct(t)}return null}function Bn(){return typeof CSS=="undefined"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ln(e){return["html","body","#document"].includes(rt(e))}function Fe(e){return Te(e).getComputedStyle(e)}function cn(e){return Qe(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Ct(e){if(rt(e)==="html")return e;let t=e.assignedSlot||e.parentNode||Pi(e)&&e.host||Xe(e);return Pi(t)?t.host:t}function Vi(e){let t=Ct(e);return ln(t)?e.ownerDocument?e.ownerDocument.body:e.body:qe(t)&&Et(t)?t:Vi(t)}function un(e,t){var n;t===void 0&&(t=[]);let r=Vi(e),i=r===((n=e.ownerDocument)==null?void 0:n.body),o=Te(r);return i?t.concat(o,o.visualViewport||[],Et(r)?r:[]):t.concat(r,un(r))}function Wi(e){let t=Fe(e),n=parseFloat(t.width)||0,r=parseFloat(t.height)||0,i=qe(e),o=i?e.offsetWidth:n,s=i?e.offsetHeight:r,a=sn(n)!==o||sn(r)!==s;return a&&(n=o,r=s),{width:n,height:r,$:a}}function Lr(e){return Qe(e)?e:e.contextElement}function Ot(e){let t=Lr(e);if(!qe(t))return nt(1);let n=t.getBoundingClientRect(),{width:r,height:i,$:o}=Wi(t),s=(o?sn(n.width):n.width)/r,a=(o?sn(n.height):n.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}var Us=nt(0);function Hi(e){let t=Te(e);return!Bn()||!t.visualViewport?Us:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Gs(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Te(e)?!1:t}function kt(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);let i=e.getBoundingClientRect(),o=Lr(e),s=nt(1);t&&(r?Qe(r)&&(s=Ot(r)):s=Ot(e));let a=Gs(o,n,r)?Hi(o):nt(0),l=(i.left+a.x)/s.x,u=(i.top+a.y)/s.y,c=i.width/s.x,f=i.height/s.y;if(o){let d=Te(o),h=r&&Qe(r)?Te(r):r,C=d.frameElement;for(;C&&r&&h!==d;){let D=Ot(C),A=C.getBoundingClientRect(),w=Fe(C),k=A.left+(C.clientLeft+parseFloat(w.paddingLeft))*D.x,b=A.top+(C.clientTop+parseFloat(w.paddingTop))*D.y;l*=D.x,u*=D.y,c*=D.x,f*=D.y,l+=k,u+=b,C=Te(C).frameElement}}return St({width:c,height:f,x:l,y:u})}function Xs(e){let{rect:t,offsetParent:n,strategy:r}=e,i=qe(n),o=Xe(n);if(n===o)return t;let s={scrollLeft:0,scrollTop:0},a=nt(1),l=nt(0);if((i||!i&&r!=="fixed")&&((rt(n)!=="body"||Et(o))&&(s=cn(n)),qe(n))){let u=kt(n);a=Ot(n),l.x=u.x+n.clientLeft,l.y=u.y+n.clientTop}return{width:t.width*a.x,height:t.height*a.y,x:t.x*a.x-s.scrollLeft*a.x+l.x,y:t.y*a.y-s.scrollTop*a.y+l.y}}function Qs(e){return Array.from(e.getClientRects())}function Ki(e){return kt(Xe(e)).left+cn(e).scrollLeft}function Js(e){let t=Xe(e),n=cn(e),r=e.ownerDocument.body,i=Ae(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=Ae(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight),s=-n.scrollLeft+Ki(e),a=-n.scrollTop;return Fe(r).direction==="rtl"&&(s+=Ae(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}function Zs(e,t){let n=Te(e),r=Xe(e),i=n.visualViewport,o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;let u=Bn();(!u||u&&t==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}function ea(e,t){let n=kt(e,!0,t==="fixed"),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=qe(e)?Ot(e):nt(1),s=e.clientWidth*o.x,a=e.clientHeight*o.y,l=i*o.x,u=r*o.y;return{width:s,height:a,x:l,y:u}}function ji(e,t,n){let r;if(t==="viewport")r=Zs(e,n);else if(t==="document")r=Js(Xe(e));else if(Qe(t))r=ea(t,n);else{let i=Hi(e);r=M(F({},t),{x:t.x-i.x,y:t.y-i.y})}return St(r)}function qi(e,t){let n=Ct(e);return n===t||!Qe(n)||ln(n)?!1:Fe(n).position==="fixed"||qi(n,t)}function ta(e,t){let n=t.get(e);if(n)return n;let r=un(e).filter(a=>Qe(a)&&rt(a)!=="body"),i=null,o=Fe(e).position==="fixed",s=o?Ct(e):e;for(;Qe(s)&&!ln(s);){let a=Fe(s),l=jn(s);!l&&a.position==="fixed"&&(i=null),(o?!l&&!i:!l&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||Et(s)&&!l&&qi(e,s))?r=r.filter(c=>c!==s):i=a,s=Ct(s)}return t.set(e,r),r}function na(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e,s=[...n==="clippingAncestors"?ta(t,this._c):[].concat(n),r],a=s[0],l=s.reduce((u,c)=>{let f=ji(t,c,i);return u.top=Ae(f.top,u.top),u.right=_t(f.right,u.right),u.bottom=_t(f.bottom,u.bottom),u.left=Ae(f.left,u.left),u},ji(t,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function ra(e){return Wi(e)}function ia(e,t,n){let r=qe(t),i=Xe(t),o=n==="fixed",s=kt(e,!0,o,t),a={scrollLeft:0,scrollTop:0},l=nt(0);if(r||!r&&!o)if((rt(t)!=="body"||Et(i))&&(a=cn(t)),r){let u=kt(t,!0,o,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else i&&(l.x=Ki(i));return{x:s.left+a.scrollLeft-l.x,y:s.top+a.scrollTop-l.y,width:s.width,height:s.height}}function Bi(e,t){return!qe(e)||Fe(e).position==="fixed"?null:t?t(e):e.offsetParent}function Yi(e,t){let n=Te(e);if(!qe(e))return n;let r=Bi(e,t);for(;r&&Li(r)&&Fe(r).position==="static";)r=Bi(r,t);return r&&(rt(r)==="html"||rt(r)==="body"&&Fe(r).position==="static"&&!jn(r))?n:r||Ri(e)||n}var oa=function(e){return Y(this,null,function*(){let{reference:t,floating:n,strategy:r}=e,i=this.getOffsetParent||Yi,o=this.getDimensions;return{reference:ia(t,yield i(n),r),floating:F({x:0,y:0},yield o(n))}})};function sa(e){return Fe(e).direction==="rtl"}var aa={convertOffsetParentRelativeRectToViewportRelativeRect:Xs,getDocumentElement:Xe,getClippingRect:na,getOffsetParent:Yi,getElementRects:oa,getClientRects:Qs,getDimensions:ra,getScale:Ot,isElement:Qe,isRTL:sa};function la(e,t){let n=null,r,i=Xe(e);function o(){clearTimeout(r),n&&n.disconnect(),n=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();let{left:u,top:c,width:f,height:d}=e.getBoundingClientRect();if(a||t(),!f||!d)return;let h=an(c),C=an(i.clientWidth-(u+f)),D=an(i.clientHeight-(c+d)),A=an(u),k={rootMargin:-h+"px "+-C+"px "+-D+"px "+-A+"px",threshold:Ae(0,_t(1,l))||1},b=!0;function E(v){let T=v[0].intersectionRatio;if(T!==l){if(!b)return s();T?s(!1,T):r=setTimeout(()=>{s(!1,1e-7)},100)}b=!1}try{n=new IntersectionObserver(E,M(F({},k),{root:i.ownerDocument}))}catch(v){n=new IntersectionObserver(E,k)}n.observe(e)}return s(!0),o}function zi(e,t,n,r){r===void 0&&(r={});let{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,u=Lr(e),c=i||o?[...u?un(u):[],...un(t)]:[];c.forEach(w=>{i&&w.addEventListener("scroll",n,{passive:!0}),o&&w.addEventListener("resize",n)});let f=u&&a?la(u,n):null,d=-1,h=null;s&&(h=new ResizeObserver(w=>{let[k]=w;k&&k.target===u&&h&&(h.unobserve(t),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{h&&h.observe(t)})),n()}),u&&!l&&h.observe(u),h.observe(t));let C,D=l?kt(e):null;l&&A();function A(){let w=kt(e);D&&(w.x!==D.x||w.y!==D.y||w.width!==D.width||w.height!==D.height)&&n(),D=w,C=requestAnimationFrame(A)}return n(),()=>{c.forEach(w=>{i&&w.removeEventListener("scroll",n),o&&w.removeEventListener("resize",n)}),f&&f(),h&&h.disconnect(),h=null,l&&cancelAnimationFrame(C)}}var Ui=(e,t,n)=>{let r=new Map,i=F({platform:aa},n),o=M(F({},i.platform),{_c:r});return Ii(e,t,M(F({},i),{platform:o}))};var ca=S('<input type="text">'),ua=S('<div role="tooltip" class="sets-tooltip suggestion-container"><div class="suggestion">'),fa=S('<div class="suggestion-item">'),da=e=>{let t,n,r,[i,o]=W(!1),[s,a]=W(0),l=()=>{o(!0),r=zi(t,n,d)},u=()=>{setTimeout(()=>{o(!1)},100)},c=w=>{a(0),e.setValue(w.currentTarget.value)},f=()=>{let w=i()&&e.options().length>0;return w&&requestAnimationFrame(()=>{d()}),w};Z(()=>{let w=s(),k=n==null?void 0:n.firstChild.childNodes[w];k&&k.scrollIntoView({block:"nearest"})});function d(){Ui(t,n,{placement:"bottom-start",strategy:"fixed",middleware:[Nr({apply({availableWidth:w,availableHeight:k,elements:b}){Object.assign(b.floating.style,{minWidth:`${t.offsetWidth}px`,maxWidth:`${w}px`,maxHeight:`${k}px`})}})]}).then(({x:w,y:k})=>{Object.assign(n.style,{left:`${w}px`,top:`${k}px`})})}let h=w=>{w.key==="ArrowDown"&&a(s()+1),w.key==="ArrowUp"&&a(s()-1),w.key==="Enter"&&e.setValue(C()[s()].value)},C=()=>e.options().filter(w=>w.label.toLowerCase().includes(e.value().toLowerCase())),D=()=>{let w=e.options().find(k=>k.value===e.value());return w?w.label:e.value()};U(()=>{}),ve(()=>{r&&r()});let A=w=>{e.setValue(w.value)};return[(()=>{let w=ca();w.$$keydown=h,w.$$input=c,w.addEventListener("blur",u),w.addEventListener("focus",l);let k=t;return typeof k=="function"?R(k,w):t=w,B(()=>{var b;return le(w,"placeholder",(b=e.placeholder)==null?void 0:b.call(e))}),B(()=>w.value=D()),w})(),m(V,{get when(){return f()},get children(){let w=ua(),k=w.firstChild,b=n;return typeof b=="function"?R(b,w):n=w,_(k,m(ee,{get each(){return C()},children:(E,v)=>(()=>{let T=fa();return T.$$mouseover=()=>{a(v())},T.$$click=()=>{A(E)},_(T,()=>E.label),B(()=>T.classList.toggle("is-selected",s()===v())),T})()})),w}})]},fn=da;z(["input","keydown","click","mouseover"]);function Wn(e){let t=e.vault.adapter.files,n=[];for(let r in t)t[r].type==="folder"&&n.push(t[r].realpath);return n}var ma=e=>m(fn,{get value(){return e.value},get setValue(){return e.setValue},placeholder:()=>"Select folder...",options:()=>Wn(app).filter(n=>n!=="/"&&n!=="").map(n=>({value:n,label:n}))}),Hn=ma;var pa=S('<button class="mod-cta">Save'),ga=S('<div class="sets-scope-editor"><div class="sets-scope-header"><div class="sets-modal-title">Scope</div></div><div class="sets-scope-body"><select><option disabled hidden value="">Select Scope...</option><option value="type">Type</option><option value="collection">Collection</option><option value="folder">Folder</option><option value="vault">Vault</option></select></div><div class="sets-button-bar"><button class="">Cancel'),ha=e=>{var w,k;let{definition:t,save:n,setDefinition:r}=te(),{db:i,app:o}=ae(),[s,a]=W(((w=t().scope)==null?void 0:w[0])||""),[l,u]=W(((k=t().scope)==null?void 0:k[1])||""),c=()=>{C()&&s()&&(r(M(F({},t()),{scope:[s(),l()]})),n(),e.exit())},f=b=>{let E=b.target;u(""),a(E.value)},d=()=>i.getTypeNames(),h=()=>d().map(b=>({value:b,label:b})),C=()=>{if(s()==="type")return d().includes(l());if(s()==="collection")return l()===xt||i.getCollections().find(b=>i.generateWikiLink(b.file,"/")===l());if(s()==="folder"){if(!l())return!0;let b=o.vault.getAbstractFileByPath(l());return b&&b instanceof Gi.TFolder}return s()==="vault"?!l():!1},D=()=>{let b=i.getCollections().map(E=>({label:E.file.basename,value:i.generateWikiLink(E.file,"/")}));return b.unshift({label:"This",value:xt}),b},A=()=>Wn(o).filter(b=>b!=="/"&&b!=="").map(b=>({value:b,label:b}));return(()=>{let b=ga(),E=b.firstChild,v=E.nextSibling,T=v.firstChild,I=v.nextSibling,P=I.firstChild;return T.$$input=f,_(v,m(V,{get when(){return s()==="type"},get children(){return m(fn,{value:l,setValue:u,options:h,placeholder:()=>"Select type..."})}}),null),_(v,m(V,{get when(){return s()==="collection"},get children(){return m(fn,{value:l,setValue:u,options:D})}}),null),_(v,m(V,{get when(){return s()==="folder"},get children(){return m(Hn,{value:l,setValue:u})}}),null),_(I,m(V,{get when(){return C()},get children(){let H=pa();return H.$$click=c,H}}),P),Ve(P,"click",e.exit,!0),B(()=>T.value=s()),b})()},Xi=ha;z(["input","click"]);var Ft=class extends Qi.Modal{constructor(t,n,r,i){super(t),this.definition=r,this._db=n,this._update=i}onOpen(){let{contentEl:t}=this,n=this;he(()=>m(Se,{get app(){return{app:n.app,db:n._db}},get children(){return m(De,{get setDefinition(){return n.definition},get updateDefinition(){return n._update},get children(){return m(Xi,{exit:()=>{n.close()}})}})}}),t)}onClose(){let{contentEl:t}=this;t.empty()}};var it=["vault"],X=function(e){return e.FileName="__bname",e.FileCreationDate="__ctime",e.FileModificationDate="__mtime",e.FilePath="__path",e}({});function Kn(e){return Object.values(X).includes(e)}var Ee=require("obsidian");var ot=e=>Ji[e],Vr=e=>Object.values(Ji).filter(t=>!!(t.compatibleTypes==="*"||t.compatibleTypes.includes(e))),Rr=(e,t,n)=>{let r=e.getValue(t);return!r||!Array.isArray(r)?!1:(n===void 0&&(n=[]),Array.isArray(n)||(n=[n]),{list:r,value:n})},Ji={eq:{op:"eq",compatibleTypes:["text","number","date","datetime","password"],matches:(e,t,n)=>e.getValue(t)==n,enforce:(e,t)=>t,selectiveness:0,displayName:()=>"Equal",isUnary:!1},neq:{op:"neq",compatibleTypes:["text","number","date","datetime","password"],matches:(e,t,n)=>e.getValue(t)!=n,selectiveness:Number.MAX_VALUE,displayName:()=>"Not equal",isUnary:!1},notempty:{op:"notempty",compatibleTypes:"*",matches:(e,t,n)=>{let r=e.getValue(t);return Array.isArray(r)?r.length>0:r!=null&&r!==""},selectiveness:10,displayName:()=>"Is not empty",isUnary:!0},isempty:{op:"isempty",compatibleTypes:"*",matches:(e,t,n)=>{let r=e.getValue(t);return Array.isArray(r)?r.length===0:r==null||r===""},enforce:(e,t)=>null,selectiveness:10,displayName:()=>"Is empty",isUnary:!0},hasall:{op:"hasall",compatibleTypes:["multitext","aliases","tags"],matches:(e,t,n)=>{let r=Rr(e,t,n);if(!r)return r;let{list:i,value:o}=r;return o.every(s=>i.includes(s))},enforce:(e,t)=>{let n=!e||!Array.isArray(e)?[]:e.slice();return(Array.isArray(t)?t:[t]).forEach(i=>!n.includes(i)&&n.push(i)),n},selectiveness:5,displayName:()=>"Has all",isUnary:!1},hasany:{op:"hasany",compatibleTypes:["multitext","aliases","tags"],matches:(e,t,n)=>{let r=Rr(e,t,n);if(!r)return r;let{list:i,value:o}=r;return o.some(s=>i.includes(s))},enforce:(e,t)=>{let n=!e||!Array.isArray(e)?[]:e.slice();return(Array.isArray(t)?t:[t]).forEach(i=>!n.includes(i)&&n.push(i)),n},selectiveness:5,displayName:()=>"Has any",isUnary:!1},hasnone:{op:"hasnone",compatibleTypes:["multitext","aliases","tags"],matches:(e,t,n)=>{let r=Rr(e,t,n);if(!r)return r;let{list:i,value:o}=r;return o.every(s=>!i.includes(s))},enforce:(e,t)=>[],selectiveness:5,displayName:()=>"Has none",isUnary:!1},gt:{op:"gt",compatibleTypes:["text","number","date","datetime","password"],matches:(e,t,n)=>e.getValue(t)>n,selectiveness:5,displayName:()=>"Greater than",isUnary:!1},gte:{op:"gte",compatibleTypes:["text","number","date","datetime","password"],matches:(e,t,n)=>e.getValue(t)>=n,enforce:(e,t)=>t,selectiveness:5,displayName:()=>"Greater than or equal",isUnary:!1},lt:{op:"lt",compatibleTypes:["text","number","date","datetime","password"],matches:(e,t,n)=>e.getValue(t)<n,selectiveness:5,displayName:()=>"Less than",isUnary:!1},lte:{op:"lte",compatibleTypes:["text","number","date","datetime","password"],matches:(e,t,n)=>e.getValue(t)<=n,enforce:(e,t)=>t,selectiveness:5,displayName:()=>"Less than or equal",isUnary:!1},contains:{op:"contains",compatibleTypes:["text","password"],matches:(e,t,n)=>(e.getValue(t)||"").toString().toLowerCase().includes((n||"").toString().toLowerCase()),selectiveness:2,displayName:()=>"Contains",isUnary:!1},nocontains:{op:"nocontains",compatibleTypes:["text","password"],matches:(e,t,n)=>!(e.getValue(t)||"").toString().toLowerCase().includes((n||"").toString().toLowerCase()),selectiveness:12,displayName:()=>"Does not contain",isUnary:!1},checked:{op:"checked",compatibleTypes:["checkbox"],matches:(e,t,n)=>e.getValue(t)==!0,selectiveness:10,displayName:()=>"Checked",isUnary:!0},unchecked:{op:"unchecked",compatibleTypes:["checkbox"],matches:(e,t,n)=>{let r=e.getValue(t);return r==!1||r===null||r===void 0},enforce:(e,t)=>!1,selectiveness:10,displayName:()=>"Unchecked",isUnary:!0}};var dn=class e{constructor(t,n,r,i,o){switch(this._db=t,this._scope=n[0],this._scopeSpecifier=n[1],this._clauses=r,this._settings=xe(),this._scope){case"type":this._clauses.push([this._settings.typeAttributeKey,"eq",this._scopeSpecifier]);break;case"collection":this._clauses.push([this._settings.collectionAttributeKey,"hasall",[this._scopeSpecifier]]);break;case"folder":this._scopeSpecifier?this._scopeFolder=this._db.getFolder(this._scopeSpecifier):this._scopeFolder=(o==null?void 0:o.file.parent)||void 0;break}let s=r.map(l=>ot(l[1]));this._clauses=this._clauses.sort((l,u)=>{let c=ot(l[1]).selectiveness,f=ot(u[1]).selectiveness;return c-f});let a=r.map(([l])=>l);this._hasExtrinsic=a.some(l=>!Kn(l)),this._attributes=a.map(l=>this._db.getAttributeDefinition(l)),this._canCreate=s.every(l=>l.enforce!==void 0),this._canCreate=this._canCreate&&this._scope!=="collection",this._context=o,this._sortBy=i.slice().reverse()}static __fromClauses(t,n,r,i,o){if(r=r.slice(),Array.isArray(r))return r.length>0?Array.isArray(r[0])?new e(t,n,r,i,o):new e(t,n,[r],i,o):new e(t,n,[],i,o);throw new Error("Query.__fromClauses: clauses must be an array of clauses")}matches(t){return!t||this._hasExtrinsic&&!t.frontmatter?!1:this._clauses.every(r=>{let[i,o,s]=r,a=this._db.getAttributeDefinition(i),l=ot(o),u=s;return $t(s)&&(u=Ln(s,a,t.db,this._context)),l.matches(a,t,u,this._context)})}inferSetType(){let t=this.getClausesByAttr(this._settings.typeAttributeKey);if(t.length>0)return t[0][2]}inferCollection(){if(this.getClausesByAttr(this._settings.collectionAttributeKey).filter(n=>n[1]==="hasall"||n[1]==="hasany").filter(n=>n[2]===xt).length>0&&this._context)return this._db.generateWikiLink(this._context.file)}getClausesByAttr(t,n="eq"){return this._clauses.filter(([i,o,s])=>i===t&&o===n)}get clauses(){return this._clauses}get canCreate(){return this._canCreate}get context(){return this._context}get sortby(){return this._sortBy}get scopeFolder(){return this._scopeFolder}};var jr=class{constructor(t){Oe(this,"context");Oe(this,"events");this.context=t,this.events={}}attach(t,n){if(t==null)throw new Error("missing event");if(n==null)throw new Error("missing callback");let r=this.events[t]||[];this.events[t]=[...r,n]}detach(t,n){if(t==null)throw new Error("missing event");if(n==null)throw new Error("missing callback");let r=this.events[t]||[];this.events[t]=r.filter(i=>i!==n)}notify(t,...n){if(t==null)throw new Error("missing event");(this.events[t]||[]).forEach(i=>{i.apply(this.context,n)})}setContext(t){this.context=t}},Zi=jr;var eo=Zi;var qn=class{constructor(t,n,r){this._key=n,this._displayName=this._displayName||Ce(this._key),this._app=t}get key(){return this._key}displayName(){return this._displayName}getValue(t){var n;return(n=t.frontmatter)==null?void 0:n[this._key]}format(t){var n;return((n=this.getValue(t))==null?void 0:n.toString())||""}getPropertyWidget(){let t=this._key,n=this._app.metadataTypeManager.getPropertyInfo(t),r=this._app.metadataTypeManager.getAssignedType(t)||(n==null?void 0:n.type);return this._app.metadataTypeManager.registeredTypeWidgets[r]}getPropertyInfo(){let t=this._key,n=app.metadataTypeManager.getPropertyInfo(this._key),r=app.metadataTypeManager.getAssignedType(t)||(n==null?void 0:n.type);return{key:t,type:r}}get readonly(){return!1}get isIntrinsic(){return!1}};var Yn=require("obsidian");var st=class{constructor(t,n){this._key=n,this._app=t}get key(){return this._key}displayName(){switch(this._key){case X.FileCreationDate:return"Creation date";case X.FileModificationDate:return"Modification date";case X.FileName:return"Name";case X.FilePath:return"Path";default:return"Unknown"}}getValue(t){switch(this._key){case X.FileCreationDate:return(0,Yn.moment)(t.file.stat.ctime).toISOString();case X.FileModificationDate:return(0,Yn.moment)(t.file.stat.mtime).toISOString();case X.FileName:return t.file.basename;case X.FilePath:return t.file.path}}getPropertyWidget(){switch(this._key){case X.FileCreationDate:case X.FileModificationDate:return this._app.metadataTypeManager.registeredTypeWidgets.date;case X.FileName:case X.FilePath:default:return this._app.metadataTypeManager.registeredTypeWidgets.text}}getPropertyInfo(){return{key:this._key,type:"text"}}get readonly(){return this._key!==X.FileName}get isIntrinsic(){return!0}format(t){let n=this.getValue(t);switch(this._key){case X.FileCreationDate:case X.FileModificationDate:return(0,Yn.moment)(n).format("LL");default:return(n==null?void 0:n.toString())||""}}};function to(e,t){t=t||((i,o)=>i<o?-1:i>o?1:0);let n=e.map((i,o)=>[i,o]),r=(i,o)=>{let s=t(i[0],o[0]);return s!=0?s:i[1]-o[1]};n.sort(r);for(let i=0;i<e.length;i++)e[i]=n[i][0];return e}var no=require("obsidian");function mn(e){let t="```"+Dn+`
`;return t+=(0,no.stringifyYaml)(e),t+="\n```\n",t}var oo=_s(io());var Un=class{constructor(t,n){this._calculate=n,this._name=t}displayName(){return Ce(this._name)}getValue(t){try{return this._calculate(t)}catch(n){return"#error"}}format(t){var n;return((n=this.getValue(t))==null?void 0:n.toString())||""}getPropertyWidget(){}getPropertyInfo(){return{key:this._name,type:"?"}}get readonly(){return!0}get isIntrinsic(){return!1}get key(){return this._name}};function Xn(e,t,n){t=t||Number.MAX_SAFE_INTEGER;let r=e.data;if(n){let i=r.find(o=>o.file.path===n);i&&(r=[i,...r.filter(o=>o.file.path!==n)])}return M(F({},e),{data:r.slice(0,t),total:r.length})}var Gn=class{constructor(t){this.dbInitialized=!1;this._collectionCache=void 0;this._typesCache=void 0;this.observer=new eo;this.accessors=new Map;this.plugin=t,this.app=t.app,this.onMetadataChanged(),this.onMetadataChanged=(0,Ee.debounce)(this.onMetadataChanged.bind(this),100),this.app.metadataCache.on("resolved",this.onMetadataChanged),this.app.vault.on("delete",this.onMetadataChanged),this.app.vault.on("rename",this.onMetadataChanged),this.app.vault.on("create",this.onMetadataChanged)}onMetadataChanged(){this.accessors.clear(),this.dbInitialized=!0,this._collectionCache=void 0,this._typesCache=void 0,this.observer.notify("metadata-changed")}dispose(){this.app.metadataCache.off("resolved",this.onMetadataChanged),this.app.vault.off("delete",this.onMetadataChanged),this.app.vault.off("rename",this.onMetadataChanged),this.app.vault.off("create",this.onMetadataChanged)}on(t,n){this.observer.attach(t,n)}off(t,n){this.observer.detach(t,n)}fromClauses(t,n,r,i){return dn.__fromClauses(this,t,n,r,i)}execute(t){if(!this.dbInitialized)throw Error("VaultDB not initialized yet");let n=Date.now(),r=this.getArchetypeFolder(),i=(r==null?void 0:r.children)||[],o=[],s;t.scopeFolder?s=t.scopeFolder.children.filter(u=>u instanceof Ee.TFile).filter(u=>{var c;return u.path!==((c=t.context)==null?void 0:c.file.path)}).map(u=>u.path):(s=this.app.metadataCache.getCachedFiles(),s=s.filter(u=>u.endsWith(".md")));for(let u of s){let c=this.app.metadataCache.getCache(u);if(c){let f=this.getObjectData(u,c);if(i.contains(f.file))continue;t.matches(f)&&o.push(f)}}t.sortby.forEach(u=>{to(o,(c,f)=>{let d=this.getAttributeDefinition(u[0]);return(u[1]?-1:1)*this.compare(d,c,f)})});let l=Date.now()-n;return{data:o,db:this,query:t,total:o.length}}createNewType(t){return Y(this,null,function*(){let n=rn(t),r=yield this.ensureFolder(`${this.plugin.settings.setsRoot}/${this.plugin.settings.typesFolder}`),i=this.getArchetypeName(t),o=yield this.app.fileManager.createNewFile(r,i,void 0,`${t} Archetype: add the properties of the ${t} here`);this.app.fileManager.processFrontMatter(o,a=>{a[this.plugin.settings.typeAttributeKey]=n});let s=yield this.getSetFolder(n);return this.createSetFile(s,n),o})}createNewInstance(t,n){return Y(this,null,function*(){let r=dn.__fromClauses(this,it,[this.plugin.settings.typeAttributeKey,"eq",t],[],void 0);return yield this.addToSet(r,void 0,n)})}createNewCollection(t){return Y(this,null,function*(){let n=t,r=`${this.plugin.settings.setsRoot}/${this.plugin.settings.collectionsRoot}`;yield this.ensureFolder(r);let i=`${r}/${n}`;yield this.ensureFolder(i);let o=`${i}/${n}.md`,s={scope:[this.plugin.settings.collectionAttributeKey,xt]},a=mn(s),l=yield this.app.vault.create(o,a);return this.app.fileManager.processFrontMatter(l,u=>{u[this.plugin.settings.typeAttributeKey]=this.plugin.settings.collectionType}),l})}createSetFile(t,n){return Y(this,null,function*(){let r=t.name+".md",o=`
${mn({scope:["type",n]})}`;return yield this.app.vault.create(t.path+"/"+r,o)})}compare(t,n,r){let i=t.getValue(n),o=t.getValue(r);return i===o||!i&&!o?0:i==null&&o!==void 0&&o!==null?-1:o==null&&i!==void 0&&i!==null?1:i<o?-1:i>o?1:0}queryType(t){let n=this.fromClauses(it,[[this.plugin.settings.typeAttributeKey,"eq",t]],[]);return this.execute(n)}canAdd(t){return t.query.canCreate}addToSet(t,n,r){return Y(this,null,function*(){var l;let i=yield this.getTemplate(t),{template:o,folder:s}=i,a="";if(o instanceof Ee.TFile&&(a=yield this.app.vault.read(o),a=this.expandTemplate(a,o,s,t,n,r)),s instanceof Ee.TFolder){let u={};n&&(u=this.inferProperties(n,t));let c=yield this.app.fileManager.createNewFile(s,r,void 0,a),f=c.basename;if(yield this.app.fileManager.processFrontMatter(c,d=>{for(let h in u)(d[h]===null||d[h]===void 0)&&(d[h]=u[h]),Array.isArray(d[h])&&!d[h].includes(u[h])&&(d[h]=d[h].concat(u[h]));for(let h in d)h.startsWith("__")&&(h==="__name_prefix"&&(f=`${d[h]}${f}`),h==="__name_suffix"&&(f=`${f}${d[h]}`),delete d[h])}),f!==c.basename){let d=`${((l=c.parent)==null?void 0:l.path)||""}/${f}.${c.extension}`;return yield this.app.fileManager.renameFile(c,d),this.app.vault.getAbstractFileByPath(d)}return c}})}expandTemplate(t,n,r,i,o,s){var a;try{t=oo.render(t,{time:(0,Ee.moment)().format("HH:mm:ss"),date:(0,Ee.moment)().format("YYYY-MM-DD"),archetype:n,folder:r,context:(a=i.context)==null?void 0:a.file,properties:o,name:s,type:i.inferSetType()},{autoTrim:!1})}catch(l){console.error(l),console.error(`Error while rendering template ${n.path}`)}return t}getTemplate(t){return Y(this,null,function*(){var o,s;let n=t.inferSetType();if(n){let a;t.scopeFolder?a=t.scopeFolder:a=this.plugin.settings.createObjectsInSetsFolder||!((o=t.context)!=null&&o.file.parent)?yield this.getSetFolder(n):t.context.file.parent;let l=this.getArchetypeFile(n);return l||(l=yield this.inferType(n)),{template:l,folder:a}}if(t.inferCollection()&&t.context){let a=t.context.file.parent;if(a)return{template:void 0,folder:a}}return t.scopeFolder?{template:void 0,folder:t.scopeFolder}:{template:void 0,folder:(s=t.context)==null?void 0:s.file.parent}})}inferProperties(t,n){let r=t.filter(s=>!s.startsWith("__")).reduce((s,a)=>M(F({},s),{[a]:null}),{}),i=n.clauses.filter(([s])=>s!==this.plugin.settings.typeAttributeKey).filter(([s])=>!this.getAttributeDefinition(s).isIntrinsic),o=n.context;return r=i.reduce((s,[a,l,u])=>{var C;let c=ot(l),f=s[a],d=u;$t(u)&&(d=Ln(u,this.getAttributeDefinition(a),this,o));let h=(C=c.enforce)==null?void 0:C.call(c,f,d,o);return M(F({},s),{[a]:h})},r),r}getCollections(){if(this._collectionCache!==void 0)return this._collectionCache;let t=[this.plugin.settings.typeAttributeKey,"eq",this.plugin.settings.collectionType],n=this.fromClauses(it,[t],[]),r=this.execute(n);return this._collectionCache=r.data,r.data}getTypes(){if(this._typesCache!==void 0)return this._typesCache;let t=this.getArchetypeFolder();if(!t)return[];let n=t.children.filter(r=>r instanceof Ee.TFile);return this._typesCache=n,n}getTypeNames(){return this.getTypes().map(t=>{var r;let n=this.app.metadataCache.getFileCache(t);if(n)return(r=n.frontmatter)==null?void 0:r[this.plugin.settings.typeAttributeKey]}).filter(t=>t!==void 0)}getCollectionNames(){return this.getCollections().map(t=>t.file.basename).filter(t=>t!==void 0)}getCollectionFileName(t){return`${this.plugin.settings.setsRoot}/${this.plugin.settings.collectionsRoot}/${t}/${t}.md`}getAttributeDefinition(t,n){if(this.accessors.has(t))return this.accessors.get(t);let r;if(Kn(t))r=new st(this.app,t);else if(n!=null&&n.calculatedFields&&t in n.calculatedFields){let i=s=>{function a(d){return this.getAttributeDefinition(d).getValue(s)}let l=n.calculatedFields[t],c=l.indexOf("return")===-1?"return "+l:l;return new Function("prop",c)(a.bind(this))};r=new Un(t,i)}else r=new qn(this.app,t);return this.accessors.set(t,r),r}getArchetypeFile(t){let n=this.getTypes();return n.length<1?void 0:n.find(i=>{var s;let o=this.app.metadataCache.getFileCache(i);if(o&&((s=o.frontmatter)==null?void 0:s[this.plugin.settings.typeAttributeKey])===t)return!0})}getTypeAttributes(t){let n=this.getArchetypeFile(t);if(n){let r=this.app.metadataCache.getFileCache(n);if(r!=null&&r.frontmatter){let i=Object.keys(r.frontmatter);return i.remove(this.plugin.settings.typeAttributeKey),i.filter(o=>!o.startsWith("__"))}}}getFolder(t){return this.app.vault.getAbstractFileByPath(t)}getArchetypeFolder(){return this.app.vault.getAbstractFileByPath(`${this.plugin.settings.setsRoot}/${this.plugin.settings.typesFolder}`)}getArchetypePath(t){return`${this.plugin.settings.setsRoot}/${this.plugin.settings.typesFolder}/${this.getArchetypeName(t)}`}getArchetypeName(t){return`${t}${this.plugin.settings.typesSuffix}.md`}getTypeDisplayName(t){return Ce(t)}getSetFolderName(t){return`${this.plugin.settings.setsRoot}/${this.getTypeDisplayName(t)}${this.plugin.settings.typeSetSuffix}`}getSetFileName(t){return`${this.plugin.settings.setsRoot}/${this.getTypeDisplayName(t)}${this.plugin.settings.typeSetSuffix}/${this.getTypeDisplayName(t)}${this.plugin.settings.typeSetSuffix}.md`}getSetFolder(t){return Y(this,null,function*(){let n=this.getSetFolderName(t),r=this.app.vault.getAbstractFileByPath(n);return(!r||!(r instanceof Ee.TFolder))&&(r=yield this.app.vault.createFolder(n)),r})}inferType(t){return Y(this,null,function*(){let n=this.getTypeDisplayName(t),r={},i=this.queryType(t);for(let u of i.data)if(u.frontmatter)for(let c in u.frontmatter)r[c]=r[c]||[],r[c].contains(u.frontmatter[c])||u.frontmatter[c]&&r[c].push(u.frontmatter[c]);let o={};for(let u in r){let c=r[u];c.length===1?o[u]=c[0]:o[u]=null}let s=this.getArchetypeName(n),a=yield this.ensureFolder(`${this.plugin.settings.setsRoot}/${this.plugin.settings.typesFolder}`),l=yield this.app.fileManager.createNewFile(a,s,void 0,`${n} Archetype Inferred`);return yield this.app.fileManager.processFrontMatter(l,u=>{Object.assign(u,o)}),l})}generateWikiLink(t,n="/"){return`[[${app.metadataCache.fileToLinktext(t,n)}]]`}getDataContext(t){return this.getObjectData(t)}getObjectData(t,n){n===void 0&&(n=this.app.metadataCache.getCache(t)||void 0);let r=this.app.vault.getAbstractFileByPath(t);if(!r)throw Error(`File ${t} not found!`);if(!(r instanceof Ee.TFile))throw Error(`${t} is a folder`);return{name:t,file:r,frontmatter:n.frontmatter,db:this}}ensureFolder(t){return Y(this,null,function*(){let n=this.app.vault.getAbstractFileByPath(t);return(!n||!(n instanceof Ee.TFolder))&&(n=yield this.app.vault.createFolder(t)),n})}inferFields(t){let n={};return t.data.forEach(r=>{Object.assign(n,r.frontmatter)}),[...Object.keys(n)]}};var uo=require("obsidian");var Zn=require("obsidian");function Qn(e,t){let n={};for(let r of t)n[r[e]]=r;return n}function Br(e,t,n){let r={};for(let i of t)r[i[e]]=n(i);return r}function so(e,t){return t.sort((r,i)=>r[e]<i[e]?-1:r[e]>i[e]?1:0)}var Wr;function Jn(e,t){return Je(e).find(n=>n.key===t)}function Je(e){Wr||(Wr=Qn("type",Object.values(e.metadataTypeManager.registeredTypeWidgets)));let t=Object.values(e.metadataTypeManager.properties).filter(i=>i.name&&i.name.length).filter(i=>!i.name.startsWith("__"));t=so("name",t);let n=t.map(i=>{let o=Wr[i.type];return{key:i.name,name:i.name,count:i.count,typeName:o==null?void 0:o.name(),typeKey:o==null?void 0:o.type,typeIcon:o==null?void 0:o.icon}});return[...[{name:new st(e,X.FileName).displayName(),key:X.FileName,count:Number.NaN,typeName:"Text",typeKey:"text",typeIcon:"lucide-text"},{name:new st(e,X.FilePath).displayName(),key:X.FilePath,count:Number.NaN,typeName:"Text",typeKey:"text",typeIcon:"lucide-text"},{name:new st(e,X.FileCreationDate).displayName(),key:X.FileCreationDate,count:Number.NaN,typeName:"Date & time",typeKey:"datetime",typeIcon:"lucide-clock"},{name:new st(e,X.FileModificationDate).displayName(),key:X.FileModificationDate,count:Number.NaN,typeName:"Date & time",typeKey:"datetime",typeIcon:"lucide-clock"}],...n]}var It=class extends Zn.SuggestModal{constructor(t,n,r){super(t),this._onSelect=n,this._filter=r}getSuggestions(t){return t=t.toLowerCase(),Je(this.app).filter(r=>r.name&&r.name.length&&r.name.toLowerCase().includes(t)).filter(r=>!this._filter||this._filter(r))}renderSuggestion(t,n){n.createEl("div",{text:t.name});let r=n.createEl("div",{cls:"metadata-property-key"}),i=r.createEl("div",{cls:"metadata-property-icon"});(0,Zn.setIcon)(i,t.typeIcon||"file-question"),r.createEl("div",{text:`${t.typeName||"unknown"}`,cls:"metadata-property-icon"})}onChooseSuggestion(t,n){this._onSelect&&this._onSelect(t)}};var Mt=require("obsidian");var ya=S('<span class="metadata-property-icon">'),ba=S('<input type="text" class="metadata-property-key" readonly>'),va=S('<div class="sets-operator-ddl">'),wa=S("<div>"),xa=S('<div class="metadata-property-value">'),$a=S('<div class="sets-clause"><div class="clickable-icon">'),_a=e=>{let{app:t,db:n}=ae(),r=()=>Je(t).find(v=>v.key===e.clause[0]),i=()=>{var E;let b=(E=s())==null?void 0:E.typeKey;return b?Vr(b):[]},o=()=>ot(e.clause[1]),[s,a]=W(r()),l=()=>{var b;return(b=s())!=null&&b.typeKey?Di(s().typeKey):[]},u,c,f,d,h;U(()=>{(0,Mt.setIcon)(h,"x")});let C=b=>{new It(t,v=>{let I=n.getAttributeDefinition(v.key).getPropertyWidget(),H=Vr(v.typeKey)[0].op;I&&e.update([v.key,H,I==null?void 0:I.default()]),a(v)}).open()},D=()=>s()!==void 0,A=()=>{var b;return(b=o())!=null&&b.isUnary?!1:l().length===0?!0:!(typeof e.clause[2]=="string"&&$t(e.clause[2]))};Z(()=>{let b=s();if(b){let E=b.typeIcon;(0,Mt.setIcon)(u,E||"file-question")}}),Z(()=>{if(D()){let b=Br("op",i(),E=>E.displayName());c.empty(),new Mt.DropdownComponent(c).addOptions(b).onChange(E=>{e.update([e.clause[0],E,e.clause[2]])}).setValue(e.clause[1]||i[0].op)}});let w=()=>{var b;return l().length>0&&!((b=o())!=null&&b.isUnary)};Z(()=>{if(w()){let b=Br("id",l(),v=>v.displayName());b[""]="Value:",f.empty();let E;e.clause[2]!==void 0&&$t(e.clause[2])?E=e.clause[2]:E="",new Mt.DropdownComponent(f).addOptions(b).onChange(v=>{e.update([e.clause[0],e.clause[1],v])}).setValue(E)}}),Z(()=>{var b,E,v,T;if(A()){if(!((b=s())!=null&&b.key))return;let P=n.getAttributeDefinition(s().key).getPropertyWidget();P&&(d.empty(),P.render(d,{key:(E=s())==null?void 0:E.key,type:(v=s())==null?void 0:v.typeKey,value:e.clause[2]||P.default()},{app:t,key:(T=s())==null?void 0:T.key,onChange:H=>{e.update([e.clause[0],e.clause[1],H])},rerender:()=>{},sourcePath:"/",blur:()=>{},metadataEditor:null}))}});let k=()=>{e.remove()};return(()=>{let b=$a(),E=b.firstChild;_(b,m(V,{get when(){return s()},get children(){return[(()=>{let T=ya(),I=u;return typeof I=="function"?R(I,T):u=T,T})(),(()=>{let T=ba();return T.$$click=C,B(()=>{var I;return T.value=(I=s())==null?void 0:I.name}),T})()]}}),E),_(b,m(V,{get when(){return D()},get children(){let T=va(),I=c;return typeof I=="function"?R(I,T):c=T,T}}),E),_(b,m(V,{get when(){return w()},get children(){let T=wa(),I=f;return typeof I=="function"?R(I,T):f=T,T}}),E),_(b,m(V,{get when(){return A()},get children(){let T=xa(),I=d;return typeof I=="function"?R(I,T):d=T,T}}),E),E.$$click=k;let v=h;return typeof v=="function"?R(v,E):h=E,b})()},ao=_a;z(["click"]);var lo=require("obsidian");var Sa=S('<div class="sets-filter-editor"><div class="sets-filter-header"><div class="sets-modal-title">Filters</div></div><div class="sets-filters-scroller"><div class="sets-filters-wrapper"></div></div><div class="sets-filter-buttons clickable-icon"><div class="sets-filter-add-btn clickable-icon"></div>Add filter</div><div class="sets-filter-topresults"><div class="sets-modal-title">Max results</div><input type="number" placeholder="Max Results "><div class="sets-modal-info"></div></div><div class="sets-button-bar"><button class="mod-cta">Save</button><button class="">Cancel'),Ca=e=>{let{definition:t,save:n,addFilter:r,updateFilter:i,removeFilter:o,setDefinition:s}=te(),a;U(()=>{(0,lo.setIcon)(a,"plus")});let l=()=>{n(),e.exit()},u=(h,C)=>{i(h,C)},c=h=>{o(h)},f=h=>{let C=[X.FileName,"eq",""];r(C)},d=h=>{let C=h.target,D=parseInt(C.value);isNaN(D)?s(M(F({},t()),{topResults:void 0})):s(M(F({},t()),{topResults:D}))};return(()=>{let h=Sa(),C=h.firstChild,D=C.nextSibling,A=D.firstChild,w=D.nextSibling,k=w.firstChild,b=w.nextSibling,E=b.firstChild,v=E.nextSibling,T=v.nextSibling,I=b.nextSibling,P=I.firstChild,H=P.nextSibling;_(A,m(ee,{get each(){return t().filter||[]},children:(Q,oe)=>m(ao,{clause:Q,remove:()=>c(oe()),update:ye=>u(oe(),ye)})})),w.$$click=f;let q=a;return typeof q=="function"?R(q,k):a=k,v.$$input=d,_(T,()=>`(default:${e.defaultTopResults})`),P.$$click=l,Ve(H,"click",e.exit,!0),B(()=>v.value=t().topResults),h})()},co=Ca;z(["click","input"]);var Pt=class extends uo.Modal{constructor(t,n,r,i,o){super(t),this.definition=r,this._db=n,this._update=o,this._defaultTopResults=i}onOpen(){let{contentEl:t}=this,n=this;he(()=>m(Se,{get app(){return{app:n.app,db:n._db}},get children(){return m(De,{get setDefinition(){return n.definition},get updateDefinition(){return n._update},get children(){return m(co,{exit:()=>{n.close()},get defaultTopResults(){return n._defaultTopResults}})}})}}),t)}onClose(){let{contentEl:t}=this;t.empty()}};var xo=require("obsidian");var pn=require("obsidian");var Hr=S('<div class="sets-field-property-toggle clickable-icon">'),ka=S('<div class="sets-field-item"><div class="sets-field-property-icon"></div><div class="sets-field-property-name">'),gt=e=>{let t,n,r,i;U(()=>{t&&(0,pn.setIcon)(t,e.typeIcon||"file-question"),r&&(0,pn.setIcon)(r,"pencil"),i&&(0,pn.setIcon)(i,"cross"),e.icon&&n&&(0,pn.setIcon)(n,e.icon)});let o=a=>{e.onItemClick&&e.onItemClick(e)},s=(a,l)=>{a.stopPropagation(),e.onIconClick?e.onIconClick(e,l):e.onItemClick&&e.onItemClick(e,l)};return(()=>{let a=ka(),l=a.firstChild,u=l.nextSibling;a.$$click=o;let c=t;return typeof c=="function"?R(c,l):t=l,_(u,()=>e.name),_(a,m(pt,{get children(){return[m(we,{get when(){return e.calculated},get children(){return[(()=>{let f=Hr();f.$$click=h=>s(h,"edit");let d=r;return typeof d=="function"?R(d,f):r=f,f})(),(()=>{let f=Hr();f.$$click=h=>s(h,"delete");let d=i;return typeof d=="function"?R(d,f):i=f,f})()]}}),m(we,{get when(){return e.icon},get children(){let f=Hr();f.$$click=s;let d=n;return typeof d=="function"?R(d,f):n=f,f}})]}}),null),a})()};z(["click"]);var vo=require("obsidian");var Kr=Symbol("store-raw"),Nt=Symbol("store-node"),at=Symbol("store-has"),fo=Symbol("store-self");function mo(e){let t=e[Be];if(!t&&(Object.defineProperty(e,Be,{value:t=new Proxy(e,Ta)}),!Array.isArray(e))){let n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let i=0,o=n.length;i<o;i++){let s=n[i];r[s].get&&Object.defineProperty(e,s,{enumerable:r[s].enumerable,get:r[s].get.bind(t)})}}return t}function er(e){let t;return e!=null&&typeof e=="object"&&(e[Be]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function hn(e,t=new Set){let n,r,i,o;if(n=e!=null&&e[Kr])return n;if(!er(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let s=0,a=e.length;s<a;s++)i=e[s],(r=hn(i,t))!==i&&(e[s]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);let s=Object.keys(e),a=Object.getOwnPropertyDescriptors(e);for(let l=0,u=s.length;l<u;l++)o=s[l],!a[o].get&&(i=e[o],(r=hn(i,t))!==i&&(e[o]=r))}return e}function tr(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function yn(e,t,n){if(e[t])return e[t];let[r,i]=W(n,{equals:!1,internal:!0});return r.$=i,e[t]=r}function Da(e,t){let n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===Be||t===Nt||(delete n.value,delete n.writable,n.get=()=>e[Be][t]),n}function po(e){In()&&yn(tr(e,Nt),fo)()}function Aa(e){return po(e),Reflect.ownKeys(e)}var Ta={get(e,t,n){if(t===Kr)return e;if(t===Be)return n;if(t===On)return po(e),n;let r=tr(e,Nt),i=r[t],o=i?i():e[t];if(t===Nt||t===at||t==="__proto__")return o;if(!i){let s=Object.getOwnPropertyDescriptor(e,t);In()&&(typeof o!="function"||e.hasOwnProperty(t))&&!(s&&s.get)&&(o=yn(r,t,o)())}return er(o)?mo(o):o},has(e,t){return t===Kr||t===Be||t===On||t===Nt||t===at||t==="__proto__"?!0:(In()&&yn(tr(e,at),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Aa,getOwnPropertyDescriptor:Da};function nr(e,t,n,r=!1){if(!r&&e[t]===n)return;let i=e[t],o=e.length;n===void 0?(delete e[t],e[at]&&e[at][t]&&i!==void 0&&e[at][t].$()):(e[t]=n,e[at]&&e[at][t]&&i===void 0&&e[at][t].$());let s=tr(e,Nt),a;if((a=yn(s,t,i))&&a.$(()=>n),Array.isArray(e)&&e.length!==o){for(let l=e.length;l<o;l++)(a=s[l])&&a.$();(a=yn(s,"length",o))&&a.$(e.length)}(a=s[fo])&&a.$()}function go(e,t){let n=Object.keys(t);for(let r=0;r<n.length;r+=1){let i=n[r];nr(e,i,t[i])}}function Ea(e,t){if(typeof t=="function"&&(t=t(e)),t=hn(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){let i=t[n];e[n]!==i&&nr(e,n,i)}nr(e,"length",r)}else go(e,t)}function gn(e,t,n=[]){let r,i=e;if(t.length>1){r=t.shift();let s=typeof r,a=Array.isArray(e);if(Array.isArray(r)){for(let l=0;l<r.length;l++)gn(e,[r[l]].concat(t),n);return}else if(a&&s==="function"){for(let l=0;l<e.length;l++)r(e[l],l)&&gn(e,[l].concat(t),n);return}else if(a&&s==="object"){let{from:l=0,to:u=e.length-1,by:c=1}=r;for(let f=l;f<=u;f+=c)gn(e,[f].concat(t),n);return}else if(t.length>1){gn(e[r],t,[r].concat(n));return}i=e[r],n=[r].concat(n)}let o=t[0];typeof o=="function"&&(o=o(i,n),o===i)||r===void 0&&o==null||(o=hn(o),r===void 0||er(i)&&er(o)&&!Array.isArray(o)?go(i,o):nr(e,r,o))}function bn(...[e,t]){let n=hn(e||{}),r=Array.isArray(n),i=mo(n);function o(...s){He(()=>{r&&s.length===1?Ea(n,s[0]):gn(n,s)})}return[i,o]}var wm=Symbol("store-root");var rr=class{constructor(e){Oe(this,"x");Oe(this,"y");Oe(this,"width");Oe(this,"height");this.x=Math.floor(e.x),this.y=Math.floor(e.y),this.width=Math.floor(e.width),this.height=Math.floor(e.height)}get rect(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get center(){return{x:this.x+this.width*.5,y:this.y+this.height*.5}}get corners(){return{topLeft:{x:this.left,y:this.top},topRight:{x:this.right,y:this.top},bottomRight:{x:this.left,y:this.bottom},bottomLeft:{x:this.right,y:this.bottom}}}},Lt=e=>{let t=new rr(e.getBoundingClientRect()),{transform:n}=getComputedStyle(e);return n&&(t=Oa(t,n)),t},Oa=(e,t)=>{let n,r;if(t.startsWith("matrix3d(")){let i=t.slice(9,-1).split(/, /);n=+i[12],r=+i[13]}else if(t.startsWith("matrix(")){let i=t.slice(7,-1).split(/, /);n=+i[4],r=+i[5]}else n=0,r=0;return new rr(M(F({},e),{x:e.x-n,y:e.y-r}))},Ye=()=>({x:0,y:0}),zr=(e,t)=>e.x===t.x&&e.y===t.y,qr=(e,t)=>new rr(M(F({},e),{x:e.x+t.x,y:e.y+t.y})),Fa=(e,t)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),Ia=(e,t)=>{let n=Math.max(e.top,t.top),r=Math.max(e.left,t.left),i=Math.min(e.right,t.right),o=Math.min(e.bottom,t.bottom),s=i-r,a=o-n;if(r<i&&n<o){let l=e.width*e.height,u=t.width*t.height,c=s*a;return c/(l+u-c)}return 0},Yr=(e,t)=>e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height,Rt=(e,t,n)=>{let r=e.transformed.center,i={distance:1/0,droppable:null};for(let o of t){let s=Fa(r,o.layout.center);s<i.distance?(i.distance=s,i.droppable=o):s===i.distance&&o.id===n.activeDroppableId&&(i.droppable=o)}return i.droppable};var Ma=(e,t,n)=>{let r=e.transformed,i={ratio:0,droppable:null};for(let o of t){let s=Ia(r,o.layout);s>i.ratio?(i.ratio=s,i.droppable=o):s>0&&s===i.ratio&&o.id===n.activeDroppableId&&(i.droppable=o)}return i.droppable},ho=ze(),ht=e=>{let t=Ke({collisionDetector:Ma},e),[n,r]=bn({draggables:{},droppables:{},sensors:{},active:{draggableId:null,get draggable(){return n.active.draggableId!==null?n.draggables[n.active.draggableId]:null},droppableId:null,get droppable(){return n.active.droppableId!==null?n.droppables[n.active.droppableId]:null},sensorId:null,get sensor(){return n.active.sensorId!==null?n.sensors[n.active.sensorId]:null},overlay:null}}),i=(O,j,p)=>{O.substring(0,O.length-1),re(()=>n[O][j])&&r(O,j,"transformers",p.id,p)},o=(O,j,p)=>{O.substring(0,O.length-1),re(()=>n[O][j])&&re(()=>n[O][j].transformers[p])&&r(O,j,"transformers",p,void 0)},s=({id:O,node:j,layout:p,data:g})=>{let x=n.draggables[O],y={id:O,node:j,layout:p,data:g,_pendingCleanup:!1},$;if(!x)Object.defineProperties(y,{transformers:{enumerable:!0,configurable:!0,writable:!0,value:{}},transform:{enumerable:!0,configurable:!0,get:()=>{if(n.active.overlay)return Ye();let L=Object.values(n.draggables[O].transformers);return L.sort((K,ie)=>K.order-ie.order),L.reduce((K,ie)=>ie.callback(K),Ye())}},transformed:{enumerable:!0,configurable:!0,get:()=>qr(n.draggables[O].layout,n.draggables[O].transform)}});else if(n.active.draggableId===O&&!n.active.overlay){let L={x:x.layout.x-p.x,y:x.layout.y-p.y},K="addDraggable-existing-offset",ie=x.transformers[K],fe=ie?ie.callback(L):L;$={id:K,order:100,callback:pe=>({x:pe.x+fe.x,y:pe.y+fe.y})},Q(()=>o("draggables",O,K))}He(()=>{r("draggables",O,y),$&&i("draggables",O,$)}),n.active.draggable&&E()},a=O=>{re(()=>n.draggables[O])&&(r("draggables",O,"_pendingCleanup",!0),queueMicrotask(()=>l(O)))},l=O=>{var j;if((j=n.draggables[O])!=null&&j._pendingCleanup){let p=n.active.draggableId===O;He(()=>{p&&r("active","draggableId",null),r("draggables",O,void 0)})}},u=({id:O,node:j,layout:p,data:g})=>{let x=n.droppables[O],y={id:O,node:j,layout:p,data:g,_pendingCleanup:!1};x||Object.defineProperties(y,{transformers:{enumerable:!0,configurable:!0,writable:!0,value:{}},transform:{enumerable:!0,configurable:!0,get:()=>{let $=Object.values(n.droppables[O].transformers);return $.sort((L,K)=>L.order-K.order),$.reduce((L,K)=>K.callback(L),Ye())}},transformed:{enumerable:!0,configurable:!0,get:()=>qr(n.droppables[O].layout,n.droppables[O].transform)}}),r("droppables",O,y),n.active.draggable&&E()},c=O=>{re(()=>n.droppables[O])&&(r("droppables",O,"_pendingCleanup",!0),queueMicrotask(()=>f(O)))},f=O=>{var j;if((j=n.droppables[O])!=null&&j._pendingCleanup){let p=n.active.droppableId===O;He(()=>{p&&r("active","droppableId",null),r("droppables",O,void 0)})}},d=({id:O,activators:j})=>{r("sensors",O,{id:O,activators:j,coordinates:{origin:{x:0,y:0},current:{x:0,y:0},get delta(){return{x:n.sensors[O].coordinates.current.x-n.sensors[O].coordinates.origin.x,y:n.sensors[O].coordinates.current.y-n.sensors[O].coordinates.origin.y}}}})},h=O=>{if(!re(()=>n.sensors[O]))return;let j=n.active.sensorId===O;He(()=>{j&&r("active","sensorId",null),r("sensors",O,void 0)})},C=({node:O,layout:j})=>{let p=n.active.overlay,g={node:O,layout:j};p||Object.defineProperties(g,{id:{enumerable:!0,configurable:!0,get:()=>{var x;return(x=n.active.draggable)==null?void 0:x.id}},data:{enumerable:!0,configurable:!0,get:()=>{var x;return(x=n.active.draggable)==null?void 0:x.data}},transformers:{enumerable:!0,configurable:!0,get:()=>Object.fromEntries(Object.entries(n.active.draggable?n.active.draggable.transformers:{}).filter(([x])=>x!=="addDraggable-existing-offset"))},transform:{enumerable:!0,configurable:!0,get:()=>{let x=Object.values(n.active.overlay?n.active.overlay.transformers:[]);return x.sort((y,$)=>y.order-$.order),x.reduce((y,$)=>$.callback(y),Ye())}},transformed:{enumerable:!0,configurable:!0,get:()=>n.active.overlay?qr(n.active.overlay.layout,n.active.overlay.transform):new rr({x:0,y:0,width:0,height:0})}}),r("active","overlay",g)},D=()=>r("active","overlay",null),A=(O,j)=>{He(()=>{r("sensors",O,"coordinates",{origin:F({},j),current:F({},j)}),r("active","sensorId",O)})},w=O=>{let j=n.active.sensorId;j&&r("sensors",j,"coordinates","current",F({},O))},k=()=>r("active","sensorId",null),b=(O,j)=>{var x;let p={};for(let y of Object.values(n.sensors))if(y)for(let[$,L]of Object.entries(y.activators))(x=p[$])!=null||(p[$]=[]),p[$].push({sensor:y,activator:L});let g={};for(let y in p){let $=y;j&&($=`on${y}`),g[$]=L=>{for(let{activator:K}of p[y]){if(n.active.sensor)break;K(L,O)}}}return g},E=()=>{let O=!1,j=Object.values(n.draggables),p=Object.values(n.droppables),g=n.active.overlay;return He(()=>{let x=new WeakMap;for(let y of j)if(y){let $=y.layout;x.has(y.node)||x.set(y.node,Lt(y.node));let L=x.get(y.node);Yr($,L)||(r("draggables",y.id,"layout",L),O=!0)}for(let y of p)if(y){let $=y.layout;x.has(y.node)||x.set(y.node,Lt(y.node));let L=x.get(y.node);Yr($,L)||(r("droppables",y.id,"layout",L),O=!0)}if(g){let y=g.layout,$=Lt(g.node);Yr(y,$)||(r("active","overlay","layout",$),O=!0)}}),O},v=()=>{var j;let O=(j=n.active.overlay)!=null?j:n.active.draggable;if(O){let p=t.collisionDetector(O,Object.values(n.droppables),{activeDroppableId:n.active.droppableId}),g=p?p.id:null;n.active.droppableId!==g&&r("active","droppableId",g)}},T=O=>{let j={id:"sensorMove",order:0,callback:p=>n.active.sensor?{x:p.x+n.active.sensor.coordinates.delta.x,y:p.y+n.active.sensor.coordinates.delta.y}:p};E(),He(()=>{r("active","draggableId",O),i("draggables",O,j)}),v()},I=()=>{let O=re(()=>n.active.draggableId);He(()=>{O!==null&&o("draggables",O,"sensorMove"),r("active",["draggableId","droppableId"],null)}),E()},P=O=>{Z(()=>{let j=n.active.draggable;j&&re(()=>O({draggable:j}))})},H=O=>{Z(()=>{let j=n.active.draggable;if(j){let p=re(()=>n.active.overlay);Object.values(p?p.transform:j.transform),re(()=>O({draggable:j,overlay:p}))}})},q=O=>{Z(()=>{let j=n.active.draggable,p=n.active.droppable;j&&re(()=>O({draggable:j,droppable:p,overlay:n.active.overlay}))})},Q=O=>{Z(({previousDraggable:j,previousDroppable:p,previousOverlay:g})=>{let x=n.active.draggable,y=x?n.active.droppable:null,$=x?n.active.overlay:null;return!x&&j&&re(()=>O({draggable:j,droppable:p,overlay:g})),{previousDraggable:x,previousDroppable:y,previousOverlay:$}},{previousDraggable:null,previousDroppable:null,previousOverlay:null})};H(()=>v()),t.onDragStart&&P(t.onDragStart),t.onDragMove&&H(t.onDragMove),t.onDragOver&&q(t.onDragOver),t.onDragEnd&&Q(t.onDragEnd);let ye=[n,{addTransformer:i,removeTransformer:o,addDraggable:s,removeDraggable:a,addDroppable:u,removeDroppable:c,addSensor:d,removeSensor:h,setOverlay:C,clearOverlay:D,recomputeLayouts:E,detectCollisions:v,draggableActivators:b,sensorStart:A,sensorMove:w,sensorEnd:k,dragStart:T,dragEnd:I,onDragStart:P,onDragMove:H,onDragOver:q,onDragEnd:Q}];return m(ho.Provider,{value:ye,get children(){return t.children}})},Vt=()=>Ue(ho)||null,Pa=(e="pointer-sensor")=>{let[t,{addSensor:n,removeSensor:r,sensorStart:i,sensorMove:o,sensorEnd:s,dragStart:a,dragEnd:l}]=Vt(),u=250,c=10;U(()=>{n({id:e,activators:{pointerdown:D}})}),ve(()=>{r(e)});let f=()=>t.active.sensorId===e,d={x:0,y:0},h=null,C=null,D=(v,T)=>{v.button===0&&(document.addEventListener("pointermove",k),document.addEventListener("pointerup",b),C=T,d.x=v.clientX,d.y=v.clientY,h=window.setTimeout(w,u))},A=()=>{h&&(clearTimeout(h),h=null),document.removeEventListener("pointermove",k),document.removeEventListener("pointerup",b),document.removeEventListener("selectionchange",E)},w=()=>{t.active.sensor?f()||A():(i(e,d),a(C),E(),document.addEventListener("selectionchange",E))},k=v=>{let T={x:v.clientX,y:v.clientY};if(!t.active.sensor){let I={x:T.x-d.x,y:T.y-d.y};Math.sqrt(I.x**2+I.y**2)>c&&w()}f()&&(v.preventDefault(),o(T))},b=v=>{A(),f()&&(v.preventDefault(),l(),s())},E=()=>{var v;(v=window.getSelection())==null||v.removeAllRanges()}},yt=e=>(Pa(),se(()=>e.children));var ir=e=>({transform:`translate3d(${e.x}px, ${e.y}px, 0)`});var Ur=(e,t={})=>{let[n,{addDraggable:r,removeDraggable:i,draggableActivators:o}]=Vt(),[s,a]=W(null);U(()=>{let f=s();f&&r({id:e,node:f,layout:Lt(f),data:t})}),ve(()=>i(e));let l=()=>n.active.draggableId===e,u=()=>{var f;return((f=n.draggables[e])==null?void 0:f.transform)||Ye()};return Object.defineProperties((f,d)=>{let h=d?d():{};Z(()=>{let C=s(),D=o(e);if(C)for(let A in D)C.addEventListener(A,D[A]);ve(()=>{if(C)for(let A in D)C.removeEventListener(A,D[A])})}),a(f),h.skipTransform||Z(()=>{var D;let C=u();if(zr(C,Ye()))f.style.removeProperty("transform");else{let A=ir(u());f.style.setProperty("transform",(D=A.transform)!=null?D:null)}})},{ref:{enumerable:!0,value:a},isActiveDraggable:{enumerable:!0,get:l},dragActivators:{enumerable:!0,get:()=>o(e,!0)},transform:{enumerable:!0,get:u}})},Gr=(e,t={})=>{let[n,{addDroppable:r,removeDroppable:i}]=Vt(),[o,s]=W(null);U(()=>{let c=o();c&&r({id:e,node:c,layout:Lt(c),data:t})}),ve(()=>i(e));let a=()=>n.active.droppableId===e,l=()=>{var c;return((c=n.droppables[e])==null?void 0:c.transform)||Ye()};return Object.defineProperties((c,f)=>{let d=f?f():{};s(c),d.skipTransform||Z(()=>{var C;let h=l();if(zr(h,Ye()))c.style.removeProperty("transform");else{let D=ir(l());c.style.setProperty("transform",(C=D.transform)!=null?C:null)}})},{ref:{enumerable:!0,value:s},isActiveDroppable:{enumerable:!0,get:a},transform:{enumerable:!0,get:l}})},Na=S("<div></div>",2),yo=e=>{let[t,{onDragStart:n,onDragEnd:r,setOverlay:i,clearOverlay:o}]=Vt(),s;n(({draggable:l})=>{i({node:l.node,layout:l.layout}),queueMicrotask(()=>{if(s){let u=Lt(s),c={x:(l.layout.width-u.width)/2,y:(l.layout.height-u.height)/2};u.x+=c.x,u.y+=c.y,i({node:s,layout:u})}})}),r(()=>queueMicrotask(o));let a=()=>{let l=t.active.overlay,u=t.active.draggable;return!l||!u?{}:F(F({position:"fixed",transition:"transform 0s",top:`${l.layout.top}px`,left:`${l.layout.left}px`,"min-width":`${u.layout.width}px`,"min-height":`${u.layout.height}px`},ir(l.transform)),e.style)};return m(_i,{get mount(){return document.body},get children(){return m(V,{get when(){return t.active.draggable},get children(){let l=Na.cloneNode(!0),u=s;return typeof u=="function"?u(l):s=l,_(l,(()=>{let c=se(()=>typeof e.children=="function",!0);return()=>c()?e.children(t.active.draggable):e.children})()),B(c=>{let f=e.class,d=a();return f!==c._v$&&(l.className=c._v$=f),c._v$2=$i(l,d,c._v$2),c},{_v$:void 0,_v$2:void 0}),l}})}})},La=(e,t,n)=>{let r=e.slice();return r.splice(n,0,...r.splice(t,1)),r},bo=ze(),jt=e=>{let[t]=Vt(),[n,r]=bn({initialIds:[],sortedIds:[]}),i=a=>a>=0&&a<n.initialIds.length;Z(()=>{r("initialIds",[...e.ids]),r("sortedIds",[...e.ids])}),Z(()=>{t.active.draggableId&&t.active.droppableId?re(()=>{let a=n.sortedIds.indexOf(t.active.draggableId),l=n.initialIds.indexOf(t.active.droppableId);if(!i(a)||!i(l))r("sortedIds",[...e.ids]);else if(a!==l){let u=La(n.sortedIds,a,l);r("sortedIds",u)}}):r("sortedIds",[...e.ids])});let s=[n,{}];return m(bo.Provider,{value:s,get children(){return e.children}})},Ra=()=>Ue(bo)||null,Va=(e,t)=>n=>{e(n),t(n)},Bt=(e,t={})=>{let[n,{addTransformer:r,removeTransformer:i}]=Vt(),[o]=Ra(),s=Ur(e,t),a=Gr(e,t),l=Va(s.ref,a.ref),u=()=>o.initialIds.indexOf(e),c=()=>o.sortedIds.indexOf(e),f=A=>{var w;return((w=n.droppables[A])==null?void 0:w.layout)||null},d=()=>{let A=Ye(),w=u(),k=c();if(k!==w){let b=f(e),E=f(o.initialIds[k]);b&&E&&(A.x=E.x-b.x,A.y=E.y-b.y)}return A},h={id:"sortableOffset",order:100,callback:A=>{let w=d();return{x:A.x+w.x,y:A.y+w.y}}};U(()=>r("droppables",e,h)),ve(()=>i("droppables",e,h.id));let C=()=>{var A,w;return(e===n.active.draggableId&&!n.active.overlay?(A=n.draggables[e])==null?void 0:A.transform:(w=n.droppables[e])==null?void 0:w.transform)||Ye()};return Object.defineProperties(A=>{s(A,()=>({skipTransform:!0})),a(A,()=>({skipTransform:!0})),Z(()=>{var k;let w=C();if(zr(w,Ye()))A.style.removeProperty("transform");else{let b=ir(C());A.style.setProperty("transform",(k=b.transform)!=null?k:null)}})},{ref:{enumerable:!0,value:l},transform:{enumerable:!0,get:C},isActiveDraggable:{enumerable:!0,get:()=>s.isActiveDraggable},dragActivators:{enumerable:!0,get:()=>s.dragActivators},isActiveDroppable:{enumerable:!0,get:()=>a.isActiveDroppable}})};var ja=S('<div class="sets-sorting-property"><select class="sets-sort-direction"><option value="asc">Ascending</option><option value="desc">Descending</option></select><div class="sets-field-property-toggle clickable-icon">'),Ba=S('<div class="sets-sorting-fields">'),Wa=S('<input class="sets-field-search" type="search" placeholder="Search for a property">'),Ha=S('<div class="sets-fields-label">Available:'),Ka=S('<div class="sets-fields-list selected-props">'),qa=S('<div class="sets-button-bar"><button class="mod-cta">Save</button><button class="">Cancel'),Ya=S('<div class="sets-sorting-editor"><h4>Sort by:'),za=e=>{let{removeSort:t,setSortDirection:n}=te(),{app:r}=ae(),i,o=Bt(e.key),s=()=>Jn(r,e.key),a=u=>{t(e.key)};U(()=>{(0,vo.setIcon)(i,"x")});let l=u=>{let f=u.target.value==="desc";n(e.key,f)};return(()=>{let u=ja(),c=u.firstChild,f=c.nextSibling;R(o,u,()=>!0),_(u,m(gt,Ke(()=>s())),c),c.$$input=l,f.$$click=a;let d=i;return typeof d=="function"?R(d,f):i=f,B(()=>c.value=e.descending?"desc":"asc"),u})()},Ua=e=>{let{definition:t,save:n,addSort:r,reorderSort:i}=te(),{app:o}=ae(),[s,a]=W(""),l=()=>{n(),e.exit()},u=()=>t().sortby||[],c=()=>Je(o).filter(A=>!u().map(([w])=>w).includes(A.key)).filter(A=>A.name.toLowerCase().includes(s().toLowerCase())),f=D=>{r(D.key,!1)},d=({draggable:D})=>{},h=({draggable:D,droppable:A})=>{D&&A&&D.id!==A.id&&i(D.id,A.id)},C=()=>u().map(D=>D[0]);return(()=>{let D=Ya(),A=D.firstChild;return _(D,m(ht,{onDragStart:d,onDragEnd:h,collisionDetector:Rt,get children(){return[m(yt,{}),(()=>{let w=Ba();return _(w,m(jt,{get ids(){return C()},get children(){return m(ee,{get each(){return u()},children:k=>m(za,{get key(){return k[0]},get descending(){return k[1]}})})}})),w})(),(()=>{let w=Wa();return w.$$input=k=>{a(k.target.value)},B(()=>w.value=s()),w})(),Ha(),(()=>{let w=Ka();return _(w,m(ee,{get each(){return c()},children:k=>m(gt,Ke(k,{icon:"arrow-up-down",onItemClick:f}))})),w})(),(()=>{let w=qa(),k=w.firstChild,b=k.nextSibling;return k.$$click=l,Ve(b,"click",e.exit,!0),w})()]}}),null),D})()},wo=Ua;z(["input","click"]);var Dt=class extends xo.Modal{constructor(t,n,r,i){super(t),this.definition=r,this._db=n,this._update=i}onOpen(){let{contentEl:t}=this,n=this;he(()=>m(Se,{get app(){return{app:n.app,db:n._db}},get children(){return m(De,{get setDefinition(){return n.definition},get updateDefinition(){return n._update},get children(){return m(wo,{exit:()=>{n.close()}})}})}}),t)}onClose(){let{contentEl:t}=this;t.empty()}};var or=require("obsidian");function $o(e,t,n){let r=e.workspace.getActiveViewOfType(or.MarkdownView);if(r){if(r.getMode()==="source"){let i=n.getSectionInfo(n.el);if(i){let o=(0,or.stringifyYaml)(t)+`
`;return r==null||r.editor.replaceRange(o,{line:(i==null?void 0:i.lineStart)+1,ch:0},{line:i==null?void 0:i.lineEnd,ch:0},"*"),!0}}return!1}}var Ga=S("<div>Uh oh..."),Xa=S('<div class="metadata-property">'),Xr=e=>{var a,l,u;let t=(l=(a=e.attribute).getPropertyWidget)==null?void 0:l.call(a),n=(u=e.data&&e.attribute.getValue(e.data))!=null?u:e.value;if(Array.isArray(n)&&(n=n.slice()),!e.attribute.getPropertyInfo)return Ga();let{key:r,type:i}=e.attribute.getPropertyInfo(),o,s=c=>{let f=c.target;if(f&&f.classList.contains("multi-select-container")){let d=f.querySelector(".multi-select-input");d&&d.focus()}};return U(()=>{var c;t&&t.render(o,{key:r,type:i,value:n!=null?n:null},{app,key:r,onChange:f=>{e.onChange&&e.onChange(f)},rerender:()=>{},sourcePath:((c=e.data)==null?void 0:c.file.path)||"/",blur:()=>{},metadataEditor:null})}),(()=>{let c=Xa();c.$$click=s;let f=o;return typeof f=="function"?R(f,c):o=c,c})()},Wt=e=>{let{key:t}=e.attribute.getPropertyInfo();return m(Xr,Ke(e,{onChange:n=>{let r=e.data.file;app.fileManager.processFrontMatter(r,i=>{i[t]=n})}}))};z(["click"]);var ko=require("obsidian");var sr=require("obsidian"),vn=class extends sr.Modal{constructor(t,n){super(t),this.message=n}onOpen(){let{contentEl:t}=this;t.createEl("h3",{text:this.message}),new sr.Setting(t).addButton(n=>n.setButtonText("OK").setCta().onClick(()=>{this.close()}))}onClose(){let{contentEl:t}=this;t.empty()}};var xn=require("obsidian"),Qa=S('<div class="sets-filename editing" autocapitalize="on">'),Ja=/[.?*+^$[\]\\(){}|-]/g;function _o(e){return e.replace(Ja,"\\$&")}var Za=xn.Platform.isWin?'*"\\/<>:|?':"\\/:"+(xn.Platform.isAndroidApp?'*?<>"':""),So=Za.split("").join("\xA0"),el=new RegExp("["+_o(So)+"]"),tl="#^[]|",Co=tl.split("").join("\xA0"),nl=new RegExp("["+_o(Co)+"]"),wn={"msg-invalid-characters":"File name cannot contain any of the following characters: "+So,"msg-unsafe-characters":"Links will not work with file names containing any of these characters: "+Co,"msg-file-already-exists":"There's already a file with the same name","msg-empty-file-name":"File name cannot be empty.","msg-bad-dotfile":"File name must not start with a dot."};function $n(e,t,n){if(t==="")return wn["msg-empty-file-name"];if(el.test(t))return wn["msg-invalid-characters"];if(t.startsWith("."))return wn["msg-bad-dotfile"];if(n&&e.vault.checkForDuplicate(n,t))return wn["msg-file-already-exists"];if(nl.test(t))return wn["msg-unsafe-characters"]}var rl=e=>{let t,[n,r]=W(void 0),{app:i}=ae(),o=e.value(),s=()=>{e.setValue(t.innerText.trim()),e.blur&&e.blur()},a=c=>{let f=$n(i,t.innerText.trim(),e.file);r(f),e.input&&e.input(t.innerText.trim())};U(()=>{let c=document.createRange();t.focus(),c.selectNodeContents(t);let f=window.getSelection();f.removeAllRanges(),f.addRange(c)});let l=c=>{c.key==="Enter"&&(c.preventDefault(),e.setValue(t.innerText.trim()),n()?new xn.Notice(n()):!n()&&e.enter&&e.enter())},u=c=>{c.preventDefault();let f=c.clipboardData.getData("text/plain");c.target.doc.queryCommandSupported("insertText")?document.execCommand("insertText",!1,f):console.error("insertText not supported")};return(()=>{let c=Qa();c.addEventListener("paste",u),c.$$keydown=l,c.addEventListener("blur",s),c.$$input=a;let f=t;return typeof f=="function"?R(f,c):t=c,le(c,"contenteditable",!0),_(c,o),B(d=>{let h=!!n(),C=n(),D=i.vault.getConfig("spellcheck");return h!==d._v$&&c.classList.toggle("sets-invalid",d._v$=h),C!==d._v$2&&le(c,"title",d._v$2=C),D!==d._v$3&&le(c,"spellcheck",d._v$3=D),d},{_v$:void 0,_v$2:void 0,_v$3:void 0}),c})()},ar=rl;z(["input","keydown"]);var il=S('<div class="sets-filename-edit clickable-icon">'),ol=S('<div class="sets-filename"><a class="internal-link sets-filename-link" target="_blank" rel="noopener">'),sl=e=>{let{app:t}=ae(),{getNewFile:n}=te(),r=()=>{var C;return(C=e.editable)!=null?C:!0},i=()=>r()?e.editMode?!0:n()===e.data.file.path:!1,[o,s]=W(i()),[a,l]=W(e.attribute.format(e.data)),u,c=C=>{o()||s(!0)},f=C=>{let D=e.data.file;C=C.trim();let A=$n(t,C,D);if(A){new vn(t,A).open();return}let w=D.getNewPathAfterRename(C);try{t.fileManager.renameFile(D,w)}catch(k){console.error(k),new vn(t,k.message).open()}},d=()=>{s(!1),f(a())},h=()=>t.metadataCache.fileToLinktext(e.data.file,"/");return Z(()=>{o()||u&&(0,ko.setIcon)(u,"pencil")}),[m(V,{get when(){return!o()},get children(){let C=ol(),D=C.firstChild;return _(D,a),_(C,m(V,{get when(){return r()},get children(){let A=il();A.$$click=c;let w=u;return typeof w=="function"?R(w,A):u=A,A}}),null),B(A=>{let w=h(),k=h();return w!==A._v$&&le(D,"data-href",A._v$=w),k!==A._v$2&&le(D,"href",A._v$2=k),A},{_v$:void 0,_v$2:void 0}),C}}),m(V,{get when(){return o()},get children(){return m(ar,{value:a,setValue:l,blur:d,enter:d,get file(){return e.data.file}})}})]},Ht=sl;z(["click"]);var Do=ze();function Ao(e){let[t,n]=W(e.gridState),r={state:t,onHover:i=>{n(o=>M(F({},o),{hovering:i}))},onExit:()=>{n(i=>M(F({},i),{hovering:void 0}))}};return m(Do.Provider,{value:r,get children(){return e.children}})}function lr(){return Ue(Do)}var al=S('<div class="sets-cell-read">'),ll=S('<div class="sets-grid-cell"><div class="sets-cell-content">'),To=e=>{let t=lr(),{state:n}=t,r=()=>(n==null?void 0:n().hovering)===e.attribute.key,i=()=>e.attribute.format(e.data);return(()=>{let o=ll(),s=o.firstChild;return _(s,m(V,{get when(){return e.attribute.readonly},get children(){let a=al();return _(a,i),a}}),null),_(s,m(V,{get when(){return!e.attribute.isIntrinsic},get children(){return m(Wt,{get data(){return e.data},get attribute(){return e.attribute}})}}),null),_(s,m(V,{get when(){return e.attribute.isIntrinsic&&!e.attribute.readonly},get children(){return m(Ht,{get data(){return e.data},get attribute(){return e.attribute}})}}),null),B(a=>{let l=!!r(),u=!e.attribute.readonly;return l!==a._v$&&o.classList.toggle("hovered",a._v$=l),u!==a._v$2&&s.classList.toggle("editable",a._v$2=u),a},{_v$:void 0,_v$2:void 0}),o})()};var cl=S('<div class="sets-header-cell"><div class="sets-header-cell-content"><div class="sets-column-name"></div><div class="sets-column-resizer">&nbsp;'),Eo=e=>{let t=lr(),{state:n,onHover:r,onExit:i}=t,o=Bt(e.key),s=u=>{t!==void 0&&r(e.key)},a=u=>{t!==void 0&&i()},l=()=>(n==null?void 0:n().hovering)===e.key;return(()=>{let u=cl(),c=u.firstChild,f=c.firstChild;return u.addEventListener("mouseleave",a),u.$$mouseover=s,R(o,f,()=>!0),_(f,()=>e.name),B(()=>u.classList.toggle("hovered",!!l())),u})()};z(["mouseover"]);var ul=e=>!e.find(t=>t.key===X.FileName),lt=ul;var fl=S('<div class="sets-header-cell">'),dl=S('<div class="sets-header-draggable"><div class="sets-cell-content">'),ml=S('<div class="sets-gridview-head"><div class="sets-headers-row">');function pl(e,t){let n={resizing:void 0,index:-1,mousex:void 0,originalSize:void 0},r=s=>{var a;if(n.resizing){let l=s.clientX-n.mousex,u=Math.max(0,n.originalSize+l);(a=t())==null||a({action:"resize",size:u,index:n.index})}},i=s=>{var a;n.resizing&&(n.resizing=void 0,(a=t())==null||a({action:"done",size:-1,index:n.index}),n.index=-1),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},o=s=>{let a=s.target;if(a.classList.contains("sets-column-resizer"))return a.closest(".sets-header-cell")};e.addEventListener("mousedown",s=>{let a=o(s);a&&(n.resizing=a,n.index=Array.prototype.indexOf.call(a.parentElement.children,a),n.originalSize=n.resizing.clientWidth,n.mousex=s.clientX,window.addEventListener("mousemove",r,!0),window.addEventListener("mouseup",i))}),e.addEventListener("dblclick",s=>{var l;let a=o(s);if(a){let u=a.parentElement.indexOf(a);(l=t())==null||l({action:"reset",size:-1,index:u})}})}var gl=e=>{let[t,n]=W(null),{updateSize:r}=te(),i=te(),o=({draggable:c})=>{n(c.id)},s=({draggable:c,droppable:f})=>{c&&f&&c.id!==f.id&&i.reorder(c.id,f.id,!0),n(null)},a=()=>{let c=t(),f=e.attributes.find(d=>d.key===c);return f==null?void 0:f.displayName()},l=c=>{switch(c.action){case"resize":if(Number.isNumber(c.size)){let f=u()[c.index];r(f,`${c.size}px`)}break;case"done":i.save();break;case"reset":{let f=u()[c.index];r(f,void 0),i.save()}break}},u=()=>e.attributes.map(c=>c.key);return m(ht,{onDragStart:o,onDragEnd:s,collisionDetector:Rt,get children(){return[m(yt,{}),(()=>{let c=ml(),f=c.firstChild;return R(pl,f,()=>l),_(f,m(V,{get when(){return lt(e.attributes)},get children(){return fl()}}),null),_(f,m(jt,{get ids(){return u()},get children(){return m(ee,{get each(){return e.attributes},children:(d,h)=>m(Eo,{get name(){return d.displayName()},get key(){return d.key}})})}}),null),_(f,m(yo,{get children(){let d=dl(),h=d.firstChild;return _(h,a),d}}),null),c})()]}})},Oo=gl;var Fo=require("obsidian"),hl=S('<a class="internal-link sets-filename-link" target="_blank" rel="noopener">'),yl=e=>{let{app:t}=ae(),n=null,r=()=>t.metadataCache.fileToLinktext(e.data.file,"/");return U(()=>{n&&(0,Fo.setIcon)(n,"link")}),(()=>{let i=hl(),o=n;return typeof o=="function"?R(o,i):n=i,B(s=>{let a=r(),l=r(),u=e.data.file.basename;return a!==s._v$&&le(i,"data-href",s._v$=a),l!==s._v$2&&le(i,"href",s._v$2=l),u!==s._v$3&&le(i,"title",s._v$3=u),s},{_v$:void 0,_v$2:void 0,_v$3:void 0}),i})()},Kt=yl;var bl=S('<div class="sets-gridview"><div class="sets-gridview-scroller sets-view-scroller"><div class="sets-gridview-scrollwrapper"><div class="sets-gridview-table"><div class="sets-gridview-body">'),vl=S('<div class="sets-grid-cell"><div class="sets-grid-mini-link">'),wl=S('<div class="sets-gridview-row">'),xl=e=>{let{definition:t}=te(),n=()=>t().fields||e.attributes.map(s=>s.key),r=()=>{let s=n().map(a=>{var l,u;return((u=(l=t().grid)==null?void 0:l.columnWidths)==null?void 0:u[a])||"minmax(max-content, 200px)"}).join(" ");return lt(e.attributes)&&(s="24px "+s),s},i=()=>{var s;return t().fields&&((s=t().fields)==null?void 0:s.length)||e.data.length},o;return U(()=>{requestAnimationFrame(()=>{var s,a;o&&o.scroll(((a=(s=t())==null?void 0:s.transientState)==null?void 0:a.scroll)||0,0)})}),m(V,{get when(){return i()},get children(){let s=bl(),a=s.firstChild,l=a.firstChild,u=l.firstChild,c=u.firstChild,f=o;return typeof f=="function"?R(f,a):o=a,_(u,m(Oo,{get attributes(){return e.attributes}}),c),_(c,m(ee,{get each(){return e.data},children:(d,h)=>(()=>{let C=wl();return _(C,m(V,{get when(){return lt(e.attributes)},get children(){let D=vl(),A=D.firstChild;return _(A,m(Kt,{data:d})),D}}),null),_(C,m(ee,{get each(){return e.attributes},children:(D,A)=>m(To,{data:d,attribute:D})}),null),C})()})),B(()=>r()!=null?u.style.setProperty("grid-template-columns",r()):u.style.removeProperty("grid-template-columns")),s}})},Io=xl;var bt=require("obsidian");var No=require("obsidian");var Mo=require("obsidian");var $l=S('<button class="mod-cta">Save'),_l=S('<div class="sets-calculated-editor"><div class="sets-calculated-editor-name"><div class="sets-fields-label">Calculated field name</div><input type="text"><span class="sets-calculated-editor-error"></span></div><div class="sets-calculated-editor-value"><div class="sets-fields-label">Calculated field definition</div><textarea class="sets-calculated-textarea"></textarea><div class="sets-calculated-editor-error"></div></div><div class="sets-calculated-editor-buttons"><button>Cancel'),Sl=e=>{let[t,n]=W(e.value[0]),[r,i]=W(e.value[1]),o=()=>e.validateName(t()),s=()=>e.validateDef(r());return(()=>{let a=_l(),l=a.firstChild,u=l.firstChild,c=u.nextSibling,f=c.nextSibling,d=l.nextSibling,h=d.firstChild,C=h.nextSibling,D=C.nextSibling,A=d.nextSibling,w=A.firstChild;return c.$$input=k=>{n(k.currentTarget.value)},_(f,o),C.$$input=k=>{i(k.currentTarget.value)},_(D,s),_(A,m(V,{get when(){return se(()=>o()=="")()&&s()==""},get children(){let k=$l();return k.$$click=()=>{e.update([t(),r()]),e.close()},k}}),w),w.$$click=()=>{e.close()},B(k=>{let b=o().length>0,E=s().length>0;return b!==k._v$&&c.classList.toggle("sets-invalid",k._v$=b),E!==k._v$2&&C.classList.toggle("sets-invalid",k._v$2=E),k},{_v$:void 0,_v$2:void 0}),B(()=>c.value=t()),B(()=>C.value=r()),a})()},_n=class extends Mo.Modal{constructor(t,n,r,i,o){super(t),this.cf=n,this._validateName=r,this._validatecode=i,this._update=o}onOpen(){let{contentEl:t}=this,n=this;he(()=>m(Sl,{get value(){return n.cf},get update(){return n._update},close:()=>{n.close()},get validateName(){return n._validateName},get validateDef(){return n._validatecode}}),t)}onClose(){let{contentEl:t}=this;t.empty()}};z(["input","click"]);var Cl=S('<div class="sortable-property-wrapper">'),kl=S('<div class="sets-fields-select"><h4>Select fields</h4><input class="sets-field-search" type="search" placeholder="Search for a property"><div class="sets-fields-columns"><div class="sets-fields-column"><div class="sets-fields-label">Available:</div><div class="sets-fields-list available-props"></div></div><div class="sets-fields-column"><div class="sets-fields-label">Visible:</div><div class="sets-fields-list selected-props"></div></div></div><div class="sets-button-bar"><div class="clickable-icon">Add calculated field</div><button class="mod-cta">Save</button><button class="">Cancel'),Dl=e=>{let t=Bt(e.key,e);return(()=>{let n=Cl();return R(t,n,()=>!0),_(n,m(gt,e)),n})()},Po=e=>{let{definition:t,save:n,addField:r,removeField:i,reorder:o,setDefinition:s}=te(),{app:a}=ae(),[l,u]=W(""),c=()=>{n(),e.exit()},f=()=>Je(a).filter(T=>!(t().fields||[]).includes(T.key)).filter(T=>T.name.toLowerCase().includes(l().toLowerCase())),d=()=>{let v=Je(a),T=Qn("key",v);return[...(t().fields||[]).map(P=>{let H=T[P];if(H)return H;if(t().calculatedFields[P])return{key:P,name:P,typeName:"Calculated",typeIcon:"function-square",typeKey:"func",calculated:!0}}).filter(P=>P==null?void 0:P.name.toLowerCase().includes(l().toLowerCase()))]},h=v=>{r(v.key)},C=v=>T=>{var H;return T=T.trim(),T===""?"cannot be empty":(((H=t().fields)==null?void 0:H.filter(q=>q!==v))||[]).includes(T)||Object.keys(t().calculatedFields||{}).filter(q=>q!==v).includes(T)?"already exists":""},D=v=>T=>{var Q;if(T=T.trim(),T==="")return"cannot be empty";let I=((Q=t().fields)==null?void 0:Q.filter(oe=>oe!==v))||[],P=Object.keys(t().calculatedFields||{}).filter(oe=>oe!==v),H=[];function q(oe){return H.push(oe),""}try{return new Function("prop",T)(q),H.every(ye=>I.includes(ye)||P.includes(ye))?"":"references unknown properties or circular reference"}catch(oe){return oe.message}return"Unkown error"},A=(v,T,I)=>{switch(T){case"edit":new _n(a,[v.key,t().calculatedFields[v.key]],C(v.key),D(v.key),P=>{let H=F({},t().calculatedFields||{});I&&delete H[I];let q=[...t().fields||[]],Q=q.indexOf(v.key);Q>-1&&q.splice(Q,1),q.splice(Q,0,P[0]),s(M(F({},t()),{calculatedFields:M(F({},H),{[P[0]]:P[1]}),fields:q}))}).open();break;case"delete":if(v.calculated){let P=F({},t().calculatedFields||{});delete P[v.key],s(M(F({},t()),{calculatedFields:P}))}i(v.key);break;default:i(v.key);break}},w=({draggable:v})=>{},k=({draggable:v,droppable:T})=>{v&&T&&v.id!==T.id&&o(v.id,T.id,!1)},b=()=>{new _n(a,["",""],C(""),D(""),v=>{let T=F({},t().calculatedFields||{});T[v[0]]=v[1];let I=[...t().fields||[]];I.push(v[0]),s(M(F({},t()),{calculatedFields:T,fields:I}))}).open()},E=()=>d().map(v=>v.key);return(()=>{let v=kl(),T=v.firstChild,I=T.nextSibling,P=I.nextSibling,H=P.firstChild,q=H.firstChild,Q=q.nextSibling,oe=H.nextSibling,ye=oe.firstChild,O=ye.nextSibling,j=P.nextSibling,p=j.firstChild,g=p.nextSibling,x=g.nextSibling;return I.$$input=y=>{u(y.target.value)},_(Q,m(ee,{get each(){return f()},children:y=>m(gt,Ke(y,{icon:"toggle-left",onIconClick:h}))})),_(O,m(ht,{onDragStart:w,onDragEnd:k,collisionDetector:Rt,get children(){return[m(yt,{}),m(jt,{get ids(){return E()},get children(){return m(ee,{get each(){return d()},children:(y,$)=>m(Dl,Ke(y,{icon:"toggle-right",onIconClick:(L,K)=>A(L,K,y.key)}))})}})]}})),p.$$click=b,g.$$click=c,Ve(x,"click",e.exit,!0),B(()=>I.value=l()),v})()};z(["input","click"]);var qt=class extends No.Modal{constructor(t,n,r,i){super(t),this.definition=r,this._db=n,this._update=i}onOpen(){let{contentEl:t}=this,n=this;he(()=>m(Se,{get app(){return{app:n.app,db:n._db}},get children(){return m(De,{get setDefinition(){return n.definition},get updateDefinition(){return n._update},get children(){return m(Po,{exit:()=>{n.close()}})}})}}),t)}onClose(){let{contentEl:t}=this;t.empty()}};var cr=require("obsidian");var Al=S('<div class="clickable-icon">'),Tl=()=>{let{definition:e,setDefinition:t,save:n}=te(),r,i=()=>e().viewMode||"grid",o=[{title:"Grid",icon:"table",viewMode:"grid"},{title:"List",icon:"list",viewMode:"list"},{title:"Board",icon:"board",viewMode:"board"},{title:"Gallery",icon:"layout-grid",viewMode:"gallery"}];Z(()=>{let l=i(),u=o.find(c=>c.viewMode===l);u&&(0,cr.setIcon)(r,u.icon)});let s=()=>{let l=i();return`${Ce(l)} view: click to change`},a=l=>{let u=new cr.Menu;o.forEach(c=>{u.addItem(f=>{f.setTitle(c.title),f.setIcon(c.icon),f.onClick(()=>{t(M(F({},e()),{viewMode:c.viewMode})),n()})})}),u.showAtMouseEvent(l)};return(()=>{let l=Al();l.$$click=a;let u=r;return typeof u=="function"?R(u,l):r=l,B(()=>le(l,"title",s())),l})()},Lo=Tl;z(["click"]);var Bo=require("obsidian");var El=S('<div class="checkbox-container"><input type="checkbox" tabindex="0">'),Ro=e=>{let t,n=r=>{e.onChange(!e.value())};return(()=>{let r=El(),i=r.firstChild;return r.$$click=n,B(()=>r.classList.toggle("is-enabled",!!e.value())),B(()=>i.checked=e.value()),r})()};z(["click"]);var Vo=require("obsidian");var Ol=S('<div class="sets-fields-select"><div class="modal-header"><h4>Gallery properties</h4></div><div>Select which properties to transclude</div><div class="sets-fields-list selected-props"></div><div></div><div class="sets-button-bar"><button class="mod-cta">Save</button><button class="">Cancel'),Fl=S('<div class="sets-field-selectable">'),jo=e=>{var c;let{definition:t,save:n,setDefinition:r}=te(),[i,o]=W(((c=t().gallery)==null?void 0:c.transclude)||[]),s;U(()=>{new Vo.Setting(s).setName("Min width").setDesc("Minimum width of each card in the gallery").addSlider(f=>{var d;f.setLimits(100,1e3,10).setValue(((d=t().gallery)==null?void 0:d.minWidth)||250).setDynamicTooltip().onChange(h=>{r(M(F({},t()),{gallery:M(F({},t().gallery||{}),{minWidth:h})}))}).showTooltip()})});let{app:a}=ae(),l=()=>{r(M(F({},t()),{gallery:M(F({},t().gallery||{}),{transclude:i()})})),n(),e.exit()},u=(f,d)=>{let h=i().slice();if(d)h.push(f);else{let C=h.indexOf(f);C>=0&&h.splice(C,1)}o(h)};return(()=>{let f=Ol(),d=f.firstChild,h=d.nextSibling,C=h.nextSibling,D=C.nextSibling,A=D.nextSibling,w=A.firstChild,k=w.nextSibling;_(C,m(ee,{get each(){return e.attributes},children:E=>{let v=Jn(a,E.key);return(()=>{let T=Fl();return _(T,m(gt,v),null),_(T,m(Ro,{value:()=>i().includes(E.key)||!1,onChange:I=>u(E.key,I)}),null),T})()}}));let b=s;return typeof b=="function"?R(b,D):s=D,w.$$click=l,Ve(k,"click",e.exit,!0),f})()};z(["click"]);var ur=class extends Bo.Modal{constructor(t,n,r,i,o){super(t),this.definition=r,this._attributes=i,this._db=n,this._update=o}onOpen(){let{contentEl:t}=this,n=this;he(()=>m(Se,{get app(){return{app:n.app,db:n._db}},get children(){return m(De,{get setDefinition(){return n.definition},get updateDefinition(){return n._update},get children(){return m(jo,{get attributes(){return n._attributes},exit:()=>{n.close()}})}})}}),t)}onClose(){let{contentEl:t}=this;t.empty()}};var Il=S('<div class="clickable-icon editmode-only" title="Set Sorting properties">'),Ml=S('<div class="clickable-icon editmode-only" title="Select fields to display">'),Pl=S('<div class="clickable-icon editmode-only" title="Set filters">'),Nl=S('<div class="clickable-icon editmode-only" title="Refresh data">'),Ll=S('<div class="clickable-icon editmode-only" title="Copy block">'),Rl=S('<div class="clickable-icon editmode-only sets-grouping" title="Grouping property">'),Vl=S('<div class="clickable-icon editmode-only" title="Gallery settings">'),jl=S('<div class="sets-toolbar-addbutton clickable-icon" title="Add new item">'),Bl=S('<div class="sets-codeblock-toolbar"><div class="clickable-icon editmode-only sets-scope" title="Change scope">'),Wl=e=>{let t,n,r,i,o,s,a,{app:l,db:u}=ae(),{definition:c,save:f,setDefinition:d,setNewFile:h,refresh:C}=te(),[D,A]=W(!1),w=()=>Y(void 0,null,function*(){let g=yield u.addToSet(e.queryResult.query,c().fields||[]);h((g==null?void 0:g.path)||"")}),k=()=>e.queryResult.db.canAdd(e.queryResult),b=g=>{d(g),f()},E=()=>{new Pt(l,u,c(),xe().topResults||100,b).open()},v=()=>{new qt(l,u,c(),b).open()},T=()=>{new Dt(l,u,c(),b).open()},I=()=>{f()},P=()=>{new Ft(l,u,c(),b).open()},H=()=>{let g=F({},c()),x=mn(g);navigator.clipboard.writeText(x)},q=()=>c().scope,Q=()=>{let[g]=q()||[];return g==="collection"?"Collection":g==="type"?"Type":g==="folder"?"Folder":g==="vault"?"Vault":"Select scope"};U(()=>{t&&(0,bt.setIcon)(t,"filter"),n&&(0,bt.setIcon)(n,"list-plus"),n&&(0,bt.setIcon)(r,"arrow-up-down"),n&&(0,bt.setIcon)(i,"refresh-cw"),n&&(0,bt.setIcon)(o,"copy"),n&&s&&(0,bt.setIcon)(s,"settings-2"),n&&a&&(0,bt.setIcon)(a,"plus-square")});let oe=()=>c().viewMode,ye=()=>{var x;let g=(x=c().board)==null?void 0:x.groupField;return g?`${u.getAttributeDefinition(g).displayName()}`:"Select.."},O=()=>{new It(l,x=>{let y=x.key;d(M(F({},c()),{board:M(F({},c().board),{groupField:y})})),f()},x=>x.typeKey==="text").open()},j=()=>{var x;let g=(x=c().gallery)==null?void 0:x.transclude;return g?g.map($=>u.getAttributeDefinition($)).map($=>$.displayName()).join(", "):"Select.."},p=g=>{new ur(l,u,c(),e.attributes,b).open()};return(()=>{let g=Bl(),x=g.firstChild;return x.$$click=P,_(x,Q),_(g,m(V,{get when(){return q()},get children(){return[(()=>{let y=Il();y.$$click=T;let $=r;return typeof $=="function"?R($,y):r=y,y})(),(()=>{let y=Ml();y.$$click=v;let $=n;return typeof $=="function"?R($,y):n=y,y})(),(()=>{let y=Pl();y.$$click=E;let $=t;return typeof $=="function"?R($,y):t=y,y})(),(()=>{let y=Nl();y.$$click=I;let $=i;return typeof $=="function"?R($,y):i=y,y})(),(()=>{let y=Ll();y.$$click=H;let $=o;return typeof $=="function"?R($,y):o=y,y})(),m(Lo,{}),m(V,{get when(){return oe()==="board"},get children(){let y=Rl();return y.$$click=O,_(y,ye),y}}),m(V,{get when(){return oe()==="gallery"},get children(){let y=Vl();y.$$click=p;let $=s;return typeof $=="function"?R($,y):s=y,y}}),m(V,{get when(){return k()},get children(){let y=jl();y.$$click=w;let $=a;return typeof $=="function"?R($,y):a=y,y}})]}}),null),g})()},Wo=Wl;z(["click"]);var Ho=require("obsidian");var Hl=S('<div class="sets-markdown-renderer">'),Kl=e=>{let{app:t}=ae(),n;return Z(()=>{Ho.MarkdownRenderer.render(t,e.markdown,n,"/",t.plugins.plugins.sets)}),(()=>{let r=Hl(),i=n;return typeof i=="function"?R(i,r):n=r,r})()},fr=Kl;var Ko=S('<div class="sets-view-field">'),ql=S('<div class="sets-view-field-prop">'),Yl=e=>{let{attribute:t,data:n}=e,r=s=>{if(s.isIntrinsic&&s.key===X.FileName)return!1;if(s.getPropertyInfo().type==="checkbox"||s.getPropertyInfo().type==="date"||s.getPropertyInfo().type==="datetime")return!0},i=s=>s.isIntrinsic&&s.key===X.FileName?!1:!r(s),o=()=>t.displayName();return[m(V,{get when(){return i(t)},get children(){let s=Ko();return _(s,m(fr,{get markdown(){return t.format(n)}})),B(()=>le(s,"title",o())),s}}),m(V,{get when(){return t.isIntrinsic&&t.key===X.FileName},get children(){let s=Ko();return _(s,m(Ht,{data:n,attribute:t,editable:!1})),s}}),m(V,{get when(){return r(t)},get children(){let s=ql();return _(s,m(Wt,{data:n,attribute:t})),B(()=>le(s,"title",o())),s}})]},qo=Yl;var zl=S('<div class="sets-listview"><div class="sets-listview-body">'),Ul=S('<div class="sets-listview-item">'),Gl=e=>{let t=se(()=>{let n=[...e.attributes];return n.sort((r,i)=>r.getPropertyInfo().type==="checkbox"?-1:i.getPropertyInfo().type==="checkbox"?1:0),n});return(()=>{let n=zl(),r=n.firstChild;return _(r,m(ee,{get each(){return e.data},children:(i,o)=>(()=>{let s=Ul();return _(s,m(ee,{get each(){return t()},children:(a,l)=>m(qo,{attribute:a,data:i})})),s})()})),n})()},dr=Gl;function Yo(e,t){return e.reduce((n,r)=>{let i=t(r);return n[i]=n[i]||[],n[i].push(r),n},{})}var Qo=require("obsidian");var Qr=S('<div class="sets-view-field">'),Xl=S('<div class="sets-item-field">'),mr=e=>{let{data:t}=e;return m(ee,{get each(){return e.attributes},children:(n,r)=>(()=>{let i=Xl();return _(i,m(pt,{get children(){return[m(we,{get when(){return n.readonly},get children(){let o=Qr();return _(o,()=>n.format(t)),o}}),m(we,{get when(){return se(()=>!!(e.transclude||[]).includes(n.key))()&&`${n.getValue(t)}`.startsWith("[")},get children(){return m(fr,{get markdown(){return`!${n.getValue(t)}`}})}}),m(we,{get when(){return!n.isIntrinsic},get children(){let o=Qr();return _(o,m(Wt,{data:t,attribute:n})),o}}),m(we,{get when(){return n.isIntrinsic&&!n.readonly},get children(){let o=Qr();return _(o,m(Ht,{data:t,attribute:n})),o}})]}})),B(()=>le(i,"title",n.displayName())),i})()})};var zo=require("obsidian");var Ql=S('<div class="sets-board-mini-link">'),Jl=S('<div class="sets-board-item"><div class="sets-board-item-handle">'),Uo=e=>{let t=Ur(e.data.file.path,e.data),n=null;return U(()=>{n&&(0,zo.setIcon)(n,"grip-horizontal")}),(()=>{let r=Jl(),i=r.firstChild;R(t,r,()=>!0);let o=n;return typeof o=="function"?R(o,i):n=i,_(r,m(mr,e),null),_(r,m(V,{get when(){return lt(e.attributes)},get children(){let s=Ql();return _(s,m(Kt,{get data(){return e.data}})),s}}),null),r})()};var Go=require("obsidian");var Zl=S("<div>"),ec=S('<div class="sets-board-lane-delete clickable-icon">'),tc=S('<div class="sets-board-lane"><div class="sets-board-lane-header">'),Xo=e=>{let{definition:t,setDefinition:n,save:r}=te(),[i,o]=W(!1),s=null,a=Gr(e.lane.value,e),l=c=>{var d;let f=[...((d=t().board)==null?void 0:d.lanes)||[]];f[e.lane.index-1]=c,n(M(F({},t()),{board:M(F({},t().board),{lanes:f})})),r()},u=()=>{var f;let c=[...((f=t().board)==null?void 0:f.lanes)||[]];c.splice(e.lane.index-1,1),n(M(F({},t()),{board:M(F({},t().board),{lanes:c})})),r()};return U(()=>{(0,Go.setIcon)(s,"minus")}),(()=>{let c=tc(),f=c.firstChild;return R(a,c,()=>!0),_(f,m(V,{get when(){return!e.lane.value||i()},get children(){return m(Xr,{get attribute(){return e.attribute},onChange:l,get value(){return e.lane.value}})}}),null),_(f,m(V,{get when(){return se(()=>!!e.lane.value)()&&!i()},get children(){let d=Zl();return d.$$click=()=>o(!0),_(d,()=>e.lane.name),d}}),null),_(f,m(V,{get when(){return!i()},get children(){let d=ec();d.$$click=u;let h=s;return typeof h=="function"?R(h,d):s=d,d}}),null),_(c,m(ee,{get each(){return e.data},children:(d,h)=>m(Uo,{get attributes(){return e.attributes},data:d})}),null),B(()=>c.classList.toggle("accept-drop",!!a.isActiveDroppable)),c})()};z(["click"]);var nc=S('<div class="sets-codeblock-empty">Please select grouping property'),rc=S('<div class="sets-board-view"><div class="sets-board-lanes-scroller sets-view-scroller"><div class="sets-board-lanes-wrapper"><div class="sets-board-add-lane clickable-icon">'),ic=e=>{var b,E;let{definition:t}=te(),{app:n,db:r}=ae(),i=(b=t().board)==null?void 0:b.groupField,o=null,s;if(!i)return nc();U(()=>{o&&(0,Qo.setIcon)(o,"plus-square"),requestAnimationFrame(()=>{var v,T;s.scroll(((T=(v=t())==null?void 0:v.transientState)==null?void 0:T.scroll)||0,0)})});let a=r.getAttributeDefinition(i),[l,u]=W(((E=t().board)==null?void 0:E.lanes)||[]),c=()=>[{name:"No "+a.displayName(),value:"__NOVALUE__",index:0},...l().map((v,T)=>({name:v,value:v,index:T+1}))],f=()=>t().fields||e.attributes.map(v=>v.key),d=r.getAttributeDefinition(i),[h,C]=W(null),D=se(()=>Yo(e.data,T=>d.getValue(T)||"__NOVALUE__")),A=({droppable:v,draggable:T})=>{v&&T&&n.fileManager.processFrontMatter(T.data.file,I=>{v.data.lane.index>0?I[i]=v.data.lane.value:I[i]=void 0}),C(null)},w=({draggable:v})=>{v&&C(v.data)},k=()=>{u([...l(),""])};return(()=>{let v=rc(),T=v.firstChild,I=T.firstChild,P=I.firstChild,H=s;typeof H=="function"?R(H,T):s=T,_(I,m(ht,{onDragEnd:A,onDragStart:w,get children(){return[m(yt,{}),m(ee,{get each(){return c()},children:(Q,oe)=>m(Xo,{get attributes(){return e.attributes},get data(){return D()[Q.value]},lane:Q,attribute:a})})]}}),P),P.$$click=k;let q=o;return typeof q=="function"?R(q,P):o=P,B(()=>I.classList.toggle("dragging",!!h())),v})()},Jo=ic;z(["click"]);var oc=S('<div class="sets-gallery-view"><div class="sets-gallery-grid">'),sc=S('<div class="sets-gallery-mini-link">'),ac=S('<div class="sets-gallery-item">'),lc=e=>{var a;let{definition:t}=te(),{app:n,db:r}=ae(),i=((a=t().gallery)==null?void 0:a.numColumns)||3,o=()=>{var l;return((l=t().gallery)==null?void 0:l.transclude)||[]},s=()=>{var l;return((l=t().gallery)==null?void 0:l.minWidth)||250};return(()=>{let l=oc(),u=l.firstChild;return _(u,()=>e.data.map((c,f)=>(()=>{let d=ac();return _(d,m(mr,{data:c,get attributes(){return e.attributes},get transclude(){return o()}}),null),_(d,m(V,{get when(){return lt(e.attributes)},get children(){let h=sc();return _(h,m(Kt,{data:c})),h}}),null),d})())),B(()=>`repeat(auto-fill, minmax(${s()}px, 1fr))`!=null?u.style.setProperty("grid-template-columns",`repeat(auto-fill, minmax(${s()}px, 1fr))`):u.style.removeProperty("grid-template-columns")),l})()},Zo=lc;var cc=S('<div class="sets-codeblock-empty"><div class="sets-codeblock-empty-text">No items found'),uc=S('<div class="sets-codeblock-more clickable-icon"> of <!>. Click for more.'),fc=S('<div class="sets-codeblock-more"> items'),dc=S('<div class="sets-codeblock-empty"><div class="sets-codeblock-empty-text">No scope selected'),mc=S('<div class="sets-codeblock">'),pc=e=>{let{getNewFile:t,definition:n}=te(),[r,i]=W(n().topResults||xe().topResults||100),o=n().scope,s=n().viewMode||"grid",a=()=>{let f=r();return Xn(e.queryResult,f,t())},l=()=>a().data,u=()=>a().total>a().data.length,c=()=>{let f=n().topResults||xe().topResults||100,d=r()+f;i(d)};return(()=>{let f=mc();return _(f,m(Wo,{get queryResult(){return e.queryResult},get attributes(){return e.attributes}}),null),_(f,m(V,{when:o,get children(){return[m(pt,{get children(){return[m(we,{get when(){return n().viewMode==="grid"||!n().viewMode},get children(){return m(Ao,{gridState:{hovering:void 0},get children(){return m(Io,{get data(){return l()},get attributes(){return e.attributes}})}})}}),m(we,{get when(){return n().viewMode==="list"},get children(){return m(dr,{get data(){return l()},get attributes(){return e.attributes}})}}),m(we,{get when(){return n().viewMode==="board"},get children(){return m(Jo,{get data(){return l()},get attributes(){return e.attributes}})}}),m(we,{get when(){return n().viewMode==="gallery"},get children(){return m(Zo,{get data(){return l()},get attributes(){return e.attributes}})}})]}}),m(pt,{get children(){return[m(we,{get when(){return e.queryResult.data.length===0},get children(){return cc()}}),m(we,{get when(){return u()},get children(){let d=uc(),h=d.firstChild,C=h.nextSibling,D=C.nextSibling;return d.$$click=c,_(d,()=>l().length,h),_(d,()=>a().total,C),d}}),m(we,{get when(){return l().length},get children(){let d=fc(),h=d.firstChild;return _(d,()=>l().length,h),d}})]}})]}}),null),_(f,m(V,{when:!o,get children(){return dc()}}),null),f})()},es=pc;z(["click"]);var Jr=new Map,gc=(e,t,n,r,i)=>{let o=n.filter||[],s=t.getDataContext(i.sourcePath),a=n.sortby||[],l=n.scope||it,[u,c]=l,f=t.fromClauses(l,o,a,s),d=t.execute(f),[h,C]=bn(d),D=Date.now(),A=()=>{let v=t.execute(f);C(v)},w=()=>{r.isConnected&&(Date.now()-D<100||A())};U(()=>{setTimeout(()=>{t.on("metadata-changed",w)},110)}),ve(()=>{t.off("metadata-changed",w)});let k;({attributes:k,definition:n}=Zr(n,t,d));let b=i.sourcePath,E=v=>{var I;let T=(I=r.querySelector(".sets-view-scroller"))==null?void 0:I.scrollLeft;Jr.set(b,{scroll:T}),delete v.transientState,t.off("metadata-changed",w),$o(e,v,i)};n.transientState=Jr.get(b),Jr.delete(b),he(()=>m(Se,{app:{app:e,db:t},get children(){return m(De,{setDefinition:n,refresh:A,updateDefinition:E,get children(){return m(es,{queryResult:h,attributes:k})}})}}),r)},ts=gc;function Zr(e,t,n){let[r,i]=e.scope||it,o=e.fields;return(!o||o.length==0)&&(r=="type"?xe().inferSetFieldsByDefault?o=t.inferFields(n):o=t.getTypeAttributes(i):r=="collection"&&xe().inferCollectionFieldsByDefault&&(o=t.inferFields(n)),o=[X.FileName,...o||[]],r==="type"&&!xe().inferSetFieldsByDefault&&(e=M(F({},e),{fields:o}))),{attributes:o.map(a=>t.getAttributeDefinition(a,e)),definition:e}}var ns=require("obsidian");var hc=S('<div class="metadata-input-longtext sets-input-editable">'),yc=S('<button class="mod-cta">Save'),bc=S('<div class="sets-button-bar"><button class="">Cancel'),Ze=class extends ns.Modal{constructor(t,n,r,i,o,s,a){super(t),this.message=n,this.placeholder=r,this.onSubmit=o,[this.value,this.setValue]=W(i),this._moreInfo=s,this._validateFileName=a!=null?a:!0}onOpen(){let{contentEl:t}=this;t.createEl("div",{text:this.message,cls:"sets-modal-title"});let n=()=>this._validateFileName?!(this.value().length===0||$n(this.app,this.value(),void 0)):!0,r=()=>{this.value().length>0&&(this.onSubmit&&this.onSubmit(this.value()),this.close())},i=s=>{this.setValue(s)},o=t.createDiv({cls:"sets-name-input"});he(()=>{let s=this;return m(Se,{get app(){return{app:s.app,db:void 0}},get children(){return[(()=>{let a=hc();return _(a,m(ar,{get value(){return s.value},get setValue(){return s.setValue},enter:r,input:i})),a})(),se(()=>se(()=>!!s._moreInfo)()&&s._moreInfo({value:s.value})),(()=>{let a=bc(),l=a.firstChild;return _(a,m(V,{get when(){return n()},get children(){let u=yc();return u.$$click=r,u}}),l),l.$$click=()=>{s.close()},a})()]}})},o)}onClose(){let{contentEl:t}=this;t.empty()}};z(["click"]);var vc=S('<div class="sets-sidebar-widget-menu-btn">'),wc=S('<div class="sets-sidebar-widget-content">'),xc=S('<div class="sets-sidebar-empty">No scope selected'),$c=S('<div class="sets-sidebar-widget">'),_c=S('<div class="sets-sidebar-widget-title">');function Sc(e,t,n){let r=M(F({},e.settings),{sidebarState:M(F({},e.settings.sidebarState),{widgets:e.settings.sidebarState.widgets.map((i,o)=>o===t?n(i):i)})});e.settings=r,e.saveSettings()}var Cc=e=>{let t,{widget:n,db:r,update:i,app:o}=e;Z(()=>{(0,Yt.setIcon)(t,"menu")});let s=l=>{i(M(F({},n()),{definition:l}))},a=l=>{l.preventDefault(),l.stopPropagation();let u=new Yt.Menu;u.addItem(c=>{let f="Rename";c.setTitle(f),c.callback=()=>{new Ze(o,"Rename widget","Enter name",n().title,d=>{i(M(F({},n()),{title:d}))},void 0,!1).open()},c.setIcon("pencil")}),u.addSeparator(),u.addItem(c=>{let f=n().definition.scope?"Scope: "+n().definition.scope:"Select scope";c.setTitle(f),c.callback=()=>{new Ft(o,r,n().definition,s).open()}}),u.addItem(c=>{let f="Attributes";c.setTitle(f),c.callback=()=>{new qt(o,r,n().definition,s).open()}}),u.addItem(c=>{let f="Filter";c.setTitle(f),c.callback=()=>{new Pt(o,r,n().definition,xe().topResultsWidget||10,s).open()}}),u.addItem(c=>{let f="Sort";c.setTitle(f),c.callback=()=>{new Dt(o,r,n().definition,s).open()}}),u.addSeparator(),u.addItem(c=>{let f="Delete";c.setTitle(f),c.callback=e.delete,c.setIcon("trash")}),e.index>=e.total-2&&u.addItem(c=>{c.setTitle("Move up"),c.setIcon("arrow-up"),c.callback=()=>{e.move(-1)}}),e.index<e.total-1&&u.addItem(c=>{c.setTitle("Move down"),c.setIcon("arrow-down"),c.callback=()=>{e.move(1)}}),u.showAtMouseEvent(l)};return(()=>{let l=vc();l.$$click=a;let u=t;return typeof u=="function"?R(u,l):t=l,l})()},kc=e=>{let{app:t,vaultDB:n}=e.plugin,[r,i]=W(e.widget),o=()=>r().definition.sortby||[],s=()=>r().definition.scope||it,a=()=>r().definition.filter||[],l=()=>n.fromClauses(s(),a(),o()),u=()=>n.execute(l()),c=()=>Xn(u(),h()),f=(0,Yt.debounce)(()=>{i(M(F({},r()),{definition:M(F({},r().definition),{timestamp:Date.now()})}))},1e3+1e3*e.index);U(()=>{setTimeout(()=>{n.on("metadata-changed",f)},110)}),ve(()=>{n.off("metadata-changed",f)});let d=k=>{let b=M(F({},e.plugin.settings),{sidebarState:M(F({},e.plugin.settings.sidebarState),{widgets:e.plugin.settings.sidebarState.widgets.map((E,v)=>v===e.index?k:E)})});e.plugin.settings=b,e.plugin.saveSettings(),i(k)},h=()=>r().definition.topResults||xe().topResultsWidget||10,C=k=>t.metadataCache.fileToLinktext(k,"/"),D=()=>{let{attributes:k,definition:b}=Zr(r().definition,n,c());return k},A=k=>{Sc(e.plugin,e.index,b=>M(F({},b),{collapsed:k}))},w=k=>{let b=e.plugin.settings.sidebarState.widgets.length};return(()=>{let k=$c();return _(k,m(on,{get title(){return(()=>{let b=_c();return _(b,()=>r().title,null),_(b,m(Cc,{widget:r,db:n,app:t,get index(){return e.index},get total(){return e.total},update:d,get delete(){return e.onDelete},get move(){return e.move}}),null),b})()},get isCollapsed(){return e.plugin.settings.sidebarState.widgets[e.index].collapsed},onToggle:A,get children(){return[m(V,{get when(){return r().definition.scope},get children(){return m(De,{get setDefinition(){return r().definition},updateDefinition:()=>{},get children(){let b=wc();return _(b,m(dr,{get attributes(){return D()},get data(){return c().data}})),b}})}}),m(V,{get when(){return!r().definition.scope},get children(){return xc()}})]}})),k})()},rs=kc;z(["click"]);var Dc=S('<li class="sets-sidebar-link-item"><a class="internal-link sets-filename-link" target="_blank" rel="noopener"></a><div class="sets-sidebar-link-item-add clickable-icon">'),is=S('<ul class="sets-sidebar-links">'),Ac=S('<div class="sets-sidebar"><div class="sets-sidebar-buttons"><div class="clickable-icon" title="Add new type"></div><div title="Add new collection" class="clickable-icon"></div><div title="Add new item" class="clickable-icon"></div></div><div class="sets-sidebar-wrapper"><div class="sets-sidebar-scroller"><div class="sets-sidebar-widgets"></div><div title="Add new widget" class="sets-sidebar-add-widget clickable-icon">Add new widget'),Tc=S('<li><a class="internal-link sets-filename-link" target="_blank" rel="noopener">'),Ec=e=>{let t;U(()=>{(0,ct.setIcon)(t,"plus")});let n=(i,o)=>{app.commands.executeCommandById(`${e.plugin.manifest.id}:sets-new-instance-${o}`)},r=()=>e.plugin.settings.sidebarState.widgets;return(()=>{let i=Dc(),o=i.firstChild,s=o.nextSibling;Ve(o,"click",e.onNavigate,!0),_(o,()=>Ce(e.type)),s.$$click=l=>n(l,e.type);let a=t;return typeof a=="function"?R(a,s):t=s,B(l=>{let u=e.link,c=e.link;return u!==l._v$&&le(o,"data-href",l._v$=u),c!==l._v$2&&le(o,"href",l._v$2=c),l},{_v$:void 0,_v$2:void 0}),i})()};function ei(e,t){let n=M(F({},e.settings),{sidebarState:t(e.settings.sidebarState)});e.settings=n,e.saveSettings()}var Oc=e=>{let{db:t,app:n}=ae(),[r,i]=W(t.getTypeNames()),[o,s]=W(t.getCollectionNames()),[a,l]=W(e.plugin.settings.sidebarState.widgets),u,c,f,d;U(()=>{(0,ct.setIcon)(u,"file-type"),(0,ct.setIcon)(c,"collection"),(0,ct.setIcon)(f,"plus-square"),t.on("metadata-changed",()=>{i(t.getTypeNames())})});let h=()=>{n.commands.executeCommandById(`${e.plugin.manifest.id}:sets-new-type`)},C=()=>{n.commands.executeCommandById(`${e.plugin.manifest.id}:sets-new-collection`)},D=I=>{let P=new ct.Menu;t.getTypeNames().forEach(q=>{P.addItem(Q=>{Q.setTitle(`Create New ${Ce(q)}`),Q.onClick(()=>{n.commands.executeCommandById(`${e.plugin.manifest.id}:sets-new-instance-${q}`)})})}),P.showAtMouseEvent(I)},A=I=>{let P=t.getSetFileName(I),H=n.vault.getAbstractFileByPath(P);return H instanceof ct.TFile?n.metadataCache.fileToLinktext(H,"/"):""},w=I=>{let H=I.target.getAttribute("data-href");H&&(I.preventDefault(),n.workspace.openLinkText(H,"",!1))},k=(I,P)=>{e.plugin.settings.sidebarState[I]=P,e.plugin.saveSettings()},b=()=>{ei(e.plugin,I=>M(F({},I),{widgets:[...I.widgets||[],{title:"New widget",collapsed:!1,definition:{}}]})),l(e.plugin.settings.sidebarState.widgets)},E=I=>{ei(e.plugin,P=>M(F({},P),{widgets:[...P.widgets.filter((H,q)=>q!==I)]})),l(e.plugin.settings.sidebarState.widgets)},v=(I,P)=>{let H=I+P;if(H<0||H>=a().length)return;let q=e.plugin.settings.sidebarState.widgets.slice(),Q=q[I];q.splice(I,1),q.splice(H,0,Q),ei(e.plugin,oe=>M(F({},oe),{widgets:q})),l(q)},T=I=>{let P=I.target,H=P.getAttribute("data-href");H&&n.workspace.trigger("hover-link",{event:I,hoverParent:P,source:"preview",targetEl:P,hoverElement:P,linktext:H})};return(()=>{let I=Ac(),P=I.firstChild,H=P.firstChild,q=H.nextSibling,Q=q.nextSibling,oe=P.nextSibling,ye=oe.firstChild,O=ye.firstChild,j=O.nextSibling,p=u;typeof p=="function"?R(p,H):u=H,H.$$click=h;let g=c;typeof g=="function"?R(g,q):c=q,q.$$click=C;let x=f;typeof x=="function"?R(x,Q):f=Q,Q.$$click=D,ye.$$mouseover=T,_(ye,m(V,{get when(){return r().length>0},get children(){return m(on,{title:"Sets",get isCollapsed(){return e.plugin.settings.sidebarState.typesCollapsed},onToggle:$=>k("typesCollapsed",$),get children(){let $=is();return _($,()=>r().map(L=>m(Ec,{get link(){return A(L)},type:L,get plugin(){return e.plugin},onNavigate:w}))),$}})}}),O),_(ye,m(V,{get when(){return o().length>0},get children(){return m(on,{title:"Collections",get isCollapsed(){return e.plugin.settings.sidebarState.collectionsCollapsed},onToggle:$=>k("collectionsCollapsed",$),get children(){let $=is();return _($,()=>o().map(L=>(()=>{let K=Tc(),ie=K.firstChild;return ie.$$click=w,_(ie,()=>Ce(L)),B(fe=>{let pe=t.getCollectionFileName(L),$e=t.getCollectionFileName(L);return pe!==fe._v$3&&le(ie,"data-href",fe._v$3=pe),$e!==fe._v$4&&le(ie,"href",fe._v$4=$e),fe},{_v$3:void 0,_v$4:void 0}),K})())),$}})}}),O),O.$$click=w,_(O,m(ee,{get each(){return a()},children:($,L)=>m(rs,{widget:$,get index(){return L()},get total(){return a().length},onNavigate:w,get plugin(){return e.plugin},onDelete:()=>{E(L())},move:K=>{v(L(),K)}})})),j.$$click=b;let y=d;return typeof y=="function"?R(y,j):d=j,I})()},os=Oc;z(["click","mouseover"]);var zt="Sets-view",pr=class extends gr.ItemView{constructor(n,r){super(n);Oe(this,"state",{});Oe(this,"handleResize",(0,gr.debounce)(()=>{this.render()},300));this.plugin=r,this.settings=xe(),this.state={},this.icon="database"}getViewType(){return zt}getDisplayText(){return"Sets"}onResize(){super.onResize(),this.handleResize()}render(){let{contentEl:n}=this;n.empty();let r=this;he(()=>m(Se,{get app(){return{app:r.plugin.app,db:r.plugin.vaultDB}},get children(){return m(os,{get plugin(){return r.plugin}})}}),n)}onOpen(){return Y(this,null,function*(){this.render()})}onClose(){return Y(this,null,function*(){})}};var Ut=require("obsidian");var Ie=require("obsidian");var hr=class extends Ie.PluginSettingTab{constructor(t,n){super(t,n),this.plugin=n}display(){let{containerEl:t}=this;t.empty();let n=new Ie.Setting(t).setName("Sets folder").setDesc("The folder where Sets will store its data.").controlEl,[r,i]=W(this.plugin.settings.setsRoot);Z(()=>{this.plugin.settings.setsRoot=r(),this.plugin.saveSettings()}),he(()=>m(Hn,{value:r,setValue:i}),n),new Ie.Setting(t).setName("Type set suffix").setDesc("The suffix that will be added to the name of the type set.").addText(o=>o.setValue(this.plugin.settings.typeSetSuffix).onChange(s=>Y(this,null,function*(){this.plugin.settings.typeSetSuffix=s,yield this.plugin.saveSettings()}))),new Ie.Setting(t).setName("Types folder").setDesc("The subfolder where Sets will store its types.").addText(o=>o.setValue(this.plugin.settings.typesFolder).onChange(s=>Y(this,null,function*(){this.plugin.settings.typesFolder=s,yield this.plugin.saveSettings()}))),new Ie.Setting(t).setName("Types suffix").setDesc("The suffix that will be added to the name of the type.").addText(o=>o.setValue(this.plugin.settings.typesSuffix).onChange(s=>Y(this,null,function*(){this.plugin.settings.typesSuffix=s,yield this.plugin.saveSettings()}))),new Ie.Setting(t).setName("Collections folder").setDesc("The subfolder where Sets will store its collections.").addText(o=>o.setValue(this.plugin.settings.collectionsRoot).onChange(s=>Y(this,null,function*(){this.plugin.settings.collectionsRoot=s,yield this.plugin.saveSettings()}))),new Ie.Setting(t).setName("Type attribute key").setDesc("The name of the attribute that will be used to store the type of a note.").addText(o=>o.setValue(this.plugin.settings.typeAttributeKey).onChange(s=>Y(this,null,function*(){this.plugin.settings.typeAttributeKey=s,yield this.plugin.saveSettings()}))),new Ie.Setting(t).setName("Collection attribute key").setDesc("The name of the attribute that will be used to store the collection of a note.").addText(o=>o.setValue(this.plugin.settings.collectionAttributeKey).onChange(s=>Y(this,null,function*(){this.plugin.settings.collectionAttributeKey=s,yield this.plugin.saveSettings()}))),new Ie.Setting(t).setName("Top results").setDesc("The default number of notes to show in the views").addText(o=>o.setValue(this.plugin.settings.topResults.toString()).onChange(s=>Y(this,null,function*(){this.plugin.settings.topResults=parseInt(s),yield this.plugin.saveSettings()}))),new Ie.Setting(t).setName("Top Results in Widgets").setDesc("The default number of notes to show in the widgets").addText(o=>o.setValue(this.plugin.settings.topResultsWidget.toString()).onChange(s=>Y(this,null,function*(){this.plugin.settings.topResultsWidget=parseInt(s),yield this.plugin.saveSettings()}))),this.createToggle(t,"Register custom properties","Register custom metadata property types.","registerCustomTypes"),this.createToggle(t,"Show sidebar at startup","Show the Sets sidebar at startup.","showAtStartup")}createToggle(t,n,r,i){new Ie.Setting(t).setName(n).setDesc(r).addToggle(o=>o.setValue(this.plugin.settings[i]).onChange(s=>Y(this,null,function*(){this.plugin.settings[i]=s,yield this.plugin.saveSettings(),this.display()})))}};var ss=require("obsidian");function as(e,t,n,r){let i=(0,ss.parseYaml)(e)||{};try{ts(n.app,n.vaultDB,i,t,r)}catch(o){console.error(o)}}var ls=require("obsidian");function Fc(e){return e.metadataTypeManager.registeredTypeWidgets.password={name:()=>"Password",type:"password",default:()=>"",icon:"lucide-key",validate:t=>typeof t=="string",render:(t,n,r)=>{t.className=t.className+" metadata-property";let i=t.createDiv({cls:"metadata-property-value"}),o=i.createEl("input"),s=l=>{r.onChange(l)};o.className="metadata-input-text mod-truncate",o.setAttr("placeholder","No value"),o.tabIndex=0,o.type="password",o.value=n.value||"",o.addEventListener("keydown",l=>{if(!l.isComposing)if(l.key==="Enter"){if(l.shiftKey||l.defaultPrevented)return;l.preventDefault(),s(o.value)}else l.key==="Escape"&&l.preventDefault()}),o.addEventListener("blur",l=>{l.defaultPrevented||s(o.value.trimEnd())});let a=i.createDiv({cls:"clickable-icon"});a.addEventListener("click",l=>Y(this,null,function*(){yield navigator.clipboard.writeText(o.value)})),(0,ls.setIcon)(a,"copy")}},e.metadataTypeManager.registeredTypeWidgets.password}var cs=Fc;var us=require("obsidian");var Ic=S('<div class="sets-modal-info"><div>Type Archetype will be created as: <code></code></div><div>The Type will have the property: <code>: </code></div><div>Set Folder will be created as: <code>'),yr=class extends Ze{constructor(t,n){super(t,"Enter type name","Type name","",r=>Y(this,null,function*(){try{let i=yield this.plugin.vaultDB.createNewType(r);yield this.app.workspace.openLinkText(i.path,"/","tab"),n.registerNewInstancesCommands()}catch(i){new us.Notice(i.message)}})),this.plugin=n,super._moreInfo=r=>{let i=this;return m(V,{get when(){return r.value()},get children(){let o=Ic(),s=o.firstChild,a=s.firstChild,l=a.nextSibling,u=s.nextSibling,c=u.firstChild,f=c.nextSibling,d=f.firstChild,h=u.nextSibling,C=h.firstChild,D=C.nextSibling;return _(l,()=>`${i.plugin.settings.setsRoot}/${i.plugin.settings.typesFolder}/${i.plugin.vaultDB.getArchetypeName(r.value())}`),_(f,()=>i.plugin.settings.typeAttributeKey,d),_(f,()=>rn(r.value()),null),_(D,()=>i.plugin.vaultDB.getSetFolderName(rn(r.value()))),o}})}}};var fs=require("obsidian");var Mc=S("<div><div>Collection will be created as: <code>"),br=class extends Ze{constructor(t,n){super(t,"Enter collection name","Collection name","",r=>Y(this,null,function*(){try{let i=yield this.plugin.vaultDB.createNewCollection(r);yield this.app.workspace.openLinkText(i.path,"/","tab")}catch(i){new fs.Notice(i.message)}})),this.plugin=n,super._moreInfo=r=>{let i=this;return m(V,{get when(){return r.value()},get children(){return[" ",(()=>{let o=Mc(),s=o.firstChild,a=s.firstChild,l=a.nextSibling;return _(l,()=>`${i.plugin.settings.setsRoot}/${i.plugin.settings.collectionsRoot}/${r.value()}/${r.value()}.md`),o})()]}})}}};var ds=require("obsidian"),vr=class extends ds.SuggestModal{constructor(t,n,r){super(t),this.data=n,this.onChoice=r}getSuggestions(t){return this.data.filter(n=>n.name.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,n){n.createEl("div",{text:t.name})}onChooseSuggestion(t){this.onChoice(t)}};var Pc='<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-kanban"><path d="M6 5v11"/><path d="M12 5v6"/><path d="M18 5v14"/></svg>',Nc='<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-stack"><path d="M16 2v5h5"/><path d="M21 6v6.5c0 .8-.7 1.5-1.5 1.5h-7c-.8 0-1.5-.7-1.5-1.5v-9c0-.8.7-1.5 1.5-1.5H17l4 4z"/><path d="M7 8v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H15"/><path d="M3 12v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H11"/></svg>',ms;function xe(){return ms}var wr=class extends Ut.Plugin{constructor(){super(...arguments);Oe(this,"_instanceCommands",[])}onload(){return Y(this,null,function*(){yield this.loadSettings(),(0,Me.addIcon)("board",Pc),(0,Me.addIcon)("collection",Nc),this.registerView(zt,n=>new pr(n,this)),this.app.workspace.onLayoutReady(()=>{this.settings.showAtStartup&&this.activateView()}),this.registerCodeBlock(),this.registerPostProcessor(),this.registerNewTypes(),this.addSettingTab(new hr(this.app,this)),this._vaultDB=new Gn(this),this.onVaultDBInitialized(),this.onFileMenu=this.onFileMenu.bind(this),this.registerEvent(this.app.workspace.on("file-menu",this.onFileMenu)),this.registerEvent(this.app.workspace.on("editor-menu",this.onEditorMenu))})}patchView(){let n=Me.MarkdownView.prototype.getDisplayText,r=this.app;Me.MarkdownView.prototype.getDisplayText=function(){var s,a;let i=this.file,o="";if(i){let l=r.metadataCache.getFileCache(i);(s=l==null?void 0:l.frontmatter)!=null&&s.__icon&&(o=(a=l==null?void 0:l.frontmatter)==null?void 0:a.__icon)}return o+n.call(this)}}onVaultDBInitialized(){this.registerCommands(),this.vaultDB.on("metadata-changed",()=>{this.registerNewInstancesCommands()})}registerCommands(){this.addCommand({id:"open-sidebar",name:"Open Sets sidebar",callback:()=>{this.activateView()}}),this.addCommand({id:"new-type",name:"Create new type",callback:()=>{new yr(this.app,this).open()}}),this.addCommand({id:"new-collection",name:"Create new collection",callback:()=>{new br(this.app,this).open()}}),this.addCommand({id:"add-to-collection",name:"Add to collection",checkCallback:n=>{let r=this.app.workspace.getActiveViewOfType(Me.MarkdownView);if(n)return!!r;if(r){let i=r.file;if(i instanceof Me.TFile){let{collectionLinks:o,currentColl:s}=this.getAvailableCollections(i),a=o.map(l=>({name:l.col.file.basename,value:l.link}));new vr(this.app,a,l=>{s.push(l.value),this.app.fileManager.processFrontMatter(i,u=>{u[this.settings.collectionAttributeKey]=s})}).open()}}return!1}}),this.registerNewInstancesCommands()}registerNewInstancesCommands(){let n=this._vaultDB.getTypeNames();n.forEach(i=>{if(this._instanceCommands.find(s=>s.id===`${this.manifest.id}:new-instance-${i}`))return;let o=this.addCommand({id:`new-instance-${i}`,name:`Create new ${Ce(i)}`,callback:()=>Y(this,null,function*(){new Ze(this.app,`Enter ${Ce(i)} name`,`${Ce(i)} name`,"",s=>Y(this,null,function*(){try{let a=yield this._vaultDB.createNewInstance(i,s);a?yield this.app.workspace.openLinkText(a.path,a.path,!0):new Me.Notice("Could not create file")}catch(a){new Me.Notice(a.message)}})).open()})});this._instanceCommands.push(o)});let r=[];this._instanceCommands.forEach(i=>{n.includes(i.id.replace(`${this.manifest.id}:new-instance-`,""))||(this.app.commands.removeCommand(i.id),r.push(i))}),r.forEach(i=>{this._instanceCommands.splice(this._instanceCommands.indexOf(i),1)})}registerNewTypes(){cs(this.app),this.app.metadataTypeManager.savePropertyInfo&&this.app.metadataTypeManager.savePropertyInfo(),this.app.metadataTypeManager.updatePropertyInfoCache&&this.app.metadataTypeManager.updatePropertyInfoCache()}onunload(){this.vaultDB.off("initialized",this.onVaultDBInitialized),this._vaultDB.off("metadata-changed",()=>{this.registerNewInstancesCommands()}),this.vaultDB.dispose(),this.app.workspace.off("file-menu",this.onFileMenu),this.app.workspace.off("editor-menu",this.onEditorMenu)}get vaultDB(){return this._vaultDB}loadSettings(){return Y(this,null,function*(){this.settings=Object.assign({},ii,yield this.loadData()),ms=this.settings})}saveSettings(){return Y(this,null,function*(){yield this.saveData(this.settings)})}activateView(){return Y(this,null,function*(){let n=this.app.workspace.getLeavesOfType(zt)[0];n||(yield this.app.workspace.getRightLeaf(!1).setViewState({type:zt,active:!0},{settings:this.settings}),n=this.app.workspace.getLeavesOfType(zt)[0]),n&&this.app.workspace.revealLeaf(n)})}registerCodeBlock(){return Y(this,null,function*(){yield(0,Ut.loadMathJax)(),yield(0,Ut.finishRenderMath)(),this.registerMarkdownCodeBlockProcessor(Dn,(n,r,i)=>{as(n,r,this,i)})})}registerPostProcessor(){return Y(this,null,function*(){})}registerEditorExtensions(){return Y(this,null,function*(){})}onFileMenu(n,r,i,o){if(!(r instanceof Me.TFile))return;let{collectionLinks:s,currentColl:a}=this.getAvailableCollections(r);s.length>0&&n.addItem(l=>{l.setTitle("Add to collection..."),s.forEach(u=>{l.setSubmenu().addItem(c=>{c.setTitle(u.col.file.basename),c.callback=()=>{a.push(u.link),this.app.fileManager.processFrontMatter(r,f=>{f[this.settings.collectionAttributeKey]=a})}})})})}getAvailableCollections(n){var a;let r=this.vaultDB.getCollections(),i=this.app.metadataCache.getFileCache(n),o=((a=i==null?void 0:i.frontmatter)==null?void 0:a[this.settings.collectionAttributeKey])||[],s=r.map(l=>({col:l,link:this.vaultDB.generateWikiLink(l.file,"/")}));return s=s.filter(l=>!o.includes(l.link)),{collectionLinks:s,currentColl:o}}onEditorMenu(n,r,i){}};

/* nosourcemap */
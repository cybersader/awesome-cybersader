/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var u=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var w=(i,e)=>{for(var r in e)u(i,r,{get:e[r],enumerable:!0})},A=(i,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of x(e))!R.call(i,t)&&t!==r&&u(i,t,{get:()=>e[t],enumerable:!(n=b(e,t))||n.enumerable});return i};var S=i=>A(u({},"__esModule",{value:!0}),i);var M={};w(M,{default:()=>f});module.exports=S(M);var c=require("obsidian");function h(i){let e={raw:i,body:i},r=i.split(`
`).map(n=>n.trim()).filter(n=>n.length>0);if(r.length>=2){let n=r[r.length-1];if(n.includes("Kindle Edition")){e.body=r.slice(0,-1).join(`
`).trim();let t=n.split(".");if(t.length>=2){let l=t[0].split(";").map(o=>o.trim());e.authors=l,t.length>=2&&(e.title=t[1].replace(/\s*\([^(]*$/,"").trim())}let a=n.match(/\(pp?\. ([^)]+)\)/);a&&(e.page=a[1])}}return e}function m(i){return i.replace(/"/g,"'").replace(/“/g,"\u2018").replace(/”/g,"\u2019")}function g(i){return i.toLowerCase().replace(/[.:,()-\u002d\u2010\u2011\u2012\u2013\u2014\u2015\ufe58\ufe63\uff0d]/gu,"").replace(/\s+/g," ").trim()}function C(i,e){var n;let r=g(i);return((n=e.find(t=>g(t.title||"")===r))==null?void 0:n.id)||null}function y(i){let e=[...i.editor||[],...i.author||[]];e=e.slice(0,4);let r=e.map(a=>a.family||a.given).join(" "),n=i.issued&&i.issued.length>0&&i.issued[0].year?i.issued[0].year:"",t=i.title||"";return[r,n,t].join(" ")}var f=class extends c.Plugin{async onload(){this.addCommand({id:"paste-quote",name:"Paste quote",editorCallback:this.pasteQuote.bind(this)}),this.addCommand({id:"paste-csl-yaml",name:"Paste CSL YAML",editorCallback:this.pasteCslYaml.bind(this)}),this.addCommand({id:"cite-reference",name:"Cite reference",editorCallback:this.citeReference.bind(this)})}async pasteQuote(e,r){let n=await navigator.clipboard.readText(),t=h(n),a=e.getCursor(),s=this.formatQuote(t.body,a),l=this.citationForQuote(t,r.file),o=`${s}${l}`;e.replaceRange(o,a),e.setCursor(e.offsetToPos(e.posToOffset(a)+o.length))}formatQuote(e,r){return r.ch===0?`> ${e}`:`\u201C${m(e)}\u201D`}citationForQuote(e,r){var l;if(!(e.title||e.page))return"";if(!e.title)return`(p. ${e.page})`;let n=r==null?null:this.app.metadataCache.getFileCache(r),t=((l=n==null?void 0:n.frontmatter)==null?void 0:l.references)||[];if(t.length==0){let o=` (*${e.title}*`;return e.page&&(o+=`, p. ${e.page}`),o+=")",o}let s=`[@${C(e.title,t)||`TODO ${e.title}`}`;return e.page&&(s+=", p. "+e.page),s+="]",s}async pasteCslYaml(e,r){if(!r.file)return;let n=await navigator.clipboard.readText();if(!n){new c.Notice("Paste CSL YAML failed: there is no text on the clipboard");return}let t;try{t=(0,c.parseYaml)(n)}catch(s){new c.Notice("Paste CSL YAML failed: could not parse clipboard text as YAML");return}let a;if(Array.isArray(t.references)&&t.references.length>0&&t.references[0].id)a=t.references;else if(Array.isArray(t)&&t.length>0&&t[0].id)a=t;else if(t.id)a=[t];else{new c.Notice("Paste CSL YAML failed: clipboard content does not look like CSL (expected object(s) with 'id' keys, optionally under a 'references' key)");return}await this.app.fileManager.processFrontMatter(r.file,s=>{(s.references===void 0||s.references===null)&&(s.references=[]),Array.isArray(s.references)||new c.Notice("Paste CSL YAML failed: there is an existing 'references' field, but it is not an array");let l=new Set((s.references||[]).map(d=>d.id)),o=[];for(let d of a)l.has(d.id)?(o.push(d.id),l.add(d.id)):s.references.push(d);o.length>0&&new c.Notice(`Paste CSL YAML skipped ${o.length} items because their IDs were already present`)})}async citeReference(e,r){var s;if(!r.file)return;let n=this.app.metadataCache.getFileCache(r.file),t=((s=n==null?void 0:n.frontmatter)==null?void 0:s.references)||[];if(!t||t.length===0){new c.Notice("Cite Reference failed: no references found in front matter");return}new p(this.app,t,l=>{let o=`[@${l}]`,d=e.getCursor();e.replaceRange(o,d),e.setCursor(e.offsetToPos(e.posToOffset(d)+o.length-1))}).open()}onunload(){}},p=class extends c.FuzzySuggestModal{constructor(r,n,t){super(r);this.references=n,this.onChooseReference=t}getItemText(r){return r.text}getItems(){return this.references.map(r=>({id:r.id,text:y(r)}))}onChooseItem(r,n){this.onChooseReference(r.id)}};

/* nosourcemap */
/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, please visit the github repository of this plugin
*/

"use strict";var hv=Object.create;var fa=Object.defineProperty;var mv=Object.getOwnPropertyDescriptor;var vv=Object.getOwnPropertyNames;var _v=Object.getPrototypeOf,gv=Object.prototype.hasOwnProperty;var yv=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Xf=(t,e)=>{for(var r in e)fa(t,r,{get:e[r],enumerable:!0})},Gf=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of vv(e))!gv.call(t,s)&&s!==r&&fa(t,s,{get:()=>e[s],enumerable:!(n=mv(e,s))||n.enumerable});return t};var Gi=(t,e,r)=>(r=t!=null?hv(_v(t)):{},Gf(e||!t||!t.__esModule?fa(r,"default",{value:t,enumerable:!0}):r,t)),bv=t=>Gf(fa({},"__esModule",{value:!0}),t);var ld=yv((pc,hc)=>{(function(t,e){typeof pc=="object"&&typeof hc<"u"?hc.exports=e():typeof define=="function"&&define.amd?define(e):(t=typeof globalThis<"u"?globalThis:t||self,t.Dexie=e())})(pc,function(){"use strict";var t=function(i,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var u in c)Object.prototype.hasOwnProperty.call(c,u)&&(a[u]=c[u])},t(i,o)};function e(i,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(i,o);function a(){this.constructor=i}i.prototype=o===null?Object.create(o):(a.prototype=o.prototype,new a)}var r=function(){return r=Object.assign||function(o){for(var a,c=1,u=arguments.length;c<u;c++){a=arguments[c];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(o[d]=a[d])}return o},r.apply(this,arguments)};function n(i,o,a){if(a||arguments.length===2)for(var c=0,u=o.length,d;c<u;c++)(d||!(c in o))&&(d||(d=Array.prototype.slice.call(o,0,c)),d[c]=o[c]);return i.concat(d||Array.prototype.slice.call(o))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,l=Object.keys,f=Array.isArray;typeof Promise<"u"&&!s.Promise&&(s.Promise=Promise);function p(i,o){return typeof o!="object"||l(o).forEach(function(a){i[a]=o[a]}),i}var m=Object.getPrototypeOf,_={}.hasOwnProperty;function b(i,o){return _.call(i,o)}function y(i,o){typeof o=="function"&&(o=o(m(i))),(typeof Reflect>"u"?l:Reflect.ownKeys)(o).forEach(function(a){$(i,a,o[a])})}var x=Object.defineProperty;function $(i,o,a,c){x(i,o,p(a&&b(a,"get")&&typeof a.get=="function"?{get:a.get,set:a.set,configurable:!0}:{value:a,configurable:!0,writable:!0},c))}function P(i){return{from:function(o){return i.prototype=Object.create(o.prototype),$(i.prototype,"constructor",i),{extend:y.bind(null,i.prototype)}}}}var F=Object.getOwnPropertyDescriptor;function j(i,o){var a=F(i,o),c;return a||(c=m(i))&&j(c,o)}var z=[].slice;function N(i,o,a){return z.call(i,o,a)}function H(i,o){return o(i)}function V(i){if(!i)throw new Error("Assertion Failed")}function Q(i){s.setImmediate?setImmediate(i):setTimeout(i,0)}function G(i,o){return i.reduce(function(a,c,u){var d=o(c,u);return d&&(a[d[0]]=d[1]),a},{})}function J(i,o){if(typeof o=="string"&&b(i,o))return i[o];if(!o)return i;if(typeof o!="string"){for(var a=[],c=0,u=o.length;c<u;++c){var d=J(i,o[c]);a.push(d)}return a}var h=o.indexOf(".");if(h!==-1){var v=i[o.substr(0,h)];return v==null?void 0:J(v,o.substr(h+1))}}function U(i,o,a){if(!(!i||o===void 0)&&!("isFrozen"in Object&&Object.isFrozen(i)))if(typeof o!="string"&&"length"in o){V(typeof a!="string"&&"length"in a);for(var c=0,u=o.length;c<u;++c)U(i,o[c],a[c])}else{var d=o.indexOf(".");if(d!==-1){var h=o.substr(0,d),v=o.substr(d+1);if(v==="")a===void 0?f(i)&&!isNaN(parseInt(h))?i.splice(h,1):delete i[h]:i[h]=a;else{var g=i[h];(!g||!b(i,h))&&(g=i[h]={}),U(g,v,a)}}else a===void 0?f(i)&&!isNaN(parseInt(o))?i.splice(o,1):delete i[o]:i[o]=a}}function ue(i,o){typeof o=="string"?U(i,o,void 0):"length"in o&&[].map.call(o,function(a){U(i,a,void 0)})}function ge(i){var o={};for(var a in i)b(i,a)&&(o[a]=i[a]);return o}var $e=[].concat;function ye(i){return $e.apply([],i)}var Re="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ye([8,16,32,64].map(function(i){return["Int","Uint","Float"].map(function(o){return o+i+"Array"})}))).filter(function(i){return s[i]}),je=new Set(Re.map(function(i){return s[i]}));function Dt(i){var o={};for(var a in i)if(b(i,a)){var c=i[a];o[a]=!c||typeof c!="object"||je.has(c.constructor)?c:Dt(c)}return o}function Kr(i){for(var o in i)if(b(i,o))return!1;return!0}var kt=null;function Ft(i){kt=new WeakMap;var o=Xt(i);return kt=null,o}function Xt(i){if(!i||typeof i!="object")return i;var o=kt.get(i);if(o)return o;if(f(i)){o=[],kt.set(i,o);for(var a=0,c=i.length;a<c;++a)o.push(Xt(i[a]))}else if(je.has(i.constructor))o=i;else{var u=m(i);o=u===Object.prototype?{}:Object.create(u),kt.set(i,o);for(var d in i)b(i,d)&&(o[d]=Xt(i[d]))}return o}var Gt={}.toString;function Zt(i){return Gt.call(i).slice(8,-1)}var pr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Te=typeof pr=="symbol"?function(i){var o;return i!=null&&(o=i[pr])&&o.apply(i)}:function(){return null};function be(i,o){var a=i.indexOf(o);return a>=0&&i.splice(a,1),a>=0}var Oe={};function Ie(i){var o,a,c,u;if(arguments.length===1){if(f(i))return i.slice();if(this===Oe&&typeof i=="string")return[i];if(u=Te(i)){for(a=[];c=u.next(),!c.done;)a.push(c.value);return a}if(i==null)return[i];if(o=i.length,typeof o=="number"){for(a=new Array(o);o--;)a[o]=i[o];return a}return[i]}for(o=arguments.length,a=new Array(o);o--;)a[o]=arguments[o];return a}var Ne=typeof Symbol<"u"?function(i){return i[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Xe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],at=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],$t=Xe.concat(at),nn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function er(i,o){this.name=i,this.message=o}P(er).from(Error).extend({toString:function(){return this.name+": "+this.message}});function Ko(i,o){return i+". Errors: "+Object.keys(o).map(function(a){return o[a].toString()}).filter(function(a,c,u){return u.indexOf(a)===c}).join(`
`)}function Vi(i,o,a,c){this.failures=o,this.failedKeys=c,this.successCount=a,this.message=Ko(i,o)}P(Vi).from(er);function Wr(i,o){this.name="BulkError",this.failures=Object.keys(o).map(function(a){return o[a]}),this.failuresByPos=o,this.message=Ko(i,this.failures)}P(Wr).from(er);var zi=$t.reduce(function(i,o){return i[o]=o+"Error",i},{}),Ls=er,ae=$t.reduce(function(i,o){var a=o+"Error";function c(u,d){this.name=a,u?typeof u=="string"?(this.message="".concat(u).concat(d?`
 `+d:""),this.inner=d||null):typeof u=="object"&&(this.message="".concat(u.name," ").concat(u.message),this.inner=u):(this.message=nn[o]||a,this.inner=null)}return P(c).from(Ls),i[o]=c,i},{});ae.Syntax=SyntaxError,ae.Type=TypeError,ae.Range=RangeError;var Bs=at.reduce(function(i,o){return i[o+"Error"]=ae[o],i},{});function Cl(i,o){if(!i||i instanceof er||i instanceof TypeError||i instanceof SyntaxError||!i.name||!Bs[i.name])return i;var a=new Bs[i.name](o||i.message,i);return"stack"in i&&$(a,"stack",{get:function(){return this.inner.stack}}),a}var on=$t.reduce(function(i,o){return["Syntax","Type","Range"].indexOf(o)===-1&&(i[o+"Error"]=ae[o]),i},{});on.ModifyError=Vi,on.DexieError=er,on.BulkError=Wr;function Be(){}function Wo(i){return i}function zh(i,o){return i==null||i===Wo?o:function(a){return o(i(a))}}function qn(i,o){return function(){i.apply(this,arguments),o.apply(this,arguments)}}function Uh(i,o){return i===Be?o:function(){var a=i.apply(this,arguments);a!==void 0&&(arguments[0]=a);var c=this.onsuccess,u=this.onerror;this.onsuccess=null,this.onerror=null;var d=o.apply(this,arguments);return c&&(this.onsuccess=this.onsuccess?qn(c,this.onsuccess):c),u&&(this.onerror=this.onerror?qn(u,this.onerror):u),d!==void 0?d:a}}function Hh(i,o){return i===Be?o:function(){i.apply(this,arguments);var a=this.onsuccess,c=this.onerror;this.onsuccess=this.onerror=null,o.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?qn(a,this.onsuccess):a),c&&(this.onerror=this.onerror?qn(c,this.onerror):c)}}function Yh(i,o){return i===Be?o:function(a){var c=i.apply(this,arguments);p(a,c);var u=this.onsuccess,d=this.onerror;this.onsuccess=null,this.onerror=null;var h=o.apply(this,arguments);return u&&(this.onsuccess=this.onsuccess?qn(u,this.onsuccess):u),d&&(this.onerror=this.onerror?qn(d,this.onerror):d),c===void 0?h===void 0?void 0:h:p(c,h)}}function Qh(i,o){return i===Be?o:function(){return o.apply(this,arguments)===!1?!1:i.apply(this,arguments)}}function Sl(i,o){return i===Be?o:function(){var a=i.apply(this,arguments);if(a&&typeof a.then=="function"){for(var c=this,u=arguments.length,d=new Array(u);u--;)d[u]=arguments[u];return a.then(function(){return o.apply(c,d)})}return o.apply(this,arguments)}}var Sr=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function mf(i,o){Sr=i}var jo={},vf=100,Al=typeof Promise>"u"?[]:function(){var i=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[i,m(i),i];var o=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[o,m(o),i]}(),_f=Al[0],gf=Al[1],Jh=Al[2],Xh=gf&&gf.then,qo=_f&&_f.constructor,Pl=!!Jh;function Gh(){queueMicrotask(em)}var Vo=function(i,o){zo.push([i,o]),Ks&&(Gh(),Ks=!1)},Il=!0,Ks=!0,Vn=[],Ws=[],Rl=Wo,sn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Be,pgp:!1,env:{},finalize:Be},se=sn,zo=[],zn=0,js=[];function Z(i){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var o=this._PSD=se;if(typeof i!="function"){if(i!==jo)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Ol(this,this._value);return}this._state=null,this._value=null,++o.ref,bf(this,i)}var Tl={get:function(){var i=se,o=Us;function a(c,u){var d=this,h=!i.global&&(i!==se||o!==Us),v=h&&!ln(),g=new Z(function(w,C){Nl(d,new yf(Ef(c,i,h,v),Ef(u,i,h,v),w,C,i))});return this._consoleTask&&(g._consoleTask=this._consoleTask),g}return a.prototype=jo,a},set:function(i){$(this,"then",i&&i.prototype===jo?Tl:{get:function(){return i},set:Tl.set})}};y(Z.prototype,{then:Tl,_then:function(i,o){Nl(this,new yf(null,null,i,o,se))},catch:function(i){if(arguments.length===1)return this.then(null,i);var o=arguments[0],a=arguments[1];return typeof o=="function"?this.then(null,function(c){return c instanceof o?a(c):qs(c)}):this.then(null,function(c){return c&&c.name===o?a(c):qs(c)})},finally:function(i){return this.then(function(o){return Z.resolve(i()).then(function(){return o})},function(o){return Z.resolve(i()).then(function(){return qs(o)})})},timeout:function(i,o){var a=this;return i<1/0?new Z(function(c,u){var d=setTimeout(function(){return u(new ae.Timeout(o))},i);a.then(c,u).finally(clearTimeout.bind(null,d))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&$(Z.prototype,Symbol.toStringTag,"Dexie.Promise"),sn.env=xf();function yf(i,o,a,c,u){this.onFulfilled=typeof i=="function"?i:null,this.onRejected=typeof o=="function"?o:null,this.resolve=a,this.reject=c,this.psd=u}y(Z,{all:function(){var i=Ie.apply(null,arguments).map(Hs);return new Z(function(o,a){i.length===0&&o([]);var c=i.length;i.forEach(function(u,d){return Z.resolve(u).then(function(h){i[d]=h,--c||o(i)},a)})})},resolve:function(i){if(i instanceof Z)return i;if(i&&typeof i.then=="function")return new Z(function(a,c){i.then(a,c)});var o=new Z(jo,!0,i);return o},reject:qs,race:function(){var i=Ie.apply(null,arguments).map(Hs);return new Z(function(o,a){i.map(function(c){return Z.resolve(c).then(o,a)})})},PSD:{get:function(){return se},set:function(i){return se=i}},totalEchoes:{get:function(){return Us}},newPSD:an,usePSD:Un,scheduler:{get:function(){return Vo},set:function(i){Vo=i}},rejectionMapper:{get:function(){return Rl},set:function(i){Rl=i}},follow:function(i,o){return new Z(function(a,c){return an(function(u,d){var h=se;h.unhandleds=[],h.onunhandled=d,h.finalize=qn(function(){var v=this;tm(function(){v.unhandleds.length===0?u():d(v.unhandleds[0])})},h.finalize),i()},o,a,c)})}}),qo&&(qo.allSettled&&$(Z,"allSettled",function(){var i=Ie.apply(null,arguments).map(Hs);return new Z(function(o){i.length===0&&o([]);var a=i.length,c=new Array(a);i.forEach(function(u,d){return Z.resolve(u).then(function(h){return c[d]={status:"fulfilled",value:h}},function(h){return c[d]={status:"rejected",reason:h}}).then(function(){return--a||o(c)})})})}),qo.any&&typeof AggregateError<"u"&&$(Z,"any",function(){var i=Ie.apply(null,arguments).map(Hs);return new Z(function(o,a){i.length===0&&a(new AggregateError([]));var c=i.length,u=new Array(c);i.forEach(function(d,h){return Z.resolve(d).then(function(v){return o(v)},function(v){u[h]=v,--c||a(new AggregateError(u))})})})}));function bf(i,o){try{o(function(a){if(i._state===null){if(a===i)throw new TypeError("A promise cannot be resolved with itself.");var c=i._lib&&Ui();a&&typeof a.then=="function"?bf(i,function(u,d){a instanceof Z?a._then(u,d):a.then(u,d)}):(i._state=!0,i._value=a,wf(i)),c&&Hi()}},Ol.bind(null,i))}catch(a){Ol(i,a)}}function Ol(i,o){if(Ws.push(o),i._state===null){var a=i._lib&&Ui();o=Rl(o),i._state=!1,i._value=o,rm(i),wf(i),a&&Hi()}}function wf(i){var o=i._listeners;i._listeners=[];for(var a=0,c=o.length;a<c;++a)Nl(i,o[a]);var u=i._PSD;--u.ref||u.finalize(),zn===0&&(++zn,Vo(function(){--zn===0&&Dl()},[]))}function Nl(i,o){if(i._state===null){i._listeners.push(o);return}var a=i._state?o.onFulfilled:o.onRejected;if(a===null)return(i._state?o.resolve:o.reject)(i._value);++o.psd.ref,++zn,Vo(Zh,[a,i,o])}function Zh(i,o,a){try{var c,u=o._value;!o._state&&Ws.length&&(Ws=[]),c=Sr&&o._consoleTask?o._consoleTask.run(function(){return i(u)}):i(u),!o._state&&Ws.indexOf(u)===-1&&nm(o),a.resolve(c)}catch(d){a.reject(d)}finally{--zn===0&&Dl(),--a.psd.ref||a.psd.finalize()}}function em(){Un(sn,function(){Ui()&&Hi()})}function Ui(){var i=Il;return Il=!1,Ks=!1,i}function Hi(){var i,o,a;do for(;zo.length>0;)for(i=zo,zo=[],a=i.length,o=0;o<a;++o){var c=i[o];c[0].apply(null,c[1])}while(zo.length>0);Il=!0,Ks=!0}function Dl(){var i=Vn;Vn=[],i.forEach(function(c){c._PSD.onunhandled.call(null,c._value,c)});for(var o=js.slice(0),a=o.length;a;)o[--a]()}function tm(i){function o(){i(),js.splice(js.indexOf(o),1)}js.push(o),++zn,Vo(function(){--zn===0&&Dl()},[])}function rm(i){Vn.some(function(o){return o._value===i._value})||Vn.push(i)}function nm(i){for(var o=Vn.length;o;)if(Vn[--o]._value===i._value){Vn.splice(o,1);return}}function qs(i){return new Z(jo,!1,i)}function Ue(i,o){var a=se;return function(){var c=Ui(),u=se;try{return cn(a,!0),i.apply(this,arguments)}catch(d){o&&o(d)}finally{cn(u,!1),c&&Hi()}}}var ht={awaits:0,echoes:0,id:0},im=0,Vs=[],zs=0,Us=0,om=0;function an(i,o,a,c){var u=se,d=Object.create(u);d.parent=u,d.ref=0,d.global=!1,d.id=++om,sn.env,d.env=Pl?{Promise:Z,PromiseProp:{value:Z,configurable:!0,writable:!0},all:Z.all,race:Z.race,allSettled:Z.allSettled,any:Z.any,resolve:Z.resolve,reject:Z.reject}:{},o&&p(d,o),++u.ref,d.finalize=function(){--this.parent.ref||this.parent.finalize()};var h=Un(d,i,a,c);return d.ref===0&&d.finalize(),h}function Yi(){return ht.id||(ht.id=++im),++ht.awaits,ht.echoes+=vf,ht.id}function ln(){return ht.awaits?(--ht.awaits===0&&(ht.id=0),ht.echoes=ht.awaits*vf,!0):!1}(""+Xh).indexOf("[native code]")===-1&&(Yi=ln=Be);function Hs(i){return ht.echoes&&i&&i.constructor===qo?(Yi(),i.then(function(o){return ln(),o},function(o){return ln(),et(o)})):i}function sm(i){++Us,(!ht.echoes||--ht.echoes===0)&&(ht.echoes=ht.awaits=ht.id=0),Vs.push(se),cn(i,!0)}function am(){var i=Vs[Vs.length-1];Vs.pop(),cn(i,!1)}function cn(i,o){var a=se;if((o?ht.echoes&&(!zs++||i!==se):zs&&(!--zs||i!==se))&&queueMicrotask(o?sm.bind(null,i):am),i!==se&&(se=i,a===sn&&(sn.env=xf()),Pl)){var c=sn.env.Promise,u=i.env;(a.global||i.global)&&(Object.defineProperty(s,"Promise",u.PromiseProp),c.all=u.all,c.race=u.race,c.resolve=u.resolve,c.reject=u.reject,u.allSettled&&(c.allSettled=u.allSettled),u.any&&(c.any=u.any))}}function xf(){var i=s.Promise;return Pl?{Promise:i,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:i.all,race:i.race,allSettled:i.allSettled,any:i.any,resolve:i.resolve,reject:i.reject}:{}}function Un(i,o,a,c,u){var d=se;try{return cn(i,!0),o(a,c,u)}finally{cn(d,!1)}}function Ef(i,o,a,c){return typeof i!="function"?i:function(){var u=se;a&&Yi(),cn(o,!0);try{return i.apply(this,arguments)}finally{cn(u,!1),c&&queueMicrotask(ln)}}}function Fl(i){Promise===qo&&ht.echoes===0?zs===0?i():enqueueNativeMicroTask(i):setTimeout(i,0)}var et=Z.reject;function Ml(i,o,a,c){if(!i.idbdb||!i._state.openComplete&&!se.letThrough&&!i._vip){if(i._state.openComplete)return et(new ae.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return et(new ae.DatabaseClosed);i.open().catch(Be)}return i._state.dbReadyPromise.then(function(){return Ml(i,o,a,c)})}else{var u=i._createTransaction(o,a,i._dbSchema);try{u.create(),i._state.PR1398_maxLoop=3}catch(d){return d.name===zi.InvalidState&&i.isOpen()&&--i._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),i.close({disableAutoOpen:!1}),i.open().then(function(){return Ml(i,o,a,c)})):et(d)}return u._promise(o,function(d,h){return an(function(){return se.trans=u,c(d,h,u)})}).then(function(d){if(o==="readwrite")try{u.idbtrans.commit()}catch{}return o==="readonly"?d:u._completion.then(function(){return d})})}}var kf="4.0.8",Hn="\uFFFF",Ll=-1/0,jr="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",$f="String expected.",Qi=[],Ys="__dbnames",Bl="readonly",Kl="readwrite";function Yn(i,o){return i?o?function(){return i.apply(this,arguments)&&o.apply(this,arguments)}:i:o}var Cf={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Qs(i){return typeof i=="string"&&!/\./.test(i)?function(o){return o[i]===void 0&&i in o&&(o=Ft(o),delete o[i]),o}:function(o){return o}}function Sf(){throw ae.Type()}function De(i,o){try{var a=Af(i),c=Af(o);if(a!==c)return a==="Array"?1:c==="Array"?-1:a==="binary"?1:c==="binary"?-1:a==="string"?1:c==="string"?-1:a==="Date"?1:c!=="Date"?NaN:-1;switch(a){case"number":case"Date":case"string":return i>o?1:i<o?-1:0;case"binary":return cm(Pf(i),Pf(o));case"Array":return lm(i,o)}}catch{}return NaN}function lm(i,o){for(var a=i.length,c=o.length,u=a<c?a:c,d=0;d<u;++d){var h=De(i[d],o[d]);if(h!==0)return h}return a===c?0:a<c?-1:1}function cm(i,o){for(var a=i.length,c=o.length,u=a<c?a:c,d=0;d<u;++d)if(i[d]!==o[d])return i[d]<o[d]?-1:1;return a===c?0:a<c?-1:1}function Af(i){var o=typeof i;if(o!=="object")return o;if(ArrayBuffer.isView(i))return"binary";var a=Zt(i);return a==="ArrayBuffer"?"binary":a}function Pf(i){return i instanceof Uint8Array?i:ArrayBuffer.isView(i)?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i)}var If=function(){function i(){}return i.prototype._trans=function(o,a,c){var u=this._tx||se.trans,d=this.name,h=Sr&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(o==="readonly"?"read":"write"," ").concat(this.name));function v(C,E,I){if(!I.schema[d])throw new ae.NotFound("Table "+d+" not part of transaction");return a(I.idbtrans,I)}var g=Ui();try{var w=u&&u.db._novip===this.db._novip?u===se.trans?u._promise(o,v,c):an(function(){return u._promise(o,v,c)},{trans:u,transless:se.transless||se}):Ml(this.db,o,[this.name],v);return h&&(w._consoleTask=h,w=w.catch(function(C){return console.trace(C),et(C)})),w}finally{g&&Hi()}},i.prototype.get=function(o,a){var c=this;return o&&o.constructor===Object?this.where(o).first(a):o==null?et(new ae.Type("Invalid argument to Table.get()")):this._trans("readonly",function(u){return c.core.get({trans:u,key:o}).then(function(d){return c.hook.reading.fire(d)})}).then(a)},i.prototype.where=function(o){if(typeof o=="string")return new this.db.WhereClause(this,o);if(f(o))return new this.db.WhereClause(this,"[".concat(o.join("+"),"]"));var a=l(o);if(a.length===1)return this.where(a[0]).equals(o[a[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(E){if(E.compound&&a.every(function(K){return E.keyPath.indexOf(K)>=0})){for(var I=0;I<a.length;++I)if(a.indexOf(E.keyPath[I])===-1)return!1;return!0}return!1}).sort(function(E,I){return E.keyPath.length-I.keyPath.length})[0];if(c&&this.db._maxKey!==Hn){var u=c.keyPath.slice(0,a.length);return this.where(u).equals(u.map(function(E){return o[E]}))}!c&&Sr&&console.warn("The query ".concat(JSON.stringify(o)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(a.join("+"),"]"));var d=this.schema.idxByName,h=this.db._deps.indexedDB;function v(E,I){return h.cmp(E,I)===0}var g=a.reduce(function(E,I){var K=E[0],k=E[1],S=d[I],R=o[I];return[K||S,K||!S?Yn(k,S&&S.multi?function(T){var O=J(T,I);return f(O)&&O.some(function(M){return v(R,M)})}:function(T){return v(R,J(T,I))}):k]},[null,null]),w=g[0],C=g[1];return w?this.where(w.name).equals(o[w.keyPath]).filter(C):c?this.filter(C):this.where(a).equals("")},i.prototype.filter=function(o){return this.toCollection().and(o)},i.prototype.count=function(o){return this.toCollection().count(o)},i.prototype.offset=function(o){return this.toCollection().offset(o)},i.prototype.limit=function(o){return this.toCollection().limit(o)},i.prototype.each=function(o){return this.toCollection().each(o)},i.prototype.toArray=function(o){return this.toCollection().toArray(o)},i.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},i.prototype.orderBy=function(o){return new this.db.Collection(new this.db.WhereClause(this,f(o)?"[".concat(o.join("+"),"]"):o))},i.prototype.reverse=function(){return this.toCollection().reverse()},i.prototype.mapToClass=function(o){var a=this,c=a.db,u=a.name;this.schema.mappedClass=o,o.prototype instanceof Sf&&(o=function(g){e(w,g);function w(){return g!==null&&g.apply(this,arguments)||this}return Object.defineProperty(w.prototype,"db",{get:function(){return c},enumerable:!1,configurable:!0}),w.prototype.table=function(){return u},w}(o));for(var d=new Set,h=o.prototype;h;h=m(h))Object.getOwnPropertyNames(h).forEach(function(g){return d.add(g)});var v=function(g){if(!g)return g;var w=Object.create(o.prototype);for(var C in g)if(!d.has(C))try{w[C]=g[C]}catch{}return w};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),o},i.prototype.defineClass=function(){function o(a){p(this,a)}return this.mapToClass(o)},i.prototype.add=function(o,a){var c=this,u=this.schema.primKey,d=u.auto,h=u.keyPath,v=o;return h&&d&&(v=Qs(h)(o)),this._trans("readwrite",function(g){return c.core.mutate({trans:g,type:"add",keys:a!=null?[a]:null,values:[v]})}).then(function(g){return g.numFailures?Z.reject(g.failures[0]):g.lastResult}).then(function(g){if(h)try{U(o,h,g)}catch{}return g})},i.prototype.update=function(o,a){if(typeof o=="object"&&!f(o)){var c=J(o,this.schema.primKey.keyPath);return c===void 0?et(new ae.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(c).modify(a)}else return this.where(":id").equals(o).modify(a)},i.prototype.put=function(o,a){var c=this,u=this.schema.primKey,d=u.auto,h=u.keyPath,v=o;return h&&d&&(v=Qs(h)(o)),this._trans("readwrite",function(g){return c.core.mutate({trans:g,type:"put",values:[v],keys:a!=null?[a]:null})}).then(function(g){return g.numFailures?Z.reject(g.failures[0]):g.lastResult}).then(function(g){if(h)try{U(o,h,g)}catch{}return g})},i.prototype.delete=function(o){var a=this;return this._trans("readwrite",function(c){return a.core.mutate({trans:c,type:"delete",keys:[o]})}).then(function(c){return c.numFailures?Z.reject(c.failures[0]):void 0})},i.prototype.clear=function(){var o=this;return this._trans("readwrite",function(a){return o.core.mutate({trans:a,type:"deleteRange",range:Cf})}).then(function(a){return a.numFailures?Z.reject(a.failures[0]):void 0})},i.prototype.bulkGet=function(o){var a=this;return this._trans("readonly",function(c){return a.core.getMany({keys:o,trans:c}).then(function(u){return u.map(function(d){return a.hook.reading.fire(d)})})})},i.prototype.bulkAdd=function(o,a,c){var u=this,d=Array.isArray(a)?a:void 0;c=c||(d?void 0:a);var h=c?c.allKeys:void 0;return this._trans("readwrite",function(v){var g=u.schema.primKey,w=g.auto,C=g.keyPath;if(C&&d)throw new ae.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(d&&d.length!==o.length)throw new ae.InvalidArgument("Arguments objects and keys must have the same length");var E=o.length,I=C&&w?o.map(Qs(C)):o;return u.core.mutate({trans:v,type:"add",keys:d,values:I,wantResults:h}).then(function(K){var k=K.numFailures,S=K.results,R=K.lastResult,T=K.failures,O=h?S:R;if(k===0)return O;throw new Wr("".concat(u.name,".bulkAdd(): ").concat(k," of ").concat(E," operations failed"),T)})})},i.prototype.bulkPut=function(o,a,c){var u=this,d=Array.isArray(a)?a:void 0;c=c||(d?void 0:a);var h=c?c.allKeys:void 0;return this._trans("readwrite",function(v){var g=u.schema.primKey,w=g.auto,C=g.keyPath;if(C&&d)throw new ae.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(d&&d.length!==o.length)throw new ae.InvalidArgument("Arguments objects and keys must have the same length");var E=o.length,I=C&&w?o.map(Qs(C)):o;return u.core.mutate({trans:v,type:"put",keys:d,values:I,wantResults:h}).then(function(K){var k=K.numFailures,S=K.results,R=K.lastResult,T=K.failures,O=h?S:R;if(k===0)return O;throw new Wr("".concat(u.name,".bulkPut(): ").concat(k," of ").concat(E," operations failed"),T)})})},i.prototype.bulkUpdate=function(o){var a=this,c=this.core,u=o.map(function(v){return v.key}),d=o.map(function(v){return v.changes}),h=[];return this._trans("readwrite",function(v){return c.getMany({trans:v,keys:u,cache:"clone"}).then(function(g){var w=[],C=[];o.forEach(function(I,K){var k=I.key,S=I.changes,R=g[K];if(R){for(var T=0,O=Object.keys(S);T<O.length;T++){var M=O[T],L=S[M];if(M===a.schema.primKey.keyPath){if(De(L,k)!==0)throw new ae.Constraint("Cannot update primary key in bulkUpdate()")}else U(R,M,L)}h.push(K),w.push(k),C.push(R)}});var E=w.length;return c.mutate({trans:v,type:"put",keys:w,values:C,updates:{keys:u,changeSpecs:d}}).then(function(I){var K=I.numFailures,k=I.failures;if(K===0)return E;for(var S=0,R=Object.keys(k);S<R.length;S++){var T=R[S],O=h[Number(T)];if(O!=null){var M=k[T];delete k[T],k[O]=M}}throw new Wr("".concat(a.name,".bulkUpdate(): ").concat(K," of ").concat(E," operations failed"),k)})})})},i.prototype.bulkDelete=function(o){var a=this,c=o.length;return this._trans("readwrite",function(u){return a.core.mutate({trans:u,type:"delete",keys:o})}).then(function(u){var d=u.numFailures,h=u.lastResult,v=u.failures;if(d===0)return h;throw new Wr("".concat(a.name,".bulkDelete(): ").concat(d," of ").concat(c," operations failed"),v)})},i}();function Uo(i){var o={},a=function(v,g){if(g){for(var w=arguments.length,C=new Array(w-1);--w;)C[w-1]=arguments[w];return o[v].subscribe.apply(null,C),i}else if(typeof v=="string")return o[v]};a.addEventType=d;for(var c=1,u=arguments.length;c<u;++c)d(arguments[c]);return a;function d(v,g,w){if(typeof v=="object")return h(v);g||(g=Qh),w||(w=Be);var C={subscribers:[],fire:w,subscribe:function(E){C.subscribers.indexOf(E)===-1&&(C.subscribers.push(E),C.fire=g(C.fire,E))},unsubscribe:function(E){C.subscribers=C.subscribers.filter(function(I){return I!==E}),C.fire=C.subscribers.reduce(g,w)}};return o[v]=a[v]=C,C}function h(v){l(v).forEach(function(g){var w=v[g];if(f(w))d(g,v[g][0],v[g][1]);else if(w==="asap")var C=d(g,Wo,function(){for(var I=arguments.length,K=new Array(I);I--;)K[I]=arguments[I];C.subscribers.forEach(function(k){Q(function(){k.apply(null,K)})})});else throw new ae.InvalidArgument("Invalid event config")})}}function Ho(i,o){return P(o).from({prototype:i}),o}function um(i){return Ho(If.prototype,function(a,c,u){this.db=i,this._tx=u,this.name=a,this.schema=c,this.hook=i._allTables[a]?i._allTables[a].hook:Uo(null,{creating:[Uh,Be],reading:[zh,Wo],updating:[Yh,Be],deleting:[Hh,Be]})})}function Ji(i,o){return!(i.filter||i.algorithm||i.or)&&(o?i.justLimit:!i.replayFilter)}function Wl(i,o){i.filter=Yn(i.filter,o)}function jl(i,o,a){var c=i.replayFilter;i.replayFilter=c?function(){return Yn(c(),o())}:o,i.justLimit=a&&!c}function fm(i,o){i.isMatch=Yn(i.isMatch,o)}function Js(i,o){if(i.isPrimKey)return o.primaryKey;var a=o.getIndexByKeyPath(i.index);if(!a)throw new ae.Schema("KeyPath "+i.index+" on object store "+o.name+" is not indexed");return a}function Rf(i,o,a){var c=Js(i,o.schema);return o.openCursor({trans:a,values:!i.keysOnly,reverse:i.dir==="prev",unique:!!i.unique,query:{index:c,range:i.range}})}function Xs(i,o,a,c){var u=i.replayFilter?Yn(i.filter,i.replayFilter()):i.filter;if(i.or){var d={},h=function(v,g,w){if(!u||u(g,w,function(I){return g.stop(I)},function(I){return g.fail(I)})){var C=g.primaryKey,E=""+C;E==="[object ArrayBuffer]"&&(E=""+new Uint8Array(C)),b(d,E)||(d[E]=!0,o(v,g,w))}};return Promise.all([i.or._iterate(h,a),Tf(Rf(i,c,a),i.algorithm,h,!i.keysOnly&&i.valueMapper)])}else return Tf(Rf(i,c,a),Yn(i.algorithm,u),o,!i.keysOnly&&i.valueMapper)}function Tf(i,o,a,c){var u=c?function(h,v,g){return a(c(h),v,g)}:a,d=Ue(u);return i.then(function(h){if(h)return h.start(function(){var v=function(){return h.continue()};(!o||o(h,function(g){return v=g},function(g){h.stop(g),v=Be},function(g){h.fail(g),v=Be}))&&d(h.value,h,function(g){return v=g}),v()})})}var dm=Symbol(),Yo=function(){function i(o){Object.assign(this,o)}return i.prototype.execute=function(o){var a;if(this.add!==void 0){var c=this.add;if(f(c))return n(n([],f(o)?o:[],!0),c,!0).sort();if(typeof c=="number")return(Number(o)||0)+c;if(typeof c=="bigint")try{return BigInt(o)+c}catch{return BigInt(0)+c}throw new TypeError("Invalid term ".concat(c))}if(this.remove!==void 0){var u=this.remove;if(f(u))return f(o)?o.filter(function(h){return!u.includes(h)}).sort():[];if(typeof u=="number")return Number(o)-u;if(typeof u=="bigint")try{return BigInt(o)-u}catch{return BigInt(0)-u}throw new TypeError("Invalid subtrahend ".concat(u))}var d=(a=this.replacePrefix)===null||a===void 0?void 0:a[0];return d&&typeof o=="string"&&o.startsWith(d)?this.replacePrefix[1]+o.substring(d.length):o},i}(),pm=function(){function i(){}return i.prototype._read=function(o,a){var c=this._ctx;return c.error?c.table._trans(null,et.bind(null,c.error)):c.table._trans("readonly",o).then(a)},i.prototype._write=function(o){var a=this._ctx;return a.error?a.table._trans(null,et.bind(null,a.error)):a.table._trans("readwrite",o,"locked")},i.prototype._addAlgorithm=function(o){var a=this._ctx;a.algorithm=Yn(a.algorithm,o)},i.prototype._iterate=function(o,a){return Xs(this._ctx,o,a,this._ctx.table.core)},i.prototype.clone=function(o){var a=Object.create(this.constructor.prototype),c=Object.create(this._ctx);return o&&p(c,o),a._ctx=c,a},i.prototype.raw=function(){return this._ctx.valueMapper=null,this},i.prototype.each=function(o){var a=this._ctx;return this._read(function(c){return Xs(a,o,c,a.table.core)})},i.prototype.count=function(o){var a=this;return this._read(function(c){var u=a._ctx,d=u.table.core;if(Ji(u,!0))return d.count({trans:c,query:{index:Js(u,d.schema),range:u.range}}).then(function(v){return Math.min(v,u.limit)});var h=0;return Xs(u,function(){return++h,!1},c,d).then(function(){return h})}).then(o)},i.prototype.sortBy=function(o,a){var c=o.split(".").reverse(),u=c[0],d=c.length-1;function h(w,C){return C?h(w[c[C]],C-1):w[u]}var v=this._ctx.dir==="next"?1:-1;function g(w,C){var E=h(w,d),I=h(C,d);return E<I?-v:E>I?v:0}return this.toArray(function(w){return w.sort(g)}).then(a)},i.prototype.toArray=function(o){var a=this;return this._read(function(c){var u=a._ctx;if(u.dir==="next"&&Ji(u,!0)&&u.limit>0){var d=u.valueMapper,h=Js(u,u.table.core.schema);return u.table.core.query({trans:c,limit:u.limit,values:!0,query:{index:h,range:u.range}}).then(function(g){var w=g.result;return d?w.map(d):w})}else{var v=[];return Xs(u,function(g){return v.push(g)},c,u.table.core).then(function(){return v})}},o)},i.prototype.offset=function(o){var a=this._ctx;return o<=0?this:(a.offset+=o,Ji(a)?jl(a,function(){var c=o;return function(u,d){return c===0?!0:c===1?(--c,!1):(d(function(){u.advance(c),c=0}),!1)}}):jl(a,function(){var c=o;return function(){return--c<0}}),this)},i.prototype.limit=function(o){return this._ctx.limit=Math.min(this._ctx.limit,o),jl(this._ctx,function(){var a=o;return function(c,u,d){return--a<=0&&u(d),a>=0}},!0),this},i.prototype.until=function(o,a){return Wl(this._ctx,function(c,u,d){return o(c.value)?(u(d),a):!0}),this},i.prototype.first=function(o){return this.limit(1).toArray(function(a){return a[0]}).then(o)},i.prototype.last=function(o){return this.reverse().first(o)},i.prototype.filter=function(o){return Wl(this._ctx,function(a){return o(a.value)}),fm(this._ctx,o),this},i.prototype.and=function(o){return this.filter(o)},i.prototype.or=function(o){return new this.db.WhereClause(this._ctx.table,o,this)},i.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},i.prototype.desc=function(){return this.reverse()},i.prototype.eachKey=function(o){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(c,u){o(u.key,u)})},i.prototype.eachUniqueKey=function(o){return this._ctx.unique="unique",this.eachKey(o)},i.prototype.eachPrimaryKey=function(o){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(c,u){o(u.primaryKey,u)})},i.prototype.keys=function(o){var a=this._ctx;a.keysOnly=!a.isMatch;var c=[];return this.each(function(u,d){c.push(d.key)}).then(function(){return c}).then(o)},i.prototype.primaryKeys=function(o){var a=this._ctx;if(a.dir==="next"&&Ji(a,!0)&&a.limit>0)return this._read(function(u){var d=Js(a,a.table.core.schema);return a.table.core.query({trans:u,values:!1,limit:a.limit,query:{index:d,range:a.range}})}).then(function(u){var d=u.result;return d}).then(o);a.keysOnly=!a.isMatch;var c=[];return this.each(function(u,d){c.push(d.primaryKey)}).then(function(){return c}).then(o)},i.prototype.uniqueKeys=function(o){return this._ctx.unique="unique",this.keys(o)},i.prototype.firstKey=function(o){return this.limit(1).keys(function(a){return a[0]}).then(o)},i.prototype.lastKey=function(o){return this.reverse().firstKey(o)},i.prototype.distinct=function(){var o=this._ctx,a=o.index&&o.table.schema.idxByName[o.index];if(!a||!a.multi)return this;var c={};return Wl(this._ctx,function(u){var d=u.primaryKey.toString(),h=b(c,d);return c[d]=!0,!h}),this},i.prototype.modify=function(o){var a=this,c=this._ctx;return this._write(function(u){var d;if(typeof o=="function")d=o;else{var h=l(o),v=h.length;d=function(T){for(var O=!1,M=0;M<v;++M){var L=h[M],D=o[L],q=J(T,L);D instanceof Yo?(U(T,L,D.execute(q)),O=!0):q!==D&&(U(T,L,D),O=!0)}return O}}var g=c.table.core,w=g.schema.primaryKey,C=w.outbound,E=w.extractKey,I=a.db._options.modifyChunkSize||200,K=[],k=0,S=[],R=function(T,O){var M=O.failures,L=O.numFailures;k+=T-L;for(var D=0,q=l(M);D<q.length;D++){var te=q[D];K.push(M[te])}};return a.clone().primaryKeys().then(function(T){var O=Ji(c)&&c.limit===1/0&&(typeof o!="function"||o===ql)&&{index:c.index,range:c.range},M=function(L){var D=Math.min(I,T.length-L);return g.getMany({trans:u,keys:T.slice(L,L+D),cache:"immutable"}).then(function(q){for(var te=[],re=[],he=C?[]:null,oe=[],de=0;de<D;++de){var Ce=q[de],ve={value:Ft(Ce),primKey:T[L+de]};d.call(ve,ve.value,ve)!==!1&&(ve.value==null?oe.push(T[L+de]):!C&&De(E(Ce),E(ve.value))!==0?(oe.push(T[L+de]),te.push(ve.value)):(re.push(ve.value),C&&he.push(T[L+de])))}return Promise.resolve(te.length>0&&g.mutate({trans:u,type:"add",values:te}).then(function(Ke){for(var pe in Ke.failures)oe.splice(parseInt(pe),1);R(te.length,Ke)})).then(function(){return(re.length>0||O&&typeof o=="object")&&g.mutate({trans:u,type:"put",keys:he,values:re,criteria:O,changeSpec:typeof o!="function"&&o,isAdditionalChunk:L>0}).then(function(Ke){return R(re.length,Ke)})}).then(function(){return(oe.length>0||O&&o===ql)&&g.mutate({trans:u,type:"delete",keys:oe,criteria:O,isAdditionalChunk:L>0}).then(function(Ke){return R(oe.length,Ke)})}).then(function(){return T.length>L+D&&M(L+I)})})};return M(0).then(function(){if(K.length>0)throw new Vi("Error modifying one or more objects",K,k,S);return T.length})})})},i.prototype.delete=function(){var o=this._ctx,a=o.range;return Ji(o)&&(o.isPrimKey||a.type===3)?this._write(function(c){var u=o.table.core.schema.primaryKey,d=a;return o.table.core.count({trans:c,query:{index:u,range:d}}).then(function(h){return o.table.core.mutate({trans:c,type:"deleteRange",range:d}).then(function(v){var g=v.failures;v.lastResult,v.results;var w=v.numFailures;if(w)throw new Vi("Could not delete some values",Object.keys(g).map(function(C){return g[C]}),h-w);return h-w})})}):this.modify(ql)},i}(),ql=function(i,o){return o.value=null};function hm(i){return Ho(pm.prototype,function(a,c){this.db=i;var u=Cf,d=null;if(c)try{u=c()}catch(w){d=w}var h=a._ctx,v=h.table,g=v.hook.reading.fire;this._ctx={table:v,index:h.index,isPrimKey:!h.index||v.schema.primKey.keyPath&&h.index===v.schema.primKey.name,range:u,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:d,or:h.or,valueMapper:g!==Wo?g:null}})}function mm(i,o){return i<o?-1:i===o?0:1}function vm(i,o){return i>o?-1:i===o?0:1}function jt(i,o,a){var c=i instanceof Nf?new i.Collection(i):i;return c._ctx.error=a?new a(o):new TypeError(o),c}function Xi(i){return new i.Collection(i,function(){return Of("")}).limit(0)}function _m(i){return i==="next"?function(o){return o.toUpperCase()}:function(o){return o.toLowerCase()}}function gm(i){return i==="next"?function(o){return o.toLowerCase()}:function(o){return o.toUpperCase()}}function ym(i,o,a,c,u,d){for(var h=Math.min(i.length,c.length),v=-1,g=0;g<h;++g){var w=o[g];if(w!==c[g])return u(i[g],a[g])<0?i.substr(0,g)+a[g]+a.substr(g+1):u(i[g],c[g])<0?i.substr(0,g)+c[g]+a.substr(g+1):v>=0?i.substr(0,v)+o[v]+a.substr(v+1):null;u(i[g],w)<0&&(v=g)}return h<c.length&&d==="next"?i+a.substr(i.length):h<i.length&&d==="prev"?i.substr(0,a.length):v<0?null:i.substr(0,v)+c[v]+a.substr(v+1)}function Gs(i,o,a,c){var u,d,h,v,g,w,C,E=a.length;if(!a.every(function(S){return typeof S=="string"}))return jt(i,$f);function I(S){u=_m(S),d=gm(S),h=S==="next"?mm:vm;var R=a.map(function(T){return{lower:d(T),upper:u(T)}}).sort(function(T,O){return h(T.lower,O.lower)});v=R.map(function(T){return T.upper}),g=R.map(function(T){return T.lower}),w=S,C=S==="next"?"":c}I("next");var K=new i.Collection(i,function(){return un(v[0],g[E-1]+c)});K._ondirectionchange=function(S){I(S)};var k=0;return K._addAlgorithm(function(S,R,T){var O=S.key;if(typeof O!="string")return!1;var M=d(O);if(o(M,g,k))return!0;for(var L=null,D=k;D<E;++D){var q=ym(O,M,v[D],g[D],h,w);q===null&&L===null?k=D+1:(L===null||h(L,q)>0)&&(L=q)}return R(L!==null?function(){S.continue(L+C)}:T),!1}),K}function un(i,o,a,c){return{type:2,lower:i,upper:o,lowerOpen:a,upperOpen:c}}function Of(i){return{type:1,lower:i,upper:i}}var Nf=function(){function i(){}return Object.defineProperty(i.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),i.prototype.between=function(o,a,c,u){c=c!==!1,u=u===!0;try{return this._cmp(o,a)>0||this._cmp(o,a)===0&&(c||u)&&!(c&&u)?Xi(this):new this.Collection(this,function(){return un(o,a,!c,!u)})}catch{return jt(this,jr)}},i.prototype.equals=function(o){return o==null?jt(this,jr):new this.Collection(this,function(){return Of(o)})},i.prototype.above=function(o){return o==null?jt(this,jr):new this.Collection(this,function(){return un(o,void 0,!0)})},i.prototype.aboveOrEqual=function(o){return o==null?jt(this,jr):new this.Collection(this,function(){return un(o,void 0,!1)})},i.prototype.below=function(o){return o==null?jt(this,jr):new this.Collection(this,function(){return un(void 0,o,!1,!0)})},i.prototype.belowOrEqual=function(o){return o==null?jt(this,jr):new this.Collection(this,function(){return un(void 0,o)})},i.prototype.startsWith=function(o){return typeof o!="string"?jt(this,$f):this.between(o,o+Hn,!0,!0)},i.prototype.startsWithIgnoreCase=function(o){return o===""?this.startsWith(o):Gs(this,function(a,c){return a.indexOf(c[0])===0},[o],Hn)},i.prototype.equalsIgnoreCase=function(o){return Gs(this,function(a,c){return a===c[0]},[o],"")},i.prototype.anyOfIgnoreCase=function(){var o=Ie.apply(Oe,arguments);return o.length===0?Xi(this):Gs(this,function(a,c){return c.indexOf(a)!==-1},o,"")},i.prototype.startsWithAnyOfIgnoreCase=function(){var o=Ie.apply(Oe,arguments);return o.length===0?Xi(this):Gs(this,function(a,c){return c.some(function(u){return a.indexOf(u)===0})},o,Hn)},i.prototype.anyOf=function(){var o=this,a=Ie.apply(Oe,arguments),c=this._cmp;try{a.sort(c)}catch{return jt(this,jr)}if(a.length===0)return Xi(this);var u=new this.Collection(this,function(){return un(a[0],a[a.length-1])});u._ondirectionchange=function(h){c=h==="next"?o._ascending:o._descending,a.sort(c)};var d=0;return u._addAlgorithm(function(h,v,g){for(var w=h.key;c(w,a[d])>0;)if(++d,d===a.length)return v(g),!1;return c(w,a[d])===0?!0:(v(function(){h.continue(a[d])}),!1)}),u},i.prototype.notEqual=function(o){return this.inAnyRange([[Ll,o],[o,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},i.prototype.noneOf=function(){var o=Ie.apply(Oe,arguments);if(o.length===0)return new this.Collection(this);try{o.sort(this._ascending)}catch{return jt(this,jr)}var a=o.reduce(function(c,u){return c?c.concat([[c[c.length-1][1],u]]):[[Ll,u]]},null);return a.push([o[o.length-1],this.db._maxKey]),this.inAnyRange(a,{includeLowers:!1,includeUppers:!1})},i.prototype.inAnyRange=function(o,a){var c=this,u=this._cmp,d=this._ascending,h=this._descending,v=this._min,g=this._max;if(o.length===0)return Xi(this);if(!o.every(function(D){return D[0]!==void 0&&D[1]!==void 0&&d(D[0],D[1])<=0}))return jt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ae.InvalidArgument);var w=!a||a.includeLowers!==!1,C=a&&a.includeUppers===!0;function E(D,q){for(var te=0,re=D.length;te<re;++te){var he=D[te];if(u(q[0],he[1])<0&&u(q[1],he[0])>0){he[0]=v(he[0],q[0]),he[1]=g(he[1],q[1]);break}}return te===re&&D.push(q),D}var I=d;function K(D,q){return I(D[0],q[0])}var k;try{k=o.reduce(E,[]),k.sort(K)}catch{return jt(this,jr)}var S=0,R=C?function(D){return d(D,k[S][1])>0}:function(D){return d(D,k[S][1])>=0},T=w?function(D){return h(D,k[S][0])>0}:function(D){return h(D,k[S][0])>=0};function O(D){return!R(D)&&!T(D)}var M=R,L=new this.Collection(this,function(){return un(k[0][0],k[k.length-1][1],!w,!C)});return L._ondirectionchange=function(D){D==="next"?(M=R,I=d):(M=T,I=h),k.sort(K)},L._addAlgorithm(function(D,q,te){for(var re=D.key;M(re);)if(++S,S===k.length)return q(te),!1;return O(re)?!0:(c._cmp(re,k[S][1])===0||c._cmp(re,k[S][0])===0||q(function(){I===d?D.continue(k[S][0]):D.continue(k[S][1])}),!1)}),L},i.prototype.startsWithAnyOf=function(){var o=Ie.apply(Oe,arguments);return o.every(function(a){return typeof a=="string"})?o.length===0?Xi(this):this.inAnyRange(o.map(function(a){return[a,a+Hn]})):jt(this,"startsWithAnyOf() only works with strings")},i}();function bm(i){return Ho(Nf.prototype,function(a,c,u){if(this.db=i,this._ctx={table:a,index:c===":id"?null:c,or:u},this._cmp=this._ascending=De,this._descending=function(d,h){return De(h,d)},this._max=function(d,h){return De(d,h)>0?d:h},this._min=function(d,h){return De(d,h)<0?d:h},this._IDBKeyRange=i._deps.IDBKeyRange,!this._IDBKeyRange)throw new ae.MissingAPI})}function Ar(i){return Ue(function(o){return Qo(o),i(o.target.error),!1})}function Qo(i){i.stopPropagation&&i.stopPropagation(),i.preventDefault&&i.preventDefault()}var Jo="storagemutated",Vl="x-storagemutated-1",fn=Uo(null,Jo),wm=function(){function i(){}return i.prototype._lock=function(){return V(!se.global),++this._reculock,this._reculock===1&&!se.global&&(se.lockOwnerFor=this),this},i.prototype._unlock=function(){if(V(!se.global),--this._reculock===0)for(se.global||(se.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var o=this._blockedFuncs.shift();try{Un(o[1],o[0])}catch{}}return this},i.prototype._locked=function(){return this._reculock&&se.lockOwnerFor!==this},i.prototype.create=function(o){var a=this;if(!this.mode)return this;var c=this.db.idbdb,u=this.db._state.dbOpenError;if(V(!this.idbtrans),!o&&!c)switch(u&&u.name){case"DatabaseClosedError":throw new ae.DatabaseClosed(u);case"MissingAPIError":throw new ae.MissingAPI(u.message,u);default:throw new ae.OpenFailed(u)}if(!this.active)throw new ae.TransactionInactive;return V(this._completion._state===null),o=this.idbtrans=o||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):c.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),o.onerror=Ue(function(d){Qo(d),a._reject(o.error)}),o.onabort=Ue(function(d){Qo(d),a.active&&a._reject(new ae.Abort(o.error)),a.active=!1,a.on("abort").fire(d)}),o.oncomplete=Ue(function(){a.active=!1,a._resolve(),"mutatedParts"in o&&fn.storagemutated.fire(o.mutatedParts)}),this},i.prototype._promise=function(o,a,c){var u=this;if(o==="readwrite"&&this.mode!=="readwrite")return et(new ae.ReadOnly("Transaction is readonly"));if(!this.active)return et(new ae.TransactionInactive);if(this._locked())return new Z(function(h,v){u._blockedFuncs.push([function(){u._promise(o,a,c).then(h,v)},se])});if(c)return an(function(){var h=new Z(function(v,g){u._lock();var w=a(v,g,u);w&&w.then&&w.then(v,g)});return h.finally(function(){return u._unlock()}),h._lib=!0,h});var d=new Z(function(h,v){var g=a(h,v,u);g&&g.then&&g.then(h,v)});return d._lib=!0,d},i.prototype._root=function(){return this.parent?this.parent._root():this},i.prototype.waitFor=function(o){var a=this._root(),c=Z.resolve(o);if(a._waitingFor)a._waitingFor=a._waitingFor.then(function(){return c});else{a._waitingFor=c,a._waitingQueue=[];var u=a.idbtrans.objectStore(a.storeNames[0]);(function h(){for(++a._spinCount;a._waitingQueue.length;)a._waitingQueue.shift()();a._waitingFor&&(u.get(-1/0).onsuccess=h)})()}var d=a._waitingFor;return new Z(function(h,v){c.then(function(g){return a._waitingQueue.push(Ue(h.bind(null,g)))},function(g){return a._waitingQueue.push(Ue(v.bind(null,g)))}).finally(function(){a._waitingFor===d&&(a._waitingFor=null)})})},i.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ae.Abort))},i.prototype.table=function(o){var a=this._memoizedTables||(this._memoizedTables={});if(b(a,o))return a[o];var c=this.schema[o];if(!c)throw new ae.NotFound("Table "+o+" not part of transaction");var u=new this.db.Table(o,c,this);return u.core=this.db.core.table(o),a[o]=u,u},i}();function xm(i){return Ho(wm.prototype,function(a,c,u,d,h){var v=this;this.db=i,this.mode=a,this.storeNames=c,this.schema=u,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=Uo(this,"complete","error","abort"),this.parent=h||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Z(function(g,w){v._resolve=g,v._reject=w}),this._completion.then(function(){v.active=!1,v.on.complete.fire()},function(g){var w=v.active;return v.active=!1,v.on.error.fire(g),v.parent?v.parent._reject(g):w&&v.idbtrans&&v.idbtrans.abort(),et(g)})})}function zl(i,o,a,c,u,d,h){return{name:i,keyPath:o,unique:a,multi:c,auto:u,compound:d,src:(a&&!h?"&":"")+(c?"*":"")+(u?"++":"")+Df(o)}}function Df(i){return typeof i=="string"?i:i?"["+[].join.call(i,"+")+"]":""}function Ul(i,o,a){return{name:i,primKey:o,indexes:a,mappedClass:null,idxByName:G(a,function(c){return[c.name,c]})}}function Em(i){return i.length===1?i[0]:i}var Xo=function(i){try{return i.only([[]]),Xo=function(){return[[]]},[[]]}catch{return Xo=function(){return Hn},Hn}};function Hl(i){return i==null?function(){}:typeof i=="string"?km(i):function(o){return J(o,i)}}function km(i){var o=i.split(".");return o.length===1?function(a){return a[i]}:function(a){return J(a,i)}}function Ff(i){return[].slice.call(i)}var $m=0;function Go(i){return i==null?":id":typeof i=="string"?i:"[".concat(i.join("+"),"]")}function Cm(i,o,a){function c(E,I){var K=Ff(E.objectStoreNames);return{schema:{name:E.name,tables:K.map(function(k){return I.objectStore(k)}).map(function(k){var S=k.keyPath,R=k.autoIncrement,T=f(S),O=S==null,M={},L={name:k.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:O,compound:T,keyPath:S,autoIncrement:R,unique:!0,extractKey:Hl(S)},indexes:Ff(k.indexNames).map(function(D){return k.index(D)}).map(function(D){var q=D.name,te=D.unique,re=D.multiEntry,he=D.keyPath,oe=f(he),de={name:q,compound:oe,keyPath:he,unique:te,multiEntry:re,extractKey:Hl(he)};return M[Go(he)]=de,de}),getIndexByKeyPath:function(D){return M[Go(D)]}};return M[":id"]=L.primaryKey,S!=null&&(M[Go(S)]=L.primaryKey),L})},hasGetAll:K.length>0&&"getAll"in I.objectStore(K[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function u(E){if(E.type===3)return null;if(E.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var I=E.lower,K=E.upper,k=E.lowerOpen,S=E.upperOpen,R=I===void 0?K===void 0?null:o.upperBound(K,!!S):K===void 0?o.lowerBound(I,!!k):o.bound(I,K,!!k,!!S);return R}function d(E){var I=E.name;function K(R){var T=R.trans,O=R.type,M=R.keys,L=R.values,D=R.range;return new Promise(function(q,te){q=Ue(q);var re=T.objectStore(I),he=re.keyPath==null,oe=O==="put"||O==="add";if(!oe&&O!=="delete"&&O!=="deleteRange")throw new Error("Invalid operation type: "+O);var de=(M||L||{length:1}).length;if(M&&L&&M.length!==L.length)throw new Error("Given keys array must have same length as given values array.");if(de===0)return q({numFailures:0,failures:{},results:[],lastResult:void 0});var Ce,ve=[],Ke=[],pe=0,mt=function(Ir){++pe,Qo(Ir)};if(O==="deleteRange"){if(D.type===4)return q({numFailures:pe,failures:Ke,results:[],lastResult:void 0});D.type===3?ve.push(Ce=re.clear()):ve.push(Ce=re.delete(u(D)))}else{var hr=oe?he?[L,M]:[L,null]:[M,null],hn=hr[0],Pr=hr[1];if(oe)for(var tr=0;tr<de;++tr)ve.push(Ce=Pr&&Pr[tr]!==void 0?re[O](hn[tr],Pr[tr]):re[O](hn[tr])),Ce.onerror=mt;else for(var tr=0;tr<de;++tr)ve.push(Ce=re[O](hn[tr])),Ce.onerror=mt}var mn=function(Ir){var ts=Ir.target.result;ve.forEach(function(mr,ua){return mr.error!=null&&(Ke[ua]=mr.error)}),q({numFailures:pe,failures:Ke,results:O==="delete"?M:ve.map(function(mr){return mr.result}),lastResult:ts})};Ce.onerror=function(Ir){mt(Ir),mn(Ir)},Ce.onsuccess=mn})}function k(R){var T=R.trans,O=R.values,M=R.query,L=R.reverse,D=R.unique;return new Promise(function(q,te){q=Ue(q);var re=M.index,he=M.range,oe=T.objectStore(I),de=re.isPrimaryKey?oe:oe.index(re.name),Ce=L?D?"prevunique":"prev":D?"nextunique":"next",ve=O||!("openKeyCursor"in de)?de.openCursor(u(he),Ce):de.openKeyCursor(u(he),Ce);ve.onerror=Ar(te),ve.onsuccess=Ue(function(Ke){var pe=ve.result;if(!pe){q(null);return}pe.___id=++$m,pe.done=!1;var mt=pe.continue.bind(pe),hr=pe.continuePrimaryKey;hr&&(hr=hr.bind(pe));var hn=pe.advance.bind(pe),Pr=function(){throw new Error("Cursor not started")},tr=function(){throw new Error("Cursor not stopped")};pe.trans=T,pe.stop=pe.continue=pe.continuePrimaryKey=pe.advance=Pr,pe.fail=Ue(te),pe.next=function(){var mn=this,Ir=1;return this.start(function(){return Ir--?mn.continue():mn.stop()}).then(function(){return mn})},pe.start=function(mn){var Ir=new Promise(function(mr,ua){mr=Ue(mr),ve.onerror=Ar(ua),pe.fail=ua,pe.stop=function(pv){pe.stop=pe.continue=pe.continuePrimaryKey=pe.advance=tr,mr(pv)}}),ts=function(){if(ve.result)try{mn()}catch(mr){pe.fail(mr)}else pe.done=!0,pe.start=function(){throw new Error("Cursor behind last entry")},pe.stop()};return ve.onsuccess=Ue(function(mr){ve.onsuccess=ts,ts()}),pe.continue=mt,pe.continuePrimaryKey=hr,pe.advance=hn,ts(),Ir},q(pe)},te)})}function S(R){return function(T){return new Promise(function(O,M){O=Ue(O);var L=T.trans,D=T.values,q=T.limit,te=T.query,re=q===1/0?void 0:q,he=te.index,oe=te.range,de=L.objectStore(I),Ce=he.isPrimaryKey?de:de.index(he.name),ve=u(oe);if(q===0)return O({result:[]});if(R){var Ke=D?Ce.getAll(ve,re):Ce.getAllKeys(ve,re);Ke.onsuccess=function(hn){return O({result:hn.target.result})},Ke.onerror=Ar(M)}else{var pe=0,mt=D||!("openKeyCursor"in Ce)?Ce.openCursor(ve):Ce.openKeyCursor(ve),hr=[];mt.onsuccess=function(hn){var Pr=mt.result;if(!Pr)return O({result:hr});if(hr.push(D?Pr.value:Pr.primaryKey),++pe===q)return O({result:hr});Pr.continue()},mt.onerror=Ar(M)}})}}return{name:I,schema:E,mutate:K,getMany:function(R){var T=R.trans,O=R.keys;return new Promise(function(M,L){M=Ue(M);for(var D=T.objectStore(I),q=O.length,te=new Array(q),re=0,he=0,oe,de=function(pe){var mt=pe.target;(te[mt._pos]=mt.result)!=null,++he===re&&M(te)},Ce=Ar(L),ve=0;ve<q;++ve){var Ke=O[ve];Ke!=null&&(oe=D.get(O[ve]),oe._pos=ve,oe.onsuccess=de,oe.onerror=Ce,++re)}re===0&&M(te)})},get:function(R){var T=R.trans,O=R.key;return new Promise(function(M,L){M=Ue(M);var D=T.objectStore(I),q=D.get(O);q.onsuccess=function(te){return M(te.target.result)},q.onerror=Ar(L)})},query:S(g),openCursor:k,count:function(R){var T=R.query,O=R.trans,M=T.index,L=T.range;return new Promise(function(D,q){var te=O.objectStore(I),re=M.isPrimaryKey?te:te.index(M.name),he=u(L),oe=he?re.count(he):re.count();oe.onsuccess=Ue(function(de){return D(de.target.result)}),oe.onerror=Ar(q)})}}}var h=c(i,a),v=h.schema,g=h.hasGetAll,w=v.tables.map(function(E){return d(E)}),C={};return w.forEach(function(E){return C[E.name]=E}),{stack:"dbcore",transaction:i.transaction.bind(i),table:function(E){var I=C[E];if(!I)throw new Error("Table '".concat(E,"' not found"));return C[E]},MIN_KEY:-1/0,MAX_KEY:Xo(o),schema:v}}function Sm(i,o){return o.reduce(function(a,c){var u=c.create;return r(r({},a),u(a))},i)}function Am(i,o,a,c){var u=a.IDBKeyRange;a.indexedDB;var d=Sm(Cm(o,u,c),i.dbcore);return{dbcore:d}}function Zs(i,o){var a=o.db,c=Am(i._middlewares,a,i._deps,o);i.core=c.dbcore,i.tables.forEach(function(u){var d=u.name;i.core.schema.tables.some(function(h){return h.name===d})&&(u.core=i.core.table(d),i[d]instanceof i.Table&&(i[d].core=u.core))})}function ea(i,o,a,c){a.forEach(function(u){var d=c[u];o.forEach(function(h){var v=j(h,u);(!v||"value"in v&&v.value===void 0)&&(h===i.Transaction.prototype||h instanceof i.Transaction?$(h,u,{get:function(){return this.table(u)},set:function(g){x(this,u,{value:g,writable:!0,configurable:!0,enumerable:!0})}}):h[u]=new i.Table(u,d))})})}function Yl(i,o){o.forEach(function(a){for(var c in a)a[c]instanceof i.Table&&delete a[c]})}function Pm(i,o){return i._cfg.version-o._cfg.version}function Im(i,o,a,c){var u=i._dbSchema;a.objectStoreNames.contains("$meta")&&!u.$meta&&(u.$meta=Ul("$meta",Lf("")[0],[]),i._storeNames.push("$meta"));var d=i._createTransaction("readwrite",i._storeNames,u);d.create(a),d._completion.catch(c);var h=d._reject.bind(d),v=se.transless||se;an(function(){if(se.trans=d,se.transless=v,o===0)l(u).forEach(function(g){Jl(a,g,u[g].primKey,u[g].indexes)}),Zs(i,a),Z.follow(function(){return i.on.populate.fire(d)}).catch(h);else return Zs(i,a),Tm(i,d,o).then(function(g){return Om(i,g,d,a)}).catch(h)})}function Rm(i,o){Mf(i._dbSchema,o),o.db.version%10===0&&!o.objectStoreNames.contains("$meta")&&o.db.createObjectStore("$meta").add(Math.ceil(o.db.version/10-1),"version");var a=ra(i,i.idbdb,o);na(i,i._dbSchema,o);for(var c=Ql(a,i._dbSchema),u=function(w){if(w.change.length||w.recreate)return console.warn("Unable to patch indexes of table ".concat(w.name," because it has changes on the type of index or primary key.")),{value:void 0};var C=o.objectStore(w.name);w.add.forEach(function(E){Sr&&console.debug("Dexie upgrade patch: Creating missing index ".concat(w.name,".").concat(E.src)),ta(C,E)})},d=0,h=c.change;d<h.length;d++){var v=h[d],g=u(v);if(typeof g=="object")return g.value}}function Tm(i,o,a){return o.storeNames.includes("$meta")?o.table("$meta").get("version").then(function(c){return c??a}):Z.resolve(a)}function Om(i,o,a,c){var u=[],d=i._versions,h=i._dbSchema=ra(i,i.idbdb,c),v=d.filter(function(w){return w._cfg.version>=o});if(v.length===0)return Z.resolve();v.forEach(function(w){u.push(function(){var C=h,E=w._cfg.dbschema;na(i,C,c),na(i,E,c),h=i._dbSchema=E;var I=Ql(C,E);I.add.forEach(function(O){Jl(c,O[0],O[1].primKey,O[1].indexes)}),I.change.forEach(function(O){if(O.recreate)throw new ae.Upgrade("Not yet support for changing primary key");var M=c.objectStore(O.name);O.add.forEach(function(L){return ta(M,L)}),O.change.forEach(function(L){M.deleteIndex(L.name),ta(M,L)}),O.del.forEach(function(L){return M.deleteIndex(L)})});var K=w._cfg.contentUpgrade;if(K&&w._cfg.version>o){Zs(i,c),a._memoizedTables={};var k=ge(E);I.del.forEach(function(O){k[O]=C[O]}),Yl(i,[i.Transaction.prototype]),ea(i,[i.Transaction.prototype],l(k),k),a.schema=k;var S=Ne(K);S&&Yi();var R,T=Z.follow(function(){if(R=K(a),R&&S){var O=ln.bind(null,null);R.then(O,O)}});return R&&typeof R.then=="function"?Z.resolve(R):T.then(function(){return R})}}),u.push(function(C){var E=w._cfg.dbschema;Nm(E,C),Yl(i,[i.Transaction.prototype]),ea(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),a.schema=i._dbSchema}),u.push(function(C){i.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(i.idbdb.version/10)===w._cfg.version?(i.idbdb.deleteObjectStore("$meta"),delete i._dbSchema.$meta,i._storeNames=i._storeNames.filter(function(E){return E!=="$meta"})):C.objectStore("$meta").put(w._cfg.version,"version"))})});function g(){return u.length?Z.resolve(u.shift()(a.idbtrans)).then(g):Z.resolve()}return g().then(function(){Mf(h,c)})}function Ql(i,o){var a={del:[],add:[],change:[]},c;for(c in i)o[c]||a.del.push(c);for(c in o){var u=i[c],d=o[c];if(!u)a.add.push([c,d]);else{var h={name:c,def:d,recreate:!1,del:[],add:[],change:[]};if(""+(u.primKey.keyPath||"")!=""+(d.primKey.keyPath||"")||u.primKey.auto!==d.primKey.auto)h.recreate=!0,a.change.push(h);else{var v=u.idxByName,g=d.idxByName,w=void 0;for(w in v)g[w]||h.del.push(w);for(w in g){var C=v[w],E=g[w];C?C.src!==E.src&&h.change.push(E):h.add.push(E)}(h.del.length>0||h.add.length>0||h.change.length>0)&&a.change.push(h)}}}return a}function Jl(i,o,a,c){var u=i.db.createObjectStore(o,a.keyPath?{keyPath:a.keyPath,autoIncrement:a.auto}:{autoIncrement:a.auto});return c.forEach(function(d){return ta(u,d)}),u}function Mf(i,o){l(i).forEach(function(a){o.db.objectStoreNames.contains(a)||(Sr&&console.debug("Dexie: Creating missing table",a),Jl(o,a,i[a].primKey,i[a].indexes))})}function Nm(i,o){[].slice.call(o.db.objectStoreNames).forEach(function(a){return i[a]==null&&o.db.deleteObjectStore(a)})}function ta(i,o){i.createIndex(o.name,o.keyPath,{unique:o.unique,multiEntry:o.multi})}function ra(i,o,a){var c={},u=N(o.objectStoreNames,0);return u.forEach(function(d){for(var h=a.objectStore(d),v=h.keyPath,g=zl(Df(v),v||"",!0,!1,!!h.autoIncrement,v&&typeof v!="string",!0),w=[],C=0;C<h.indexNames.length;++C){var E=h.index(h.indexNames[C]);v=E.keyPath;var I=zl(E.name,v,!!E.unique,!!E.multiEntry,!1,v&&typeof v!="string",!1);w.push(I)}c[d]=Ul(d,g,w)}),c}function Dm(i,o,a){i.verno=o.version/10;var c=i._dbSchema=ra(i,o,a);i._storeNames=N(o.objectStoreNames,0),ea(i,[i._allTables],l(c),c)}function Fm(i,o){var a=ra(i,i.idbdb,o),c=Ql(a,i._dbSchema);return!(c.add.length||c.change.some(function(u){return u.add.length||u.change.length}))}function na(i,o,a){for(var c=a.db.objectStoreNames,u=0;u<c.length;++u){var d=c[u],h=a.objectStore(d);i._hasGetAll="getAll"in h;for(var v=0;v<h.indexNames.length;++v){var g=h.indexNames[v],w=h.index(g).keyPath,C=typeof w=="string"?w:"["+N(w).join("+")+"]";if(o[d]){var E=o[d].idxByName[C];E&&(E.name=g,delete o[d].idxByName[C],o[d].idxByName[g]=E)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(i._hasGetAll=!1)}function Lf(i){return i.split(",").map(function(o,a){o=o.trim();var c=o.replace(/([&*]|\+\+)/g,""),u=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return zl(c,u||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),f(u),a===0)})}var Mm=function(){function i(){}return i.prototype._parseStoresSpec=function(o,a){l(o).forEach(function(c){if(o[c]!==null){var u=Lf(o[c]),d=u.shift();if(d.unique=!0,d.multi)throw new ae.Schema("Primary key cannot be multi-valued");u.forEach(function(h){if(h.auto)throw new ae.Schema("Only primary key can be marked as autoIncrement (++)");if(!h.keyPath)throw new ae.Schema("Index must have a name and cannot be an empty string")}),a[c]=Ul(c,d,u)}})},i.prototype.stores=function(o){var a=this.db;this._cfg.storesSource=this._cfg.storesSource?p(this._cfg.storesSource,o):o;var c=a._versions,u={},d={};return c.forEach(function(h){p(u,h._cfg.storesSource),d=h._cfg.dbschema={},h._parseStoresSpec(u,d)}),a._dbSchema=d,Yl(a,[a._allTables,a,a.Transaction.prototype]),ea(a,[a._allTables,a,a.Transaction.prototype,this._cfg.tables],l(d),d),a._storeNames=l(d),this},i.prototype.upgrade=function(o){return this._cfg.contentUpgrade=Sl(this._cfg.contentUpgrade||Be,o),this},i}();function Lm(i){return Ho(Mm.prototype,function(a){this.db=i,this._cfg={version:a,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Xl(i,o){var a=i._dbNamesDB;return a||(a=i._dbNamesDB=new qr(Ys,{addons:[],indexedDB:i,IDBKeyRange:o}),a.version(1).stores({dbnames:"name"})),a.table("dbnames")}function Gl(i){return i&&typeof i.databases=="function"}function Bm(i){var o=i.indexedDB,a=i.IDBKeyRange;return Gl(o)?Promise.resolve(o.databases()).then(function(c){return c.map(function(u){return u.name}).filter(function(u){return u!==Ys})}):Xl(o,a).toCollection().primaryKeys()}function Km(i,o){var a=i.indexedDB,c=i.IDBKeyRange;!Gl(a)&&o!==Ys&&Xl(a,c).put({name:o}).catch(Be)}function Wm(i,o){var a=i.indexedDB,c=i.IDBKeyRange;!Gl(a)&&o!==Ys&&Xl(a,c).delete(o).catch(Be)}function Zl(i){return an(function(){return se.letThrough=!0,i()})}function jm(){var i=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!i||!indexedDB.databases)return Promise.resolve();var o;return new Promise(function(a){var c=function(){return indexedDB.databases().finally(a)};o=setInterval(c,100),c()}).finally(function(){return clearInterval(o)})}var ec;function tc(i){return!("from"in i)}var It=function(i,o){if(this)p(this,arguments.length?{d:1,from:i,to:arguments.length>1?o:i}:{d:0});else{var a=new It;return i&&"d"in i&&p(a,i),a}};y(It.prototype,(ec={add:function(i){return es(this,i),this},addKey:function(i){return Zo(this,i,i),this},addKeys:function(i){var o=this;return i.forEach(function(a){return Zo(o,a,a)}),this},hasKey:function(i){var o=ia(this).next(i).value;return o&&De(o.from,i)<=0&&De(o.to,i)>=0}},ec[pr]=function(){return ia(this)},ec));function Zo(i,o,a){var c=De(o,a);if(!isNaN(c)){if(c>0)throw RangeError();if(tc(i))return p(i,{from:o,to:a,d:1});var u=i.l,d=i.r;if(De(a,i.from)<0)return u?Zo(u,o,a):i.l={from:o,to:a,d:1,l:null,r:null},Kf(i);if(De(o,i.to)>0)return d?Zo(d,o,a):i.r={from:o,to:a,d:1,l:null,r:null},Kf(i);De(o,i.from)<0&&(i.from=o,i.l=null,i.d=d?d.d+1:1),De(a,i.to)>0&&(i.to=a,i.r=null,i.d=i.l?i.l.d+1:1);var h=!i.r;u&&!i.l&&es(i,u),d&&h&&es(i,d)}}function es(i,o){function a(c,u){var d=u.from,h=u.to,v=u.l,g=u.r;Zo(c,d,h),v&&a(c,v),g&&a(c,g)}tc(o)||a(i,o)}function Bf(i,o){var a=ia(o),c=a.next();if(c.done)return!1;for(var u=c.value,d=ia(i),h=d.next(u.from),v=h.value;!c.done&&!h.done;){if(De(v.from,u.to)<=0&&De(v.to,u.from)>=0)return!0;De(u.from,v.from)<0?u=(c=a.next(v.from)).value:v=(h=d.next(u.from)).value}return!1}function ia(i){var o=tc(i)?null:{s:0,n:i};return{next:function(a){for(var c=arguments.length>0;o;)switch(o.s){case 0:if(o.s=1,c)for(;o.n.l&&De(a,o.n.from)<0;)o={up:o,n:o.n.l,s:1};else for(;o.n.l;)o={up:o,n:o.n.l,s:1};case 1:if(o.s=2,!c||De(a,o.n.to)<=0)return{value:o.n,done:!1};case 2:if(o.n.r){o.s=3,o={up:o,n:o.n.r,s:0};continue}case 3:o=o.up}return{done:!0}}}}function Kf(i){var o,a,c=(((o=i.r)===null||o===void 0?void 0:o.d)||0)-(((a=i.l)===null||a===void 0?void 0:a.d)||0),u=c>1?"r":c<-1?"l":"";if(u){var d=u==="r"?"l":"r",h=r({},i),v=i[u];i.from=v.from,i.to=v.to,i[u]=v[u],h[u]=v[d],i[d]=h,h.d=Wf(h)}i.d=Wf(i)}function Wf(i){var o=i.r,a=i.l;return(o?a?Math.max(o.d,a.d):o.d:a?a.d:0)+1}function oa(i,o){return l(o).forEach(function(a){i[a]?es(i[a],o[a]):i[a]=Dt(o[a])}),i}function rc(i,o){return i.all||o.all||Object.keys(i).some(function(a){return o[a]&&Bf(o[a],i[a])})}var Qn={},nc={},ic=!1;function sa(i,o){oa(nc,i),ic||(ic=!0,setTimeout(function(){ic=!1;var a=nc;nc={},oc(a,!1)},0))}function oc(i,o){o===void 0&&(o=!1);var a=new Set;if(i.all)for(var c=0,u=Object.values(Qn);c<u.length;c++){var d=u[c];jf(d,i,a,o)}else for(var h in i){var v=/^idb\:\/\/(.*)\/(.*)\//.exec(h);if(v){var g=v[1],w=v[2],d=Qn["idb://".concat(g,"/").concat(w)];d&&jf(d,i,a,o)}}a.forEach(function(C){return C()})}function jf(i,o,a,c){for(var u=[],d=0,h=Object.entries(i.queries.query);d<h.length;d++){for(var v=h[d],g=v[0],w=v[1],C=[],E=0,I=w;E<I.length;E++){var K=I[E];rc(o,K.obsSet)?K.subscribers.forEach(function(T){return a.add(T)}):c&&C.push(K)}c&&u.push([g,C])}if(c)for(var k=0,S=u;k<S.length;k++){var R=S[k],g=R[0],C=R[1];i.queries.query[g]=C}}function qm(i){var o=i._state,a=i._deps.indexedDB;if(o.isBeingOpened||i.idbdb)return o.dbReadyPromise.then(function(){return o.dbOpenError?et(o.dbOpenError):i});o.isBeingOpened=!0,o.dbOpenError=null,o.openComplete=!1;var c=o.openCanceller,u=Math.round(i.verno*10),d=!1;function h(){if(o.openCanceller!==c)throw new ae.DatabaseClosed("db.open() was cancelled")}var v=o.dbReadyResolve,g=null,w=!1,C=function(){return new Z(function(E,I){if(h(),!a)throw new ae.MissingAPI;var K=i.name,k=o.autoSchema||!u?a.open(K):a.open(K,u);if(!k)throw new ae.MissingAPI;k.onerror=Ar(I),k.onblocked=Ue(i._fireOnBlocked),k.onupgradeneeded=Ue(function(S){if(g=k.transaction,o.autoSchema&&!i._options.allowEmptyDB){k.onerror=Qo,g.abort(),k.result.close();var R=a.deleteDatabase(K);R.onsuccess=R.onerror=Ue(function(){I(new ae.NoSuchDatabase("Database ".concat(K," doesnt exist")))})}else{g.onerror=Ar(I);var T=S.oldVersion>Math.pow(2,62)?0:S.oldVersion;w=T<1,i.idbdb=k.result,d&&Rm(i,g),Im(i,T/10,g,I)}},I),k.onsuccess=Ue(function(){g=null;var S=i.idbdb=k.result,R=N(S.objectStoreNames);if(R.length>0)try{var T=S.transaction(Em(R),"readonly");if(o.autoSchema)Dm(i,S,T);else if(na(i,i._dbSchema,T),!Fm(i,T)&&!d)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),S.close(),u=S.version+1,d=!0,E(C());Zs(i,T)}catch{}Qi.push(i),S.onversionchange=Ue(function(O){o.vcFired=!0,i.on("versionchange").fire(O)}),S.onclose=Ue(function(O){i.on("close").fire(O)}),w&&Km(i._deps,K),E()},I)}).catch(function(E){switch(E?.name){case"UnknownError":if(o.PR1398_maxLoop>0)return o.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),C();break;case"VersionError":if(u>0)return u=0,C();break}return Z.reject(E)})};return Z.race([c,(typeof navigator>"u"?Z.resolve():jm()).then(C)]).then(function(){return h(),o.onReadyBeingFired=[],Z.resolve(Zl(function(){return i.on.ready.fire(i.vip)})).then(function E(){if(o.onReadyBeingFired.length>0){var I=o.onReadyBeingFired.reduce(Sl,Be);return o.onReadyBeingFired=[],Z.resolve(Zl(function(){return I(i.vip)})).then(E)}})}).finally(function(){o.openCanceller===c&&(o.onReadyBeingFired=null,o.isBeingOpened=!1)}).catch(function(E){o.dbOpenError=E;try{g&&g.abort()}catch{}return c===o.openCanceller&&i._close(),et(E)}).finally(function(){o.openComplete=!0,v()}).then(function(){if(w){var E={};i.tables.forEach(function(I){I.schema.indexes.forEach(function(K){K.name&&(E["idb://".concat(i.name,"/").concat(I.name,"/").concat(K.name)]=new It(-1/0,[[[]]]))}),E["idb://".concat(i.name,"/").concat(I.name,"/")]=E["idb://".concat(i.name,"/").concat(I.name,"/:dels")]=new It(-1/0,[[[]]])}),fn(Jo).fire(E),oc(E,!0)}return i})}function sc(i){var o=function(h){return i.next(h)},a=function(h){return i.throw(h)},c=d(o),u=d(a);function d(h){return function(v){var g=h(v),w=g.value;return g.done?w:!w||typeof w.then!="function"?f(w)?Promise.all(w).then(c,u):c(w):w.then(c,u)}}return d(o)()}function Vm(i,o,a){var c=arguments.length;if(c<2)throw new ae.InvalidArgument("Too few arguments");for(var u=new Array(c-1);--c;)u[c-1]=arguments[c];a=u.pop();var d=ye(u);return[i,d,a]}function qf(i,o,a,c,u){return Z.resolve().then(function(){var d=se.transless||se,h=i._createTransaction(o,a,i._dbSchema,c);h.explicit=!0;var v={trans:h,transless:d};if(c)h.idbtrans=c.idbtrans;else try{h.create(),h.idbtrans._explicit=!0,i._state.PR1398_maxLoop=3}catch(E){return E.name===zi.InvalidState&&i.isOpen()&&--i._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),i.close({disableAutoOpen:!1}),i.open().then(function(){return qf(i,o,a,null,u)})):et(E)}var g=Ne(u);g&&Yi();var w,C=Z.follow(function(){if(w=u.call(h,h),w)if(g){var E=ln.bind(null,null);w.then(E,E)}else typeof w.next=="function"&&typeof w.throw=="function"&&(w=sc(w))},v);return(w&&typeof w.then=="function"?Z.resolve(w).then(function(E){return h.active?E:et(new ae.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):C.then(function(){return w})).then(function(E){return c&&h._resolve(),h._completion.then(function(){return E})}).catch(function(E){return h._reject(E),et(E)})})}function aa(i,o,a){for(var c=f(i)?i.slice():[i],u=0;u<a;++u)c.push(o);return c}function zm(i){return r(r({},i),{table:function(o){var a=i.table(o),c=a.schema,u={},d=[];function h(S,R,T){var O=Go(S),M=u[O]=u[O]||[],L=S==null?0:typeof S=="string"?1:S.length,D=R>0,q=r(r({},T),{name:D?"".concat(O,"(virtual-from:").concat(T.name,")"):T.name,lowLevelIndex:T,isVirtual:D,keyTail:R,keyLength:L,extractKey:Hl(S),unique:!D&&T.unique});if(M.push(q),q.isPrimaryKey||d.push(q),L>1){var te=L===2?S[0]:S.slice(0,L-1);h(te,R+1,T)}return M.sort(function(re,he){return re.keyTail-he.keyTail}),q}var v=h(c.primaryKey.keyPath,0,c.primaryKey);u[":id"]=[v];for(var g=0,w=c.indexes;g<w.length;g++){var C=w[g];h(C.keyPath,0,C)}function E(S){var R=u[Go(S)];return R&&R[0]}function I(S,R){return{type:S.type===1?2:S.type,lower:aa(S.lower,S.lowerOpen?i.MAX_KEY:i.MIN_KEY,R),lowerOpen:!0,upper:aa(S.upper,S.upperOpen?i.MIN_KEY:i.MAX_KEY,R),upperOpen:!0}}function K(S){var R=S.query.index;return R.isVirtual?r(r({},S),{query:{index:R.lowLevelIndex,range:I(S.query.range,R.keyTail)}}):S}var k=r(r({},a),{schema:r(r({},c),{primaryKey:v,indexes:d,getIndexByKeyPath:E}),count:function(S){return a.count(K(S))},query:function(S){return a.query(K(S))},openCursor:function(S){var R=S.query.index,T=R.keyTail,O=R.isVirtual,M=R.keyLength;if(!O)return a.openCursor(S);function L(D){function q(re){re!=null?D.continue(aa(re,S.reverse?i.MAX_KEY:i.MIN_KEY,T)):S.unique?D.continue(D.key.slice(0,M).concat(S.reverse?i.MIN_KEY:i.MAX_KEY,T)):D.continue()}var te=Object.create(D,{continue:{value:q},continuePrimaryKey:{value:function(re,he){D.continuePrimaryKey(aa(re,i.MAX_KEY,T),he)}},primaryKey:{get:function(){return D.primaryKey}},key:{get:function(){var re=D.key;return M===1?re[0]:re.slice(0,M)}},value:{get:function(){return D.value}}});return te}return a.openCursor(K(S)).then(function(D){return D&&L(D)})}});return k}})}var Um={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:zm};function ac(i,o,a,c){return a=a||{},c=c||"",l(i).forEach(function(u){if(!b(o,u))a[c+u]=void 0;else{var d=i[u],h=o[u];if(typeof d=="object"&&typeof h=="object"&&d&&h){var v=Zt(d),g=Zt(h);v!==g?a[c+u]=o[u]:v==="Object"?ac(d,h,a,c+u+"."):d!==h&&(a[c+u]=o[u])}else d!==h&&(a[c+u]=o[u])}}),l(o).forEach(function(u){b(i,u)||(a[c+u]=o[u])}),a}function lc(i,o){return o.type==="delete"?o.keys:o.keys||o.values.map(i.extractKey)}var Hm={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(i){return r(r({},i),{table:function(o){var a=i.table(o),c=a.schema.primaryKey,u=r(r({},a),{mutate:function(d){var h=se.trans,v=h.table(o).hook,g=v.deleting,w=v.creating,C=v.updating;switch(d.type){case"add":if(w.fire===Be)break;return h._promise("readwrite",function(){return E(d)},!0);case"put":if(w.fire===Be&&C.fire===Be)break;return h._promise("readwrite",function(){return E(d)},!0);case"delete":if(g.fire===Be)break;return h._promise("readwrite",function(){return E(d)},!0);case"deleteRange":if(g.fire===Be)break;return h._promise("readwrite",function(){return I(d)},!0)}return a.mutate(d);function E(k){var S=se.trans,R=k.keys||lc(c,k);if(!R)throw new Error("Keys missing");return k=k.type==="add"||k.type==="put"?r(r({},k),{keys:R}):r({},k),k.type!=="delete"&&(k.values=n([],k.values,!0)),k.keys&&(k.keys=n([],k.keys,!0)),Ym(a,k,R).then(function(T){var O=R.map(function(M,L){var D=T[L],q={onerror:null,onsuccess:null};if(k.type==="delete")g.fire.call(q,M,D,S);else if(k.type==="add"||D===void 0){var te=w.fire.call(q,M,k.values[L],S);M==null&&te!=null&&(M=te,k.keys[L]=M,c.outbound||U(k.values[L],c.keyPath,M))}else{var re=ac(D,k.values[L]),he=C.fire.call(q,re,M,D,S);if(he){var oe=k.values[L];Object.keys(he).forEach(function(de){b(oe,de)?oe[de]=he[de]:U(oe,de,he[de])})}}return q});return a.mutate(k).then(function(M){for(var L=M.failures,D=M.results,q=M.numFailures,te=M.lastResult,re=0;re<R.length;++re){var he=D?D[re]:R[re],oe=O[re];he==null?oe.onerror&&oe.onerror(L[re]):oe.onsuccess&&oe.onsuccess(k.type==="put"&&T[re]?k.values[re]:he)}return{failures:L,results:D,numFailures:q,lastResult:te}}).catch(function(M){return O.forEach(function(L){return L.onerror&&L.onerror(M)}),Promise.reject(M)})})}function I(k){return K(k.trans,k.range,1e4)}function K(k,S,R){return a.query({trans:k,values:!1,query:{index:c,range:S},limit:R}).then(function(T){var O=T.result;return E({type:"delete",keys:O,trans:k}).then(function(M){return M.numFailures>0?Promise.reject(M.failures[0]):O.length<R?{failures:[],numFailures:0,lastResult:void 0}:K(k,r(r({},S),{lower:O[O.length-1],lowerOpen:!0}),R)})})}}});return u}})}};function Ym(i,o,a){return o.type==="add"?Promise.resolve([]):i.getMany({trans:o.trans,keys:a,cache:"immutable"})}function Vf(i,o,a){try{if(!o||o.keys.length<i.length)return null;for(var c=[],u=0,d=0;u<o.keys.length&&d<i.length;++u)De(o.keys[u],i[d])===0&&(c.push(a?Ft(o.values[u]):o.values[u]),++d);return c.length===i.length?c:null}catch{return null}}var Qm={stack:"dbcore",level:-1,create:function(i){return{table:function(o){var a=i.table(o);return r(r({},a),{getMany:function(c){if(!c.cache)return a.getMany(c);var u=Vf(c.keys,c.trans._cache,c.cache==="clone");return u?Z.resolve(u):a.getMany(c).then(function(d){return c.trans._cache={keys:c.keys,values:c.cache==="clone"?Ft(d):d},d})},mutate:function(c){return c.type!=="add"&&(c.trans._cache=null),a.mutate(c)}})}}}};function zf(i,o){return i.trans.mode==="readonly"&&!!i.subscr&&!i.trans.explicit&&i.trans.db._options.cache!=="disabled"&&!o.schema.primaryKey.outbound}function Uf(i,o){switch(i){case"query":return o.values&&!o.unique;case"get":return!1;case"getMany":return!1;case"count":return!1;case"openCursor":return!1}}var Jm={stack:"dbcore",level:0,name:"Observability",create:function(i){var o=i.schema.name,a=new It(i.MIN_KEY,i.MAX_KEY);return r(r({},i),{transaction:function(c,u,d){if(se.subscr&&u!=="readonly")throw new ae.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(se.querier));return i.transaction(c,u,d)},table:function(c){var u=i.table(c),d=u.schema,h=d.primaryKey,v=d.indexes,g=h.extractKey,w=h.outbound,C=h.autoIncrement&&v.filter(function(k){return k.compound&&k.keyPath.includes(h.keyPath)}),E=r(r({},u),{mutate:function(k){var S=k.trans,R=k.mutatedParts||(k.mutatedParts={}),T=function(de){var Ce="idb://".concat(o,"/").concat(c,"/").concat(de);return R[Ce]||(R[Ce]=new It)},O=T(""),M=T(":dels"),L=k.type,D=k.type==="deleteRange"?[k.range]:k.type==="delete"?[k.keys]:k.values.length<50?[lc(h,k).filter(function(de){return de}),k.values]:[],q=D[0],te=D[1],re=k.trans._cache;if(f(q)){O.addKeys(q);var he=L==="delete"||q.length===te.length?Vf(q,re):null;he||M.addKeys(q),(he||te)&&Xm(T,d,he,te)}else if(q){var oe={from:q.lower,to:q.upper};M.add(oe),O.add(oe)}else O.add(a),M.add(a),d.indexes.forEach(function(de){return T(de.name).add(a)});return u.mutate(k).then(function(de){return q&&(k.type==="add"||k.type==="put")&&(O.addKeys(de.results),C&&C.forEach(function(Ce){var ve=k.values.map(function(pe){return Ce.extractKey(pe)}),Ke=Ce.keyPath.findIndex(function(pe){return pe===h.keyPath});de.results.forEach(function(pe){return ve[Ke]=pe}),T(Ce.name).addKeys(ve)})),S.mutatedParts=oa(S.mutatedParts||{},R),de})}}),I=function(k){var S,R,T=k.query,O=T.index,M=T.range;return[O,new It((S=M.lower)!==null&&S!==void 0?S:i.MIN_KEY,(R=M.upper)!==null&&R!==void 0?R:i.MAX_KEY)]},K={get:function(k){return[h,new It(k.key)]},getMany:function(k){return[h,new It().addKeys(k.keys)]},count:I,query:I,openCursor:I};return l(K).forEach(function(k){E[k]=function(S){var R=se.subscr,T=!!R,O=zf(se,u)&&Uf(k,S),M=O?S.obsSet={}:R;if(T){var L=function(de){var Ce="idb://".concat(o,"/").concat(c,"/").concat(de);return M[Ce]||(M[Ce]=new It)},D=L(""),q=L(":dels"),te=K[k](S),re=te[0],he=te[1];if(k==="query"&&re.isPrimaryKey&&!S.values?q.add(he):L(re.name||"").add(he),!re.isPrimaryKey)if(k==="count")q.add(a);else{var oe=k==="query"&&w&&S.values&&u.query(r(r({},S),{values:!1}));return u[k].apply(this,arguments).then(function(de){if(k==="query"){if(w&&S.values)return oe.then(function(pe){var mt=pe.result;return D.addKeys(mt),de});var Ce=S.values?de.result.map(g):de.result;S.values?D.addKeys(Ce):q.addKeys(Ce)}else if(k==="openCursor"){var ve=de,Ke=S.values;return ve&&Object.create(ve,{key:{get:function(){return q.addKey(ve.primaryKey),ve.key}},primaryKey:{get:function(){var pe=ve.primaryKey;return q.addKey(pe),pe}},value:{get:function(){return Ke&&D.addKey(ve.primaryKey),ve.value}}})}return de})}}return u[k].apply(this,arguments)}}),E}})}};function Xm(i,o,a,c){function u(d){var h=i(d.name||"");function v(w){return w!=null?d.extractKey(w):null}var g=function(w){return d.multiEntry&&f(w)?w.forEach(function(C){return h.addKey(C)}):h.addKey(w)};(a||c).forEach(function(w,C){var E=a&&v(a[C]),I=c&&v(c[C]);De(E,I)!==0&&(E!=null&&g(E),I!=null&&g(I))})}o.indexes.forEach(u)}function Hf(i,o,a){if(a.numFailures===0)return o;if(o.type==="deleteRange")return null;var c=o.keys?o.keys.length:"values"in o&&o.values?o.values.length:1;if(a.numFailures===c)return null;var u=r({},o);return f(u.keys)&&(u.keys=u.keys.filter(function(d,h){return!(h in a.failures)})),"values"in u&&f(u.values)&&(u.values=u.values.filter(function(d,h){return!(h in a.failures)})),u}function Gm(i,o){return o.lower===void 0?!0:o.lowerOpen?De(i,o.lower)>0:De(i,o.lower)>=0}function Zm(i,o){return o.upper===void 0?!0:o.upperOpen?De(i,o.upper)<0:De(i,o.upper)<=0}function cc(i,o){return Gm(i,o)&&Zm(i,o)}function Yf(i,o,a,c,u,d){if(!a||a.length===0)return i;var h=o.query.index,v=h.multiEntry,g=o.query.range,w=c.schema.primaryKey,C=w.extractKey,E=h.extractKey,I=(h.lowLevelIndex||h).extractKey,K=a.reduce(function(k,S){var R=k,T=[];if(S.type==="add"||S.type==="put")for(var O=new It,M=S.values.length-1;M>=0;--M){var L=S.values[M],D=C(L);if(!O.hasKey(D)){var q=E(L);(v&&f(q)?q.some(function(oe){return cc(oe,g)}):cc(q,g))&&(O.addKey(D),T.push(L))}}switch(S.type){case"add":R=k.concat(o.values?T:T.map(function(oe){return C(oe)}));break;case"put":var te=new It().addKeys(S.values.map(function(oe){return C(oe)}));R=k.filter(function(oe){return!te.hasKey(o.values?C(oe):oe)}).concat(o.values?T:T.map(function(oe){return C(oe)}));break;case"delete":var re=new It().addKeys(S.keys);R=k.filter(function(oe){return!re.hasKey(o.values?C(oe):oe)});break;case"deleteRange":var he=S.range;R=k.filter(function(oe){return!cc(C(oe),he)});break}return R},i);return K===i?i:(K.sort(function(k,S){return De(I(k),I(S))||De(C(k),C(S))}),o.limit&&o.limit<1/0&&(K.length>o.limit?K.length=o.limit:i.length===o.limit&&K.length<o.limit&&(u.dirty=!0)),d?Object.freeze(K):K)}function Qf(i,o){return De(i.lower,o.lower)===0&&De(i.upper,o.upper)===0&&!!i.lowerOpen==!!o.lowerOpen&&!!i.upperOpen==!!o.upperOpen}function ev(i,o,a,c){if(i===void 0)return o!==void 0?-1:0;if(o===void 0)return 1;var u=De(i,o);if(u===0){if(a&&c)return 0;if(a)return 1;if(c)return-1}return u}function tv(i,o,a,c){if(i===void 0)return o!==void 0?1:0;if(o===void 0)return-1;var u=De(i,o);if(u===0){if(a&&c)return 0;if(a)return-1;if(c)return 1}return u}function rv(i,o){return ev(i.lower,o.lower,i.lowerOpen,o.lowerOpen)<=0&&tv(i.upper,o.upper,i.upperOpen,o.upperOpen)>=0}function nv(i,o,a,c){var u=Qn["idb://".concat(i,"/").concat(o)];if(!u)return[];var d=u.queries[a];if(!d)return[null,!1,u,null];var h=c.query?c.query.index.name:null,v=d[h||""];if(!v)return[null,!1,u,null];switch(a){case"query":var g=v.find(function(E){return E.req.limit===c.limit&&E.req.values===c.values&&Qf(E.req.query.range,c.query.range)});if(g)return[g,!0,u,v];var w=v.find(function(E){var I="limit"in E.req?E.req.limit:1/0;return I>=c.limit&&(c.values?E.req.values:!0)&&rv(E.req.query.range,c.query.range)});return[w,!1,u,v];case"count":var C=v.find(function(E){return Qf(E.req.query.range,c.query.range)});return[C,!!C,u,v]}}function iv(i,o,a,c){i.subscribers.add(a),c.addEventListener("abort",function(){i.subscribers.delete(a),i.subscribers.size===0&&ov(i,o)})}function ov(i,o){setTimeout(function(){i.subscribers.size===0&&be(o,i)},3e3)}var sv={stack:"dbcore",level:0,name:"Cache",create:function(i){var o=i.schema.name,a=r(r({},i),{transaction:function(c,u,d){var h=i.transaction(c,u,d);if(u==="readwrite"){var v=new AbortController,g=v.signal,w=function(C){return function(){if(v.abort(),u==="readwrite"){for(var E=new Set,I=0,K=c;I<K.length;I++){var k=K[I],S=Qn["idb://".concat(o,"/").concat(k)];if(S){var R=i.table(k),T=S.optimisticOps.filter(function(Ke){return Ke.trans===h});if(h._explicit&&C&&h.mutatedParts)for(var O=0,M=Object.values(S.queries.query);O<M.length;O++)for(var L=M[O],D=0,q=L.slice();D<q.length;D++){var te=q[D];rc(te.obsSet,h.mutatedParts)&&(be(L,te),te.subscribers.forEach(function(Ke){return E.add(Ke)}))}else if(T.length>0){S.optimisticOps=S.optimisticOps.filter(function(Ke){return Ke.trans!==h});for(var re=0,he=Object.values(S.queries.query);re<he.length;re++)for(var L=he[re],oe=0,de=L.slice();oe<de.length;oe++){var te=de[oe];if(te.res!=null&&h.mutatedParts)if(C&&!te.dirty){var Ce=Object.isFrozen(te.res),ve=Yf(te.res,te.req,T,R,te,Ce);te.dirty?(be(L,te),te.subscribers.forEach(function(mt){return E.add(mt)})):ve!==te.res&&(te.res=ve,te.promise=Z.resolve({result:ve}))}else te.dirty&&be(L,te),te.subscribers.forEach(function(mt){return E.add(mt)})}}}}E.forEach(function(Ke){return Ke()})}}};h.addEventListener("abort",w(!1),{signal:g}),h.addEventListener("error",w(!1),{signal:g}),h.addEventListener("complete",w(!0),{signal:g})}return h},table:function(c){var u=i.table(c),d=u.schema.primaryKey,h=r(r({},u),{mutate:function(v){var g=se.trans;if(d.outbound||g.db._options.cache==="disabled"||g.explicit)return u.mutate(v);var w=Qn["idb://".concat(o,"/").concat(c)];if(!w)return u.mutate(v);var C=u.mutate(v);return(v.type==="add"||v.type==="put")&&(v.values.length>=50||lc(d,v).some(function(E){return E==null}))?C.then(function(E){var I=r(r({},v),{values:v.values.map(function(k,S){var R,T=!((R=d.keyPath)===null||R===void 0)&&R.includes(".")?Ft(k):r({},k);return U(T,d.keyPath,E.results[S]),T})}),K=Hf(w,I,E);w.optimisticOps.push(K),queueMicrotask(function(){return v.mutatedParts&&sa(v.mutatedParts)})}):(w.optimisticOps.push(v),v.mutatedParts&&sa(v.mutatedParts),C.then(function(E){if(E.numFailures>0){be(w.optimisticOps,v);var I=Hf(w,v,E);I&&w.optimisticOps.push(I),v.mutatedParts&&sa(v.mutatedParts)}}),C.catch(function(){be(w.optimisticOps,v),v.mutatedParts&&sa(v.mutatedParts)})),C},query:function(v){var g;if(!zf(se,u)||!Uf("query",v))return u.query(v);var w=((g=se.trans)===null||g===void 0?void 0:g.db._options.cache)==="immutable",C=se,E=C.requery,I=C.signal,K=nv(o,c,"query",v),k=K[0],S=K[1],R=K[2],T=K[3];if(k&&S)k.obsSet=v.obsSet;else{var O=u.query(v).then(function(M){var L=M.result;if(k&&(k.res=L),w){for(var D=0,q=L.length;D<q;++D)Object.freeze(L[D]);Object.freeze(L)}else M.result=Ft(L);return M}).catch(function(M){return T&&k&&be(T,k),Promise.reject(M)});k={obsSet:v.obsSet,promise:O,subscribers:new Set,type:"query",req:v,dirty:!1},T?T.push(k):(T=[k],R||(R=Qn["idb://".concat(o,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),R.queries.query[v.query.index.name||""]=T)}return iv(k,T,E,I),k.promise.then(function(M){return{result:Yf(M.result,v,R?.optimisticOps,u,k,w)}})}});return h}});return a}};function la(i,o){return new Proxy(i,{get:function(a,c,u){return c==="db"?o:Reflect.get(a,c,u)}})}var qr=function(){function i(o,a){var c=this;this._middlewares={},this.verno=0;var u=i.dependencies;this._options=a=r({addons:i.addons,autoOpen:!0,indexedDB:u.indexedDB,IDBKeyRange:u.IDBKeyRange,cache:"cloned"},a),this._deps={indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange};var d=a.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var h={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Be,dbReadyPromise:null,cancelOpen:Be,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:a.autoOpen};h.dbReadyPromise=new Z(function(g){h.dbReadyResolve=g}),h.openCanceller=new Z(function(g,w){h.cancelOpen=w}),this._state=h,this.name=o,this.on=Uo(this,"populate","blocked","versionchange","close",{ready:[Sl,Be]}),this.on.ready.subscribe=H(this.on.ready.subscribe,function(g){return function(w,C){i.vip(function(){var E=c._state;if(E.openComplete)E.dbOpenError||Z.resolve().then(w),C&&g(w);else if(E.onReadyBeingFired)E.onReadyBeingFired.push(w),C&&g(w);else{g(w);var I=c;C||g(function K(){I.on.ready.unsubscribe(w),I.on.ready.unsubscribe(K)})}})}}),this.Collection=hm(this),this.Table=um(this),this.Transaction=xm(this),this.Version=Lm(this),this.WhereClause=bm(this),this.on("versionchange",function(g){g.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(c.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(c.name,"'. Closing db now to resume the delete request.")),c.close({disableAutoOpen:!1})}),this.on("blocked",function(g){!g.newVersion||g.newVersion<g.oldVersion?console.warn("Dexie.delete('".concat(c.name,"') was blocked")):console.warn("Upgrade '".concat(c.name,"' blocked by other connection holding version ").concat(g.oldVersion/10))}),this._maxKey=Xo(a.IDBKeyRange),this._createTransaction=function(g,w,C,E){return new c.Transaction(g,w,C,c._options.chromeTransactionDurability,E)},this._fireOnBlocked=function(g){c.on("blocked").fire(g),Qi.filter(function(w){return w.name===c.name&&w!==c&&!w._state.vcFired}).map(function(w){return w.on("versionchange").fire(g)})},this.use(Qm),this.use(sv),this.use(Jm),this.use(Um),this.use(Hm);var v=new Proxy(this,{get:function(g,w,C){if(w==="_vip")return!0;if(w==="table")return function(I){return la(c.table(I),v)};var E=Reflect.get(g,w,C);return E instanceof If?la(E,v):w==="tables"?E.map(function(I){return la(I,v)}):w==="_createTransaction"?function(){var I=E.apply(this,arguments);return la(I,v)}:E}});this.vip=v,d.forEach(function(g){return g(c)})}return i.prototype.version=function(o){if(isNaN(o)||o<.1)throw new ae.Type("Given version is not a positive number");if(o=Math.round(o*10)/10,this.idbdb||this._state.isBeingOpened)throw new ae.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,o);var a=this._versions,c=a.filter(function(u){return u._cfg.version===o})[0];return c||(c=new this.Version(o),a.push(c),a.sort(Pm),c.stores({}),this._state.autoSchema=!1,c)},i.prototype._whenReady=function(o){var a=this;return this.idbdb&&(this._state.openComplete||se.letThrough||this._vip)?o():new Z(function(c,u){if(a._state.openComplete)return u(new ae.DatabaseClosed(a._state.dbOpenError));if(!a._state.isBeingOpened){if(!a._state.autoOpen){u(new ae.DatabaseClosed);return}a.open().catch(Be)}a._state.dbReadyPromise.then(c,u)}).then(o)},i.prototype.use=function(o){var a=o.stack,c=o.create,u=o.level,d=o.name;d&&this.unuse({stack:a,name:d});var h=this._middlewares[a]||(this._middlewares[a]=[]);return h.push({stack:a,create:c,level:u??10,name:d}),h.sort(function(v,g){return v.level-g.level}),this},i.prototype.unuse=function(o){var a=o.stack,c=o.name,u=o.create;return a&&this._middlewares[a]&&(this._middlewares[a]=this._middlewares[a].filter(function(d){return u?d.create!==u:c?d.name!==c:!1})),this},i.prototype.open=function(){var o=this;return Un(sn,function(){return qm(o)})},i.prototype._close=function(){var o=this._state,a=Qi.indexOf(this);if(a>=0&&Qi.splice(a,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}o.isBeingOpened||(o.dbReadyPromise=new Z(function(c){o.dbReadyResolve=c}),o.openCanceller=new Z(function(c,u){o.cancelOpen=u}))},i.prototype.close=function(o){var a=o===void 0?{disableAutoOpen:!0}:o,c=a.disableAutoOpen,u=this._state;c?(u.isBeingOpened&&u.cancelOpen(new ae.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new ae.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},i.prototype.delete=function(o){var a=this;o===void 0&&(o={disableAutoOpen:!0});var c=arguments.length>0&&typeof arguments[0]!="object",u=this._state;return new Z(function(d,h){var v=function(){a.close(o);var g=a._deps.indexedDB.deleteDatabase(a.name);g.onsuccess=Ue(function(){Wm(a._deps,a.name),d()}),g.onerror=Ar(h),g.onblocked=a._fireOnBlocked};if(c)throw new ae.InvalidArgument("Invalid closeOptions argument to db.delete()");u.isBeingOpened?u.dbReadyPromise.then(v):v()})},i.prototype.backendDB=function(){return this.idbdb},i.prototype.isOpen=function(){return this.idbdb!==null},i.prototype.hasBeenClosed=function(){var o=this._state.dbOpenError;return o&&o.name==="DatabaseClosed"},i.prototype.hasFailed=function(){return this._state.dbOpenError!==null},i.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(i.prototype,"tables",{get:function(){var o=this;return l(this._allTables).map(function(a){return o._allTables[a]})},enumerable:!1,configurable:!0}),i.prototype.transaction=function(){var o=Vm.apply(this,arguments);return this._transaction.apply(this,o)},i.prototype._transaction=function(o,a,c){var u=this,d=se.trans;(!d||d.db!==this||o.indexOf("!")!==-1)&&(d=null);var h=o.indexOf("?")!==-1;o=o.replace("!","").replace("?","");var v,g;try{if(g=a.map(function(C){var E=C instanceof u.Table?C.name:C;if(typeof E!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return E}),o=="r"||o===Bl)v=Bl;else if(o=="rw"||o==Kl)v=Kl;else throw new ae.InvalidArgument("Invalid transaction mode: "+o);if(d){if(d.mode===Bl&&v===Kl)if(h)d=null;else throw new ae.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");d&&g.forEach(function(C){if(d&&d.storeNames.indexOf(C)===-1)if(h)d=null;else throw new ae.SubTransaction("Table "+C+" not included in parent transaction.")}),h&&d&&!d.active&&(d=null)}}catch(C){return d?d._promise(null,function(E,I){I(C)}):et(C)}var w=qf.bind(null,this,v,g,d,c);return d?d._promise(v,w,"lock"):se.trans?Un(se.transless,function(){return u._whenReady(w)}):this._whenReady(w)},i.prototype.table=function(o){if(!b(this._allTables,o))throw new ae.InvalidTable("Table ".concat(o," does not exist"));return this._allTables[o]},i}(),av=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",lv=function(){function i(o){this._subscribe=o}return i.prototype.subscribe=function(o,a,c){return this._subscribe(!o||typeof o=="function"?{next:o,error:a,complete:c}:o)},i.prototype[av]=function(){return this},i}(),ca;try{ca={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{ca={indexedDB:null,IDBKeyRange:null}}function Jf(i){var o=!1,a,c=new lv(function(u){var d=Ne(i);function h(T){var O=Ui();try{d&&Yi();var M=an(i,T);return d&&(M=M.finally(ln)),M}finally{O&&Hi()}}var v=!1,g,w={},C={},E={get closed(){return v},unsubscribe:function(){v||(v=!0,g&&g.abort(),I&&fn.storagemutated.unsubscribe(S))}};u.start&&u.start(E);var I=!1,K=function(){return Fl(R)};function k(){return rc(C,w)}var S=function(T){oa(w,T),k()&&K()},R=function(){if(!(v||!ca.indexedDB)){w={};var T={};g&&g.abort(),g=new AbortController;var O={subscr:T,signal:g.signal,requery:K,querier:i,trans:null},M=h(O);Promise.resolve(M).then(function(L){o=!0,a=L,!(v||O.signal.aborted)&&(w={},C=T,!Kr(C)&&!I&&(fn(Jo,S),I=!0),Fl(function(){return!v&&u.next&&u.next(L)}))},function(L){o=!1,["DatabaseClosedError","AbortError"].includes(L?.name)||v||Fl(function(){v||u.error&&u.error(L)})})}};return setTimeout(K,0),E});return c.hasValue=function(){return o},c.getValue=function(){return a},c}var Jn=qr;y(Jn,r(r({},on),{delete:function(i){var o=new Jn(i,{addons:[]});return o.delete()},exists:function(i){return new Jn(i,{addons:[]}).open().then(function(o){return o.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(i){try{return Bm(Jn.dependencies).then(i)}catch{return et(new ae.MissingAPI)}},defineClass:function(){function i(o){p(this,o)}return i},ignoreTransaction:function(i){return se.trans?Un(se.transless,i):i()},vip:Zl,async:function(i){return function(){try{var o=sc(i.apply(this,arguments));return!o||typeof o.then!="function"?Z.resolve(o):o}catch(a){return et(a)}}},spawn:function(i,o,a){try{var c=sc(i.apply(a,o||[]));return!c||typeof c.then!="function"?Z.resolve(c):c}catch(u){return et(u)}},currentTransaction:{get:function(){return se.trans||null}},waitFor:function(i,o){var a=Z.resolve(typeof i=="function"?Jn.ignoreTransaction(i):i).timeout(o||6e4);return se.trans?se.trans.waitFor(a):a},Promise:Z,debug:{get:function(){return Sr},set:function(i){mf(i)}},derive:P,extend:p,props:y,override:H,Events:Uo,on:fn,liveQuery:Jf,extendObservabilitySet:oa,getByKeyPath:J,setByKeyPath:U,delByKeyPath:ue,shallowClone:ge,deepClone:Ft,getObjectDiff:ac,cmp:De,asap:Q,minKey:Ll,addons:[],connections:Qi,errnames:zi,dependencies:ca,cache:Qn,semVer:kf,version:kf.split(".").map(function(i){return parseInt(i)}).reduce(function(i,o,a){return i+o/Math.pow(10,a*2)})})),Jn.maxKey=Xo(Jn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(fn(Jo,function(i){if(!dn){var o;o=new CustomEvent(Vl,{detail:i}),dn=!0,dispatchEvent(o),dn=!1}}),addEventListener(Vl,function(i){var o=i.detail;dn||uc(o)}));function uc(i){var o=dn;try{dn=!0,fn.storagemutated.fire(i),oc(i,!0)}finally{dn=o}}var dn=!1,pn,fc=function(){};typeof BroadcastChannel<"u"&&(fc=function(){pn=new BroadcastChannel(Vl),pn.onmessage=function(i){return i.data&&uc(i.data)}},fc(),typeof pn.unref=="function"&&pn.unref(),fn(Jo,function(i){dn||pn.postMessage(i)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(i){if(!qr.disableBfCache&&i.persisted){Sr&&console.debug("Dexie: handling persisted pagehide"),pn?.close();for(var o=0,a=Qi;o<a.length;o++){var c=a[o];c.close({disableAutoOpen:!1})}}}),addEventListener("pageshow",function(i){!qr.disableBfCache&&i.persisted&&(Sr&&console.debug("Dexie: handling persisted pageshow"),fc(),uc({all:new It(-1/0,[[]])}))}));function cv(i){return new Yo({add:i})}function uv(i){return new Yo({remove:i})}function fv(i,o){return new Yo({replacePrefix:[i,o]})}Z.rejectionMapper=Cl,mf(Sr);var dv=Object.freeze({__proto__:null,Dexie:qr,liveQuery:Jf,Entity:Sf,cmp:De,PropModSymbol:dm,PropModification:Yo,replacePrefix:fv,add:cv,remove:uv,default:qr,RangeSet:It,mergeRanges:es,rangesOverlap:Bf});return r(qr,dv,{default:qr}),qr})});var zy={};Xf(zy,{default:()=>$l});module.exports=bv(zy);var qi=require("obsidian");var nt=require("obsidian");var da=Gi(require("node:path")),pa=class{constructor(e){this.config=e}parse(e,r){let n=e.split(this.config.paragraphSeparator),s=0;for(;s<n.length;)s<n.length-1&&n[s].length<this.config.chunkSize?(n[s]=[n[s],n[s+1]].join(this.config.paragraphSeparator),n.splice(s+1,1)):s+=1;return n.map(l=>({content:l,parent:r,createdAt:new Date().valueOf()}))}};function Zi(t){let e=da.default.basename(t.parent,da.default.extname(t.parent)),r=da.default.dirname(t.parent),n="";return n+=`Title: ${e}
`,r!="."&&(n+=`Folder: ${r}
`),n+=t.content,n}var Zf=`You are an assistant invoked as a plugin within Obsidian, the popular knowledge management and note-taking software.
The user's knowledgebase usually contains both original thoughts and references to other people's work on the internet and in books. They also keep track of projects and tasks there.
Content rules you must follow:
- Think step by step.
- You don't need to provide the perfect answer in one shot. Assume some of the provided context is outdated or incomplete. You can ask for clarification if you need more information.
- Your answers should be precise and grounded in the provided sources, but you are encouraged to be opinionated as long as they are marked as such. User prefers short and clear answers.
- You can be direct and honest, there is no need to preface your response with disclaimers, warnings or filler text.
- If possible, try to highlight implicit connections in the provided context that is otherwise hidden.
Formatting rules to follow:
- Use additional Markdown formatting to highlight the most important parts of your response. For example: bold, italic, bulleted and numbered lists.`,ed=`
Your goal is to rewrite the user's question into search keywords.
`,td=[{input:"How do I make a pie?",output:"make a pie"},{input:"What were the major contributions of Joseph Swan to the development of the incandescent light bulb?",output:"Joseph Swan's contribution to development of incandescent light bulb"},{input:"What is the difference between a solid and a liquid?",output:"solid and liquid difference"},{input:"What are the odds for slot machines?",output:"slot machine odds"}],rs="---***---",rd=(t,e)=>`Given the provided context below, answer the user's query. Each chunk of context is separated by \`${rs}\`.
<context>
${t}
</context>
User query: ${e}
Answer:`,eo=(t,e)=>{let r=t;return e.length>0&&(r+=`

Additional context is attached below:
<context>
`,r+=e.map(n=>Zi(n)).join(`

${rs}

`),r+="</context>"),r},nd=`Summarize the following note in two sentences. Use simple language.
Do not add any context or prefix (such as 'The note outlines...'), just respond with the summary.
`,id=`Extract key topics and entities from the following note.
Return at most 5 key topics and entities. Each topic should be a few words long. Only provide a key topic if it's indeed important and frequently referenced.
Something referenced only once is not a key topic.
Accuracy and trustworthyness are more important than providing topics at all costs. Some documents doesn't have key topics at all.
Response format: JSON with the following schema:
{
	"topics: [
		"topic1",
		"topic2",
		"topic3"
	]
}
Don't forget to encode special characters according to the JSON format specification.
`,od=`Your task is to generate a list of proactive questions based on the given context.
The context is a sample of documents about a specific research topic.
For each question, you should consider the following:
1. What is the main theme of the question? Pick a theme that is at most 3 words long. The theme should use plain language, no need to escape characters.
2. What is an appropriate question to explore the provided documents? It should be a full sentence, ending with a question mark.
Generate AT MOST 6 questions. If you can't think of any more questions, you can provide fewer.
Response format: JSON with the following schema:
{
	"questions": [
		{
			"content": "How do the different technologies compare (X, Y, Z) in terms of W?",
			"theme": "comparison"
		},
		{
			"content": "How did the invention of X influence Y?",
			"theme": "impact"
		}
	]
}
Remember, certain characters need to be escaped in JSON strings.
`;var Jy=require("obsidian"),ha=class{constructor(e,r){this.vault=e,this.db=r}async prune(){let e=Date.now(),r=[];for(let _ of await this.db.workspace.toArray())await this.vault.adapter.exists(_.workspaceFile)||(console.log(`Pruned dangling workspace ${_.workspaceFile}.`),r.push(_.workspaceFile));let n=await this.db.workspace.where("workspaceFile").anyOf(r).delete(),s=new Set((await this.db.workspace.toArray()).map(_=>_.workspaceFile)),l=[];for(let _ of await this.db.vectorStore.toArray()){let b=await this.vault.adapter.exists(_.node.parent),y=_.includedInWorkspace.some(x=>s.has(x));(!b||!y)&&(l.push(_.node.parent),console.log(`Pruned dangling vector store entry of ${_.node.parent}.`))}let f=await this.db.vectorStore.where("node.parent").anyOf(l).delete(),p=[];for(let _ of await this.db.noteDerivedData.toArray())await this.vault.adapter.exists(_.path)||(console.log(`Pruned dangling derived data of ${_.path}.`),p.push(_.path));let m=await this.db.noteDerivedData.where("path").anyOf(p).delete();return console.log(`Pruned ${n} dangling workspaces`),console.log(`Pruned ${f} dangling vector store entries`),console.log(`Pruned ${m} dangling note derived data`),console.log(`Operation took ${Date.now()-e}ms`),n+f+m}};var ad={openAIApiKey:"",anthropicApikey:"",systemPrompt:Zf,noteContextMinChars:500,chunkSize:1e3,retrievedNodeCount:10,questionAndAnswerModel:"gpt-4o-mini-2024-07-18",noteContextModel:"gpt-4o-mini-2024-07-18",promptFolder:"Resources/LLM/Prompts"},wv=["gpt-4-turbo-2024-04-09","gpt-4o-2024-08-06","gpt-4o-mini-2024-07-18","claude-3-haiku-20240307","claude-3-sonnet-20240229","claude-3-5-sonnet-20241022","claude-3-opus-20240229"],ma=class extends nt.PluginSettingTab{constructor(e,r){super(e,r),this.plugin=r}display(){let{containerEl:e}=this;e.empty(),new nt.Setting(e).setName("General settings").setHeading(),new nt.Setting(e).setName("Model for conversationss").setDesc("The model used to answer questions in the LLM workspace view").addDropdown(f=>{f.addOptions(sd()).setValue(this.plugin.settings.questionAndAnswerModel).onChange(async p=>{this.plugin.settings.questionAndAnswerModel=p,await this.plugin.saveSettings()})}),new nt.Setting(e).setName("Model for note context").setDesc("The model used to generate note context (summary, key topics)").addDropdown(f=>{f.addOptions(sd()).setValue(this.plugin.settings.noteContextModel).onChange(async p=>{this.plugin.settings.noteContextModel=p,await this.plugin.saveSettings()})}),new nt.Setting(e).setName("Prompt folder location").setDesc("Files in the folder will be available as prompts. Type @ to the chat input to open the prompt selector.").addText(f=>{f.setValue(this.plugin.settings.promptFolder).setPlaceholder("Select a folder").onChange(async p=>{this.plugin.settings.promptFolder=p,await this.plugin.saveSettings()})}),new nt.Setting(e).setName("Note context minimum length").setDesc("Don't create note context (summary, key topics) for notes shorter than this many characters.").addSlider(f=>{f.setLimits(0,1e3,100).setValue(this.plugin.settings.noteContextMinChars).setDynamicTooltip().onChange(async p=>{this.plugin.settings.noteContextMinChars=p,await this.plugin.saveSettings()})}),new nt.Setting(e).setName("Prune database").setDesc("For most file change events in your vault, the plugin's database is kept in sync automatically. However, some vault changes don't remove plugin data immediately to avoid expensive LLM API calls in case it's needed again (such as building embeddings). This button manually prunes the plugin database.").addButton(f=>{f.setButtonText("Prune").onClick(async()=>{let m=await new ha(this.app.vault,this.plugin.db).prune();new nt.Notice(`Pruned ${m} database entries.`,0)})}),new nt.Setting(e).setName("API keys").setHeading();let r=document.createDocumentFragment(),n=document.createElement("a");n.href="https://platform.openai.com",n.textContent="platform.openai.com",r.append("Required when using workspace chat mode, even if a different LLM provider is used for answering questions (document embedding always uses the OpenAI API).",document.createElement("br"),"Create a key at ",n),new nt.Setting(e).setName("OpenAI API key").setDesc(r).addText(f=>f.setPlaceholder("sk-").setValue(this.plugin.settings.openAIApiKey).onChange(async p=>{this.plugin.settings.openAIApiKey=p,await this.plugin.saveSettings()}));let s=document.createDocumentFragment(),l=document.createElement("a");l.href="https://console.anthropic.com",l.textContent="console.anthropic.com",s.append("Required when using an Anthropic model.",document.createElement("br"),"Create a key at ",l),new nt.Setting(e).setName("Anthropic API key").setDesc(s).addText(f=>f.setPlaceholder("sk-ant-").setValue(this.plugin.settings.anthropicApikey).onChange(async p=>{this.plugin.settings.anthropicApikey=p,await this.plugin.saveSettings()})),new nt.Setting(e).setName("Retrieval parameters").setHeading(),new nt.Setting(e).setName("System prompt").setDesc("The instructions and extra context included in all LLM queries.").addTextArea(f=>{f.setPlaceholder("System prompt").setValue(this.plugin.settings.systemPrompt).onChange(async p=>{this.plugin.settings.systemPrompt=p,await this.plugin.saveSettings()}),f.inputEl.rows=10,f.inputEl.style.width="100%"}),new nt.Setting(e).setName("Chunk size").setDesc("Notes are chunked into smaller parts before indexing and during retrieval. This setting controls the maximum size of a chunk (in characters).").addText(f=>{f.setPlaceholder("Number of characters").setValue(this.plugin.settings.chunkSize.toString()).onChange(async p=>{try{let m=parseInt(p);if(isNaN(m))throw new Error("Chunk size must be a number");this.plugin.settings.chunkSize=m,await this.plugin.saveSettings()}catch(m){console.error(m),new nt.Notice("Chunk size must be a number")}})}),new nt.Setting(e).setName("Number of chunks in context").setDesc(`In workspace chat mode, the most relevant notes are added to the LLM context. This setting controls the number of chunks to include.
Note: one note does not necessarily equal one chunk, as notes are split into smaller chunks.`).addText(f=>{f.setPlaceholder("Number of chunks").setValue(this.plugin.settings.retrievedNodeCount.toString()).onChange(async p=>{try{let m=parseInt(p);if(isNaN(m))throw new Error("Chunk count must be a number");this.plugin.settings.retrievedNodeCount=m,await this.plugin.saveSettings()}catch(m){console.error(m),new nt.Notice("Chunk count must be a number")}})})}};function sd(){return wv.reduce((t,e)=>(t[e]=e,t),{})}var to=class{constructor(e){this.db=e}async addNode(e,r,n){await this.db.vectorStore.add({node:e,includedInWorkspace:[n],embedding:r})}async query(e,r,n){return(await this.db.vectorStore.where("includedInWorkspace").equals(r).toArray()).sort((f,p)=>dc(p.embedding,e)-dc(f.embedding,e)).slice(0,n).map(f=>({similarity:dc(f.embedding,e),node:f.node}))}async updateFilePath(e,r){await this.db.vectorStore.where("node.parent").equals(e).modify({"node.parent":r})}async deleteFiles(...e){return await this.db.vectorStore.where("node.parent").anyOf(e).delete()}async updateWorkspacePath(e,r){await this.db.vectorStore.where("includedInWorkspace").equals(e).modify(n=>{n.includedInWorkspace=n.includedInWorkspace.map(s=>s===e?r:s)})}};function dc(t,e){let r=0;for(let n=0;n<t.length;n++)r+=t[n]*e[n];return r}var va=Gi(ld(),1),cd=Symbol.for("Dexie"),ns=globalThis[cd]||(globalThis[cd]=va.default);if(va.default.semVer!==ns.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${va.default.semVer} and ${ns.semVer}`);var{liveQuery:Xn,mergeRanges:ib,rangesOverlap:ob,RangeSet:sb,cmp:ab,Entity:lb,PropModSymbol:cb,PropModification:ub,replacePrefix:fb,add:db,remove:pb}=ns;var _a=class extends ns{constructor(e){super(`llm-workspace/${e}`),this.version(1).stores({noteDerivedData:"path",vectorStore:"++, *includedInWorkspace, node.parent",workspace:"workspaceFile, *links"})}};var uu=require("obsidian");var $p=Gi(require("node:path")),iI=require("obsidian");var vr=Array.isArray,is=Array.from,mc=Object.keys,rr=Object.defineProperty,nr=Object.getOwnPropertyDescriptor,vc=Object.getOwnPropertyDescriptors,_c=Object.prototype,ud=Array.prototype,vn=Object.getPrototypeOf;var gt=()=>{};function fd(t){return typeof t?.then=="function"}function ro(t){for(var e=0;e<t.length;e++)t[e]()}var ir=Symbol("$state"),Gn=Symbol("$state metadata"),ga=Symbol("legacy props"),dd=Symbol("");var ya=!1,hd=!1,gc=[],pd=[];function md(){ya=!1;let t=gc.slice();gc=[],ro(t)}function xv(){hd=!1;let t=pd.slice();pd=[],ro(t)}function Mt(t){ya||(ya=!0,queueMicrotask(md)),gc.push(t)}function vd(){ya&&md(),hd&&xv()}var os="font-weight: bold",ss="font-weight: normal";function _d(t,e,r){console.warn("hydration_attribute_changed")}function no(t){console.warn("hydration_mismatch")}function gd(){console.warn("lifecycle_double_unmount")}function yc(t,e){console.warn("ownership_invalid_mutation")}function ba(t){console.warn("state_proxy_equality_mismatch")}var io="[",Zn="[!",ei="]",_n={};var Ct=Symbol(),Rt=Symbol("filename"),yd=Symbol("hmr");var Ev={},kv=/at (?:.+ \()?(.+):(\d+):(\d+)\)?$/,$v=/@(.+):(\d+):(\d+)$/;function Cv(){let t=new Error().stack;if(!t)return null;let e=[];for(let r of t.split(`
`)){let n=kv.exec(r)??$v.exec(r);n&&e.push({file:n[1],line:+n[2],column:+n[3]})}return e}function bd(){let t=Cv()?.slice(4);if(!t)return null;for(let e=0;e<t.length;e++){let r=t[e],n=Ev[r.file];if(!n){if(e===0)return null;continue}for(let s of n){if(s.end==null)return null;if(s.start.line<r.line&&s.end.line>r.line)return s.component}}return null}var Sv=Symbol("ADD_OWNER");function bc(t,e){if(e.owners!==null)for(;t;){if(t.owners===null){e.owners=null;break}for(let r of t.owners)e.owners.add(r);t=t.parent}}function wd(t,e){return t.owners===null?!0:t.owners.has(e)||t.parent!==null&&wd(t.parent,e)}function xd(t){return t?.owners?.values().next().value??xd(t.parent)}var Av=!1;function Ed(t){if(Av)return;let e=bd();if(e&&!wd(t,e)){let r=xd(t);r[Rt]!==e[Rt]?yc(e[Rt],r[Rt]):yc()}}function xa(t){return t===this.v}function as(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function oo(t){return!as(t,this.v)}function wc(){if(!1){let t=new Error("bind_invalid_checkbox_value\nUsing `bind:value` together with a checkbox input is not allowed. Use `bind:checked` instead");throw t.name="Svelte error",t}else throw new Error("bind_invalid_checkbox_value")}function kd(){if(!1){let t=new Error(`derived_references_self
A derived value cannot reference itself recursively`);throw t.name="Svelte error",t}else throw new Error("derived_references_self")}function $d(t){if(!1){let e=new Error(`effect_in_teardown
\`${t}\` cannot be used inside an effect cleanup function`);throw e.name="Svelte error",e}else throw new Error("effect_in_teardown")}function Cd(){if(!1){let t=new Error("effect_in_unowned_derived\nEffect cannot be created inside a `$derived` value that was not itself created inside an effect");throw t.name="Svelte error",t}else throw new Error("effect_in_unowned_derived")}function Sd(t){if(!1){let e=new Error(`effect_orphan
\`${t}\` can only be used inside an effect (e.g. during component initialisation)`);throw e.name="Svelte error",e}else throw new Error("effect_orphan")}function xc(){if(!1){let t=new Error(`effect_update_depth_exceeded
Maximum update depth exceeded. This can happen when a reactive block or effect repeatedly sets a new value. Svelte limits the number of nested updates to prevent infinite loops`);throw t.name="Svelte error",t}else throw new Error("effect_update_depth_exceeded")}function Ad(){if(!1){let t=new Error(`hydration_failed
Failed to hydrate the application`);throw t.name="Svelte error",t}else throw new Error("hydration_failed")}function Pd(t){if(!1){let e=new Error(`props_invalid_value
Cannot do \`bind:${t}={undefined}\` when \`${t}\` has a fallback value`);throw e.name="Svelte error",e}else throw new Error("props_invalid_value")}function Id(t){if(!1){let e=new Error(`rune_outside_svelte
The \`${t}\` rune is only available inside \`.svelte\` and \`.svelte.js/ts\` files`);throw e.name="Svelte error",e}else throw new Error("rune_outside_svelte")}function Rd(){if(!1){let t=new Error("state_descriptors_fixed\nProperty descriptors defined on `$state` objects must contain `value` and always be `enumerable`, `configurable` and `writable`.");throw t.name="Svelte error",t}else throw new Error("state_descriptors_fixed")}function Td(){if(!1){let t=new Error("state_prototype_fixed\nCannot set prototype of `$state` object");throw t.name="Svelte error",t}else throw new Error("state_prototype_fixed")}function Od(){if(!1){let t=new Error("state_unsafe_local_read\nReading state that was created inside the same derived is forbidden. Consider using `untrack` to read locally created state");throw t.name="Svelte error",t}else throw new Error("state_unsafe_local_read")}function Nd(){if(!1){let t=new Error("state_unsafe_mutation\nUpdating state inside a derived or a template expression is forbidden. If the value should not be reactive, declare it without `$state`");throw t.name="Svelte error",t}else throw new Error("state_unsafe_mutation")}var Rr=!1;function Dd(){Rr=!0}var ti=new Set;function kc(t){ti=t}function He(t){return{f:0,v:t,reactions:null,equals:xa,version:0}}function tt(t){return Pv(He(t))}function yr(t,e=!1){let r=He(t);return e||(r.equals=oo),Rr&&Ee!==null&&Ee.l!==null&&(Ee.l.s??=[]).push(r),r}function Pv(t){return Ae!==null&&Ae.f&2&&(gr===null?Md([t]):gr.push(t)),t}function le(t,e){return Ae!==null&&Ur()&&Ae.f&18&&(gr===null||!gr.includes(t))&&Nd(),gn(t,e)}function gn(t,e){if(!t.equals(e)&&(t.v=e,t.version=Ea(),Fd(t,1024),Ur()&&me!==null&&me.f&512&&!(me.f&32)&&(yt!==null&&yt.includes(t)?(Ot(me,1024),lo(me)):Vr===null?Ld([t]):Vr.push(t)),!1)){let n=Array.from(ti);var r=zr;so(!0);try{for(let s of n)s.f&512&&Ot(s,2048),yn(s)&&ri(s)}finally{so(r)}ti.clear()}return e}function Fd(t,e){var r=t.reactions;if(r!==null)for(var n=Ur(),s=r.length,l=0;l<s;l++){var f=r[l],p=f.f;if(!(p&1024)&&!(!n&&f===me)){if(!1){ti.add(f);continue}Ot(f,e),p&640&&(p&2?Fd(f,2048):lo(f))}}}function xe(t){var e=1026;me===null?e|=128:me.f|=524288;let r={children:null,ctx:Ee,deps:null,equals:xa,f:e,fn:t,reactions:null,v:null,version:0,parent:me};if(Ae!==null&&Ae.f&2){var n=Ae;(n.children??=[]).push(r)}return r}function Ac(t){let e=xe(t);return e.equals=oo,e}function Cc(t){var e=t.children;if(e!==null){t.children=null;for(var r=0;r<e.length;r+=1){var n=e[r];n.f&2?ls(n):Vt(n)}}}var $c=[];function Pc(t){var e,r=me;if(it(t.parent),!1){let n=ti;kc(new Set);try{$c.includes(t)&&kd(),$c.push(t),Cc(t),e=ka(t)}finally{it(r),kc(n),$c.pop()}}else try{Cc(t),e=ka(t)}finally{it(r)}return e}function Ic(t){var e=Pc(t),r=(bn||t.f&128)&&t.deps!==null?2048:512;Ot(t,r),t.equals(e)||(t.v=e,t.version=Ea())}function ls(t){Cc(t),ii(t,0),Ot(t,8192),t.v=t.children=t.deps=t.ctx=t.reactions=null}function $a(t){if(!1){let e=new Error(`lifecycle_outside_component
\`${t}(...)\` can only be used during component initialisation`);throw e.name="Svelte error",e}else throw new Error("lifecycle_outside_component")}var Wd=0,Ov=1,Bd=new WeakSet,Ca=Wd,cs=!1,zr=!1,Pa=!1;function so(t){zr=t}function Tc(t){Pa=t}var oi=[],co=0,us=[],Ae=null;function St(t){Ae=t}var me=null;function it(t){me=t}var gr=null;function Md(t){gr=t}var yt=null,zt=0,Vr=null;function Ld(t){Vr=t}var jd=0,bn=!1,Aa=null,Ee=null;function Oc(t){Ee=t}var qt=null;function Ia(t){qt=t}function Ea(){return++jd}function Ur(){return!Rr||Ee!==null&&Ee.l===null}function yn(t){var e=t.f;if(e&1024)return!0;if(e&2048){var r=t.deps,n=(e&128)!==0;if(r!==null){var s;if(e&256){for(s=0;s<r.length;s++)(r[s].reactions??=[]).push(t);t.f^=256}for(s=0;s<r.length;s++){var l=r[s];if(yn(l)&&Ic(l),n&&me!==null&&!bn&&!l?.reactions?.includes(t)&&(l.reactions??=[]).push(t),l.version>t.version)return!0}}n||Ot(t,512)}return!1}function Nv(t,e,r){if(!!1||Bd.has(t)||r===null)throw t;let n=[],s=e.fn?.name;s&&n.push(s);let l=r;for(;l!==null;){if(!1){var f=l.function?.[Rt];if(f){let _=f.split("/").pop();n.push(_)}}l=l.p}let p=/Firefox/.test(navigator.userAgent)?"  ":"	";rr(t,"message",{value:t.message+`
${n.map(_=>`
${p}in ${_}`).join("")}
`});let m=t.stack;if(m){let _=m.split(`
`),b=[];for(let y=0;y<_.length;y++){let x=_[y];x.includes("svelte/src/internal")||b.push(x)}rr(t,"stack",{value:t.stack+b.join(`
`)})}throw Bd.add(t),t}function ka(t){var e=yt,r=zt,n=Vr,s=Ae,l=bn,f=gr,p=Ee,m=t.f;yt=null,zt=0,Vr=null,Ae=m&96?null:t,bn=!zr&&(m&128)!==0,gr=null,Ee=t.ctx;try{var _=(0,t.fn)(),b=t.deps;if(yt!==null){var y;if(ii(t,zt),b!==null&&zt>0)for(b.length=zt+yt.length,y=0;y<yt.length;y++)b[zt+y]=yt[y];else t.deps=b=yt;if(!bn)for(y=zt;y<b.length;y++)(b[y].reactions??=[]).push(t)}else b!==null&&zt<b.length&&(ii(t,zt),b.length=zt);return _}finally{yt=e,zt=r,Vr=n,Ae=s,bn=l,gr=f,Ee=p}}function Dv(t,e){let r=e.reactions;if(r!==null){var n=r.indexOf(t);if(n!==-1){var s=r.length-1;s===0?r=e.reactions=null:(r[n]=r[s],r.pop())}}r===null&&e.f&2&&(yt===null||!yt.includes(e))&&(Ot(e,2048),e.f&384||(e.f^=256),ii(e,0))}function ii(t,e){var r=t.deps;if(r!==null)for(var n=e;n<r.length;n++)Dv(t,r[n])}function ri(t){var e=t.f;if(!(e&8192)){Ot(t,512);var r=me,n=Ee;if(me=t,!1){var s=qt;qt=t.component_function}try{e&16?Ud(t):Fc(t),Dc(t),Nc(t);var l=ka(t);t.teardown=typeof l=="function"?l:null,t.version=jd,!1}catch(f){Nv(f,t,n)}finally{me=r,!1}}}function qd(){if(co>1e3)if(co=0,!1)try{xc()}catch(t){throw rr(t,"stack",{value:""}),console.error("Last ten effects were: ",us.slice(-10).map(e=>e.fn)),us=[],t}else xc();co++}function Vd(t){var e=t.length;if(e!==0){qd();var r=zr;zr=!0;try{for(var n=0;n<e;n++){var s=t[n];s.f&512||(s.f^=512);var l=[];zd(s,l),Fv(l)}}finally{zr=r}}}function Fv(t){var e=t.length;if(e!==0)for(var r=0;r<e;r++){var n=t[r];!(n.f&12288)&&yn(n)&&(ri(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null?Mc(n):n.fn=null))}}function Mv(){if(cs=!1,co>1001)return;let t=oi;oi=[],Vd(t),cs||(co=0,!1)}function lo(t){Ca===Wd&&(cs||(cs=!0,queueMicrotask(Mv)));for(var e=t;e.parent!==null;){e=e.parent;var r=e.f;if(r&96){if(!(r&512))return;e.f^=512}}oi.push(e)}function zd(t,e){var r=t.first,n=[];e:for(;r!==null;){var s=r.f,l=(s&32)!==0,f=l&&(s&512)!==0;if(!f&&!(s&4096))if(s&8){l?r.f^=512:yn(r)&&ri(r);var p=r.first;if(p!==null){r=p;continue}}else s&4&&n.push(r);var m=r.next;if(m===null){let y=r.parent;for(;y!==null;){if(t===y)break e;var _=y.next;if(_!==null){r=_;continue e}y=y.parent}}r=m}for(var b=0;b<n.length;b++)p=n[b],e.push(p),zd(p,e)}function ai(t){var e=Ca,r=oi;try{qd();let s=[];Ca=Ov,oi=s,cs=!1,Vd(r);var n=t?.();return vd(),(oi.length>0||s.length>0)&&ai(),co=0,!1,n}finally{Ca=e,oi=r}}function A(t){var e=t.f,r=(e&2)!==0;if(r&&e&8192){var n=Pc(t);return ls(t),n}if(Aa!==null&&Aa.add(t),Ae!==null){gr!==null&&gr.includes(t)&&Od();var s=Ae.deps;yt===null&&s!==null&&s[zt]===t?zt++:yt===null?yt=[t]:yt.push(t),Vr!==null&&me!==null&&me.f&512&&!(me.f&32)&&Vr.includes(t)&&(Ot(me,1024),lo(me))}else if(r&&t.deps===null){var l=t,f=l.parent;f!==null&&!f.deriveds?.includes(l)&&(f.deriveds??=[]).push(l)}return r&&(l=t,yn(l)&&Ic(l)),t.v}function lt(t){let e=Ae;try{return Ae=null,t()}finally{Ae=e}}var Lv=-3585;function Ot(t,e){t.f=t.f&Lv|e}function Fe(t,e=!1,r){Ee={p:Ee,c:null,e:null,m:!1,s:t,x:null,l:null},Rr&&!e&&(Ee.l={s:null,u:null,r1:[],r2:He(!1)}),!1}function Me(t){let e=Ee;if(e!==null){t!==void 0&&(e.x=t);let f=e.e;if(f!==null){var r=me,n=Ae;e.e=null;try{for(var s=0;s<f.length;s++){var l=f[s];it(l.effect),St(l.reaction),cr(l.fn)}}finally{it(r),St(n)}}Ee=e.p,!1,e.m=!0}return t||{}}if(!1){let t=function(e){if(!(e in globalThis)){let r;Object.defineProperty(globalThis,e,{configurable:!0,get:()=>{if(r!==void 0)return r;Id(e)},set:n=>{r=n}})}};t("$state"),t("$effect"),t("$derived"),t("$inspect"),t("$props"),t("$bindable")}var fe=!1;function Bt(t){fe=t}var we;function rt(t){if(t===null)throw no(),_n;return we=t}function bt(){return rt(Nt(we))}function B(t){if(fe){if(Nt(we)!==null)throw no(),_n;we=t}}function fs(){for(var t=0,e=we;;){if(e.nodeType===8){var r=e.data;if(r===ei){if(t===0)return e;t-=1}else(r===io||r===Zn)&&(t+=1)}var n=Nt(e);e.remove(),e=n}}function qe(t,e=null,r){if(typeof t!="object"||t===null||ir in t)return t;let n=vn(t);if(n!==_c&&n!==ud)return t;var s=new Map,l=vr(t),f=He(0);l&&s.set("length",He(t.length));var p;if(!1)if(p={parent:e,owners:null},r){let m=r.v?.[Gn]?.owners;p.owners=m?new Set(m):null}else p.owners=e===null?Ee!==null?new Set([Ee.function]):null:new Set;return new Proxy(t,{defineProperty(m,_,b){(!("value"in b)||b.configurable===!1||b.enumerable===!1||b.writable===!1)&&Rd();var y=s.get(_);return y===void 0?(y=He(b.value),s.set(_,y)):le(y,qe(b.value,p)),!0},deleteProperty(m,_){var b=s.get(_);if(b===void 0)_ in m&&s.set(_,He(Ct));else{if(l&&typeof _=="string"){var y=s.get("length"),x=Number(_);Number.isInteger(x)&&x<y.v&&le(y,x)}le(b,Ct),Hd(f)}return!0},get(m,_,b){if(!1)return p;if(_===ir)return t;var y=s.get(_),x=_ in m;if(y===void 0&&(!x||nr(m,_)?.writable)&&(y=He(qe(x?m[_]:Ct,p)),s.set(_,y)),y!==void 0){var $=A(y);if(!1){var P=$?.[Gn];P&&P?.parent!==p&&bc(p,P)}return $===Ct?void 0:$}return Reflect.get(m,_,b)},getOwnPropertyDescriptor(m,_){var b=Reflect.getOwnPropertyDescriptor(m,_);if(b&&"value"in b){var y=s.get(_);y&&(b.value=A(y))}else if(b===void 0){var x=s.get(_),$=x?.v;if(x!==void 0&&$!==Ct)return{enumerable:!0,configurable:!0,value:$,writable:!0}}return b},has(m,_){if(_===ir)return!0;var b=s.get(_),y=b!==void 0&&b.v!==Ct||Reflect.has(m,_);if(b!==void 0||me!==null&&(!y||nr(m,_)?.writable)){b===void 0&&(b=He(y?qe(m[_],p):Ct),s.set(_,b));var x=A(b);if(x===Ct)return!1}return y},set(m,_,b,y){var x=s.get(_),$=_ in m;if(l&&_==="length")for(var P=b;P<x.v;P+=1){var F=s.get(P+"");F!==void 0?le(F,Ct):P in m&&(F=He(Ct),s.set(P+"",F))}if(x===void 0?(!$||nr(m,_)?.writable)&&(x=He(void 0),le(x,qe(b,p)),s.set(_,x)):($=x.v!==Ct,le(x,qe(b,p))),!1){var j=b?.[Gn];j&&j?.parent!==p&&bc(p,j),Ed(p)}var z=Reflect.getOwnPropertyDescriptor(m,_);if(z?.set&&z.set.call(y,b),!$){if(l&&typeof _=="string"){var N=s.get("length"),H=Number(_);Number.isInteger(H)&&H>=N.v&&le(N,H+1)}Hd(f)}return!0},ownKeys(m){A(f);var _=Reflect.ownKeys(m).filter(x=>{var $=s.get(x);return $===void 0||$.v!==Ct});for(var[b,y]of s)y.v!==Ct&&!(b in m)&&_.push(b);return _},setPrototypeOf(){Td()}})}function Hd(t,e=1){le(t,t.v+e)}function li(t){return t!==null&&typeof t=="object"&&ir in t?t[ir]:t}function Yd(){let t=Array.prototype,e=Array.__svelte_cleanup;e&&e();let{indexOf:r,lastIndexOf:n,includes:s}=t;t.indexOf=function(l,f){let p=r.call(this,l,f);return p===-1&&r.call(li(this),li(l),f)!==-1&&ba("array.indexOf(...)"),p},t.lastIndexOf=function(l,f){let p=n.call(this,l,f??this.length-1);return p===-1&&n.call(li(this),li(l),f??this.length-1)!==-1&&ba("array.lastIndexOf(...)"),p},t.includes=function(l,f){let p=s.call(this,l,f);return p||s.call(li(this),li(l),f)&&ba("array.includes(...)"),p},Array.__svelte_cleanup=()=>{t.indexOf=r,t.lastIndexOf=n,t.includes=s}}var Lc,Qd,Jd,Xd;function Ra(){if(Lc===void 0){Lc=window,Qd=document;var t=Element.prototype,e=Node.prototype;Jd=nr(e,"firstChild").get,Xd=nr(e,"nextSibling").get,t.__click=void 0,t.__className="",t.__attributes=null,t.__styles=null,t.__e=void 0,Text.prototype.__t=void 0,!1}}function ur(t=""){return document.createTextNode(t)}function Ge(t){return Jd.call(t)}function Nt(t){return Xd.call(t)}function W(t,e){if(!fe)return Ge(t);var r=Ge(we);if(r===null)r=we.appendChild(ur());else if(e&&r.nodeType!==3){var n=ur();return r?.before(n),rt(n),n}return rt(r),r}function Ze(t,e){if(!fe){var r=Ge(t);return r instanceof Comment&&r.data===""?Nt(r):r}if(e&&we?.nodeType!==3){var n=ur();return we?.before(n),rt(n),n}return we}function Y(t,e=1,r=!1){let n=fe?we:t;for(;e--;)n=Nt(n);if(!fe)return n;var s=n.nodeType;if(r&&s!==3){var l=ur();return n?.before(l),rt(l),l}return rt(n),n}function fo(t){t.textContent=""}function ep(t){me===null&&Ae===null&&Sd(t),Ae!==null&&Ae.f&128&&Cd(),Pa&&$d(t)}function Bv(t,e){var r=e.last;r===null?e.last=e.first=t:(r.next=t,t.prev=r,e.last=t)}function po(t,e,r,n=!0){var s=(t&64)!==0,l=me;if(!1)for(;l!==null&&l.f&131072;)l=l.parent;var f={ctx:Ee,deps:null,deriveds:null,nodes_start:null,nodes_end:null,f:t|1024,first:null,fn:e,last:null,next:null,parent:s?null:l,prev:null,teardown:null,transitions:null,version:0};if(!1,r){var p=zr;try{so(!0),ri(f),f.f|=16384}catch(b){throw Vt(f),b}finally{so(p)}}else e!==null&&lo(f);var m=r&&f.deps===null&&f.first===null&&f.nodes_start===null&&f.teardown===null&&(f.f&524288)===0;if(!m&&!s&&n&&(l!==null&&Bv(f,l),Ae!==null&&Ae.f&2)){var _=Ae;(_.children??=[]).push(f)}return f}function Ut(t){let e=po(8,null,!1);return Ot(e,512),e.teardown=t,e}function Ht(t){ep("$effect");var e=me!==null&&(me.f&32)!==0&&Ee!==null&&!Ee.m;if(!1,e){var r=Ee;(r.e??=[]).push({fn:t,effect:me,reaction:Ae})}else{var n=cr(t);return n}}function ho(t){let e=po(64,t,!0);return()=>{Vt(e)}}function cr(t){return po(4,t,!1)}function Tt(t){return po(8,t,!0)}function ke(t){return!1,Kt(t)}function Kt(t,e=0){return po(24|e,t,!0)}function ct(t,e=!0){return po(40,t,!0,e)}function Nc(t){var e=t.teardown;if(e!==null){let r=Pa,n=Ae;Tc(!0),St(null);try{e.call(null)}finally{Tc(r),St(n)}}}function Dc(t){var e=t.deriveds;if(e!==null){t.deriveds=null;for(var r=0;r<e.length;r+=1)ls(e[r])}}function Fc(t,e=!1){var r=t.first;for(t.first=t.last=null;r!==null;){var n=r.next;Vt(r,e),r=n}}function Ud(t){for(var e=t.first;e!==null;){var r=e.next;e.f&32||Vt(e),e=r}}function Vt(t,e=!0){var r=!1;if((e||t.f&262144)&&t.nodes_start!==null){for(var n=t.nodes_start,s=t.nodes_end;n!==null;){var l=n===s?null:Nt(n);n.remove(),n=l}r=!0}Fc(t,e&&!r),Dc(t),ii(t,0),Ot(t,8192);var f=t.transitions;if(f!==null)for(let m of f)m.stop();Nc(t);var p=t.parent;p!==null&&p.first!==null&&Mc(t),!1,t.next=t.prev=t.teardown=t.ctx=t.deps=t.parent=t.fn=t.nodes_start=t.nodes_end=null}function Mc(t){var e=t.parent,r=t.prev,n=t.next;r!==null&&(r.next=n),n!==null&&(n.prev=r),e!==null&&(e.first===t&&(e.first=n),e.last===t&&(e.last=r))}function fr(t,e){var r=[];Ta(t,r,!0),Bc(r,()=>{Vt(t),e&&e()})}function Bc(t,e){var r=t.length;if(r>0){var n=()=>--r||e();for(var s of t)s.out(n)}else e()}function Ta(t,e,r){if(!(t.f&4096)){if(t.f^=4096,t.transitions!==null)for(let f of t.transitions)(f.is_global||r)&&e.push(f);for(var n=t.first;n!==null;){var s=n.next,l=(n.f&32768)!==0||(n.f&32)!==0;Ta(n,e,l?r:!1),n=s}}}function br(t){tp(t,!0)}function tp(t,e){if(t.f&4096){yn(t)&&ri(t),t.f^=4096;for(var r=t.first;r!==null;){var n=r.next,s=(r.f&32768)!==0||(r.f&32)!==0;tp(r,s?e:!1),r=n}if(t.transitions!==null)for(let l of t.transitions)(l.is_global||e)&&l.in()}}function Oa(t,e){if(e){let r=document.body;t.autofocus=!0,Mt(()=>{document.activeElement===r&&t.focus()})}}function Kc(t){fe&&Ge(t)!==null&&fo(t)}var rp=!1;function Wc(){rp||(rp=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(let e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function Na(t){var e=Ae,r=me;St(null),it(null);try{return t()}finally{St(e),it(r)}}function jc(t,e,r,n=r){t.addEventListener(e,()=>Na(r));let s=t.__on_r;s?t.__on_r=()=>{s(),n()}:t.__on_r=n,Wc()}var qc=new Set,Da=new Set;function np(t,e,r,n){function s(l){if(n.capture||mo.call(e,l),!l.cancelBubble)return Na(()=>r.call(this,l))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Mt(()=>{e.addEventListener(t,s,n)}):e.addEventListener(t,s,n),s}function Vc(t,e,r,n,s){var l={capture:n,passive:s},f=np(t,e,r,l);(e===document.body||e===window||e===document)&&Ut(()=>{e.removeEventListener(t,f,l)})}function ot(t){for(var e=0;e<t.length;e++)qc.add(t[e]);for(var r of Da)r(t)}function mo(t){var e=this,r=e.ownerDocument,n=t.type,s=t.composedPath?.()||[],l=s[0]||t.target,f=0,p=t.__root;if(p){var m=s.indexOf(p);if(m!==-1&&(e===document||e===window)){t.__root=e;return}var _=s.indexOf(e);if(_===-1)return;m<=_&&(f=m)}if(l=s[f]||t.target,l!==e){rr(t,"currentTarget",{configurable:!0,get(){return l||r}});var b=Ae,y=me;St(null),it(null);try{for(var x,$=[];l!==null;){var P=l.assignedSlot||l.parentNode||l.host||null;try{var F=l["__"+n];if(F!==void 0&&!l.disabled)if(vr(F)){var[j,...z]=F;j.apply(l,[t,...z])}else F.call(l,t)}catch(N){x?$.push(N):x=N}if(t.cancelBubble||P===e||P===null)break;l=P}if(x){for(let N of $)queueMicrotask(()=>{throw N});throw x}}finally{t.__root=e,delete t.currentTarget,St(b),it(y)}}}var Kv;function ip(){Kv=void 0}function ds(t){var e=document.createElement("template");return e.innerHTML=t,e.content}function Yt(t,e){var r=me;r.nodes_start===null&&(r.nodes_start=t,r.nodes_end=e)}function ne(t,e){var r=(e&1)!==0,n=(e&2)!==0,s,l=!t.startsWith("<!>");return()=>{if(fe)return Yt(we,null),we;s===void 0&&(s=ds(l?t:"<!>"+t),r||(s=Ge(s)));var f=n?document.importNode(s,!0):s.cloneNode(!0);if(r){var p=Ge(f),m=f.lastChild;Yt(p,m)}else Yt(f,f);return f}}function zc(t,e,r="svg"){var n=!t.startsWith("<!>"),s=(e&1)!==0,l=`<${r}>${n?t:"<!>"+t}</${r}>`,f;return()=>{if(fe)return Yt(we,null),we;if(!f){var p=ds(l),m=Ge(p);if(s)for(f=document.createDocumentFragment();Ge(m);)f.appendChild(Ge(m));else f=Ge(m)}var _=f.cloneNode(!0);if(s){var b=Ge(_),y=_.lastChild;Yt(b,y)}else Yt(_,_);return _}}function wr(){if(fe)return Yt(we,null),we;var t=document.createDocumentFragment(),e=document.createComment(""),r=ur();return t.append(e,r),Yt(e,r),t}function X(t,e){if(fe){me.nodes_end=we,bt();return}t!==null&&t.before(e)}var jv=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected","webkitdirectory"];var _x=[...jv,"formNoValidate","isMap","noModule","playsInline","readOnly","value","inert","volume"];var qv=["touchstart","touchmove"];function sp(t){return qv.includes(t)}var Uc=!0;function Le(t,e){var r=e==null?"":typeof e=="object"?e+"":e;r!==(t.__t??=t.nodeValue)&&(t.__t=r,t.nodeValue=r==null?"":r+"")}function Nr(t,e){return ap(t,e)}function Yc(t,e){Ra(),e.intro=e.intro??!1;let r=e.target,n=fe,s=we;try{for(var l=Ge(r);l&&(l.nodeType!==8||l.data!==io);)l=Nt(l);if(!l)throw _n;Bt(!0),rt(l),bt();let f=ap(t,{...e,anchor:l});if(we===null||we.nodeType!==8||we.data!==ei)throw no(),_n;return Bt(!1),f}catch(f){if(f===_n)return e.recover===!1&&Ad(),Ra(),fo(r),Bt(!1),Nr(t,e);throw f}finally{Bt(n),rt(s),ip()}}var vo=new Map;function ap(t,{target:e,anchor:r,props:n={},events:s,context:l,intro:f=!0}){Ra();var p=new Set,m=y=>{for(var x=0;x<y.length;x++){var $=y[x];if(!p.has($)){p.add($);var P=sp($);e.addEventListener($,mo,{passive:P});var F=vo.get($);F===void 0?(document.addEventListener($,mo,{passive:P}),vo.set($,1)):vo.set($,F+1)}}};m(is(qc)),Da.add(m);var _=void 0,b=ho(()=>{var y=r??e.appendChild(ur());return ct(()=>{if(l){Fe({});var x=Ee;x.c=l}s&&(n.$$events=s),fe&&Yt(y,null),Uc=f,_=t(y,n)||{},Uc=!0,fe&&(me.nodes_end=we),l&&Me()}),()=>{for(var x of p){e.removeEventListener(x,mo);var $=vo.get(x);--$===0?(document.removeEventListener(x,mo),vo.delete(x)):vo.set(x,$)}Da.delete(m),Hc.delete(_),y!==r&&y.parentNode?.removeChild(y)}});return Hc.set(_,b),_}var Hc=new WeakMap;function Yr(t){let e=Hc.get(t);e?e():!1}var Qc=0,Fa=1,Jc=2;function Xc(t,e,r,n,s){fe&&bt();var l=t,f=Ur(),p=Ee,m=null,_,b,y,x,$=(f?He:yr)(void 0),P=(f?He:yr)(void 0),F=!1;function j(N,H){F=!0,H&&(it(z),St(z),Oc(p),!1);try{N===Qc&&r&&(b?br(b):b=ct(()=>r(l))),N===Fa&&n&&(y?br(y):y=ct(()=>n(l,$))),N===Jc&&s&&(x?br(x):x=ct(()=>s(l,P))),N!==Qc&&b&&fr(b,()=>b=null),N!==Fa&&y&&fr(y,()=>y=null),N!==Jc&&x&&fr(x,()=>x=null)}finally{H&&(!1,Oc(null),St(null),it(null),ai())}}var z=Kt(()=>{if(_!==(_=e())){if(fd(_)){var N=_;F=!1,N.then(H=>{N===_&&(gn($,H),j(Fa,!0))},H=>{if(N===_&&(gn(P,H),j(Jc,!0),!s))throw P.v}),fe?r&&(b=ct(()=>r(l))):Mt(()=>{F||j(Qc,!0)})}else gn($,_),j(Fa,!1);return()=>_=null}});fe&&(l=we)}function Se(t,e,r,n=null,s=!1){fe&&bt();var l=t,f=null,p=null,m=null,_=s?32768:0;Kt(()=>{if(m===(m=!!e()))return;let b=!1;if(fe){let y=l.data===Zn;m===y&&(l=fs(),rt(l),Bt(!1),b=!0)}m?(f?br(f):f=ct(()=>r(l)),p&&fr(p,()=>{p=null})):(p?br(p):n&&(p=ct(()=>n(l))),f&&fr(f,()=>{f=null})),b&&Bt(!0)},_),fe&&(l=we)}var ps=null;function Qr(t,e){return e}function Hv(t,e,r,n){for(var s=[],l=e.length,f=0;f<l;f++)Ta(e[f].e,s,!0);var p=l>0&&s.length===0&&r!==null;if(p){var m=r.parentNode;fo(m),m.append(r),n.clear(),wn(t,e[0].prev,e[l-1].next)}Bc(s,()=>{for(var _=0;_<l;_++){var b=e[_];p||(n.delete(b.k),wn(t,b.prev,b.next)),Vt(b.e,!p)}})}function wt(t,e,r,n,s,l=null){var f=t,p={flags:e,items:new Map,first:null},m=(e&4)!==0;if(m){var _=t;f=fe?rt(Ge(_)):_.appendChild(ur())}fe&&bt();var b=null,y=!1;Kt(()=>{var x=r(),$=vr(x)?x:x==null?[]:is(x),P=$.length;if(y&&P===0)return;y=P===0;let F=!1;if(fe){var j=f.data===Zn;j!==(P===0)&&(f=fs(),rt(f),Bt(!1),F=!0)}if(fe){for(var z=null,N,H=0;H<P;H++){if(we.nodeType===8&&we.data===ei){f=we,F=!0,Bt(!1);break}var V=$[H],Q=n(V,H);N=dp(we,p,z,null,V,Q,H,s,e),p.items.set(Q,N),z=N}P>0&&rt(fs())}if(!fe){var G=Ae;Yv($,p,f,s,e,(G.f&4096)!==0,n)}l!==null&&(P===0?b?br(b):b=ct(()=>l(f)):b!==null&&fr(b,()=>{b=null})),F&&Bt(!0),r()}),fe&&(f=we)}function Yv(t,e,r,n,s,l,f){var p=(s&8)!==0,m=(s&3)!==0,_=t.length,b=e.items,y=e.first,x=y,$,P=null,F,j=[],z=[],N,H,V,Q;if(p)for(Q=0;Q<_;Q+=1)N=t[Q],H=f(N,Q),V=b.get(H),V!==void 0&&(V.a?.measure(),(F??=new Set).add(V));for(Q=0;Q<_;Q+=1){if(N=t[Q],H=f(N,Q),V=b.get(H),V===void 0){var G=x?x.e.nodes_start:r;P=dp(G,e,P,P===null?e.first:P.next,N,H,Q,n,s),b.set(H,P),j=[],z=[],x=P.next;continue}if(m&&Qv(V,N,Q,s),V.e.f&4096&&(br(V.e),p&&(V.a?.unfix(),(F??=new Set).delete(V))),V!==x){if($!==void 0&&$.has(V)){if(j.length<z.length){var J=z[0],U;P=J.prev;var ue=j[0],ge=j[j.length-1];for(U=0;U<j.length;U+=1)up(j[U],J,r);for(U=0;U<z.length;U+=1)$.delete(z[U]);wn(e,ue.prev,ge.next),wn(e,P,ue),wn(e,ge,J),x=J,P=ge,Q-=1,j=[],z=[]}else $.delete(V),up(V,x,r),wn(e,V.prev,V.next),wn(e,V,P===null?e.first:P.next),wn(e,P,V),P=V;continue}for(j=[],z=[];x!==null&&x.k!==H;)(l||!(x.e.f&4096))&&($??=new Set).add(x),z.push(x),x=x.next;if(x===null)continue;V=x}j.push(V),P=V,x=V.next}if(x!==null||$!==void 0){for(var $e=$===void 0?[]:is($);x!==null;)(l||!(x.e.f&4096))&&$e.push(x),x=x.next;var ye=$e.length;if(ye>0){var Re=s&4&&_===0?r:null;if(p){for(Q=0;Q<ye;Q+=1)$e[Q].a?.measure();for(Q=0;Q<ye;Q+=1)$e[Q].a?.fix()}Hv(e,$e,Re,b)}}p&&Mt(()=>{if(F!==void 0)for(V of F)V.a?.apply()}),me.first=e.first&&e.first.e,me.last=P&&P.e}function Qv(t,e,r,n){n&1&&gn(t.v,e),n&2?gn(t.i,r):t.i=r}function dp(t,e,r,n,s,l,f,p,m){var _=ps,b=(m&1)!==0,y=(m&16)===0,x=b?y?yr(s):He(s):s,$=m&2?He(f):f,P={i:$,v:x,k:l,a:null,e:null,prev:r,next:n};ps=P;try{return P.e=ct(()=>p(t,x,$),fe),P.e.prev=r&&r.e,P.e.next=n&&n.e,r===null?e.first=P:(r.next=P,r.e.next=P.e),n!==null&&(n.prev=P,n.e.prev=P.e),P}finally{ps=_}}function up(t,e,r){for(var n=t.next?t.next.e.nodes_start:r,s=e?e.e.nodes_start:r,l=t.e.nodes_start;l!==n;){var f=Nt(l);s.before(l),l=f}}function wn(t,e,r){e===null?t.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}function eu(t,e,r,n,s){fe&&bt();var l=e.$$slots?.[r],f=!1;l===!0&&(l=e[r==="default"?"children":r],f=!0),l===void 0?s!==null&&s(t):l(t,f?()=>n:n)}function _o(t,e,r,n){var s=t.__attributes??={};if(fe&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")){n||Gv(t,e,r??"");return}s[e]!==(s[e]=r)&&(e==="style"&&"__styles"in t&&(t.__styles={}),e==="loading"&&(t[dd]=r),r==null?t.removeAttribute(e):typeof r!="string"&&Xv(t).includes(e)?t[e]=r:t.setAttribute(e,r))}var hp=new Map;function Xv(t){var e=hp.get(t.nodeName);if(e)return e;hp.set(t.nodeName,e=[]);for(var r,n=vn(t),s=Element.prototype;s!==n;){r=vc(n);for(var l in r)r[l].set&&e.push(l);n=vn(n)}return e}function Gv(t,e,r){!1}function tu(t,e){return t===e?!0:new URL(t,document.baseURI).href===new URL(e,document.baseURI).href}function mp(t){return t.split(",").map(e=>e.trim().split(" ").filter(Boolean))}function Zv(t,e){var r=mp(t.srcset),n=mp(e);return n.length===r.length&&n.every(([s,l],f)=>l===r[f][1]&&(tu(r[f][0],s)||tu(s,r[f][0])))}function ru(t,e){var r=t.__className,n=vp(e);fe&&t.getAttribute("class")===n?t.__className=n:(r!==n||fe&&t.getAttribute("class")!==n)&&(n===""?t.removeAttribute("class"):t.setAttribute("class",n),t.__className=n)}function xr(t,e){var r=t.__className,n=vp(e);fe&&t.className===n?t.__className=n:(r!==n||fe&&t.className!==n)&&(e==null?t.removeAttribute("class"):t.className=n,t.__className=n)}function vp(t){return t??""}function nu(t,e,r=e){var n=Ur();jc(t,"input",()=>{!1;var s=_p(t)?gp(t.value):t.value;r(s),n&&s!==(s=e())&&(t.value=s??"")}),Tt(()=>{!1;var s=e();if(fe&&t.defaultValue!==t.value){r(t.value);return}_p(t)&&s===gp(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function _p(t){var e=t.type;return e==="number"||e==="range"}function gp(t){return t===""?null:+t}function yp(t,e){return t===e||t?.[ir]===e}function Jr(t={},e,r,n){return cr(()=>{var s,l;return Tt(()=>{s=l,l=n?.()||[],lt(()=>{t!==r(...l)&&(e(t,...l),s&&yp(r(...s),t)&&e(null,...s))})}),()=>{Mt(()=>{l&&yp(r(...l),t)&&e(null,...l)})}}),t}var La=!1;function Ve(t,e,r){let n=r[e]??={store:null,source:yr(void 0),unsubscribe:gt};if(n.store!==t)if(n.unsubscribe(),n.store=t??null,t==null)n.source.v=void 0,n.unsubscribe=gt;else{var s=!0;n.unsubscribe=hs(t,l=>{s?n.source.v=l:le(n.source,l)}),s=!1}return A(n.source)}function Er(){let t={};return Ut(()=>{for(var e in t)t[e].unsubscribe()}),t}function iu(t){var e=La;try{return La=!1,[t(),La]}finally{La=e}}function bp(t){for(var e=me,r=me;e!==null&&!(e.f&96);)e=e.parent;try{return it(e),t()}finally{it(r)}}function xn(t,e,r,n){var s=(r&1)!==0,l=!Rr||(r&2)!==0,f=(r&8)!==0,p=(r&16)!==0,m=!1,_;f?[_,m]=iu(()=>t[e]):_=t[e];var b=ir in t||ga in t,y=nr(t,e)?.set??(b&&f&&e in t?J=>t[e]=J:void 0),x=n,$=!0,P=!1,F=()=>(P=!0,$&&($=!1,p?x=lt(n):x=n),x);_===void 0&&n!==void 0&&(y&&l&&Pd(e),_=F(),y&&y(_));var j;if(l)j=()=>{var J=t[e];return J===void 0?F():($=!0,P=!1,J)};else{var z=bp(()=>(s?xe:Ac)(()=>t[e]));z.f|=65536,j=()=>{var J=A(z);return J!==void 0&&(x=void 0),J===void 0?x:J}}if(!(r&4))return j;if(y){var N=t.$$legacy;return function(J,U){return arguments.length>0?((!l||!U||N||m)&&y(U?j():J),J):j()}}var H=!1,V=!1,Q=yr(_),G=bp(()=>xe(()=>{var J=j(),U=A(Q);return H?(H=!1,V=!0,U):(V=!1,Q.v=J)}));return s||(G.equals=oo),function(J,U){if(Aa!==null&&(H=V,j(),A(Q)),arguments.length>0){let ue=U?A(G):l&&f?qe(J):J;return G.equals(ue)||(H=!0,le(Q,ue),P&&x!==void 0&&(x=ue),lt(()=>A(G))),J}return A(G)}}function wp(t){return new ou(t)}var ou=class{#t;#e;constructor(e){var r=new Map,n=(l,f)=>{var p=yr(f);return r.set(l,p),p};let s=new Proxy({...e.props||{},$$events:{}},{get(l,f){return A(r.get(f)??n(f,Reflect.get(l,f)))},has(l,f){return f===ga?!0:(A(r.get(f)??n(f,Reflect.get(l,f))),Reflect.has(l,f))},set(l,f,p){return le(r.get(f)??n(f,p),p),Reflect.set(l,f,p)}});this.#e=(e.hydrate?Yc:Nr)(e.component,{target:e.target,anchor:e.anchor,props:s,context:e.context,intro:e.intro??!1,recover:e.recover}),(!e?.props?.$$host||e.sync===!1)&&ai(),this.#t=s.$$events;for(let l of Object.keys(this.#e))l==="$set"||l==="$destroy"||l==="$on"||rr(this,l,{get(){return this.#e[l]},set(f){this.#e[l]=f},enumerable:!0});this.#e.$set=l=>{Object.assign(s,l)},this.#e.$destroy=()=>{Yr(this.#e)}}$set(e){this.#e.$set(e)}$on(e,r){this.#t[e]=this.#t[e]||[];let n=(...s)=>r.call(this,...s);return this.#t[e].push(n),()=>{this.#t[e]=this.#t[e].filter(s=>s!==n)}}$destroy(){this.#e.$destroy()}};var m_;typeof HTMLElement=="function"&&(m_=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;$$me;constructor(t,e,r){super(),this.$$ctor=t,this.$$s=e,r&&this.attachShadow({mode:"open"})}addEventListener(t,e,r){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let n=this.$$c.$on(t,e);this.$$l_u.set(e,n)}super.addEventListener(t,e,r)}removeEventListener(t,e,r){if(super.removeEventListener(t,e,r),this.$$c){let n=this.$$l_u.get(e);n&&(n(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(n){return s=>{let l=document.createElement("slot");n!=="default"&&(l.name=n),X(s,l)}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let e={},r=v_(this);for(let n of this.$$s)n in r&&(n==="default"&&!this.$$d.children?(this.$$d.children=t(n),e.default=!0):e[n]=t(n));for(let n of this.attributes){let s=this.$$g_p(n.name);s in this.$$d||(this.$$d[s]=su(s,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=wp({component:this.$$ctor,target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$host:this}}),this.$$me=ho(()=>{Tt(()=>{this.$$r=!0;for(let n of mc(this.$$c)){if(!this.$$p_d[n]?.reflect)continue;this.$$d[n]=this.$$c[n];let s=su(n,this.$$d[n],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,s)}this.$$r=!1})});for(let n in this.$$l)for(let s of this.$$l[n]){let l=this.$$c.$on(n,s);this.$$l_u.set(s,l)}this.$$l={}}}attributeChangedCallback(t,e,r){this.$$r||(t=this.$$g_p(t),this.$$d[t]=su(t,r,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$me(),this.$$c=void 0)})}$$g_p(t){return mc(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function su(t,e,r,n){let s=r[t]?.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!n||!r[t])return e;if(n==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}function v_(t){let e={};return t.childNodes.forEach(r=>{e[r.slot||"default"]=!0}),e}function Ep(t){Ee===null&&$a("onMount"),Rr&&Ee.l!==null?k_(Ee).m.push(t):Ht(()=>{let e=lt(t);if(typeof e=="function")return e})}function k_(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}function hs(t,e,r){if(t==null)return e(void 0),r&&r(void 0),gt;let n=lt(()=>t.subscribe(e,r));return n.unsubscribe?()=>n.unsubscribe():n}var go=[];function Ba(t,e){return{subscribe:kr(t,e).subscribe}}function kr(t,e=gt){let r=null,n=new Set;function s(p){if(as(t,p)&&(t=p,r)){let m=!go.length;for(let _ of n)_[1](),go.push(_,t);if(m){for(let _=0;_<go.length;_+=2)go[_][0](go[_+1]);go.length=0}}}function l(p){s(p(t))}function f(p,m=gt){let _=[p,m];return n.add(_),n.size===1&&(r=e(s,l)||gt),p(t),()=>{n.delete(_),n.size===0&&r&&(r(),r=null)}}return{set:s,update:l,subscribe:f}}function au(t,e,r){let n=!Array.isArray(t),s=n?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let l=e.length<2;return Ba(r,(f,p)=>{let m=!1,_=[],b=0,y=gt,x=()=>{if(b)return;y();let P=e(n?_[0]:_,f,p);l?f(P):y=typeof P=="function"?P:gt},$=s.map((P,F)=>hs(P,j=>{_[F]=j,b&=~(1<<F),m&&x()},()=>{b|=1<<F}));return m=!0,x(),function(){ro($),y(),m=!1}})}function Ka(t){let e;return hs(t,r=>e=r)(),e}var ms="category",kp="context",lu="LLM workspace";function Wa(t){if(!t)return!1;let e=t.frontmatter;return!e||!(ms in e)?!1:e[ms]instanceof Array?e[ms].includes(lu):e[ms]===lu}function cu(t){return!t||!t.frontmatter?null:kp in t.frontmatter?t.frontmatter[kp]:null}function Cp(t){return[".md",".txt",".markdown"].includes($p.default.extname(t))}function Sp(t){t||(t={}),t[ms]=lu}var ut=kr(),At=kr(),En=kr();async function vs(t,e){return t.noteDerivedData.get(e)}async function ja(t,e){return t.noteDerivedData.delete(e)}async function Ap(t,e,r){t.transaction("rw",t.noteDerivedData,async()=>{await vs(t,e)?await t.noteDerivedData.update(e,{summary:r}):await t.noteDerivedData.add({path:e,summary:r})})}async function Pp(t,e,r){t.transaction("rw",t.noteDerivedData,async()=>{await vs(t,e)?await t.noteDerivedData.update(e,{keyTopics:r}):await t.noteDerivedData.add({path:e,keyTopics:r})})}var qa=class{constructor(e,r,n){this.obsidianEventRefs=[];this.workspaces=[];this.onFileDelete=e=>{e instanceof uu.TFolder||setTimeout(async()=>await this.processFileDelete(e.path),0)};this.onFileRename=(e,r)=>{e instanceof uu.TFolder||setTimeout(async()=>await this.processFileMove(r,e.path),0)};this.onMetadataChange=(e,r,n)=>{let s=this.workspaces.find(l=>l.workspaceFile===e.path);if(s){if(!Wa(n)){setTimeout(async()=>await this.processWorkspaceDelete(e.path),0);return}let l=s.links,f=n.links?.map(_=>this.app.metadataCache.getFirstLinkpathDest(_.link,s.workspaceFile))?.filter(_=>_!==null)?.map(_=>_.path)??[],p=f.filter(_=>!l.includes(_)),m=l.filter(_=>!f.includes(_));if(p.length>0)for(let _ of p)setTimeout(async()=>await this.processWorkspaceLinkAdd(s.workspaceFile,_),0);if(m.length>0)for(let _ of m)setTimeout(async()=>await this.processWorkspaceLinkRemove(s.workspaceFile,_),0)}};this.processFileDelete=async e=>{this.isWorkspaceFile(e)?await this.processWorkspaceDelete(e):await this.vectorStore.deleteFiles(e),await ja(this.db,e)};this.processFileMove=async(e,r)=>{this.isWorkspaceFile(e)?this.db.transaction("rw",this.db.vectorStore,this.db.workspace,async()=>{await this.vectorStore.updateWorkspacePath(e,r),await this.db.workspace.where("workspaceFile").equals(e).modify(n=>{n.workspaceFile=r})}):this.db.transaction("rw",this.db.vectorStore,this.db.workspace,async()=>{await this.vectorStore.updateFilePath(e,r),await this.processLinkUpdateInAllWorkspaces(e,r)}),await this.db.noteDerivedData.update(e,{path:r})};this.app=e,this.db=r,this.vectorStore=n}subscribeToChanges(){this.workspaceSubscription=Xn(()=>this.db.workspace.toArray()).subscribe({next:e=>{this.workspaces=e},error:e=>console.error(e)}),this.obsidianEventRefs.push(this.app.vault.on("delete",this.onFileDelete),this.app.vault.on("rename",this.onFileRename),this.app.metadataCache.on("changed",this.onMetadataChange))}unsubscribeFromChanges(){this.workspaceSubscription?.unsubscribe(),this.obsidianEventRefs.forEach(e=>{this.app.vault.offref(e)})}async processWorkspaceDelete(e){await this.db.workspace.where("workspaceFile").equals(e).delete()}async processWorkspaceLinkAdd(e,r){console.log(`Processing workspace link add: ${e} -> ${r}`),await this.db.workspace.where("workspaceFile").equals(e).modify(n=>{n.links.includes(r)||n.links.push(r)})}async processWorkspaceLinkRemove(e,r){console.log(`Processing workspace link remove: ${e} -> ${r}`),await this.db.workspace.where("workspaceFile").equals(e).modify(n=>{n.links=n.links.filter(s=>s!==r)})}async processLinkUpdateInAllWorkspaces(e,r){console.log(`Processing link update in all workspaces: ${e} -> ${r}`),await this.db.workspace.where("links").equals(e).modify(n=>{n.links=n.links.map(s=>s===e?r:s)})}isWorkspaceFile(e){return this.workspaces.some(r=>r.workspaceFile===e)}};var Th=require("obsidian");var Ip="5";typeof window<"u"&&(window.__svelte||={v:new Set}).v.add(Ip);var oN=require("obsidian");var Dp=require("obsidian");async function*Rp(t){let e=new fu,r=new du;for await(let n of t)for(let s of r.decode(n)){let l=e.decode(s);l&&(yield l)}for(let n of r.flush()){let s=e.decode(n);s&&(yield s)}}var fu=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let l={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],l}if(this.chunks.push(e),e.startsWith(":"))return null;let r=e.indexOf(":");if(r===-1)return null;let n=e.substring(0,r),s=e.substring(r+1);return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}},du=class t{static{this.NEWLINE_CHARS=new Set([`
`,"\r"])}static{this.NEWLINE_REGEXP=/\r\n|[\n\r]/g}constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let r=new TextDecoder("utf8").decode(e);if(this.trailingCR&&(r="\r"+r,this.trailingCR=!1),r.endsWith("\r")&&(this.trailingCR=!0,r=r.slice(0,-1)),!r)return[];let n=t.NEWLINE_CHARS.has(r[r.length-1]||""),s=r.split(t.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};var Tp=require("node:https"),Op=require("node:stream");async function Np(t,e={}){return new Promise((r,n)=>{let s={method:e.method||"GET",headers:e.headers||{}},l=new Op.Readable({read(){}}),f=(0,Tp.request)(t,s,p=>{if(p.statusCode!==200){var m="";p.on("readable",()=>{m+=p.read()}),p.on("end",()=>{console.error("Failed request's response body",m)}),n(new Error(`Unexpected status code: ${p.statusCode}`));return}r(l),p.on("data",_=>{l.push(_)}),p.on("end",()=>{l.push(null)}),l.on("error",_=>{console.log("error",_),n(_)})});f.on("error",p=>{n(p)}),e.body&&f.write(e.body),f.end()})}var Va=class{constructor(e,r){this.apiKey=e,this.model=r}get displayName(){return`Anthropic ${this.model}`}async*createStreamingChatCompletion(e,r){if(this.apiKey==="")throw new Error("Anthropic API key is not set");if(e.length==0)throw new Error("At least one message is required and first message must be the system role");if(e[0].role!=="system")throw new Error("First message must be the system role, got "+e[0].role);let n=await Np("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"anthropic-version":"2023-06-01","x-api-key":this.apiKey,"content-type":"application/json"},body:JSON.stringify({stream:!0,model:this.model,temperature:pu(r.temperature),max_tokens:r.maxTokens,system:e[0].content,messages:e.slice(1).map(p=>({role:p.role,content:eo(p.content,p.attachedContent)}))})}),s=0,l=0,f=Rp(n);for await(let p of f){if(!p.data)continue;let m=JSON.parse(p.data);switch(m.type){case"message_start":m.message.usage.input_tokens&&(s+=m.message.usage.input_tokens),yield{type:"start"};break;case"content_block_delta":yield{content:m.delta.text,type:"delta"};break;case"message_delta":m.usage.output_tokens&&(l=m.usage.output_tokens);break;case"message_stop":yield{type:"stop",usage:{inputTokens:s,outputTokens:l,cachedInputTokens:0},temeperature:pu(r.temperature)};break}}}async createChatCompletion(e,r){if(this.apiKey==="")throw new Error("Anthropic API key is not set");if(e.length==0)throw new Error("At least one message is required and first message must be the system role");if(e[0].role!=="system")throw new Error("First message must be the system role, got "+e[0].role);try{return{content:(await(await this.makeRequest(e,r,!1)).json).content[0].text,role:"assistant",attachedContent:[]}}catch(n){return Promise.reject(n)}}async createJSONCompletion(e,r,n){if(this.apiKey==="")throw new Error("Anthropic API key is not set");let s=[{role:"system",content:e,attachedContent:[]},{role:"user",content:r,attachedContent:[]},{role:"assistant",content:"{",attachedContent:[]}],f=await(await this.makeRequest(s,n,!1)).json;try{return JSON.parse("{"+f.content[0].text)}catch(p){throw new Error(`LLM response could not be parsed to JSON schema: ${p}
Response: {${f.content[0].text}`)}}async makeRequest(e,r,n){let s=await(0,Dp.requestUrl)({url:"https://api.anthropic.com/v1/messages",method:"POST",contentType:"application/json",headers:{"anthropic-version":"2023-06-01","x-api-key":this.apiKey},body:JSON.stringify({stream:n,model:this.model,temperature:pu(r.temperature),max_tokens:r.maxTokens,system:e[0].content,messages:e.slice(1).map(l=>({role:l.role,content:eo(l.content,l.attachedContent)}))}),throw:!1});return s.status<200||s.status>=400?Promise.reject(s.text):s}};function pu(t){switch(t){case"balanced":return .5;case"creative":return .9;case"precise":return .1}}var Su={};Xf(Su,{APIConnectionError:()=>Gr,APIConnectionTimeoutError:()=>Zr,APIError:()=>st,APIUserAbortError:()=>ft,AuthenticationError:()=>xo,BadRequestError:()=>wo,ConflictError:()=>$o,ContentFilterFinishReasonError:()=>pi,InternalServerError:()=>Ao,LengthFinishReasonError:()=>di,NotFoundError:()=>ko,OpenAIError:()=>_e,PermissionDeniedError:()=>Eo,RateLimitError:()=>So,UnprocessableEntityError:()=>Co});var ci="4.67.0";var Fp=!1,ui,hu,$_,C_,S_,mu,A_,za,vu,_u,gu,Ua,yu;function Mp(t,e={auto:!1}){if(Fp)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(ui)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${ui}'\``);Fp=e.auto,ui=t.kind,hu=t.fetch,$_=t.Request,C_=t.Response,S_=t.Headers,mu=t.FormData,A_=t.Blob,za=t.File,vu=t.ReadableStream,_u=t.getMultipartRequestOptions,gu=t.getDefaultAgent,Ua=t.fileFromPath,yu=t.isFsReadStream}var Ha=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Lp({manuallyImported:t}={}){let e=t?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",r,n,s,l;try{r=fetch,n=Request,s=Response,l=Headers}catch(f){throw new Error(`this environment is missing the following Web Fetch API type: ${f.message}. ${e}`)}return{kind:"web",fetch:r,Request:n,Response:s,Headers:l,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(f,p)=>({...p,body:new Ha(f)}),getDefaultAgent:f=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:f=>!1}}ui||Mp(Lp(),{auto:!0});var Dr=class t{constructor(e,r){this.iterator=e,this.controller=r}static fromSSEResponse(e,r){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let l=!1;try{for await(let f of I_(e,r))if(!l){if(f.data.startsWith("[DONE]")){l=!0;continue}if(f.event===null){let p;try{p=JSON.parse(f.data)}catch(m){throw console.error("Could not parse message into JSON:",f.data),console.error("From chunk:",f.raw),m}if(p&&p.error)throw new st(void 0,p.error,void 0,void 0);yield p}else{let p;try{p=JSON.parse(f.data)}catch(m){throw console.error("Could not parse message into JSON:",f.data),console.error("From chunk:",f.raw),m}if(f.event=="error")throw new st(void 0,p.error,p.message,void 0);yield{event:f.event,data:p}}}l=!0}catch(f){if(f instanceof Error&&f.name==="AbortError")return;throw f}finally{l||r.abort()}}return new t(s,r)}static fromReadableStream(e,r){let n=!1;async function*s(){let f=new yo,p=Bp(e);for await(let m of p)for(let _ of f.decode(m))yield _;for(let m of f.flush())yield m}async function*l(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let f=!1;try{for await(let p of s())f||p&&(yield JSON.parse(p));f=!0}catch(p){if(p instanceof Error&&p.name==="AbortError")return;throw p}finally{f||r.abort()}}return new t(l,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],r=[],n=this.iterator(),s=l=>({next:()=>{if(l.length===0){let f=n.next();e.push(f),r.push(f)}return l.shift()}});return[new t(()=>s(e),this.controller),new t(()=>s(r),this.controller)]}toReadableStream(){let e=this,r,n=new TextEncoder;return new vu({async start(){r=e[Symbol.asyncIterator]()},async pull(s){try{let{value:l,done:f}=await r.next();if(f)return s.close();let p=n.encode(JSON.stringify(l)+`
`);s.enqueue(p)}catch(l){s.error(l)}},async cancel(){await r.return?.()}})}};async function*I_(t,e){if(!t.body)throw e.abort(),new _e("Attempted to iterate over a response with no body");let r=new bu,n=new yo,s=Bp(t.body);for await(let l of R_(s))for(let f of n.decode(l)){let p=r.decode(f);p&&(yield p)}for(let l of n.flush()){let f=r.decode(l);f&&(yield f)}}async function*R_(t){let e=new Uint8Array;for await(let r of t){if(r==null)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):typeof r=="string"?new TextEncoder().encode(r):r,s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let l;for(;(l=T_(e))!==-1;)yield e.slice(0,l),e=e.slice(l)}e.length>0&&(yield e)}function T_(t){for(let n=0;n<t.length-2;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}var bu=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let l={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],l}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,s]=O_(e,":");return s.startsWith(" ")&&(s=s.substring(1)),r==="event"?this.event=s:r==="data"&&this.data.push(s),null}},yo=class t{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let r=this.decodeText(e);if(this.trailingCR&&(r="\r"+r,this.trailingCR=!1),r.endsWith("\r")&&(this.trailingCR=!0,r=r.slice(0,-1)),!r)return[];let n=t.NEWLINE_CHARS.has(r[r.length-1]||""),s=r.split(t.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new _e(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new _e(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new _e("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};yo.NEWLINE_CHARS=new Set([`
`,"\r"]);yo.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function O_(t,e){let r=t.indexOf(e);return r!==-1?[t.substring(0,r),e,t.substring(r+e.length)]:[t,"",""]}function Bp(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let r=await e.read();return r?.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){let r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Kp=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",Wp=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&_s(t),_s=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",N_=t=>Wp(t)||Kp(t)||yu(t);async function Eu(t,e,r){if(t=await t,Wp(t))return t;if(Kp(t)){let s=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");let l=_s(s)?[await s.arrayBuffer()]:[s];return new za(l,e,r)}let n=await D_(t);if(e||(e=M_(t)??"unknown_file"),!r?.type){let s=n[0]?.type;typeof s=="string"&&(r={...r,type:s})}return new za(n,e,r)}async function D_(t){let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(_s(t))e.push(await t.arrayBuffer());else if(L_(t))for await(let r of t)e.push(r);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${t?.constructor?.name}; props: ${F_(t)}`);return e}function F_(t){return`[${Object.getOwnPropertyNames(t).map(r=>`"${r}"`).join(", ")}]`}function M_(t){return wu(t.name)||wu(t.filename)||wu(t.path)?.split(/[\\/]/).pop()}var wu=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},L_=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",ku=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody";var dr=async t=>{let e=await jp(t.body);return _u(e,t)},jp=async t=>{let e=new mu;return await Promise.all(Object.entries(t||{}).map(([r,n])=>xu(e,r,n))),e};var xu=async(t,e,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")t.append(e,String(r));else if(N_(r)){let n=await Eu(r);t.append(e,n)}else if(Array.isArray(r))await Promise.all(r.map(n=>xu(t,e+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,s])=>xu(t,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var K_=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},W_=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Ya;async function Hp(t){let{response:e}=t;if(t.options.stream)return bo("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):Dr.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;let r=e.headers.get("content-type");if(r?.includes("application/json")||r?.includes("application/vnd.api+json")){let l=await e.json();return bo("response",e.status,e.url,e.headers,l),Yp(l,e)}let s=await e.text();return bo("response",e.status,e.url,e.headers,s),s}function Yp(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Qa=class t extends Promise{constructor(e,r=Hp){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=r}_thenUnwrap(e){return new t(this.responsePromise,async r=>Yp(e(await this.parseResponse(r)),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r,request_id:r.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Ja=class{constructor({baseURL:e,maxRetries:r=2,timeout:n=6e5,httpAgent:s,fetch:l}){this.baseURL=e,this.maxRetries=$u("maxRetries",r),this.timeout=$u("timeout",n),this.httpAgent=s,this.fetch=l??hu}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...U_(),...this.authHeaders(e)}}validateHeaders(e,r){}defaultIdempotencyKey(){return`stainless-node-retry-${J_()}`}get(e,r){return this.methodRequest("get",e,r)}post(e,r){return this.methodRequest("post",e,r)}patch(e,r){return this.methodRequest("patch",e,r)}put(e,r){return this.methodRequest("put",e,r)}delete(e,r){return this.methodRequest("delete",e,r)}methodRequest(e,r,n){return this.request(Promise.resolve(n).then(async s=>{let l=s&&_s(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:r,...s,body:l}}))}getAPIList(e,r,n){return this.requestAPIList(r,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:r=0}={}){let{method:n,path:s,query:l,headers:f={}}=e,p=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:ku(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,m=this.calculateContentLength(p),_=this.buildURL(s,l);"timeout"in e&&$u("timeout",e.timeout);let b=e.timeout??this.timeout,y=e.httpAgent??this.httpAgent??gu(_),x=b+1e3;typeof y?.options?.timeout=="number"&&x>(y.options.timeout??0)&&(y.options.timeout=x),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),f[this.idempotencyHeader]=e.idempotencyKey);let $=this.buildHeaders({options:e,headers:f,contentLength:m,retryCount:r});return{req:{method:n,...p&&{body:p},headers:$,...y&&{agent:y},signal:e.signal??null},url:_,timeout:b}}buildHeaders({options:e,headers:r,contentLength:n,retryCount:s}){let l={};n&&(l["content-length"]=n);let f=this.defaultHeaders(e);return Up(l,f),Up(l,r),ku(e.body)&&ui!=="node"&&delete l["content-type"],G_(r,"x-stainless-retry-count")===void 0&&(l["x-stainless-retry-count"]=String(s)),this.validateHeaders(l,r),l}async prepareOptions(e){}async prepareRequest(e,{url:r,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(r=>[...r])):{...e}:{}}makeStatusError(e,r,n,s){return st.generate(e,r,n,s)}request(e,r=null){return new Qa(this.makeRequest(e,r))}async makeRequest(e,r){let n=await e,s=n.maxRetries??this.maxRetries;r==null&&(r=s),await this.prepareOptions(n);let{req:l,url:f,timeout:p}=this.buildRequest(n,{retryCount:s-r});if(await this.prepareRequest(l,{url:f,options:n}),bo("request",f,n,l.headers),n.signal?.aborted)throw new ft;let m=new AbortController,_=await this.fetchWithTimeout(f,l,p,m).catch(Xa);if(_ instanceof Error){if(n.signal?.aborted)throw new ft;if(r)return this.retryRequest(n,r);throw _.name==="AbortError"?new Zr:new Gr({cause:_})}let b=j_(_.headers);if(!_.ok){if(r&&this.shouldRetry(_)){let j=`retrying, ${r} attempts remaining`;return bo(`response (error; ${j})`,_.status,f,b),this.retryRequest(n,r,b)}let y=await _.text().catch(j=>Xa(j).message),x=H_(y),$=x?void 0:y;throw bo(`response (error; ${r?"(error; no more retries left)":"(error; not retryable)"})`,_.status,f,b,$),this.makeStatusError(_.status,x,$,b)}return{response:_,options:n,controller:m}}requestAPIList(e,r){let n=this.makeRequest(r,null);return new Cu(this,n,e)}buildURL(e,r){let n=Q_(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Qp(s)||(r={...s,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(n.search=this.stringifyQuery(r)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([r,n])=>typeof n<"u").map(([r,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(r)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(r)}=`;throw new _e(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,r,n,s){let{signal:l,...f}=r||{};l&&l.addEventListener("abort",()=>s.abort());let p=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...f}).finally(()=>{clearTimeout(p)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let r=e.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,r,n){let s,l=n?.["retry-after-ms"];if(l){let p=parseFloat(l);Number.isNaN(p)||(s=p)}let f=n?.["retry-after"];if(f&&!s){let p=parseFloat(f);Number.isNaN(p)?s=Date.parse(f)-Date.now():s=p*1e3}if(!(s&&0<=s&&s<60*1e3)){let p=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(r,p)}return await Xr(s),this.makeRequest(e,r-1)}calculateDefaultRetryTimeoutMillis(e,r){let l=r-e,f=Math.min(.5*Math.pow(2,l),8),p=1-Math.random()*.25;return f*p*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ci}`}},gs=class{constructor(e,r,n,s){Ya.set(this,void 0),K_(this,Ya,e,"f"),this.options=s,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new _e("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let r={...this.options};if("params"in e&&typeof r.query=="object")r.query={...r.query,...e.params};else if("url"in e){let n=[...Object.entries(r.query||{}),...e.url.searchParams.entries()];for(let[s,l]of n)e.url.searchParams.set(s,l);r.query=void 0,r.path=e.url.toString()}return await W_(this,Ya,"f").requestAPIList(this.constructor,r)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ya=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let r of e.getPaginatedItems())yield r}},Cu=class extends Qa{constructor(e,r,n){super(r,async s=>new n(e,s.response,await Hp(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let r of e)yield r}},j_=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,r){let n=r.toString();return e[n.toLowerCase()]||e[n]}}),q_={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ze=t=>typeof t=="object"&&t!==null&&!Qp(t)&&Object.keys(t).every(e=>Jp(q_,e)),V_=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ci,"X-Stainless-OS":Vp(Deno.build.os),"X-Stainless-Arch":qp(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ci,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ci,"X-Stainless-OS":Vp(process.platform),"X-Stainless-Arch":qp(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let t=z_();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ci,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ci,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function z_(){if(typeof navigator>"u"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:r}of t){let n=r.exec(navigator.userAgent);if(n){let s=n[1]||0,l=n[2]||0,f=n[3]||0;return{browser:e,version:`${s}.${l}.${f}`}}}return null}var qp=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Vp=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),zp,U_=()=>zp??(zp=V_()),H_=t=>{try{return JSON.parse(t)}catch{return}},Y_=new RegExp("^(?:[a-z]+:)?//","i"),Q_=t=>Y_.test(t),Xr=t=>new Promise(e=>setTimeout(e,t)),$u=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new _e(`${t} must be an integer`);if(e<0)throw new _e(`${t} must be a positive integer`);return e},Xa=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)};var ys=t=>{if(typeof process<"u")return process.env?.[t]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(t)?.trim()};function Qp(t){if(!t)return!0;for(let e in t)return!1;return!0}function Jp(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Up(t,e){for(let r in e){if(!Jp(e,r))continue;let n=r.toLowerCase();if(!n)continue;let s=e[r];s===null?delete t[n]:s!==void 0&&(t[n]=s)}}function bo(t,...e){typeof process<"u"&&process?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${t}`,...e)}var J_=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),Xp=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",X_=t=>typeof t?.get=="function";var G_=(t,e)=>{let r=e.toLowerCase();if(X_(t)){let n=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,l,f)=>l+f.toUpperCase());for(let s of[e,r,e.toUpperCase(),n]){let l=t.get(s);if(l)return l}}for(let[n,s]of Object.entries(t))if(n.toLowerCase()===r)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s};function bs(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}var _e=class extends Error{},st=class t extends _e{constructor(e,r,n,s){super(`${t.makeMessage(e,r,n)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"];let l=r;this.error=l,this.code=l?.code,this.param=l?.param,this.type=l?.type}static makeMessage(e,r,n){let s=r?.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,r,n,s){if(!e)return new Gr({message:n,cause:Xa(r)});let l=r?.error;return e===400?new wo(e,l,n,s):e===401?new xo(e,l,n,s):e===403?new Eo(e,l,n,s):e===404?new ko(e,l,n,s):e===409?new $o(e,l,n,s):e===422?new Co(e,l,n,s):e===429?new So(e,l,n,s):e>=500?new Ao(e,l,n,s):new t(e,l,n,s)}},ft=class extends st{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Gr=class extends st{constructor({message:e,cause:r}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,r&&(this.cause=r)}},Zr=class extends Gr{constructor({message:e}={}){super({message:e??"Request timed out."})}},wo=class extends st{constructor(){super(...arguments),this.status=400}},xo=class extends st{constructor(){super(...arguments),this.status=401}},Eo=class extends st{constructor(){super(...arguments),this.status=403}},ko=class extends st{constructor(){super(...arguments),this.status=404}},$o=class extends st{constructor(){super(...arguments),this.status=409}},Co=class extends st{constructor(){super(...arguments),this.status=422}},So=class extends st{constructor(){super(...arguments),this.status=429}},Ao=class extends st{},di=class extends _e{constructor(){super("Could not parse response content as the length limit was reached")}},pi=class extends _e{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Ga="RFC3986",Za={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},Gp="RFC1738";var Z_=Array.isArray,Fr=(()=>{let t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})();var Au=1024,Zp=(t,e,r,n,s)=>{if(t.length===0)return t;let l=t;if(typeof t=="symbol"?l=Symbol.prototype.toString.call(t):typeof t!="string"&&(l=String(t)),r==="iso-8859-1")return escape(l).replace(/%u[0-9a-f]{4}/gi,function(p){return"%26%23"+parseInt(p.slice(2),16)+"%3B"});let f="";for(let p=0;p<l.length;p+=Au){let m=l.length>=Au?l.slice(p,p+Au):l,_=[];for(let b=0;b<m.length;++b){let y=m.charCodeAt(b);if(y===45||y===46||y===95||y===126||y>=48&&y<=57||y>=65&&y<=90||y>=97&&y<=122||s===Gp&&(y===40||y===41)){_[_.length]=m.charAt(b);continue}if(y<128){_[_.length]=Fr[y];continue}if(y<2048){_[_.length]=Fr[192|y>>6]+Fr[128|y&63];continue}if(y<55296||y>=57344){_[_.length]=Fr[224|y>>12]+Fr[128|y>>6&63]+Fr[128|y&63];continue}b+=1,y=65536+((y&1023)<<10|m.charCodeAt(b)&1023),_[_.length]=Fr[240|y>>18]+Fr[128|y>>12&63]+Fr[128|y>>6&63]+Fr[128|y&63]}f+=_.join("")}return f};function eh(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function Pu(t,e){if(Z_(t)){let r=[];for(let n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)}var eg=Object.prototype.hasOwnProperty,th={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},Mr=Array.isArray,tg=Array.prototype.push,rh=function(t,e){tg.apply(t,Mr(e)?e:[e])},rg=Date.prototype.toISOString,dt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Zp,encodeValuesOnly:!1,format:Ga,formatter:Za[Ga],indices:!1,serializeDate(t){return rg.call(t)},skipNulls:!1,strictNullHandling:!1};function ng(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}var Iu={};function nh(t,e,r,n,s,l,f,p,m,_,b,y,x,$,P,F,j,z){let N=t,H=z,V=0,Q=!1;for(;(H=H.get(Iu))!==void 0&&!Q;){let ge=H.get(t);if(V+=1,typeof ge<"u"){if(ge===V)throw new RangeError("Cyclic object value");Q=!0}typeof H.get(Iu)>"u"&&(V=0)}if(typeof _=="function"?N=_(e,N):N instanceof Date?N=x?.(N):r==="comma"&&Mr(N)&&(N=Pu(N,function(ge){return ge instanceof Date?x?.(ge):ge})),N===null){if(l)return m&&!F?m(e,dt.encoder,j,"key",$):e;N=""}if(ng(N)||eh(N)){if(m){let ge=F?e:m(e,dt.encoder,j,"key",$);return[P?.(ge)+"="+P?.(m(N,dt.encoder,j,"value",$))]}return[P?.(e)+"="+P?.(String(N))]}let G=[];if(typeof N>"u")return G;let J;if(r==="comma"&&Mr(N))F&&m&&(N=Pu(N,m)),J=[{value:N.length>0?N.join(",")||null:void 0}];else if(Mr(_))J=_;else{let ge=Object.keys(N);J=b?ge.sort(b):ge}let U=p?String(e).replace(/\./g,"%2E"):String(e),ue=n&&Mr(N)&&N.length===1?U+"[]":U;if(s&&Mr(N)&&N.length===0)return ue+"[]";for(let ge=0;ge<J.length;++ge){let $e=J[ge],ye=typeof $e=="object"&&typeof $e.value<"u"?$e.value:N[$e];if(f&&ye===null)continue;let Re=y&&p?$e.replace(/\./g,"%2E"):$e,je=Mr(N)?typeof r=="function"?r(ue,Re):ue:ue+(y?"."+Re:"["+Re+"]");z.set(t,V);let Dt=new WeakMap;Dt.set(Iu,z),rh(G,nh(ye,je,r,n,s,l,f,p,r==="comma"&&F&&Mr(N)?null:m,_,b,y,x,$,P,F,j,Dt))}return G}function ig(t=dt){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=t.charset||dt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=Ga;if(typeof t.format<"u"){if(!eg.call(Za,t.format))throw new TypeError("Unknown format option provided.");r=t.format}let n=Za[r],s=dt.filter;(typeof t.filter=="function"||Mr(t.filter))&&(s=t.filter);let l;if(t.arrayFormat&&t.arrayFormat in th?l=t.arrayFormat:"indices"in t?l=t.indices?"indices":"repeat":l=dt.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let f=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:dt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:dt.addQueryPrefix,allowDots:f,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:dt.allowEmptyArrays,arrayFormat:l,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:dt.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?dt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:dt.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:dt.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:dt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:dt.encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:dt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:dt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:dt.strictNullHandling}}function Ru(t,e={}){let r=t,n=ig(e),s,l;typeof n.filter=="function"?(l=n.filter,r=l("",r)):Mr(n.filter)&&(l=n.filter,s=l);let f=[];if(typeof r!="object"||r===null)return"";let p=th[n.arrayFormat],m=p==="comma"&&n.commaRoundTrip;s||(s=Object.keys(r)),n.sort&&s.sort(n.sort);let _=new WeakMap;for(let x=0;x<s.length;++x){let $=s[x];n.skipNulls&&r[$]===null||rh(f,nh(r[$],$,p,m,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,_))}let b=f.join(n.delimiter),y=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),b.length>0?y+b:""}var kn=class extends gs{constructor(e,r,n,s){super(e,r,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},Ye=class extends gs{constructor(e,r,n,s){super(e,r,n,s),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let r=Object.fromEntries(e.url.searchParams);return Object.keys(r).length?r:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let r=e[e.length-1]?.id;return r?{params:{after:r}}:null}};var ie=class{constructor(e){this._client=e}};var hi=class extends ie{create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}};hi||(hi={});var $n=class extends ie{constructor(){super(...arguments),this.completions=new hi(this._client)}};(function(t){t.Completions=hi})($n||($n={}));var mi=class extends ie{create(e,r){return this._client.post("/audio/speech",{body:e,...r,__binaryResponse:!0})}};mi||(mi={});var vi=class extends ie{create(e,r){return this._client.post("/audio/transcriptions",dr({body:e,...r}))}};vi||(vi={});var _i=class extends ie{create(e,r){return this._client.post("/audio/translations",dr({body:e,...r}))}};_i||(_i={});var Cn=class extends ie{constructor(){super(...arguments),this.transcriptions=new vi(this._client),this.translations=new _i(this._client),this.speech=new mi(this._client)}};(function(t){t.Transcriptions=vi,t.Translations=_i,t.Speech=mi})(Cn||(Cn={}));var Sn=class extends ie{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(`/batches/${e}`,r)}list(e={},r){return ze(e)?this.list({},e):this._client.getAPIList("/batches",An,{query:e,...r})}cancel(e,r){return this._client.post(`/batches/${e}/cancel`,r)}},An=class extends Ye{};(function(t){t.BatchesPage=An})(Sn||(Sn={}));var gi=class extends ie{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,r){return this._client.get(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,r,n){return this._client.post(`/assistants/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},r){return ze(e)?this.list({},e):this._client.getAPIList("/assistants",yi,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,r){return this._client.delete(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},yi=class extends Ye{};(function(t){t.AssistantsPage=yi})(gi||(gi={}));function Tu(t){return typeof t.parse=="function"}var Pn=t=>t?.role==="assistant",Ou=t=>t?.role==="function",Nu=t=>t?.role==="tool";var $r=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},Qe=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Du,el,tl,ws,xs,rl,Es,en,ks,nl,il,Po,oh,Io=class{constructor(){Du.add(this),this.controller=new AbortController,el.set(this,void 0),tl.set(this,()=>{}),ws.set(this,()=>{}),xs.set(this,void 0),rl.set(this,()=>{}),Es.set(this,()=>{}),en.set(this,{}),ks.set(this,!1),nl.set(this,!1),il.set(this,!1),Po.set(this,!1),$r(this,el,new Promise((e,r)=>{$r(this,tl,e,"f"),$r(this,ws,r,"f")}),"f"),$r(this,xs,new Promise((e,r)=>{$r(this,rl,e,"f"),$r(this,Es,r,"f")}),"f"),Qe(this,el,"f").catch(()=>{}),Qe(this,xs,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Qe(this,Du,"m",oh).bind(this))},0)}_connected(){this.ended||(Qe(this,tl,"f").call(this),this._emit("connect"))}get ended(){return Qe(this,ks,"f")}get errored(){return Qe(this,nl,"f")}get aborted(){return Qe(this,il,"f")}abort(){this.controller.abort()}on(e,r){return(Qe(this,en,"f")[e]||(Qe(this,en,"f")[e]=[])).push({listener:r}),this}off(e,r){let n=Qe(this,en,"f")[e];if(!n)return this;let s=n.findIndex(l=>l.listener===r);return s>=0&&n.splice(s,1),this}once(e,r){return(Qe(this,en,"f")[e]||(Qe(this,en,"f")[e]=[])).push({listener:r,once:!0}),this}emitted(e){return new Promise((r,n)=>{$r(this,Po,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,r)})}async done(){$r(this,Po,!0,"f"),await Qe(this,xs,"f")}_emit(e,...r){if(Qe(this,ks,"f"))return;e==="end"&&($r(this,ks,!0,"f"),Qe(this,rl,"f").call(this));let n=Qe(this,en,"f")[e];if(n&&(Qe(this,en,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...r))),e==="abort"){let s=r[0];!Qe(this,Po,"f")&&!n?.length&&Promise.reject(s),Qe(this,ws,"f").call(this,s),Qe(this,Es,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=r[0];!Qe(this,Po,"f")&&!n?.length&&Promise.reject(s),Qe(this,ws,"f").call(this,s),Qe(this,Es,"f").call(this,s),this._emit("end")}}_emitFinal(){}};el=new WeakMap,tl=new WeakMap,ws=new WeakMap,xs=new WeakMap,rl=new WeakMap,Es=new WeakMap,en=new WeakMap,ks=new WeakMap,nl=new WeakMap,il=new WeakMap,Po=new WeakMap,Du=new WeakSet,oh=function(e){if($r(this,nl,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ft),e instanceof ft)return $r(this,il,!0,"f"),this._emit("abort",e);if(e instanceof _e)return this._emit("error",e);if(e instanceof Error){let r=new _e(e.message);return r.cause=e,this._emit("error",r)}return this._emit("error",new _e(String(e)))};function Fu(t){return t?.$brand==="auto-parseable-response-format"}function bi(t){return t?.$brand==="auto-parseable-tool"}function sh(t,e){return!e||!Mu(e)?{...t,choices:t.choices.map(r=>({...r,message:{...r.message,parsed:null,tool_calls:r.message.tool_calls??[]}}))}:$s(t,e)}function $s(t,e){let r=t.choices.map(n=>{if(n.finish_reason==="length")throw new di;if(n.finish_reason==="content_filter")throw new pi;return{...n,message:{...n.message,tool_calls:n.message.tool_calls?.map(s=>pg(e,s))??[],parsed:n.message.content&&!n.message.refusal?dg(e,n.message.content):null}}});return{...t,choices:r}}function dg(t,e){return t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function pg(t,e){let r=t.tools?.find(n=>n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:bi(r)?r.$parseRaw(e.function.arguments):r?.function.strict?JSON.parse(e.function.arguments):null}}}function ah(t,e){if(!t)return!1;let r=t.tools?.find(n=>n.function?.name===e.function.name);return bi(r)||r?.function.strict||!1}function Mu(t){return Fu(t.response_format)?!0:t.tools?.some(e=>bi(e)||e.type==="function"&&e.function.strict===!0)??!1}function lh(t){for(let e of t??[]){if(e.type!=="function")throw new _e(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new _e(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Wt=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Pt,Lu,ol,Bu,Ku,Wu,uh,ju,ch=10,Ro=class extends Io{constructor(){super(...arguments),Pt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let r=e.choices[0]?.message;return r&&this._addMessage(r),e}_addMessage(e,r=!0){if("content"in e||(e.content=null),this.messages.push(e),r){if(this._emit("message",e),(Ou(e)||Nu(e))&&e.content)this._emit("functionCallResult",e.content);else if(Pn(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Pn(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new _e("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Wt(this,Pt,"m",Lu).call(this)}async finalMessage(){return await this.done(),Wt(this,Pt,"m",ol).call(this)}async finalFunctionCall(){return await this.done(),Wt(this,Pt,"m",Bu).call(this)}async finalFunctionCallResult(){return await this.done(),Wt(this,Pt,"m",Ku).call(this)}async totalUsage(){return await this.done(),Wt(this,Pt,"m",Wu).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let r=Wt(this,Pt,"m",ol).call(this);r&&this._emit("finalMessage",r);let n=Wt(this,Pt,"m",Lu).call(this);n&&this._emit("finalContent",n);let s=Wt(this,Pt,"m",Bu).call(this);s&&this._emit("finalFunctionCall",s);let l=Wt(this,Pt,"m",Ku).call(this);l!=null&&this._emit("finalFunctionCallResult",l),this._chatCompletions.some(f=>f.usage)&&this._emit("totalUsage",Wt(this,Pt,"m",Wu).call(this))}async _createChatCompletion(e,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Wt(this,Pt,"m",uh).call(this,r);let l=await e.chat.completions.create({...r,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion($s(l,r))}async _runChatCompletion(e,r,n){for(let s of r.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,r,n)}async _runFunctions(e,r,n){let s="function",{function_call:l="auto",stream:f,...p}=r,m=typeof l!="string"&&l?.name,{maxChatCompletions:_=ch}=n||{},b={};for(let x of r.functions)b[x.name||x.function.name]=x;let y=r.functions.map(x=>({name:x.name||x.function.name,parameters:x.parameters,description:x.description}));for(let x of r.messages)this._addMessage(x,!1);for(let x=0;x<_;++x){let P=(await this._createChatCompletion(e,{...p,function_call:l,functions:y,messages:[...this.messages]},n)).choices[0]?.message;if(!P)throw new _e("missing message in ChatCompletion response");if(!P.function_call)return;let{name:F,arguments:j}=P.function_call,z=b[F];if(z){if(m&&m!==F){let Q=`Invalid function_call: ${JSON.stringify(F)}. ${JSON.stringify(m)} requested. Please try again`;this._addMessage({role:s,name:F,content:Q});continue}}else{let Q=`Invalid function_call: ${JSON.stringify(F)}. Available options are: ${y.map(G=>JSON.stringify(G.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:F,content:Q});continue}let N;try{N=Tu(z)?await z.parse(j):j}catch(Q){this._addMessage({role:s,name:F,content:Q instanceof Error?Q.message:String(Q)});continue}let H=await z.function(N,this),V=Wt(this,Pt,"m",ju).call(this,H);if(this._addMessage({role:s,name:F,content:V}),m)return}}async _runTools(e,r,n){let s="tool",{tool_choice:l="auto",stream:f,...p}=r,m=typeof l!="string"&&l?.function?.name,{maxChatCompletions:_=ch}=n||{},b=r.tools.map($=>{if(bi($)){if(!$.$callback)throw new _e("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:$.$callback,name:$.function.name,description:$.function.description||"",parameters:$.function.parameters,parse:$.$parseRaw,strict:!0}}}return $}),y={};for(let $ of b)$.type==="function"&&(y[$.function.name||$.function.function.name]=$.function);let x="tools"in r?b.map($=>$.type==="function"?{type:"function",function:{name:$.function.name||$.function.function.name,parameters:$.function.parameters,description:$.function.description,strict:$.function.strict}}:$):void 0;for(let $ of r.messages)this._addMessage($,!1);for(let $=0;$<_;++$){let F=(await this._createChatCompletion(e,{...p,tool_choice:l,tools:x,messages:[...this.messages]},n)).choices[0]?.message;if(!F)throw new _e("missing message in ChatCompletion response");if(!F.tool_calls?.length)return;for(let j of F.tool_calls){if(j.type!=="function")continue;let z=j.id,{name:N,arguments:H}=j.function,V=y[N];if(V){if(m&&m!==N){let U=`Invalid tool_call: ${JSON.stringify(N)}. ${JSON.stringify(m)} requested. Please try again`;this._addMessage({role:s,tool_call_id:z,content:U});continue}}else{let U=`Invalid tool_call: ${JSON.stringify(N)}. Available options are: ${Object.keys(y).map(ue=>JSON.stringify(ue)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:z,content:U});continue}let Q;try{Q=Tu(V)?await V.parse(H):H}catch(U){let ue=U instanceof Error?U.message:String(U);this._addMessage({role:s,tool_call_id:z,content:ue});continue}let G=await V.function(Q,this),J=Wt(this,Pt,"m",ju).call(this,G);if(this._addMessage({role:s,tool_call_id:z,content:J}),m)return}}}};Pt=new WeakSet,Lu=function(){return Wt(this,Pt,"m",ol).call(this).content??null},ol=function(){let e=this.messages.length;for(;e-- >0;){let r=this.messages[e];if(Pn(r)){let{function_call:n,...s}=r,l={...s,content:r.content??null,refusal:r.refusal??null};return n&&(l.function_call=n),l}}throw new _e("stream ended without producing a ChatCompletionMessage with role=assistant")},Bu=function(){for(let e=this.messages.length-1;e>=0;e--){let r=this.messages[e];if(Pn(r)&&r?.function_call)return r.function_call;if(Pn(r)&&r?.tool_calls?.length)return r.tool_calls.at(-1)?.function}},Ku=function(){for(let e=this.messages.length-1;e>=0;e--){let r=this.messages[e];if(Ou(r)&&r.content!=null||Nu(r)&&r.content!=null&&typeof r.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(s=>s.type==="function"&&s.id===r.tool_call_id)))return r.content}},Wu=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:r}of this._chatCompletions)r&&(e.completion_tokens+=r.completion_tokens,e.prompt_tokens+=r.prompt_tokens,e.total_tokens+=r.total_tokens);return e},uh=function(e){if(e.n!=null&&e.n>1)throw new _e("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ju=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Cs=class t extends Ro{static runFunctions(e,r,n){let s=new t,l={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,r,l)),s}static runTools(e,r,n){let s=new t,l={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,l)),s}_addMessage(e,r=!0){super._addMessage(e,r),Pn(e)&&e.content&&this._emit("content",e.content)}};var _t={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},qu=class extends Error{},Vu=class extends Error{};function hg(t,e=_t.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return mg(t.trim(),e)}var mg=(t,e)=>{let r=t.length,n=0,s=x=>{throw new qu(`${x} at position ${n}`)},l=x=>{throw new Vu(`${x} at position ${n}`)},f=()=>(y(),n>=r&&s("Unexpected end of input"),t[n]==='"'?p():t[n]==="{"?m():t[n]==="["?_():t.substring(n,n+4)==="null"||_t.NULL&e&&r-n<4&&"null".startsWith(t.substring(n))?(n+=4,null):t.substring(n,n+4)==="true"||_t.BOOL&e&&r-n<4&&"true".startsWith(t.substring(n))?(n+=4,!0):t.substring(n,n+5)==="false"||_t.BOOL&e&&r-n<5&&"false".startsWith(t.substring(n))?(n+=5,!1):t.substring(n,n+8)==="Infinity"||_t.INFINITY&e&&r-n<8&&"Infinity".startsWith(t.substring(n))?(n+=8,1/0):t.substring(n,n+9)==="-Infinity"||_t.MINUS_INFINITY&e&&1<r-n&&r-n<9&&"-Infinity".startsWith(t.substring(n))?(n+=9,-1/0):t.substring(n,n+3)==="NaN"||_t.NAN&e&&r-n<3&&"NaN".startsWith(t.substring(n))?(n+=3,NaN):b()),p=()=>{let x=n,$=!1;for(n++;n<r&&(t[n]!=='"'||$&&t[n-1]==="\\");)$=t[n]==="\\"?!$:!1,n++;if(t.charAt(n)=='"')try{return JSON.parse(t.substring(x,++n-Number($)))}catch(P){l(String(P))}else if(_t.STR&e)try{return JSON.parse(t.substring(x,n-Number($))+'"')}catch{return JSON.parse(t.substring(x,t.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},m=()=>{n++,y();let x={};try{for(;t[n]!=="}";){if(y(),n>=r&&_t.OBJ&e)return x;let $=p();y(),n++;try{let P=f();Object.defineProperty(x,$,{value:P,writable:!0,enumerable:!0,configurable:!0})}catch(P){if(_t.OBJ&e)return x;throw P}y(),t[n]===","&&n++}}catch{if(_t.OBJ&e)return x;s("Expected '}' at end of object")}return n++,x},_=()=>{n++;let x=[];try{for(;t[n]!=="]";)x.push(f()),y(),t[n]===","&&n++}catch{if(_t.ARR&e)return x;s("Expected ']' at end of array")}return n++,x},b=()=>{if(n===0){t==="-"&&_t.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t)}catch($){if(_t.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}l(String($))}}let x=n;for(t[n]==="-"&&n++;t[n]&&!",]}".includes(t[n]);)n++;n==r&&!(_t.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(t.substring(x,n))}catch{t.substring(x,n)==="-"&&_t.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t.substring(x,t.lastIndexOf("e")))}catch(P){l(String(P))}}},y=()=>{for(;n<r&&` 
\r	`.includes(t[n]);)n++};return f()},zu=t=>hg(t,_t.ALL^_t.NUM);var To=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},We=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},pt,tn,Oo,In,Uu,sl,Hu,Yu,Qu,al,Ju,fh,No=class t extends Ro{constructor(e){super(),pt.add(this),tn.set(this,void 0),Oo.set(this,void 0),In.set(this,void 0),To(this,tn,e,"f"),To(this,Oo,[],"f")}get currentChatCompletionSnapshot(){return We(this,In,"f")}static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){let s=new t(r);return s._run(()=>s._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,r,n){super._createChatCompletion;let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),We(this,pt,"m",Uu).call(this);let l=await e.chat.completions.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let f of l)We(this,pt,"m",Hu).call(this,f);if(l.controller.signal?.aborted)throw new ft;return this._addChatCompletion(We(this,pt,"m",al).call(this))}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),We(this,pt,"m",Uu).call(this),this._connected();let s=Dr.fromReadableStream(e,this.controller),l;for await(let f of s)l&&l!==f.id&&this._addChatCompletion(We(this,pt,"m",al).call(this)),We(this,pt,"m",Hu).call(this,f),l=f.id;if(s.controller.signal?.aborted)throw new ft;return this._addChatCompletion(We(this,pt,"m",al).call(this))}[(tn=new WeakMap,Oo=new WeakMap,In=new WeakMap,pt=new WeakSet,Uu=function(){this.ended||To(this,In,void 0,"f")},sl=function(r){let n=We(this,Oo,"f")[r.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},We(this,Oo,"f")[r.index]=n,n)},Hu=function(r){if(this.ended)return;let n=We(this,pt,"m",fh).call(this,r);this._emit("chunk",r,n);for(let s of r.choices){let l=n.choices[s.index];s.delta.content!=null&&l.message?.role==="assistant"&&l.message?.content&&(this._emit("content",s.delta.content,l.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:l.message.content,parsed:l.message.parsed})),s.delta.refusal!=null&&l.message?.role==="assistant"&&l.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:l.message.refusal}),s.logprobs?.content!=null&&l.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:l.logprobs?.content??[]}),s.logprobs?.refusal!=null&&l.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:l.logprobs?.refusal??[]});let f=We(this,pt,"m",sl).call(this,l);l.finish_reason&&(We(this,pt,"m",Qu).call(this,l),f.current_tool_call_index!=null&&We(this,pt,"m",Yu).call(this,l,f.current_tool_call_index));for(let p of s.delta.tool_calls??[])f.current_tool_call_index!==p.index&&(We(this,pt,"m",Qu).call(this,l),f.current_tool_call_index!=null&&We(this,pt,"m",Yu).call(this,l,f.current_tool_call_index)),f.current_tool_call_index=p.index;for(let p of s.delta.tool_calls??[]){let m=l.message.tool_calls?.[p.index];m?.type&&(m?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:m.function?.name,index:p.index,arguments:m.function.arguments,parsed_arguments:m.function.parsed_arguments,arguments_delta:p.function?.arguments??""}):(m?.type,void 0))}}},Yu=function(r,n){if(We(this,pt,"m",sl).call(this,r).done_tool_calls.has(n))return;let l=r.message.tool_calls?.[n];if(!l)throw new Error("no tool call snapshot");if(!l.type)throw new Error("tool call snapshot missing `type`");if(l.type==="function"){let f=We(this,tn,"f")?.tools?.find(p=>p.type==="function"&&p.function.name===l.function.name);this._emit("tool_calls.function.arguments.done",{name:l.function.name,index:n,arguments:l.function.arguments,parsed_arguments:bi(f)?f.$parseRaw(l.function.arguments):f?.function.strict?JSON.parse(l.function.arguments):null})}else l.type},Qu=function(r){let n=We(this,pt,"m",sl).call(this,r);if(r.message.content&&!n.content_done){n.content_done=!0;let s=We(this,pt,"m",Ju).call(this);this._emit("content.done",{content:r.message.content,parsed:s?s.$parseRaw(r.message.content):null})}r.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:r.message.refusal})),r.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:r.logprobs.content})),r.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:r.logprobs.refusal}))},al=function(){if(this.ended)throw new _e("stream has ended, this shouldn't happen");let r=We(this,In,"f");if(!r)throw new _e("request ended without sending any chunks");return To(this,In,void 0,"f"),To(this,Oo,[],"f"),vg(r,We(this,tn,"f"))},Ju=function(){let r=We(this,tn,"f")?.response_format;return Fu(r)?r:null},fh=function(r){var n,s,l,f;let p=We(this,In,"f"),{choices:m,..._}=r;p?Object.assign(p,_):p=To(this,In,{..._,choices:[]},"f");for(let{delta:b,finish_reason:y,index:x,logprobs:$=null,...P}of r.choices){let F=p.choices[x];if(F||(F=p.choices[x]={finish_reason:y,index:x,message:{},logprobs:$,...P}),$)if(!F.logprobs)F.logprobs=Object.assign({},$);else{let{content:G,refusal:J,...U}=$;Object.assign(F.logprobs,U),G&&((n=F.logprobs).content??(n.content=[]),F.logprobs.content.push(...G)),J&&((s=F.logprobs).refusal??(s.refusal=[]),F.logprobs.refusal.push(...J))}if(y&&(F.finish_reason=y,We(this,tn,"f")&&Mu(We(this,tn,"f")))){if(y==="length")throw new di;if(y==="content_filter")throw new pi}if(Object.assign(F,P),!b)continue;let{content:j,refusal:z,function_call:N,role:H,tool_calls:V,...Q}=b;if(Object.assign(F.message,Q),z&&(F.message.refusal=(F.message.refusal||"")+z),H&&(F.message.role=H),N&&(F.message.function_call?(N.name&&(F.message.function_call.name=N.name),N.arguments&&((l=F.message.function_call).arguments??(l.arguments=""),F.message.function_call.arguments+=N.arguments)):F.message.function_call=N),j&&(F.message.content=(F.message.content||"")+j,!F.message.refusal&&We(this,pt,"m",Ju).call(this)&&(F.message.parsed=zu(F.message.content))),V){F.message.tool_calls||(F.message.tool_calls=[]);for(let{index:G,id:J,type:U,function:ue,...ge}of V){let $e=(f=F.message.tool_calls)[G]??(f[G]={});Object.assign($e,ge),J&&($e.id=J),U&&($e.type=U),ue&&($e.function??($e.function={name:ue.name??"",arguments:""})),ue?.name&&($e.function.name=ue.name),ue?.arguments&&($e.function.arguments+=ue.arguments,ah(We(this,tn,"f"),$e)&&($e.function.parsed_arguments=zu($e.function.arguments)))}}}return p},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("chunk",s=>{let l=r.shift();l?l.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let l of r)l.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let l of r)l.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((l,f)=>r.push({resolve:l,reject:f})).then(l=>l?{value:l,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Dr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function vg(t,e){let{id:r,choices:n,created:s,model:l,system_fingerprint:f,...p}=t,m={...p,id:r,choices:n.map(({message:_,finish_reason:b,index:y,logprobs:x,...$})=>{if(!b)throw new _e(`missing finish_reason for choice ${y}`);let{content:P=null,function_call:F,tool_calls:j,...z}=_,N=_.role;if(!N)throw new _e(`missing role for choice ${y}`);if(F){let{arguments:H,name:V}=F;if(H==null)throw new _e(`missing function_call.arguments for choice ${y}`);if(!V)throw new _e(`missing function_call.name for choice ${y}`);return{...$,message:{content:P,function_call:{arguments:H,name:V},role:N,refusal:_.refusal??null},finish_reason:b,index:y,logprobs:x}}return j?{...$,index:y,finish_reason:b,logprobs:x,message:{...z,role:N,content:P,refusal:_.refusal??null,tool_calls:j.map((H,V)=>{let{function:Q,type:G,id:J,...U}=H,{arguments:ue,name:ge,...$e}=Q||{};if(J==null)throw new _e(`missing choices[${y}].tool_calls[${V}].id
${ll(t)}`);if(G==null)throw new _e(`missing choices[${y}].tool_calls[${V}].type
${ll(t)}`);if(ge==null)throw new _e(`missing choices[${y}].tool_calls[${V}].function.name
${ll(t)}`);if(ue==null)throw new _e(`missing choices[${y}].tool_calls[${V}].function.arguments
${ll(t)}`);return{...U,id:J,type:G,function:{...$e,name:ge,arguments:ue}}})}}:{...$,message:{...z,content:P,role:N,refusal:_.refusal??null},finish_reason:b,index:y,logprobs:x}}),created:s,model:l,object:"chat.completion",...f?{system_fingerprint:f}:{}};return sh(m,e)}function ll(t){return JSON.stringify(t)}var Ss=class t extends No{static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static runFunctions(e,r,n){let s=new t(null),l={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,r,l)),s}static runTools(e,r,n){let s=new t(r),l={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,l)),s}};var As=class extends ie{parse(e,r){return lh(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>$s(n,e))}runFunctions(e,r){return e.stream?Ss.runFunctions(this._client,e,r):Cs.runFunctions(this._client,e,r)}runTools(e,r){return e.stream?Ss.runTools(this._client,e,r):Cs.runTools(this._client,e,r)}stream(e,r){return No.createChatCompletion(this._client,e,r)}};var wi=class extends ie{constructor(){super(...arguments),this.completions=new As(this._client)}};(function(t){t.Completions=As})(wi||(wi={}));var ce=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Qt=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},Et,Xu,Lr,cl,Cr,Ei,Do,xi,dl,Jt,ul,fl,Rs,Ps,Is,dh,ph,hh,mh,vh,_h,gh,Br=class t extends Io{constructor(){super(...arguments),Et.add(this),Xu.set(this,[]),Lr.set(this,{}),cl.set(this,{}),Cr.set(this,void 0),Ei.set(this,void 0),Do.set(this,void 0),xi.set(this,void 0),dl.set(this,void 0),Jt.set(this,void 0),ul.set(this,void 0),fl.set(this,void 0),Rs.set(this,void 0)}[(Xu=new WeakMap,Lr=new WeakMap,cl=new WeakMap,Cr=new WeakMap,Ei=new WeakMap,Do=new WeakMap,xi=new WeakMap,dl=new WeakMap,Jt=new WeakMap,ul=new WeakMap,fl=new WeakMap,Rs=new WeakMap,Et=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",s=>{let l=r.shift();l?l.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let l of r)l.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let l of r)l.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((l,f)=>r.push({resolve:l,reject:f})).then(l=>l?{value:l,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new t;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=Dr.fromReadableStream(e,this.controller);for await(let l of s)ce(this,Et,"m",Ps).call(this,l);if(s.controller.signal?.aborted)throw new ft;return this._addRun(ce(this,Et,"m",Is).call(this))}toReadableStream(){return new Dr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,s,l){let f=new t;return f._run(()=>f._runToolAssistantStream(e,r,n,s,{...l,headers:{...l?.headers,"X-Stainless-Helper-Method":"stream"}})),f}async _createToolAssistantStream(e,r,n,s,l){let f=l?.signal;f&&(f.aborted&&this.controller.abort(),f.addEventListener("abort",()=>this.controller.abort()));let p={...s,stream:!0},m=await e.submitToolOutputs(r,n,p,{...l,signal:this.controller.signal});this._connected();for await(let _ of m)ce(this,Et,"m",Ps).call(this,_);if(m.controller.signal?.aborted)throw new ft;return this._addRun(ce(this,Et,"m",Is).call(this))}static createThreadAssistantStream(e,r,n){let s=new t;return s._run(()=>s._threadAssistantStream(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,r,n,s){let l=new t;return l._run(()=>l._runAssistantStream(e,r,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),l}currentEvent(){return ce(this,ul,"f")}currentRun(){return ce(this,fl,"f")}currentMessageSnapshot(){return ce(this,Cr,"f")}currentRunStepSnapshot(){return ce(this,Rs,"f")}async finalRunSteps(){return await this.done(),Object.values(ce(this,Lr,"f"))}async finalMessages(){return await this.done(),Object.values(ce(this,cl,"f"))}async finalRun(){if(await this.done(),!ce(this,Ei,"f"))throw Error("Final run was not received.");return ce(this,Ei,"f")}async _createThreadAssistantStream(e,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let l={...r,stream:!0},f=await e.createAndRun(l,{...n,signal:this.controller.signal});this._connected();for await(let p of f)ce(this,Et,"m",Ps).call(this,p);if(f.controller.signal?.aborted)throw new ft;return this._addRun(ce(this,Et,"m",Is).call(this))}async _createAssistantStream(e,r,n,s){let l=s?.signal;l&&(l.aborted&&this.controller.abort(),l.addEventListener("abort",()=>this.controller.abort()));let f={...n,stream:!0},p=await e.create(r,f,{...s,signal:this.controller.signal});this._connected();for await(let m of p)ce(this,Et,"m",Ps).call(this,m);if(p.controller.signal?.aborted)throw new ft;return this._addRun(ce(this,Et,"m",Is).call(this))}static accumulateDelta(e,r){for(let[n,s]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let l=e[n];if(l==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof l=="string"&&typeof s=="string")l+=s;else if(typeof l=="number"&&typeof s=="number")l+=s;else if(bs(l)&&bs(s))l=this.accumulateDelta(l,s);else if(Array.isArray(l)&&Array.isArray(s)){if(l.every(f=>typeof f=="string"||typeof f=="number")){l.push(...s);continue}for(let f of s){if(!bs(f))throw new Error(`Expected array delta entry to be an object but got: ${f}`);let p=f.index;if(p==null)throw console.error(f),new Error("Expected array delta entry to have an `index` property");if(typeof p!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${p}`);let m=l[p];m==null?l.push(f):l[p]=this.accumulateDelta(m,f)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${l}`);e[n]=l}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,s){return await this._createAssistantStream(r,e,n,s)}async _runToolAssistantStream(e,r,n,s,l){return await this._createToolAssistantStream(n,e,r,s,l)}};Ps=function(e){if(!this.ended)switch(Qt(this,ul,e,"f"),ce(this,Et,"m",hh).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ce(this,Et,"m",gh).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ce(this,Et,"m",ph).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ce(this,Et,"m",dh).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Is=function(){if(this.ended)throw new _e("stream has ended, this shouldn't happen");if(!ce(this,Ei,"f"))throw Error("Final run has not been received");return ce(this,Ei,"f")},dh=function(e){let[r,n]=ce(this,Et,"m",vh).call(this,e,ce(this,Cr,"f"));Qt(this,Cr,r,"f"),ce(this,cl,"f")[r.id]=r;for(let s of n){let l=r.content[s.index];l?.type=="text"&&this._emit("textCreated",l.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let l=s.text,f=r.content[s.index];if(f&&f.type=="text")this._emit("textDelta",l,f.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=ce(this,Do,"f")){if(ce(this,xi,"f"))switch(ce(this,xi,"f").type){case"text":this._emit("textDone",ce(this,xi,"f").text,ce(this,Cr,"f"));break;case"image_file":this._emit("imageFileDone",ce(this,xi,"f").image_file,ce(this,Cr,"f"));break}Qt(this,Do,s.index,"f")}Qt(this,xi,r.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(ce(this,Do,"f")!==void 0){let s=e.data.content[ce(this,Do,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,ce(this,Cr,"f"));break;case"text":this._emit("textDone",s.text,ce(this,Cr,"f"));break}}ce(this,Cr,"f")&&this._emit("messageDone",e.data),Qt(this,Cr,void 0,"f")}},ph=function(e){let r=ce(this,Et,"m",mh).call(this,e);switch(Qt(this,Rs,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let l of n.step_details.tool_calls)l.index==ce(this,dl,"f")?this._emit("toolCallDelta",l,r.step_details.tool_calls[l.index]):(ce(this,Jt,"f")&&this._emit("toolCallDone",ce(this,Jt,"f")),Qt(this,dl,l.index,"f"),Qt(this,Jt,r.step_details.tool_calls[l.index],"f"),ce(this,Jt,"f")&&this._emit("toolCallCreated",ce(this,Jt,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Qt(this,Rs,void 0,"f"),e.data.step_details.type=="tool_calls"&&ce(this,Jt,"f")&&(this._emit("toolCallDone",ce(this,Jt,"f")),Qt(this,Jt,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},hh=function(e){ce(this,Xu,"f").push(e),this._emit("event",e)},mh=function(e){switch(e.event){case"thread.run.step.created":return ce(this,Lr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=ce(this,Lr,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let s=Br.accumulateDelta(r,n.delta);ce(this,Lr,"f")[e.data.id]=s}return ce(this,Lr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ce(this,Lr,"f")[e.data.id]=e.data;break}if(ce(this,Lr,"f")[e.data.id])return ce(this,Lr,"f")[e.data.id];throw new Error("No snapshot available")},vh=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let l of s.delta.content)if(l.index in r.content){let f=r.content[l.index];r.content[l.index]=ce(this,Et,"m",_h).call(this,l,f)}else r.content[l.index]=l,n.push(l);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},_h=function(e,r){return Br.accumulateDelta(r,e)},gh=function(e){switch(Qt(this,fl,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Qt(this,Ei,e.data,"f"),ce(this,Jt,"f")&&(this._emit("toolCallDone",ce(this,Jt,"f")),Qt(this,Jt,void 0,"f"));break;case"thread.run.cancelling":break}};var ki=class extends ie{create(e,r,n){return this._client.post(`/threads/${e}/messages`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,r,n){return this._client.get(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,r,n,s){return this._client.post(`/threads/${e}/messages/${r}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,r={},n){return ze(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/messages`,$i,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,r,n){return this._client.delete(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}},$i=class extends Ye{};(function(t){t.MessagesPage=$i})(ki||(ki={}));var Ci=class extends ie{retrieve(e,r,n,s={},l){return ze(s)?this.retrieve(e,r,n,{},s):this._client.get(`/threads/${e}/runs/${r}/steps/${n}`,{query:s,...l,headers:{"OpenAI-Beta":"assistants=v2",...l?.headers}})}list(e,r,n={},s){return ze(n)?this.list(e,r,{},n):this._client.getAPIList(`/threads/${e}/runs/${r}/steps`,Si,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}},Si=class extends Ye{};(function(t){t.RunStepsPage=Si})(Ci||(Ci={}));var Ai=class extends ie{constructor(){super(...arguments),this.steps=new Ci(this._client)}create(e,r,n){let{include:s,...l}=r;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:l,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:r.stream??!1})}retrieve(e,r,n){return this._client.get(`/threads/${e}/runs/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,r,n,s){return this._client.post(`/threads/${e}/runs/${r}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,r={},n){return ze(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/runs`,Pi,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,r,n){return this._client.post(`/threads/${e}/runs/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(e,s.id,n)}createAndStream(e,r,n){return Br.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:l,response:f}=await this.retrieve(e,r,{...n,headers:{...n?.headers,...s}}).withResponse();switch(l.status){case"queued":case"in_progress":case"cancelling":let p=5e3;if(n?.pollIntervalMs)p=n.pollIntervalMs;else{let m=f.headers.get("openai-poll-after-ms");if(m){let _=parseInt(m);isNaN(_)||(p=_)}}await Xr(p);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return l}}}stream(e,r,n){return Br.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n,s){return this._client.post(`/threads/${e}/runs/${r}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,r,n,s){let l=await this.submitToolOutputs(e,r,n,s);return await this.poll(e,l.id,s)}submitToolOutputsStream(e,r,n,s){return Br.createToolAssistantStream(e,r,this._client.beta.threads.runs,n,s)}},Pi=class extends Ye{};(function(t){t.RunsPage=Pi,t.Steps=Ci,t.RunStepsPage=Si})(Ai||(Ai={}));var Ii=class extends ie{constructor(){super(...arguments),this.runs=new Ai(this._client),this.messages=new ki(this._client)}create(e={},r){return ze(e)?this.create({},e):this._client.post("/threads",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,r){return this._client.get(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,r,n){return this._client.post(`/threads/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,r){return this._client.delete(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:e.stream??!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.thread_id,n.id,r)}createAndRunStream(e,r){return Br.createThreadAssistantStream(e,this._client.beta.threads,r)}};(function(t){t.Runs=Ai,t.RunsPage=Pi,t.Messages=ki,t.MessagesPage=$i})(Ii||(Ii={}));var xh=async t=>{let e=await Promise.allSettled(t),r=e.filter(s=>s.status==="rejected");if(r.length){for(let s of r)console.error(s.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let s of e)s.status==="fulfilled"&&n.push(s.value);return n};var Ri=class extends ie{create(e,r,n){return this._client.post(`/vector_stores/${e}/files`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,r={},n){return ze(r)?this.list(e,{},r):this._client.getAPIList(`/vector_stores/${e}/files`,rn,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,r,n){return this._client.delete(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(e,s.id,n)}async poll(e,r,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let l=await this.retrieve(e,r,{...n,headers:s}).withResponse(),f=l.data;switch(f.status){case"in_progress":let p=5e3;if(n?.pollIntervalMs)p=n.pollIntervalMs;else{let m=l.response.headers.get("openai-poll-after-ms");if(m){let _=parseInt(m);isNaN(_)||(p=_)}}await Xr(p);break;case"failed":case"completed":return f}}}async upload(e,r,n){let s=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,r,n){let s=await this.upload(e,r,n);return await this.poll(e,s.id,n)}},rn=class extends Ye{};(function(t){t.VectorStoreFilesPage=rn})(Ri||(Ri={}));var Ti=class extends ie{create(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/file_batches/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,r,n){let s=await this.create(e,r);return await this.poll(e,s.id,n)}listFiles(e,r,n={},s){return ze(n)?this.listFiles(e,r,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${r}/files`,rn,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async poll(e,r,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:l,response:f}=await this.retrieve(e,r,{...n,headers:s}).withResponse();switch(l.status){case"in_progress":let p=5e3;if(n?.pollIntervalMs)p=n.pollIntervalMs;else{let m=f.headers.get("openai-poll-after-ms");if(m){let _=parseInt(m);isNaN(_)||(p=_)}}await Xr(p);break;case"failed":case"cancelled":case"completed":return l}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},s){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let l=s?.maxConcurrency??5,f=Math.min(l,r.length),p=this._client,m=r.values(),_=[...n];async function b(x){for(let $ of x){let P=await p.files.create({file:$,purpose:"assistants"},s);_.push(P.id)}}let y=Array(f).fill(m).map(b);return await xh(y),await this.createAndPoll(e,{file_ids:_})}};Ti||(Ti={});var Oi=class extends ie{constructor(){super(...arguments),this.files=new Ri(this._client),this.fileBatches=new Ti(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,r){return this._client.get(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,r,n){return this._client.post(`/vector_stores/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},r){return ze(e)?this.list({},e):this._client.getAPIList("/vector_stores",Ni,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,r){return this._client.delete(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},Ni=class extends Ye{};(function(t){t.VectorStoresPage=Ni,t.Files=Ri,t.VectorStoreFilesPage=rn,t.FileBatches=Ti})(Oi||(Oi={}));var Rn=class extends ie{constructor(){super(...arguments),this.vectorStores=new Oi(this._client),this.chat=new wi(this._client),this.assistants=new gi(this._client),this.threads=new Ii(this._client)}};(function(t){t.VectorStores=Oi,t.VectorStoresPage=Ni,t.Chat=wi,t.Assistants=gi,t.AssistantsPage=yi,t.Threads=Ii})(Rn||(Rn={}));var Tn=class extends ie{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}};Tn||(Tn={});var On=class extends ie{create(e,r){return this._client.post("/embeddings",{body:e,...r})}};On||(On={});var Nn=class extends ie{create(e,r){return this._client.post("/files",dr({body:e,...r}))}retrieve(e,r){return this._client.get(`/files/${e}`,r)}list(e={},r){return ze(e)?this.list({},e):this._client.getAPIList("/files",Dn,{query:e,...r})}del(e,r){return this._client.delete(`/files/${e}`,r)}content(e,r){return this._client.get(`/files/${e}/content`,{...r,__binaryResponse:!0})}retrieveContent(e,r){return this._client.get(`/files/${e}/content`,{...r,headers:{Accept:"application/json",...r?.headers}})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),l=Date.now(),f=await this.retrieve(e);for(;!f.status||!s.has(f.status);)if(await Xr(r),f=await this.retrieve(e),Date.now()-l>n)throw new Zr({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return f}},Dn=class extends kn{};(function(t){t.FileObjectsPage=Dn})(Nn||(Nn={}));var Di=class extends ie{list(e,r={},n){return ze(r)?this.list(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Fi,{query:r,...n})}},Fi=class extends Ye{};(function(t){t.FineTuningJobCheckpointsPage=Fi})(Di||(Di={}));var Mi=class extends ie{constructor(){super(...arguments),this.checkpoints=new Di(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(`/fine_tuning/jobs/${e}`,r)}list(e={},r){return ze(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Li,{query:e,...r})}cancel(e,r){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return ze(r)?this.listEvents(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Bi,{query:r,...n})}},Li=class extends Ye{},Bi=class extends Ye{};(function(t){t.FineTuningJobsPage=Li,t.FineTuningJobEventsPage=Bi,t.Checkpoints=Di,t.FineTuningJobCheckpointsPage=Fi})(Mi||(Mi={}));var Fn=class extends ie{constructor(){super(...arguments),this.jobs=new Mi(this._client)}};(function(t){t.Jobs=Mi,t.FineTuningJobsPage=Li,t.FineTuningJobEventsPage=Bi})(Fn||(Fn={}));var Mn=class extends ie{createVariation(e,r){return this._client.post("/images/variations",dr({body:e,...r}))}edit(e,r){return this._client.post("/images/edits",dr({body:e,...r}))}generate(e,r){return this._client.post("/images/generations",{body:e,...r})}};Mn||(Mn={});var Ln=class extends ie{retrieve(e,r){return this._client.get(`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",Bn,e)}del(e,r){return this._client.delete(`/models/${e}`,r)}},Bn=class extends kn{};(function(t){t.ModelsPage=Bn})(Ln||(Ln={}));var Kn=class extends ie{create(e,r){return this._client.post("/moderations",{body:e,...r})}};Kn||(Kn={});var Ki=class extends ie{create(e,r,n){return this._client.post(`/uploads/${e}/parts`,dr({body:r,...n}))}};Ki||(Ki={});var Wn=class extends ie{constructor(){super(...arguments),this.parts=new Ki(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(`/uploads/${e}/complete`,{body:r,...n})}};(function(t){t.Parts=Ki})(Wn||(Wn={}));var Sh,Je=class extends Ja{constructor({baseURL:e=ys("OPENAI_BASE_URL"),apiKey:r=ys("OPENAI_API_KEY"),organization:n=ys("OPENAI_ORG_ID")??null,project:s=ys("OPENAI_PROJECT_ID")??null,...l}={}){if(r===void 0)throw new _e("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let f={apiKey:r,organization:n,project:s,...l,baseURL:e||"https://api.openai.com/v1"};if(!f.dangerouslyAllowBrowser&&Xp())throw new _e(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:f.baseURL,timeout:f.timeout??6e5,httpAgent:f.httpAgent,maxRetries:f.maxRetries,fetch:f.fetch}),this.completions=new Tn(this),this.chat=new $n(this),this.embeddings=new On(this),this.files=new Nn(this),this.images=new Mn(this),this.audio=new Cn(this),this.moderations=new Kn(this),this.models=new Ln(this),this.fineTuning=new Fn(this),this.beta=new Rn(this),this.batches=new Sn(this),this.uploads=new Wn(this),this._options=f,this.apiKey=r,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Ru(e,{arrayFormat:"brackets"})}};Sh=Je;Je.OpenAI=Sh;Je.DEFAULT_TIMEOUT=6e5;Je.OpenAIError=_e;Je.APIError=st;Je.APIConnectionError=Gr;Je.APIConnectionTimeoutError=Zr;Je.APIUserAbortError=ft;Je.NotFoundError=ko;Je.ConflictError=$o;Je.RateLimitError=So;Je.BadRequestError=wo;Je.AuthenticationError=xo;Je.InternalServerError=Ao;Je.PermissionDeniedError=Eo;Je.UnprocessableEntityError=Co;Je.toFile=Eu;Je.fileFromPath=Ua;var{OpenAIError:hO,APIError:mO,APIConnectionError:vO,APIConnectionTimeoutError:_O,APIUserAbortError:gO,NotFoundError:yO,ConflictError:bO,RateLimitError:wO,BadRequestError:xO,AuthenticationError:EO,InternalServerError:kO,PermissionDeniedError:$O,UnprocessableEntityError:CO}=Su;(function(t){t.Page=kn,t.CursorPage=Ye,t.Completions=Tn,t.Chat=$n,t.Embeddings=On,t.Files=Nn,t.FileObjectsPage=Dn,t.Images=Mn,t.Audio=Cn,t.Moderations=Kn,t.Models=Ln,t.ModelsPage=Bn,t.FineTuning=Fn,t.Beta=Rn,t.Batches=Sn,t.BatchesPage=An,t.Uploads=Wn})(Je||(Je={}));var Gu=Je;var hl=class{constructor(e,r){this.client=new Gu({apiKey:e,dangerouslyAllowBrowser:!0}),this.apiKey=e,this.model=r}get displayName(){return`OpenAI ${this.model}`}async*createStreamingChatCompletion(e,r){if(this.apiKey==="")throw new Error("OpenAI API key is not set");let n=await this.client.chat.completions.create({model:this.model,stream:!0,messages:e.map(p=>({role:p.role,content:eo(p.content,p.attachedContent)})),stream_options:{include_usage:!0},max_tokens:r.maxTokens,temperature:pl(r.temperature)}),s=0,l=0,f=0;yield{type:"start"};for await(let p of n)p.usage&&(s+=p.usage.prompt_tokens,l+=p.usage.completion_tokens,f+=p.usage.prompt_tokens_details?.cached_tokens??0),p.choices.length>0&&(yield{content:p.choices[0].delta.content??"",type:"delta"});yield{type:"stop",usage:{inputTokens:s,outputTokens:l,cachedInputTokens:f},temeperature:pl(r.temperature)}}async createChatCompletion(e,r){if(this.apiKey==="")throw new Error("OpenAI API key is not set");return{content:(await this.client.chat.completions.create({model:this.model,messages:e.map(s=>({role:s.role,content:eo(s.content,s.attachedContent)})),max_tokens:r.maxTokens,temperature:pl(r.temperature)})).choices[0].message.content,role:"assistant",attachedContent:[]}}async createJSONCompletion(e,r,n){if(this.apiKey==="")throw new Error("OpenAI API key is not set");let s=await this.client.chat.completions.create({model:this.model,messages:[{role:"system",content:e},{role:"user",content:r}],response_format:{type:"json_object"},max_tokens:n.maxTokens,temperature:pl(n.temperature)});try{return JSON.parse(s.choices[0].message.content)}catch(l){throw new Error(`LLM response could not be parsed to JSON schema: ${l}
Response: ${s.choices[0].message.content}`)}}};function pl(t){switch(t){case"balanced":return .5;case"creative":return 1;case"precise":return .2}}var $g="gpt-4o-mini-2024-07-18",Cg=.1,Ah="text-embedding-3-small",ml=class{constructor(e){this.client=new Gu({apiKey:e,dangerouslyAllowBrowser:!0}),this.apiKey=e}async embedNode(e){if(this.apiKey==="")throw new Error("OpenAI API key is not set. Note embeddings always use the OpenAI API and need an API key regardless of the LLM setting.");return(await this.client.embeddings.create({input:Zi(e),model:Ah})).data[0].embedding}async embedQuery(e){if(this.apiKey==="")throw new Error("OpenAI API key is not set. Embeddings always use the OpenAI API and need an API key regardless of the LLM setting.");let r=await this.improveQuery(e),n=await this.client.embeddings.create({input:r,model:Ah});return{originalQuery:e,improvedQuery:r,embedding:n.data[0].embedding}}async improveQuery(e){let r=[{role:"system",content:ed},...td.flatMap(s=>[{role:"user",content:s.input},{role:"assistant",content:s.output}]),{role:"user",content:e}];return(await this.client.chat.completions.create({messages:r,model:$g,temperature:Cg})).choices[0].message.content}};var Fo=au(ut,t=>{let e=t.questionAndAnswerModel;if(e.startsWith("gpt"))return new hl(t.openAIApiKey,e);if(e.startsWith("claude"))return new Va(t.anthropicApikey,e);throw new Error("Invalid model: "+e)});async function Ph(t,e){let r={temperature:"precise",maxTokens:512};return(await e.createChatCompletion([{role:"system",content:nd,attachedContent:[]},{role:"user",content:t,attachedContent:[]}],r)).content}async function Ih(t,e){let r={temperature:"precise",maxTokens:1024};return(await e.createJSONCompletion(id,t,r)).topics}Dd();function Wi(t){}var Rh=require("obsidian");var Sg=ne("<span></span>");function Pe(t,e){Fe(e,!0);let r;Ht(()=>{r&&(r.replaceChildren(),(0,Rh.setIcon)(r,e.iconId))});var n=Sg();Jr(n,s=>r=s,()=>r),ke(()=>xr(n,`size-${e.size??"m"??""} color-${e.color??"muted"??""} ${e.className??""} svelte-1cfhmlc`)),X(t,n),Me()}var Ag=zc('<svg version="1.1" id="L5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 0 0" xml:space="preserve"><circle fill="var(--text-normal)" stroke="none" cx="6" cy="50" r="6"><animateTransform attributeName="transform" dur="1s" type="translate" values="0 15 ; 0 -15; 0 15" repeatCount="indefinite" begin="0.1"></animateTransform></circle><circle fill="var(--text-normal)" stroke="none" cx="30" cy="50" r="6"><animateTransform attributeName="transform" dur="1s" type="translate" values="0 10 ; 0 -10; 0 10" repeatCount="indefinite" begin="0.2"></animateTransform></circle><circle fill="var(--text-normal)" stroke="none" cx="54" cy="50" r="6"><animateTransform attributeName="transform" dur="1s" type="translate" values="0 5 ; 0 -5; 0 5" repeatCount="indefinite" begin="0.3"></animateTransform></circle></svg>');function ji(t,e){"use strict";var r=Ag();ke(()=>ru(r,`size-${e.size??""} svelte-l055uv`)),X(t,r)}var Pg=async(t,e,r,n,s)=>{A(e)&&(await ja(r.db,A(e).path),n(A(e)),s(A(e)))},Ig=(t,e,r)=>A(e)?.path&&r.onOpenNoteChat(A(e)?.path),Rg=(t,e,r)=>A(e)?.path&&r.onOpenWorkspace(A(e)?.path),Tg=ne('<div class="text-sm text-muted">Loading <span class="relative top-1"><!></span></div>'),Og=ne('<div class="text-sm font-medium">Summary</div> <p class="mt-1 select-text text-sm"> </p>',1),Ng=(t,e,r)=>e(A(r).file?.path??""),Dg=ne('<a href="#"> </a>'),Fg=(t,e,r)=>e(A(r).name),Mg=ne('<div class="group flex flex-row items-center"><span class="mr-1 select-text"> </span> <button class="clickable-icon invisible group-hover:visible" aria-label="Create note"><!></button></div>'),Lg=ne("<li><!></li>"),Bg=ne('<div class="text-sm font-medium">Key topics</div> <ul class="mt-1 text-sm"></ul>',1),Kg=ne("<!> <!>",1),Wg=ne(`<p class="text-sm">Note is too short to generate context data for. You can adjust the threshold in the
			plugin settings.</p>`),jg=ne('<p class="w-full text-center text-sm text-muted">No file is open</p>'),qg=ne('<!> <div class="mb-2 flex flex-row justify-center"><button class="clickable-icon" aria-label="Recompute" data-tooltip-delay="300"><!></button> <button class="clickable-icon" aria-label="Chat with note" data-tooltip-delay="300"><!></button> <button class="clickable-icon" aria-label="Open note as LLM workspace" data-tooltip-delay="300"><!></button></div> <!> <!>',1);function Zu(t,e){Fe(e,!0);let r=Er(),n=()=>Ve(At,"$appStore",r),s=()=>Ve(ut,"$settingsStore",r),l=()=>Ve(A(b),"$derivedData",r),f=()=>Ve(Fo,"$llmClient",r),p,m=tt(qe(n().workspace.getActiveFile()));Ht(()=>{let ye=Re=>{le(m,qe(Re))};return n().workspace.on("file-open",ye),()=>n().workspace.off("file-open",ye)});let _=xe(async()=>A(m)?(await n().vault.cachedRead(A(m))).length>=s().noteContextMinChars:!1),b=xe(()=>(A(m),Xn(async()=>{if(A(m))return await vs(e.db,A(m).path)}))),y=xe(()=>{var ye,Re;return(Re=(ye=l()===null||l()===void 0?void 0:l().keyTopics)===null||ye===void 0?void 0:ye.map(je=>({name:je,file:n().metadataCache.getFirstLinkpathDest(je,"")})))!==null&&Re!==void 0?Re:[]}),x=tt(!1),$=async ye=>{let Re=await n().vault.cachedRead(ye);if(!(Re.length<s().noteContextMinChars))try{le(x,!0);let je=await Ph(Re,f());await Ap(e.db,ye.path,je)}catch(je){console.error(je)}finally{le(x,!1)}},P=async ye=>{let Re=await n().vault.cachedRead(ye);if(!(Re.length<s().noteContextMinChars))try{le(x,!0);let je=await Ih(Re,f());await Pp(e.db,ye.path,je)}catch(je){console.error(je)}finally{le(x,!1)}};Ht(()=>{!A(m)||s().openAIApiKey===""||!p||!p.isShown()||vs(e.db,A(m).path).then(ye=>{!ye&&A(m)&&($(A(m)),P(A(m)))})});let F=ye=>{n().workspace.openLinkText(ye,"","tab")},j=async ye=>{let Re=`${ye}.md`;await n().vault.create(Re,""),F(Re)};var z=qg(),N=Ze(z);Wi(N,{});var H=Y(N,2),V=W(H);V.__click=[Pg,m,e,P,$];var Q=W(V);Pe(Q,{iconId:"refresh-cw",size:"m"}),B(V);var G=Y(V,2);G.__click=[Ig,m,e];var J=W(G);Pe(J,{iconId:"message-square",size:"m"}),B(G);var U=Y(G,2);U.__click=[Rg,m,e];var ue=W(U);Pe(ue,{iconId:"library-big",size:"m"}),B(U),B(H),Jr(H,ye=>p=ye,()=>p);var ge=Y(H,2);Se(ge,()=>A(x),ye=>{var Re=Tg(),je=Y(W(Re)),Dt=W(je);ji(Dt,{size:"s"}),B(je),B(Re),X(ye,Re)});var $e=Y(ge,2);Xc($e,()=>A(_),null,(ye,Re)=>{var je=wr(),Dt=Ze(je);Se(Dt,()=>A(Re),Kr=>{var kt=Kg(),Ft=Ze(kt);Se(Ft,()=>l()?.summary,Gt=>{var Zt=Og(),pr=Y(Ze(Zt),2),Te=W(pr,!0);B(pr),ke(()=>Le(Te,l().summary)),X(Gt,Zt)});var Xt=Y(Ft,2);Se(Xt,()=>A(y)&&A(y).length>0,Gt=>{var Zt=Bg(),pr=Y(Ze(Zt),2);wt(pr,21,()=>A(y),Qr,(Te,be)=>{var Oe=Lg(),Ie=W(Oe);Se(Ie,()=>A(be).file,Ne=>{var Xe=Dg();Xe.__click=[Ng,F,be];var at=W(Xe,!0);B(Xe),ke(()=>Le(at,A(be).name)),X(Ne,Xe)},Ne=>{var Xe=Mg(),at=W(Xe),$t=W(at,!0);B(at);var nn=Y(at,2);nn.__click=[Fg,j,be];var er=W(nn);Pe(er,{iconId:"file-plus",size:"xs"}),B(nn),B(Xe),ke(()=>Le($t,A(be).name)),X(Ne,Xe)}),B(Oe),X(Te,Oe)}),B(pr),X(Gt,Zt)}),X(Kr,kt)},Kr=>{var kt=wr(),Ft=Ze(kt);Se(Ft,()=>A(m),Xt=>{var Gt=Wg();X(Xt,Gt)},Xt=>{var Gt=jg();X(Xt,Gt)},!0),X(Kr,kt)}),X(ye,je)}),ke(()=>{V.disabled=A(m)==null,G.disabled=A(m)==null,U.disabled=A(m)==null}),X(t,z),Me()}ot(["click"]);var Ts="llm-note-context-view",vl=class extends Th.ItemView{constructor(r,n,s,l,f){super(r);this.icon="brain-circuit";this.navigation=!1;this.settings=n,this.db=s,this.openNoteChat=l,this.openWorkspace=f}getViewType(){return Ts}getDisplayText(){return"Note context"}async onOpen(){ut.set(this.settings),At.set(this.app),En.set(this),this.component=Nr(Zu,{target:this.contentEl,props:{db:this.db,onOpenNoteChat:this.openNoteChat,onOpenWorkspace:this.openWorkspace}})}async onClose(){Yr(this.component)}};var Wh=require("obsidian");var Kh=require("obsidian");var _l=(t,e,r)=>{let n=kr(null),s=()=>n.set(null),l=async(f,p)=>{let m=Ka(n);if(!m||!m.queryResponse){m={initialUserQuery:f,queryResponse:null,additionalMessages:[],isLoading:!0,error:null},n.set(m);try{for await(let _ of t.query(f,p))m.queryResponse=_,m.isLoading=!0,n.set(m);m.isLoading=!1,n.set(m)}catch(_){console.error(_),m.isLoading=!1,_ instanceof Error&&_.message==="Unexpected status code: 401"?m.error=new Error("Unauthorized. Did you set the right API key?"):m.error=_,n.set(m)}}else{m.additionalMessages.push({role:"user",content:f,attachedContent:p}),m.isLoading=!0,n.set(m);let _=[{role:"system",content:m.queryResponse.systemPrompt,attachedContent:[]},{role:"user",content:m.queryResponse.userPrompt,attachedContent:[]},{role:"assistant",content:m.queryResponse.text,attachedContent:[]},...m.additionalMessages];try{let b=e.createStreamingChatCompletion(_,r);for await(let y of b){switch(y.type){case"start":m.isLoading=!0,m.additionalMessages.push({role:"assistant",content:"",attachedContent:[]});break;case"delta":m.isLoading=!0,m.additionalMessages.length>0&&m.additionalMessages.last().role==="assistant"&&(m.additionalMessages.last().content+=y.content);break;case"stop":m.isLoading=!1}n.set(m)}}catch(b){m.isLoading=!1,m.error=b,n.set(m)}}};return{subscribe:n.subscribe,submitMessage:l,resetConversation:s}};var Vg=10,Oh=1e3;async function Nh(t,e,r){let n=await zg(r,e),s={temperature:"creative",maxTokens:1024};return(await t.createJSONCompletion(od,n,s)).questions}async function zg(t,e){let r=t.sort(()=>Math.random()-.5).slice(0,Vg);return(await Promise.all(r.map(async s=>{let l=e.getFileByPath(s.path);if(!l)return"";let f=await e.cachedRead(l);return f.length<Oh?f:f.slice(0,Oh)+"... (truncated)"}))).map((s,l)=>`### Source ${l+1}

${s}`).join(`

---

`)}var gl=class{constructor(e,r,n){this.retriever=e,this.synthesizer=r,this.workspaceFilePath=n}async*query(e,r){let n=await this.retriever.retrieve(e,this.workspaceFilePath),s=[...n.nodes,...r.map(l=>({node:l,similarity:1}))];yield*this.synthesizer.synthesize(e,s,n.improvedQuery)}},yl=class{constructor(e,r,n){this.synthesizer=e,this.content=r,this.notePath=n}async*query(e,r){let n=[{node:{content:this.content,parent:this.notePath,createdAt:new Date().valueOf()},similarity:1},...r.map(s=>({node:s,similarity:1}))];yield*this.synthesizer.synthesize(e,n,e)}};var bl=class{constructor(e,r,n){this.index=e,this.embeddingClient=r,this.options=n}async retrieve(e,r){let n=await this.embeddingClient.embedQuery(e);return{nodes:await this.index.query(n.embedding,r,this.options.limit),improvedQuery:n.improvedQuery}}};var Mo=class{constructor(e,r,n,s=null){this.completionClient=e,this.completionOptions=r,this.systemPrompt=n,this.workspaceContext=s}async*synthesize(e,r,n){let s=r.sort((_,b)=>_.similarity-b.similarity).map(_=>Zi(_.node)).join(`

${rs}

`);this.workspaceContext&&(s+=`

${rs}

`,s+="High-level context provided by the user: ",s+=this.workspaceContext);let l=rd(s,e),f=this.systemPrompt,p=this.completionClient.createStreamingChatCompletion([{role:"system",content:f,attachedContent:[]},{role:"user",content:l,attachedContent:[]}],this.completionOptions),m="";for await(let _ of p)switch(_.type){case"start":{yield{text:m,sources:r,retrievalDetails:{originalQuery:e,improvedQuery:n},systemPrompt:f,userPrompt:l};break}case"delta":{m+=_.content,yield{text:m,sources:r,retrievalDetails:{originalQuery:e,improvedQuery:n},systemPrompt:f,userPrompt:l};break}case"stop":yield{text:m,sources:r,retrievalDetails:{originalQuery:e,improvedQuery:n},systemPrompt:f,userPrompt:l,debugInfo:{createdAt:Date.now(),inputTokens:_.usage?.inputTokens,cachedInputTokens:_.usage?.cachedInputTokens,outputTokens:_.usage?.outputTokens,temperature:_.temeperature}}}}};var RN=require("obsidian");async function wl(t,e){let r="LLM workspace debug.md",n=t.metadataCache.getFirstLinkpathDest(r,""),s=Ug(e);n&&await t.vault.delete(n),await t.vault.create(r,s),await t.workspace.openLinkText(r,"","tab")}function Ug(t){return t.debugInfo?`
### ${window.moment(t.debugInfo.createdAt).format("YYYY-MM-DD HH:mm:ss")}

**Original Query**: ${t.retrievalDetails?.originalQuery}
**Query used for embedding**: ${t.retrievalDetails?.improvedQuery}
**Input tokens**: ${t.debugInfo.inputTokens??"N/A"}
**Cached input tokens**: ${t.debugInfo.cachedInputTokens??"N/A"}
**Output tokens**: ${t.debugInfo.outputTokens??"N/A"}
**Temperature**: ${t.debugInfo.temperature}

#### System Prompt

\`\`\`
${t.systemPrompt}
\`\`\`

#### User Prompt

\`\`\`
${t.userPrompt}
\`\`\`
`:""}var Hg=ne('<div class="rounded bg-error p-2 text-on-accent"><p class="font-medium"> </p> <p class="text-sm"> </p></div>');function Os(t,e){let r=xn(e,"title",8,"Something went wrong"),n=xn(e,"body",8);var s=Hg(),l=W(s),f=W(l,!0);B(l);var p=Y(l,2),m=W(p,!0);B(p),B(s),ke(()=>{Le(f,r()),Le(m,n())}),X(t,s)}var Yg=ne('<div class="my-2 flex flex-row"><div><!></div> <div class="ml-1 mr-1 text-sm text-muted"> </div> <div class="text-sm"> </div></div>');function jn(t,e){var r=Yg(),n=W(r),s=W(n);Pe(s,{get iconId(){return e.iconId},size:"s"}),B(n);var l=Y(n,2),f=W(l);B(l);var p=Y(l,2),m=W(p,!0);B(p),B(r),ke(()=>{Le(f,`${e.label??""}:`),Le(m,e.value)}),X(t,r)}var Qg=(t,e,r)=>e.onChange(A(r)),Jg=ne("<button> </button>"),Xg=ne('<div class="my-4 flex flex-col items-center"><div class="mb-1 text-sm text-muted">Conversation style</div> <div class="flex flex-row gap-x-1 rounded bg-secondary p-1"></div></div>');function Ns(t,e){Fe(e,!0);let r=["creative","balanced","precise"];var n=Xg(),s=Y(W(n),2);wt(s,21,()=>r,Qr,(l,f)=>{var p=Jg();p.__click=[Qg,e,f];var m=W(p,!0);B(p),ke(()=>{xr(p,"capitalize !shadow-none "+(e.temperature===A(f)?"!bg-interactive-accent !text-on-accent hover:!bg-interactive-accent-hover":"bg-interactive hover:bg-interactive-hover")),Le(m,A(f))}),X(l,p)}),B(s),B(n),X(t,n),Me()}ot(["click"]);var Mh=require("obsidian");var Dh=require("obsidian");var Gg=ne("<div></div>");function Lo(t,e){Fe(e,!0);let r=Er(),n=()=>Ve(At,"$appStore",r),s=()=>Ve(En,"$viewStore",r),l=xn(e,"className",3,""),f;Ht(()=>{f&&(f.replaceChildren(),Dh.MarkdownRenderer.render(n(),e.source,f,"",s()))});var p=Gg();Jr(p,m=>f=m,()=>f),ke(()=>xr(p,l())),X(t,p),Me()}var ef=Gi(require("node:path")),Zg=ne('<div class="flex flex-row items-center rounded border border-solid border-border bg-primary px-1 py-0.5 text-sm"> </div>'),ey=(t,e)=>e.onCopy(e.message.content),ty=ne('<button class="clickable-icon" aria-label="Copy response" data-tooltip-delay="300"><!></button>'),ry=ne('<div class="flex flex-row items-baseline"><!> <!></div> <div class="flex w-full flex-row pl-5"><div class="flex flex-grow flex-row flex-wrap gap-1"></div> <!></div>',1);function xl(t,e){Fe(e,!0);var r=ry(),n=Ze(r),s=W(n);Se(s,()=>e.message.role==="user",b=>{Pe(b,{iconId:"user",size:"s",className:"mr-2 flex-none relative top-0.5"})},b=>{var y=wr(),x=Ze(y);Se(x,()=>e.message.role==="assistant",$=>{Pe($,{iconId:"sparkles",size:"s",className:"mr-2 flex-none relative top-0.5"})},null,!0),X(b,y)});var l=Y(s,2),f=xe(()=>(e.message.role==="user"?"text-accent font-medium":"")+" grow select-text");Lo(l,{get source(){return e.message.content},get className(){return A(f)}}),B(n);var p=Y(n,2),m=W(p);wt(m,21,()=>e.message.attachedContent,b=>b.parent,(b,y)=>{var x=Zg(),$=W(x,!0);ke(()=>Le($,ef.default.basename(A(y).parent,ef.default.extname(A(y).parent)))),B(x),X(b,x)}),B(m);var _=Y(m,2);Se(_,()=>e.message.role==="assistant",b=>{var y=ty();y.__click=[ey,e];var x=W(y);Pe(x,{iconId:"copy",size:"s"}),B(y),X(b,y)},b=>{var y=wr(),x=Ze(y);Se(x,()=>e.message.role==="user",$=>{},null,!0),X(b,y)}),B(p),X(t,r),Me()}ot(["click"]);var tf=Gi(require("node:path")),ny=(t,e,r)=>e.onClick(A(r).path),iy=ne('<li class="mb-1"><a href="#"> </a> <span aria-label="Relevance score" data-tooltip-delay="300" data-tooltip-position="top" class="ml-1 rounded-md bg-secondary px-1 py-0.5 font-mono text-xs"> </span></li>'),oy=ne('<div class="mt-2 rounded bg-primary-alt p-3"><div class="font-medium">Sources:</div> <ol class="mb-0 mt-2"></ol></div>');function rf(t,e){Fe(e,!0);let r=xe(()=>{let l=[];for(let f of e.queryResponse.sources){let p=l.find(m=>m.path===f.node.parent);p?p.similarity=Math.max(p.similarity,f.similarity):l.push({base:tf.default.basename(f.node.parent,tf.default.extname(f.node.parent)),path:f.node.parent,similarity:f.similarity})}return l.sort((f,p)=>p.similarity-f.similarity),l});var n=oy(),s=Y(W(n),2);wt(s,21,()=>A(r),Qr,(l,f)=>{var p=iy(),m=W(p);m.__click=[ny,e,f];var _=W(m,!0);B(m);var b=Y(m,2),y=W(b);ke(()=>Le(y,`${Math.round(A(f).similarity*100)??""}%`)),B(b),B(p),ke(()=>Le(_,A(f).base)),X(l,p)}),B(s),B(n),X(t,n),Me()}ot(["click"]);var Fh=require("obsidian");var Bo=require("obsidian");async function of(t,e,r){let n=[];r?Bo.Vault.recurseChildren(r,f=>{f instanceof Bo.TFile&&n.push(f)}):n=t.vault.getMarkdownFiles();let s=new nf(t,n,e),l=r?r.path:"vault";s.setPlaceholder(`Select a file from ${l}`),s.open()}var nf=class extends Bo.FuzzySuggestModal{constructor(e,r,n){super(e),this.files=r,this.onSelect=n}getItems(){return this.files}getItemText(e){return e.basename}onChooseItem(e,r){this.onSelect(e)}};var sy=(t,e,r)=>{le(e,""),r.onNewConversation()},ay=(t,e,r)=>A(e).remove(A(r)),ly=ne('<div class="flex flex-row items-center rounded border border-solid border-border bg-primary px-1 py-0.5 text-sm"> <button class="ml-1 h-fit w-fit bg-transparent p-0 !shadow-none hover:shadow-none"><!></button></div>'),cy=(t,e)=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),e(new SubmitEvent("submit")))},uy=async(t,e,r)=>{let n=t.target;if(n.selectionStart!=n.selectionEnd)return;let s=n.selectionStart;n.value.length>=2&&n.value[s-1]==="["&&n.value[s-2]==="["&&e(s),n.value.length>=1&&n.value[s-1]==="@"&&r(s)},fy=ne('<button class="clickable-icon" aria-label="New conversation"><!></button>'),dy=ne('<form class="fixed bottom-11 left-4 right-4"><div class="flex flex-row flex-wrap gap-1 py-2"></div> <div class="flex flex-row gap-x-2"><textarea class="text-normal w-full resize-y bg-secondary"></textarea> <div class="flex flex-col justify-center gap-y-2"><button class="clickable-icon" type="submit" aria-label="Send message"><!></button> <!></div></div></form>');function sf(t,e){Fe(e,!0);let r=Er(),n=()=>Ve(At,"$appStore",r),s=()=>Ve(ut,"$settingsStore",r),l=`\u21E7 + \u23CE: line break
[[: attach file
@: insert prompt`,f=4,p=8,m=tt(""),_=tt(f),b=tt(qe([])),y=G=>{G.preventDefault(),e.onSubmit(A(m),A(b)),le(m,""),le(_,f),le(b,qe([]))},x=async G=>{le(m,A(m).slice(0,G-2)+A(m).slice(G));let J=U=>{A(b).some(ue=>ue.path===U.path)||A(b).push(U)};await of(n(),J)},$=async G=>{le(m,A(m).slice(0,G-1)+A(m).slice(G));let J=async ue=>{let ge=await n().vault.cachedRead(ue);le(m,A(m)+" "+ge),le(_,p)},U=n().vault.getFolderByPath(s().promptFolder);if(!U){new Fh.Notice(`Prompt folder not found: ${s().promptFolder}`,1e3);return}await of(n(),J,U)};var P=dy(),F=W(P);wt(F,21,()=>A(b),G=>G.basename,(G,J)=>{var U=ly(),ue=W(U),ge=Y(ue);ge.__click=[ay,b,J];var $e=W(ge);Pe($e,{iconId:"x",size:"s"}),B(ge),B(U),ke(()=>Le(ue,`${A(J).basename??""} `)),X(G,U)}),B(F);var j=Y(F,2),z=W(j);Kc(z),Oa(z,!0),z.__keydown=[cy,y],z.__input=[uy,x,$];var N=Y(z,2),H=W(N);ke(()=>H.disabled=e.disabled||A(m).trim()=="");var V=W(H);Pe(V,{iconId:"send"}),B(H);var Q=Y(H,2);Se(Q,()=>e.isConversationActive,G=>{var J=fy();J.__click=[sy,m,e];var U=W(J);Pe(U,{iconId:"list-restart"}),B(J),X(G,J)}),B(N),B(j),B(P),ke(()=>{_o(z,"rows",A(_)),_o(z,"placeholder",(e.isConversationActive?"Continue conversation...":"Ask a question...")+`
`+l)}),Vc("submit",P,y),nu(z,()=>A(m),G=>le(m,G)),X(t,P),Me()}ot(["click","keydown","input"]);var py=ne('<div class="flex flex-row items-center svelte-k0aztr"><!> <div aria-label="Query used for retrieving relevant notes" data-tooltip-delay="300" class="svelte-k0aztr"><!></div></div>'),hy=(t,e,r)=>e(r.conversation?.queryResponse?.text??""),my=(t,e)=>{e.conversation?.queryResponse?.debugInfo&&e.onDebugClick(e.conversation.queryResponse)},vy=ne('<!> <div class="flex flex-row items-baseline svelte-k0aztr"><!> <!></div> <div class="mb-1 flex w-full flex-row justify-end svelte-k0aztr"><button class="clickable-icon svelte-k0aztr" aria-label="Copy response" data-tooltip-delay="300"><!></button> <button class="clickable-icon svelte-k0aztr" aria-label="Debug response" data-tooltip-delay="300"><!></button></div> <!>',1),_y=ne('<div class="flex flex-row items-baseline svelte-k0aztr"><!> <div class="relative top-2 svelte-k0aztr"><!></div></div>'),gy=ne('<div class="flex flex-row justify-start svelte-k0aztr"><!> <p class="text-sm svelte-k0aztr">Note content has changed</p> <button class="clickable-icon svelte-k0aztr" aria-label="Start new conversation" data-tooltip-delay="300"><!></button></div>'),yy=ne('<div class="grow svelte-k0aztr"><!> <!> <!> <!> <!> <!></div>'),by=ne('<div class="conversation-scroller relative grow pb-36 svelte-k0aztr"><!> <div id="scroll-anchor" class="svelte-k0aztr"></div> <!></div>');function Ds(t,e){Fe(e,!0);let r=m=>{navigator.clipboard.writeText(m),new Mh.Notice("Copied to clipboard",1e3)};var n=by(),s=W(n);Se(s,()=>e.conversation,m=>{var _=yy(),b=W(_);Se(b,()=>e.conversation.initialUserQuery,j=>{var z=xe(()=>({role:"user",content:e.conversation.initialUserQuery,attachedContent:[]}));xl(j,{get message(){return A(z)},onCopy:N=>r(N),onEdit:N=>{}})});var y=Y(b,2);Se(y,()=>e.conversation.queryResponse,j=>{var z=vy(),N=Ze(z);Se(N,()=>e.conversation.queryResponse.retrievalDetails?.originalQuery!=e.conversation.queryResponse.retrievalDetails?.improvedQuery,ye=>{var Re=py(),je=W(Re);Pe(je,{size:"s",iconId:"target",className:"mr-2"});var Dt=Y(je,2),Kr=W(Dt),kt=xe(()=>e.conversation.queryResponse.retrievalDetails?.improvedQuery??"");Lo(Kr,{className:"grow select-text text-faint",get source(){return A(kt)}}),B(Dt),B(Re),X(ye,Re)});var H=Y(N,2),V=W(H);Pe(V,{iconId:"sparkles",size:"s",className:"mr-2 flex-none relative top-1"});var Q=Y(V,2);Lo(Q,{className:"grow select-text",get source(){return e.conversation.queryResponse.text}}),B(H);var G=Y(H,2),J=W(G);J.__click=[hy,r,e];var U=W(J);Pe(U,{iconId:"copy",size:"s"}),B(J);var ue=Y(J,2);ue.__click=[my,e];var ge=W(ue);Pe(ge,{iconId:"bug-play",size:"s"}),B(ue),B(G);var $e=Y(G,2);Se($e,()=>e.conversation.queryResponse.sources.length>1,ye=>{rf(ye,{get queryResponse(){return e.conversation.queryResponse},get onClick(){return e.onSourceClick}})}),X(j,z)});var x=Y(y,2);wt(x,17,()=>e.conversation.additionalMessages,j=>j.content,(j,z)=>{xl(j,{get message(){return A(z)},onCopy:N=>r(N),onEdit:N=>{}})});var $=Y(x,2);Se($,()=>e.conversation.isLoading,j=>{var z=_y(),N=W(z);Pe(N,{iconId:"sparkles",size:"s",className:"mr-2 flex-none relative top-1"});var H=Y(N,2),V=W(H);ji(V,{size:"l"}),B(H),B(z),X(j,z)});var P=Y($,2);Se(P,()=>e.isOutdated,j=>{var z=gy(),N=W(z);Pe(N,{iconId:"file-warning",size:"s",className:"mr-2"});var H=Y(N,4);H.__click=function(...Q){e.onReload?.apply(this,Q)};var V=W(H);Pe(V,{iconId:"refresh-cw",size:"s"}),B(H),B(z),X(j,z)});var F=Y(P,2);Se(F,()=>e.conversation.error,j=>{Os(j,{get body(){return e.conversation.error}})}),B(_),X(m,_)},m=>{var _=wr(),b=Ze(_);eu(b,e,"empty",{},null),X(m,_)});var l=Y(s,4),f=xe(()=>e.conversation?.isLoading??!1),p=xe(()=>e.conversation!=null);sf(l,{get disabled(){return A(f)},get isConversationActive(){return A(p)},get onSubmit(){return e.onMessageSubmit},get onNewConversation(){return e.onNewConversation}}),B(n),X(t,n),Me()}ot(["click"]);var wy=(t,e)=>e.onLinkClick(e.fileInfo.path),xy=(t,e)=>le(e,!A(e)),Ey=ne('<div class="link-parent"><!> <span class="text-sm"> </span></div>'),ky=(t,e)=>e.onLinkRebuild(e.fileInfo),$y=ne('<div class="flex flex-col"><div class="flex flex-row"><span class="mr-1 mt-[1px] self-baseline" data-tooltip-position="top" data-tooltip-delay="300"><!></span> <div class="grow"><a href="#" class="text-sm"> </a></div> <button class="clickable-icon ml-1 self-center"><!></button></div> <div><!> <div><!> <span class="text-sm"> </span></div> <button class="mt-2">Re-index file</button></div></div>');function af(t,e){Fe(e,!0);let r=tt(!0),n=tt(qe(window.moment()));Ep(()=>{let Q=setInterval(()=>{A(r)||le(n,qe(window.moment()))},6e4);return()=>clearInterval(Q)});let s=xe(()=>{let Q=window.moment(e.fileInfo.lastProcessed).from(A(n));switch(e.fileInfo.nodeCount){case 0:return"Not indexed yet";case 1:return`Indexed as 1 node ${Q}`;default:return`Indexed as ${e.fileInfo.nodeCount} nodes ${Q}`}});var l=$y(),f=W(l),p=W(f),m=W(p);Se(m,()=>e.fileInfo.nodeCount===0,Q=>{Pe(Q,{iconId:"file-x",size:"s",color:"error"})},Q=>{Pe(Q,{iconId:"file-check-2",size:"s",color:"success"})}),B(p);var _=Y(p,2),b=W(_);b.__click=[wy,e];var y=W(b,!0);B(b),B(_);var x=Y(_,2);x.__click=[xy,r];var $=W(x);Se($,()=>A(r),Q=>{Pe(Q,{iconId:"chevron-down",size:"s"})},Q=>{Pe(Q,{iconId:"chevron-up",size:"s"})}),B(x),B(f);var P=Y(f,2),F=W(P);Se(F,()=>e.fileInfo.parent&&!e.fileInfo.parent.isRoot(),Q=>{var G=Ey(),J=W(G);Pe(J,{iconId:"folder",size:"s",className:"relative top-[3px] mr-0.5"});var U=Y(J,2),ue=W(U,!0);B(U),B(G),ke(()=>Le(ue,e.fileInfo.parent.name)),X(Q,G)});var j=Y(F,2),z=W(j);Pe(z,{iconId:"calendar-clock",size:"s",className:"relative top-[3px] mr-0.5"});var N=Y(z,2),H=W(N,!0);B(N),B(j);var V=Y(j,2);V.__click=[ky,e],B(P),B(l),ke(()=>{_o(p,"aria-label",A(s)),Le(y,e.fileInfo.name),xr(P,(A(r)?"hidden":"")+" mb-4 ml-5 flex flex-col items-start gap-1 text-muted"),Le(H,A(s))}),X(t,l),Me()}ot(["click"]);var Lh=require("obsidian"),Cy=ne("<div></div>");function lf(t,e){Fe(e,!0);let r=xn(e,"className",3,""),n;Ht(()=>{n&&(n.replaceChildren(),new Lh.ProgressBarComponent(n).setValue(e.value))});var s=Cy();Jr(s,l=>n=l,()=>n),ke(()=>xr(s,r())),X(t,s),Me()}var Bh=10,Sy=(t,e)=>e.onRebuildAll(),Ay=(t,e)=>le(e,!A(e)),Py=ne('<button class="clickable-text"> </button>'),Iy=ne('<div><div class="flex items-center justify-between"><div class="mr-1 flex w-full flex-row items-center"><div class="grow text-base font-medium">Workspace sources</div> <!></div> <button class="clickable-icon" aria-label="Re-index all" data-tooltip-delay="300"><!></button></div> <div class="mt-2"><!> <!></div></div>');function cf(t,e){Fe(e,!0);let r=tt(!0),n=xe(()=>A(r)?e.links.slice(0,Bh):e.links);var s=Iy(),l=W(s),f=W(l),p=Y(W(f),2);Se(p,()=>e.indexingProgress<100,$=>{lf($,{get value(){return e.indexingProgress},className:"w-1/4"})}),B(f);var m=Y(f,2);m.__click=[Sy,e];var _=W(m);Pe(_,{iconId:"refresh-cw",size:"s"}),B(m),B(l);var b=Y(l,2),y=W(b);wt(y,17,()=>A(n),$=>$.path,($,P)=>{af($,{get fileInfo(){return A(P)},onLinkClick:F=>e.onLinkClick(F),onLinkRebuild:F=>e.onLinkRebuild(F)})});var x=Y(y,2);Se(x,()=>e.links.length>Bh,$=>{var P=Py();P.__click=[Ay,r];var F=W(P,!0);B(P),ke(()=>Le(F,A(r)?"Show more":"Show fewer")),X($,P)}),B(b),B(s),X(t,s),Me()}ot(["click"]);var Ry=(t,e)=>e.onRegenerate(),Ty=ne('<div class="relative my-4"><span class="text-sm italic text-muted">Thinking</span> <span class="absolute top-1 ml-1"><!></span></div>'),Oy=ne('<div class="mb-6 w-full text-sm text-muted"><p>Workspace is not analyzed yet.</p> <p>Click the regenerate button to get started.</p></div>'),Ny=(t,e,r)=>e.onQuestionSelect(A(r)),Dy=(t,e,r)=>t.key==="Enter"&&e.onQuestionSelect(A(r)),Fy=ne('<div class="min-w-48 max-w-96 basis-1/2 cursor-pointer rounded bg-secondary p-3 hover:bg-hover" role="button" tabindex="0"><div class="flex flex-row"><!> <div class="ml-1 text-sm capitalize text-muted"> </div></div> <div class="mt-1 text-sm"> </div></div>'),My=ne('<div class="grid grid-cols-2 gap-4"></div>'),Ly=ne('<div class="mb-4"><div class="align-center mb-3 mt-4 flex flex-row justify-between"><div class="font-medium">Explore</div> <button class="clickable-icon" aria-label="Regenerate" data-delay="300"><!></button></div> <!></div>');function uf(t,e){Fe(e,!0);var r=Ly(),n=W(r),s=Y(W(n),2);s.__click=[Ry,e];var l=W(s);Pe(l,{iconId:"refresh-cw",size:"s"}),B(s),B(n);var f=Y(n,2);Se(f,()=>e.isLoading,p=>{var m=Ty(),_=Y(W(m),2),b=W(_);ji(b,{size:"m"}),B(_),B(m),X(p,m)},p=>{var m=wr(),_=Ze(m);Se(_,()=>e.questions.length===0,b=>{var y=Oy();X(b,y)},b=>{var y=My();wt(y,21,()=>e.questions,Qr,(x,$)=>{var P=Fy();P.__click=[Ny,e,$],P.__keyup=[Dy,e,$];var F=W(P),j=W(F);Pe(j,{iconId:"help",size:"s"});var z=Y(j,2),N=W(z,!0);B(z),B(F);var H=Y(F,2),V=W(H,!0);B(H),B(P),ke(()=>{Le(N,A($).theme),Le(V,A($).content)}),X(x,P)}),B(y),X(b,y)},!0),X(p,m)}),B(r),X(t,r),Me()}ot(["click","keyup"]);var By=ne('<div slot="empty"><!> <div><div class="font-medium">Configuration</div> <!> <!> <!> <!></div></div>'),Ky=ne("<!> <!> <!>",1),Wy=ne("<div><h4>Not a workspace yet</h4> <p> </p></div>"),jy=ne('<!> <div class="flex h-full w-full flex-col pb-32"><!></div>',1);function ff(t,e){Fe(e,!0);let r=Er(),n=()=>Ve(At,"$appStore",r),s=()=>Ve(y,"$metadata",r),l=()=>Ve(ut,"$settingsStore",r),f=()=>Ve(Fo,"$llmClient",r),p=()=>Ve(J,"$links",r),m=()=>Ve(A(G),"$conversation",r),_=()=>Ve(U,"$workspaceData",r),b=tt(null),y=Ba(n().metadataCache.getFileCache(e.workspaceFile),Te=>{let be=n().metadataCache.on("changed",Oe=>{var Ie;if(Oe===e.workspaceFile){let Ne=n().metadataCache.getFileCache(e.workspaceFile);Te(Ne),le($,qe((Ie=cu(Ne))!==null&&Ie!==void 0?Ie:""))}});return()=>n().metadataCache.offref(be)}),x=xe(()=>Wa(s())),$=tt(null),P=tt(qe(cu(s()))),F=new to(e.db),j=qe({temperature:"balanced",maxTokens:1024}),z=xe(()=>new pa({chunkSize:l().chunkSize,paragraphSeparator:`

`})),N=xe(()=>new ml(l().openAIApiKey)),H=xe(()=>new bl(F,A(N),{limit:l().retrievedNodeCount})),V=xe(()=>new Mo(f(),j,l().systemPrompt,A(P))),Q=xe(()=>new gl(A(H),A(V),e.workspaceFile.path)),G=xe(()=>_l(A(Q),f(),j)),J=Xn(async()=>{let Te=await e.db.workspace.where("workspaceFile").equals(e.workspaceFile.path).first();if(!Te)return console.error("Workspace not found",e.workspaceFile.path),[];let be=[Te.workspaceFile,...Te.links],Ie=(await Promise.all(be.map(async Ne=>e.db.vectorStore.where("node.parent").equals(Ne).toArray()))).flat().reduce((Ne,Xe)=>{let at=Xe.node.parent;if(Ne.has(at))Ne.get(at).nodeCount+=1;else{let $t=n().vault.getFileByPath(at);Ne.set(at,{name:$t.basename,parent:$t.parent,path:at,nodeCount:1,lastProcessed:Xe.node.createdAt})}return Ne},new Map);return be.map(Ne=>{let Xe=Ie.get(Ne);if(Xe)return Xe.path!=Ne&&console.warn(`Mismatch between path of vector store entry and workspace link:
Path from vector store entry: ${Xe.path}
Path from workspace: ${Ne}`),Xe;{let at=n().vault.getFileByPath(Ne);return{name:at.basename,parent:at.parent,path:Ne,nodeCount:0,lastProcessed:void 0}}})}),U=Xn(async()=>e.db.workspace.where("workspaceFile").equals(e.workspaceFile.path).first()),ue=tt(!1),ge=async()=>{le(ue,!0);try{let Te=await Nh(f(),n().vault,p());await e.db.workspace.update(e.workspaceFile.path,{derivedQuestions:Te})}catch(Te){console.error("Failed to build questions",Te)}finally{le(ue,!1)}},$e=async Te=>{A(G).resetConversation(),A(G).submitMessage(Te.content,[])},ye=tt(100),Re=async()=>{let Te=[e.workspaceFile.path];if(e.workspaceFile.path in n().metadataCache.resolvedLinks){let be=n().metadataCache.resolvedLinks[e.workspaceFile.path];for(let Oe of Object.keys(be))Cp(Oe)&&Te.push(Oe)}else Te=[];if(Te.length===0){new Kh.Notice("Workspace has no linked notes");return}try{le(b,null),le(ye,0),await F.deleteFiles(...Te);let be=[];for(let Oe of Te){let Ie=n().vault.getFileByPath(Oe);if(!Ie)continue;let Ne=await n().vault.cachedRead(Ie);for(let Xe of A(z).parse(Ne,Ie.path))be.push(Xe)}for(let Oe=0;Oe<be.length;(Oe+=1)-1){let Ie=be[Oe],Ne=await A(N).embedNode(Ie);await F.addNode(Ie,Ne,e.workspaceFile.path),le(ye,100*(Oe+2)/be.length)}}catch(be){console.error("Failed to rebuild linked files",be),le(b,qe(be))}},je=Te=>{n().workspace.openLinkText(Te,"","tab")},Dt=async Te=>{le(b,null);try{await F.deleteFiles(Te.path);let be=n().vault.getFileByPath(Te.path);if(!be)return;let Oe=await n().vault.cachedRead(be);for(let Ie of A(z).parse(Oe,be.path)){let Ne=await A(N).embedNode(Ie);await F.addNode(Ie,Ne,e.workspaceFile.path)}}catch(be){console.error("Failed to rebuild linked file",be),le(b,qe(be))}},Kr=()=>{kt(),A(G).resetConversation()},kt=()=>{A($)!==null&&(le(P,qe(A($))),le($,null))},Ft=async(Te,be)=>{var Oe=[];for(let Ie of be)try{Oe.push({content:await n().vault.cachedRead(Ie),parent:Ie.path,createdAt:new Date().valueOf()})}catch(Ne){console.error(`Failed to attach file ${Ie.path}`,Ne);continue}A(G).submitMessage(Te,Oe)};var Xt=jy(),Gt=Ze(Xt);Wi(Gt,{});var Zt=Y(Gt,2),pr=W(Zt);Se(pr,()=>A(x),Te=>{var be=Ky(),Oe=Ze(be),Ie=xe(()=>p()||[]);cf(Oe,{get links(){return A(Ie)},get indexingProgress(){return A(ye)},onLinkClick:je,onLinkRebuild:Dt,onRebuildAll:Re});var Ne=Y(Oe,2);Se(Ne,()=>A(b),$t=>{var nn=xe(()=>A(b).toString());Os($t,{get body(){return A(nn)}})});var Xe=Y(Ne,2),at=xe(()=>A($)!==null);Ds(Xe,{get conversation(){return m()},get isOutdated(){return A(at)},onMessageSubmit:Ft,onSourceClick:$t=>je($t),onDebugClick:$t=>wl(n(),$t),onNewConversation:Kr,onReload:kt,$$slots:{empty:($t,nn)=>{var er=By(),Ko=W(er),Vi=xe(()=>_()?.derivedQuestions??[]);uf(Ko,{get questions(){return A(Vi)},get isLoading(){return A(ue)},onRegenerate:ge,onQuestionSelect:async on=>$e(on)});var Wr=Y(Ko,2),zi=Y(W(Wr),2);jn(zi,{iconId:"bot",label:"LLM",get value(){return f().displayName}});var Ls=Y(zi,2);jn(Ls,{iconId:"separator-horizontal",label:"Chunk size",get value(){return`${l().chunkSize??""} characters`}});var ae=Y(Ls,2),Bs=xe(()=>l().retrievedNodeCount.toString());jn(ae,{iconId:"files",label:"Number of chunks in context",get value(){return A(Bs)}});var Cl=Y(ae,2);Ns(Cl,{get temperature(){return j.temperature},onChange:on=>j.temperature=on}),B(Wr),B(er),X($t,er)}}}),X(Te,be)},Te=>{var be=Wy(),Oe=Y(W(be),2),Ie=W(Oe);B(Oe),B(be),ke(()=>Le(Ie,`${e.workspaceFile.basename??""} is not an LLM workspace yet. Update its frontmatter and try
				again.`)),X(Te,be)}),B(Zt),X(t,Xt),Me()}var Fs="llm-workspace-view",El=class extends Wh.ItemView{constructor(r,n,s){super(r);this.viewTitle="LLM Workspace";this.navigation=!1;this.settings=n,this.db=s}getViewType(){return Fs}getDisplayText(){return this.viewTitle}getIcon(){return"sparkles"}async onOpen(){ut.set(this.settings),At.set(this.app),En.set(this),this.addAction("file-input","Open workspace note",()=>{this.filePath&&this.app.workspace.openLinkText(this.filePath,"","tab")})}async onClose(){Yr(this.component)}async setState(r,n){return this.filePath=r.filePath,await this.updateWorkspaceStore(r.filePath),this.createComponent(),super.setState(r,n)}getState(){return{filePath:this.filePath??""}}createComponent(){let r=this.app.vault.getFileByPath(this.filePath??"");if(!r){let n=this.containerEl.children[1];n.empty(),n.createEl("p",{text:`File not found: ${this.filePath}`});return}this.component=Nr(ff,{target:this.contentEl,props:{workspaceFile:r,db:this.db}}),this.viewTitle=`${r.basename} (LLM Workspace)`}async updateWorkspaceStore(r){let n=this.app.vault.getFileByPath(r);if(!n)return;try{await this.app.fileManager.processFrontMatter(n,Sp)}catch(f){console.warn("Failed to add workspace property to frontmatter",f)}if(await this.db.workspace.where("workspaceFile").equals(r).count()==1)return;let l=this.app.metadataCache.getFileCache(n)?.links?.map(f=>this.app.metadataCache.getFirstLinkpathDest(f.link,n.path))?.filter(f=>f!==null)?.map(f=>f.path)?.unique()??[];await this.db.workspace.put({workspaceFile:n.path,links:l,derivedQuestions:[]})}};var jh=require("obsidian");var qy=ne('<div slot="empty"><div class="font-medium">Configuration</div> <!> <!> <!></div>'),Vy=ne('<!> <div class="h-full w-full"><!></div>',1);function df(t,e){Fe(e,!0);let r=Er(),n=()=>Ve(At,"$appStore",r),s=()=>Ve(Fo,"$llmClient",r),l=()=>Ve(ut,"$settingsStore",r),f=()=>Ve(_,"$noteContent",r),p=()=>Ve(A($),"$conversation",r),m=tt(null),_=kr("",G=>{n().vault.cachedRead(e.file).then(U=>{G(U)});let J=n().vault.on("modify",U=>{U.path===e.file.path&&n().vault.cachedRead(e.file).then(ue=>{le(m,qe(ue))})});return()=>n().vault.offref(J)}),b=qe({temperature:"balanced",maxTokens:1024}),y=xe(()=>new Mo(s(),b,l().systemPrompt)),x=xe(()=>new yl(A(y),f(),e.file.path)),$=xe(()=>_l(A(x),s(),b)),P=()=>{F(),A($).resetConversation()},F=()=>{A(m)!==null&&(_.set(A(m)),le(m,null))},j=async(G,J)=>{var U=[];for(let ue of J)try{U.push({content:await n().vault.cachedRead(ue),parent:ue.path,createdAt:new Date().valueOf()})}catch(ge){console.error(`Failed to attach file ${ue.path}`,ge);continue}A($).submitMessage(G,U)};var z=Vy(),N=Ze(z);Wi(N,{});var H=Y(N,2),V=W(H),Q=xe(()=>A(m)!==null);Ds(V,{get conversation(){return p()},get isOutdated(){return A(Q)},onMessageSubmit:j,onNewConversation:P,onDebugClick:G=>wl(n(),G),onSourceClick:()=>{},onReload:F,$$slots:{empty:(G,J)=>{var U=qy(),ue=Y(W(U),2);jn(ue,{iconId:"file-text",label:"Conversation grounded in",get value(){return e.file.basename}});var ge=Y(ue,2);jn(ge,{iconId:"bot",label:"LLM",get value(){return s().displayName}});var $e=Y(ge,2);Ns($e,{get temperature(){return b.temperature},onChange:ye=>b.temperature=ye}),B(U),X(G,U)}}}),B(H),X(t,z),Me()}var Ms="llm-note-chat-view",kl=class extends jh.ItemView{constructor(r,n,s){super(r);this.viewTitle="LLM note chat";this.navigation=!1;this.settings=n,this.db=s}getViewType(){return Ms}getDisplayText(){return this.viewTitle}getIcon(){return"sparkles"}async onOpen(){ut.set(this.settings),At.set(this.app),En.set(this),this.addAction("file-input","Open note",()=>{this.filePath&&this.app.workspace.openLinkText(this.filePath,"","tab")})}async onClose(){Yr(this.component)}async setState(r,n){return this.filePath=r.filePath,this.createComponent(),super.setState(r,n)}getState(){return{filePath:this.filePath??""}}createComponent(){let r=this.app.vault.getFileByPath(this.filePath??"");if(!r){let n=this.containerEl.children[1];n.empty(),n.createEl("p",{text:`File not found: ${this.filePath}`});return}this.component=Nr(df,{target:this.contentEl,props:{file:r}}),this.viewTitle=`${r.basename} (LLM note chat)`}};var pf=Gi(require("node:path")),qh=require("obsidian");async function Vh(t,e,r){let n=(await e.workspace.toArray()).map(l=>l.workspaceFile),s=new hf(t,n,r);s.setPlaceholder("Select a workspace to open"),s.open()}var hf=class extends qh.FuzzySuggestModal{constructor(e,r,n){super(e),this.workspaces=r,this.onSelect=n}getItems(){return this.workspaces}getItemText(e){return pf.default.basename(e,pf.default.extname(e))}onChooseItem(e,r){this.onSelect(e)}};var $l=class extends qi.Plugin{async onload(){await this.loadSettings(),this.db=new _a(this.app.appId??this.app.vault.getName());let e=new to(this.db);this.reconciler=new qa(this.app,this.db,e),this.reconciler.subscribeToChanges(),this.registerViews(),this.addSettingTab(new ma(this.app,this)),this.registerCommands(),this.registerMenuEntries()}onunload(){this.reconciler.unsubscribeFromChanges()}async launchContextView(){let{workspace:e}=this.app,r=null,n=e.getLeavesOfType(Ts);if(n.length>0)r=n[0];else{if(r=e.getRightLeaf(!1),!r)return;await r.setViewState({type:Ts,active:!0})}e.revealLeaf(r)}async launchWorkspaceView(e){let{workspace:r}=this.app,n=null,s=r.getLeavesOfType(Fs);if(s.length>0){let l=s[0].parent;n=r.createLeafInParent(l,s.length)}else n=r.getLeaf("split","vertical");await n.setViewState({type:Fs,active:!0,state:{filePath:e}}),r.revealLeaf(n)}async launchNoteChatView(e){let{workspace:r}=this.app,n=null,s=r.getLeavesOfType(Ms);if(s.length>0){let l=s[0].parent;n=r.createLeafInParent(l,s.length)}else n=r.getLeaf("split","vertical");await n.setViewState({type:Ms,active:!0,state:{filePath:e}}),r.revealLeaf(n)}async loadSettings(){this.settings=Object.assign({},ad,await this.loadData()),ut.set(this.settings)}async saveSettings(){await this.saveData(this.settings),ut.set(this.settings)}registerViews(){this.registerView(Ts,e=>new vl(e,this.settings,this.db,r=>this.launchNoteChatView(r),r=>this.launchWorkspaceView(r))),this.registerView(Fs,e=>new El(e,this.settings,this.db)),this.registerView(Ms,e=>new kl(e,this.settings,this.db))}registerCommands(){this.addCommand({id:"activate-context-view",name:"Open context panel",callback:()=>this.launchContextView()}),this.addCommand({id:"activate-workspace-view",name:"Open active note as LLM workspace",callback:()=>{let e=this.app.workspace.getActiveFile();if(!e){new qi.Notice("Open a note first and try again");return}this.launchWorkspaceView(e.path)}}),this.addCommand({id:"activate-note-chat-view",name:"Chat with active note",callback:()=>{let e=this.app.workspace.getActiveFile();if(!e){new qi.Notice("Open a note first and try again");return}this.launchNoteChatView(e.path)}}),this.addCommand({id:"open-workspace-suggest-modal",name:"Open existing workspace",callback:async()=>{await Vh(this.app,this.db,e=>this.launchWorkspaceView(e))}})}registerMenuEntries(){this.registerEvent(this.app.workspace.on("file-menu",(e,r)=>{r instanceof qi.TFolder||(e.addItem(n=>{n.setTitle("Chat with note"),n.setIcon("message-square"),n.onClick(()=>{this.launchNoteChatView(r.path)})}),e.addItem(n=>{n.setTitle("Open as LLM workspace"),n.setIcon("library-big"),n.onClick(()=>{this.launchWorkspaceView(r.path)})}))}))}};
/*! Bundled license information:

dexie/dist/dexie.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/

/* nosourcemap */